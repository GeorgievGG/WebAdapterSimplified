¨
WC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\BaseProfilerProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

abstract 
class  
BaseProfilerProvider .
:/ 0
IProfilerProvider1 B
{ 
[ 	
Obsolete	 
( 
$str v
)v w
]w x
public 
abstract 
MiniProfiler $
Start% *
(* +
ProfileLevel+ 7
level8 =
,= >
string? E
sessionNameF Q
=R S
nullT X
)X Y
;Y Z
public 
abstract 
MiniProfiler $
Start% *
(* +
string+ 1
sessionName2 =
=> ?
null@ D
)D E
;E F
public 
abstract 
void 
Stop !
(! "
bool" &
discardResults' 5
)5 6
;6 7
public$$ 
abstract$$ 
MiniProfiler$$ $
GetCurrentProfiler$$% 7
($$7 8
)$$8 9
;$$9 :
	protected++ 
static++ 
void++ 
SetProfilerActive++ /
(++/ 0
MiniProfiler++0 <
profiler++= E
)++E F
{,, 	
if-- 
(-- 
profiler-- 
==-- 
null--  
)--  !
throw.. 
new.. !
ArgumentNullException.. /
(../ 0
$str..0 :
)..: ;
;..; <
profiler00 
.00 
IsActive00 
=00 
true00  $
;00$ %
}11 	
	protected88 
static88 
bool88 
StopProfiler88 *
(88* +
MiniProfiler88+ 7
profiler888 @
)88@ A
{99 	
if:: 
(:: 
profiler:: 
==:: 
null::  
)::  !
throw;; 
new;; !
ArgumentNullException;; /
(;;/ 0
$str;;0 :
);;: ;
;;;; <
if== 
(== 
!== 
profiler== 
.== 
StopImpl== "
(==" #
)==# $
)==$ %
return>> 
false>> 
;>> 
profiler@@ 
.@@ 
IsActive@@ 
=@@ 
false@@  %
;@@% &
returnAA 
trueAA 
;AA 
}BB 	
	protectedII 
staticII 
voidII 
SaveProfilerII *
(II* +
MiniProfilerII+ 7
currentII8 ?
)II? @
{JJ 	
varMM 
storageMM 
=MM 
currentMM !
.MM! "
StorageMM" )
;MM) *
ifNN 
(NN 
storageNN 
==NN 
nullNN 
)NN  
{OO 
MiniProfilerPP 
.PP 
SettingsPP %
.PP% &!
EnsureStorageStrategyPP& ;
(PP; <
)PP< =
;PP= >
storageQQ 
=QQ 
MiniProfilerQQ &
.QQ& '
SettingsQQ' /
.QQ/ 0
StorageQQ0 7
;QQ7 8
}RR 
storageSS 
.SS 
SaveSS 
(SS 
currentSS  
)SS  !
;SS! "
ifTT 
(TT 
currentTT 
.TT 
HasUserViewedTT %
==TT& (
falseTT) .
)TT. /
{UU 
storageVV 
.VV 
SetUnviewedVV #
(VV# $
currentVV$ +
.VV+ ,
UserVV, 0
,VV0 1
currentVV2 9
.VV9 :
IdVV: <
)VV< =
;VV= >
}WW 
}XX 	
}YY 
}ZZ ë
PC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\ClientTimings.cs
	namespace		 	
StackExchange		
 
.		 
	Profiling		 !
{

 
[ 
DataContract 
] 
public 

class 
ClientTimings 
{ 
private 
const 
string 
ClientTimingPrefix /
=0 1
$str2 N
;N O
private 
const 
string 
ClientProbesPrefix /
=0 1
$str2 A
;A B
[ 	

DataMember	 
( 
Order 
= 
$num 
) 
] 
public 
List 
< 
ClientTiming  
>  !
Timings" )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
[ 	

DataMember	 
( 
Order 
= 
$num 
) 
] 
public 
int 
RedirectCount  
{! "
get# &
;& '
set( +
;+ ,
}- .
public## 
static## 
ClientTimings## #
FromRequest##$ /
(##/ 0
HttpRequest##0 ;
request##< C
)##C D
{$$ 	
ClientTimings%% 
timing%%  
=%%! "
null%%# '
;%%' (
long&& 
navigationStart&&  
;&&  !
long'' 
.'' 
TryParse'' 
('' 
request'' !
[''! "
ClientTimingPrefix''" 4
+''5 6
$str''7 I
]''I J
,''J K
out''L O
navigationStart''P _
)''_ `
;''` a
if(( 
((( 
navigationStart(( 
>((  !
$num((" #
)((# $
{)) 
var** 
timings** 
=** 
new** !
List**" &
<**& '
ClientTiming**' 3
>**3 4
(**4 5
)**5 6
;**6 7
timing,, 
=,, 
new,, 
ClientTimings,, *
(,,* +
),,+ ,
;,,, -
int.. 
redirectCount.. !
;..! "
int// 
.// 
TryParse// 
(// 
request// $
[//$ %
$str//% S
]//S T
,//T U
out//V Y
redirectCount//Z g
)//g h
;//h i
timing00 
.00 
RedirectCount00 $
=00% &
redirectCount00' 4
;004 5
var22 

clientPerf22 
=22  
new22! $

Dictionary22% /
<22/ 0
string220 6
,226 7
ClientTiming228 D
>22D E
(22E F
)22F G
;22G H
var33 
clientProbes33  
=33! "
new33# &

Dictionary33' 1
<331 2
int332 5
,335 6
ClientTiming337 C
>33C D
(33D E
)33E F
;33F G
foreach55 
(55 
string66 
key66 
in66 !
request77 
.77  
Form77  $
.77$ %
Keys77% )
.77) *
Cast77* .
<77. /
string77/ 5
>775 6
(776 7
)777 8
.88  
OrderBy88  '
(88' (
i88( )
=>88* ,
i88- .
.88. /
IndexOf88/ 6
(886 7
$str887 ?
,88? @
StringComparison88A Q
.88Q R
Ordinal88R Y
)88Y Z
>88[ \
$num88] ^
?88_ `
$str88a d
+88e f
i88g h
:88i j
i88k l
)88l m
)88m n
{99 
if:: 
(:: 
key:: 
.:: 

StartsWith:: &
(::& '
ClientTimingPrefix::' 9
)::9 :
)::: ;
{;; 
long<< 
val<<  
;<<  !
long== 
.== 
TryParse== %
(==% &
request==& -
[==- .
key==. 1
]==1 2
,==2 3
out==4 7
val==8 ;
)==; <
;==< =
val>> 
-=>> 
navigationStart>> .
;>>. /
string@@ 

parsedName@@ )
=@@* +
key@@, /
.@@/ 0
	Substring@@0 9
(@@9 :
ClientTimingPrefixAA .
.AA. /
LengthAA/ 5
,AA5 6
(AA7 8
keyAA8 ;
.AA; <
LengthAA< B
-AAC D
$numAAE F
)AAF G
-AAH I
ClientTimingPrefixAAJ \
.AA\ ]
LengthAA] c
)AAc d
;AAd e
ifDD 
(DD 
valDD 
>DD  !
$numDD" #
)DD# $
{EE 
ifFF 
(FF  

parsedNameFF  *
.FF* +
EndsWithFF+ 3
(FF3 4
$strFF4 ;
)FF; <
)FF< =
{GG 
varHH  #
	shortNameHH$ -
=HH. /

parsedNameHH0 :
.HH: ;
	SubstringHH; D
(HHD E
$numHHE F
,HHF G

parsedNameHHH R
.HHR S
LengthHHS Y
-HHZ [
$numHH\ ]
)HH] ^
;HH^ _

clientPerfII  *
[II* +
	shortNameII+ 4
]II4 5
=II6 7
newII8 ;
ClientTimingII< H
{JJ< =
DurationKK@ H
=KKI J
-KKK L
$numKKL M
,KKM N
NameLL@ D
=LLE F

parsedNameLLG Q
,LLQ R
StartMM@ E
=MMF G
valMMH K
}NN< =
;NN= >
}OO 
elsePP  
ifPP! #
(PP$ %

parsedNamePP% /
.PP/ 0
EndsWithPP0 8
(PP8 9
$strPP9 >
)PP> ?
)PP? @
{QQ 
varRR  #
	shortNameRR$ -
=RR. /

parsedNameRR0 :
.RR: ;
	SubstringRR; D
(RRD E
$numRRE F
,RRF G

parsedNameRRH R
.RRR S
LengthRRS Y
-RRZ [
$numRR\ ]
)RR] ^
;RR^ _
ClientTimingSS  ,
tSS- .
;SS. /
ifTT  "
(TT# $

clientPerfTT$ .
.TT. /
TryGetValueTT/ :
(TT: ;
	shortNameTT; D
,TTD E
outTTF I
tTTJ K
)TTK L
)TTL M
{UU  !
tVV$ %
.VV% &
DurationVV& .
=VV/ 0
valVV1 4
-VV5 6
tVV7 8
.VV8 9
StartVV9 >
;VV> ?
tWW$ %
.WW% &
NameWW& *
=WW+ ,
	shortNameWW- 6
;WW6 7
}XX  !
}YY 
elseZZ  
{[[ 

clientPerf\\  *
[\\* +

parsedName\\+ 5
]\\5 6
=\\7 8
new\\9 <
ClientTiming\\= I
{\\J K
Name\\L P
=\\Q R

parsedName\\S ]
,\\] ^
Start\\_ d
=\\e f
val\\g j
,\\j k
Duration\\l t
=\\u v
-\\w x
$num\\x y
}\\z {
;\\{ |
}]] 
}^^ 
}__ 
ifaa 
(aa 
keyaa 
.aa 

StartsWithaa &
(aa& '
ClientProbesPrefixaa' 9
)aa9 :
)aa: ;
{bb 
intcc 
probeIdcc #
;cc# $
ifdd 
(dd 
keydd 
.dd  
IndexOfdd  '
(dd' (
$strdd( +
,dd+ ,
StringComparisondd- =
.dd= >
Ordinaldd> E
)ddE F
>ddG H
$numddI J
&&ddK M
intddN Q
.ddQ R
TryParseddR Z
(ddZ [
keydd[ ^
.dd^ _
	Substringdd_ h
(ddh i
ClientProbesPrefixddi {
.dd{ |
Length	dd| Ç
,
ddÇ É
key
ddÑ á
.
ddá à
IndexOf
ddà è
(
ddè ê
$str
ddê ì
,
ddì î
StringComparison
ddï •
.
dd• ¶
Ordinal
dd¶ ≠
)
dd≠ Æ
-
ddØ ∞ 
ClientProbesPrefix
dd± √
.
dd√ ƒ
Length
ddƒ  
)
dd  À
,
ddÀ Ã
out
ddÕ –
probeId
dd— ÿ
)
ddÿ Ÿ
)
ddŸ ⁄
{ee 
ClientTimingff (
tff) *
;ff* +
ifgg 
(gg  
!gg  !
clientProbesgg! -
.gg- .
TryGetValuegg. 9
(gg9 :
probeIdgg: A
,ggA B
outggC F
tggG H
)ggH I
)ggI J
{hh 
tii  !
=ii" #
newii$ '
ClientTimingii( 4
(ii4 5
)ii5 6
;ii6 7
clientProbesjj  ,
.jj, -
Addjj- 0
(jj0 1
probeIdjj1 8
,jj8 9
tjj: ;
)jj; <
;jj< =
}kk 
ifmm 
(mm  
keymm  #
.mm# $
EndsWithmm$ ,
(mm, -
$strmm- 2
)mm2 3
)mm3 4
{nn 
too  !
.oo! "
Nameoo" &
=oo' (
requestoo) 0
[oo0 1
keyoo1 4
]oo4 5
;oo5 6
}pp 
ifrr 
(rr  
keyrr  #
.rr# $
EndsWithrr$ ,
(rr, -
$strrr- 2
)rr2 3
)rr3 4
{ss 
longtt  $
valtt% (
;tt( )
longuu  $
.uu$ %
TryParseuu% -
(uu- .
requestuu. 5
[uu5 6
keyuu6 9
]uu9 :
,uu: ;
outuu< ?
valuu@ C
)uuC D
;uuD E
ifvv  "
(vv# $
valvv$ '
>vv( )
$numvv* +
)vv+ ,
{ww  !
txx$ %
.xx% &
Startxx& +
=xx, -
valxx. 1
-xx2 3
navigationStartxx4 C
;xxC D
}yy  !
}zz 
}{{ 
}|| 
}}} 
foreach 
( 
var 
group "
in# %
clientProbes& 2
.
ÄÄ 
Values
ÄÄ !
.
ÄÄ! "
OrderBy
ÄÄ" )
(
ÄÄ) *
p
ÄÄ* +
=>
ÄÄ, .
p
ÄÄ/ 0
.
ÄÄ0 1
Name
ÄÄ1 5
)
ÄÄ5 6
.
ÅÅ 
GroupBy
ÅÅ "
(
ÅÅ" #
p
ÅÅ# $
=>
ÅÅ% '
p
ÅÅ( )
.
ÅÅ) *
Name
ÅÅ* .
)
ÅÅ. /
)
ÅÅ/ 0
{
ÇÇ 
ClientTiming
ÉÉ  
current
ÉÉ! (
=
ÉÉ) *
null
ÉÉ+ /
;
ÉÉ/ 0
foreach
ÑÑ 
(
ÑÑ 
var
ÑÑ  
item
ÑÑ! %
in
ÑÑ& (
group
ÑÑ) .
)
ÑÑ. /
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
current
ÜÜ #
==
ÜÜ$ &
null
ÜÜ' +
)
ÜÜ+ ,
{
áá 
current
àà #
=
àà$ %
item
àà& *
;
àà* +
}
ââ 
else
ää 
{
ãã 
current
åå #
.
åå# $
Duration
åå$ ,
=
åå- .
item
åå/ 3
.
åå3 4
Start
åå4 9
-
åå: ;
current
åå< C
.
ååC D
Start
ååD I
;
ååI J
timings
çç #
.
çç# $
Add
çç$ '
(
çç' (
current
çç( /
)
çç/ 0
;
çç0 1
current
éé #
=
éé$ %
null
éé& *
;
éé* +
}
èè 
}
êê 
}
ëë 
foreach
ìì 
(
ìì 
var
ìì 
item
ìì !
in
ìì" $

clientPerf
ìì% /
.
ìì/ 0
Values
ìì0 6
)
ìì6 7
{
îî 
item
ïï 
.
ïï 
Name
ïï 
=
ïï 
SentenceCase
ïï  ,
(
ïï, -
item
ïï- 1
.
ïï1 2
Name
ïï2 6
)
ïï6 7
;
ïï7 8
}
ññ 
timings
òò 
.
òò 
AddRange
òò  
(
òò  !

clientPerf
òò! +
.
òò+ ,
Values
òò, 2
)
òò2 3
;
òò3 4
timing
ôô 
.
ôô 
Timings
ôô 
=
ôô  
timings
ôô! (
.
ôô( )
OrderBy
ôô) 0
(
ôô0 1
t
ôô1 2
=>
ôô3 5
t
ôô6 7
.
ôô7 8
Start
ôô8 =
)
ôô= >
.
ôô> ?
ToList
ôô? E
(
ôôE F
)
ôôF G
;
ôôG H
}
öö 
return
úú 
timing
úú 
;
úú 
}
ùù 	
private
üü 
static
üü 
string
üü 
SentenceCase
üü *
(
üü* +
string
üü+ 1
value
üü2 7
)
üü7 8
{
†† 	
var
°° 
sb
°° 
=
°° 
new
°° 
StringBuilder
°° &
(
°°& '
)
°°' (
;
°°( )
for
¢¢ 
(
¢¢ 
int
¢¢ 
i
¢¢ 
=
¢¢ 
$num
¢¢ 
;
¢¢ 
i
¢¢ 
<
¢¢ 
value
¢¢  %
.
¢¢% &
Length
¢¢& ,
;
¢¢, -
i
¢¢. /
++
¢¢/ 1
)
¢¢1 2
{
££ 
if
§§ 
(
§§ 
i
§§ 
==
§§ 
$num
§§ 
)
§§ 
{
•• 
sb
¶¶ 
.
¶¶ 
Append
¶¶ 
(
¶¶ 
char
¶¶ "
.
¶¶" #
ToUpper
¶¶# *
(
¶¶* +
value
¶¶+ 0
[
¶¶0 1
$num
¶¶1 2
]
¶¶2 3
)
¶¶3 4
)
¶¶4 5
;
¶¶5 6
continue
ßß 
;
ßß 
}
®® 
if
™™ 
(
™™ 
value
™™ 
[
™™ 
i
™™ 
]
™™ 
==
™™ 
char
™™  $
.
™™$ %
ToUpper
™™% ,
(
™™, -
value
™™- 2
[
™™2 3
i
™™3 4
]
™™4 5
)
™™5 6
)
™™6 7
{
´´ 
sb
¨¨ 
.
¨¨ 
Append
¨¨ 
(
¨¨ 
$char
¨¨ !
)
¨¨! "
;
¨¨" #
}
≠≠ 
sb
ØØ 
.
ØØ 
Append
ØØ 
(
ØØ 
value
ØØ 
[
ØØ  
i
ØØ  !
]
ØØ! "
)
ØØ" #
;
ØØ# $
}
∞∞ 
return
≤≤ 
sb
≤≤ 
.
≤≤ 
ToString
≤≤ 
(
≤≤ 
)
≤≤  
;
≤≤  !
}
≥≥ 	
[
∏∏ 	
DataContract
∏∏	 
]
∏∏ 
public
ππ 
class
ππ 
ClientTiming
ππ !
{
∫∫ 	
[
ææ 

DataMember
ææ 
(
ææ 
Order
ææ 
=
ææ 
$num
ææ  !
)
ææ! "
]
ææ" #
public
øø 
string
øø 
Name
øø 
{
øø  
get
øø! $
;
øø$ %
set
øø& )
;
øø) *
}
øø+ ,
[
ƒƒ 

DataMember
ƒƒ 
(
ƒƒ 
Order
ƒƒ 
=
ƒƒ 
$num
ƒƒ  !
)
ƒƒ! "
]
ƒƒ" #
public
≈≈ 
decimal
≈≈ 
Start
≈≈  
{
≈≈! "
get
≈≈# &
;
≈≈& '
set
≈≈( +
;
≈≈+ ,
}
≈≈- .
[
   

DataMember
   
(
   
Order
   
=
   
$num
    !
)
  ! "
]
  " #
public
ÀÀ 
decimal
ÀÀ 
Duration
ÀÀ #
{
ÀÀ$ %
get
ÀÀ& )
;
ÀÀ) *
set
ÀÀ+ .
;
ÀÀ. /
}
ÀÀ0 1
[
—— 
ScriptIgnore
—— 
]
—— 
public
““ 
Guid
““ 
Id
““ 
{
““ 
get
““  
;
““  !
set
““" %
;
““% &
}
““' (
[
ÿÿ 
ScriptIgnore
ÿÿ 
]
ÿÿ 
public
ŸŸ 
Guid
ŸŸ 
MiniProfilerId
ŸŸ &
{
ŸŸ' (
get
ŸŸ) ,
;
ŸŸ, -
set
ŸŸ. 1
;
ŸŸ1 2
}
ŸŸ3 4
}
⁄⁄ 	
}
€€ 
}‹‹ Ç4
OC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\CustomTiming.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
[

 
DataContract

 
]

 
public 

class 
CustomTiming 
: 
IDisposable  +
{ 
private 
readonly 
decimal  
?  !

_minSaveMs" ,
;, -
[ 	
Obsolete	 
( 
$str *
)* +
]+ ,
public 
CustomTiming 
( 
) 
{ 	
} 	
public 
CustomTiming 
( 
MiniProfiler (
profiler) 1
,1 2
string3 9
commandString: G
,G H
decimalI P
?P Q
	minSaveMsR [
=\ ]
null^ b
)b c
{ 	
	_profiler 
= 
profiler  
;  !
_startTicks 
= 
profiler "
." #
ElapsedTicks# /
;/ 0

_minSaveMs 
= 
	minSaveMs "
;" #
CommandString   
=   
commandString   )
;  ) *
Id"" 
="" 
Guid"" 
."" 
NewGuid"" 
("" 
)"" 
;""  
StartMilliseconds## 
=## 
profiler##  (
.##( )"
GetRoundedMilliseconds##) ?
(##? @
profiler##@ H
.##H I
ElapsedTicks##I U
)##U V
;##V W
if%% 
(%% 
!%% 
MiniProfiler%% 
.%% 
Settings%% &
.%%& '5
)ExcludeStackTraceSnippetFromCustomTimings%%' P
)%%P Q
{&& 
StackTraceSnippet'' !
=''" #
Helpers''$ +
.''+ ,
StackTraceSnippet'', =
.''= >
Get''> A
(''A B
)''B C
;''C D
}(( 
})) 	
private++ 
readonly++ 
MiniProfiler++ %
	_profiler++& /
;++/ 0
private,, 
readonly,, 
long,, 
_startTicks,, )
;,,) *
[11 	

DataMember11	 
(11 
Order11 
=11 
$num11 
)11 
]11 
public22 
Guid22 
Id22 
{22 
get22 
;22 
set22 !
;22! "
}22# $
[77 	

DataMember77	 
(77 
Order77 
=77 
$num77 
)77 
]77 
public88 
string88 
CommandString88 #
{88$ %
get88& )
;88) *
set88+ .
;88. /
}880 1
[>> 	

DataMember>>	 
(>> 
Order>> 
=>> 
$num>> 
)>> 
]>> 
public?? 
string?? 
ExecuteType?? !
{??" #
get??$ '
;??' (
set??) ,
;??, -
}??. /
[DD 	

DataMemberDD	 
(DD 
OrderDD 
=DD 
$numDD 
)DD 
]DD 
publicEE 
stringEE 
StackTraceSnippetEE '
{EE( )
getEE* -
;EE- .
setEE/ 2
;EE2 3
}EE4 5
[JJ 	

DataMemberJJ	 
(JJ 
OrderJJ 
=JJ 
$numJJ 
)JJ 
]JJ 
publicKK 
decimalKK 
StartMillisecondsKK (
{KK) *
getKK+ .
;KK. /
setKK0 3
;KK3 4
}KK5 6
[PP 	

DataMemberPP	 
(PP 
OrderPP 
=PP 
$numPP 
)PP 
]PP 
publicQQ 
decimalQQ 
?QQ  
DurationMillisecondsQQ ,
{QQ- .
getQQ/ 2
;QQ2 3
setQQ4 7
;QQ7 8
}QQ9 :
[WW 	

DataMemberWW	 
(WW 
OrderWW 
=WW 
$numWW 
)WW 
]WW 
publicXX 
decimalXX 
?XX *
FirstFetchDurationMillisecondsXX 6
{XX7 8
getXX9 <
;XX< =
setXX> A
;XXA B
}XXC D
internalZZ 
stringZZ 
CategoryZZ  
{ZZ! "
getZZ# &
;ZZ& '
setZZ( +
;ZZ+ ,
}ZZ- .
public`` 
void`` 
FirstFetchCompleted`` '
(``' (
)``( )
{aa 	
ifbb 
(bb *
FirstFetchDurationMillisecondsbb .
==bb/ 1
nullbb2 6
)bb6 7
{cc *
FirstFetchDurationMillisecondsdd .
=dd/ 0
	_profilerdd1 :
.dd: ;#
GetDurationMillisecondsdd; R
(ddR S
_startTicksddS ^
)dd^ _
;dd_ `
}ee 
}ff 	
publickk 
voidkk 
Stopkk 
(kk 
)kk 
{ll 	
ifmm 
(mm  
DurationMillisecondsmm $
==mm% '
nullmm( ,
)mm, -
{nn  
DurationMillisecondsoo $
=oo% &
	_profileroo' 0
.oo0 1#
GetDurationMillisecondsoo1 H
(ooH I
_startTicksooI T
)ooT U
;ooU V
}pp 
ifrr 
(rr 

_minSaveMsrr 
.rr 
HasValuerr #
&&rr$ &

_minSaveMsrr' 1
.rr1 2
Valuerr2 7
>rr8 9
$numrr: ;
)rr; <
{ss 
iftt 
(tt  
DurationMillisecondstt (
<tt) *

_minSaveMstt+ 5
.tt5 6
Valuett6 ;
)tt; <
{uu 
	_profilervv 
.vv 
Headvv "
.vv" #
RemoveCustomTimingvv# 5
(vv5 6
Categoryvv6 >
,vv> ?
thisvv@ D
)vvD E
;vvE F
}ww 
}xx 
}yy 	
void{{ 
IDisposable{{ 
.{{ 
Dispose{{  
({{  !
){{! "
{|| 	
Stop}} 
(}} 
)}} 
;}} 
}~~ 	
public
ÉÉ 
override
ÉÉ 
string
ÉÉ 
ToString
ÉÉ '
(
ÉÉ' (
)
ÉÉ( )
{
ÑÑ 	
return
ÖÖ 
CommandString
ÖÖ  
;
ÖÖ  !
}
ÜÜ 	
}
áá 
}àà Á.
VC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\Compression.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
{ 
internal 	
static
 
class 
Compression "
{		 
public

 
static

	 
void

 0
$EncodeStreamAndAppendResponseHeaders

 9
(

9 :
HttpRequest

: E
request

F M
,

M N
HttpResponse

O [
response

\ d
)

d e
{ 
var 
encoding 
= 
request 
. 
Headers !
[! "
$str" 3
]3 4
;4 50
$EncodeStreamAndAppendResponseHeaders '
(' (
response( 0
,0 1
encoding2 :
): ;
;; <
} 
public 
static	 
void 0
$EncodeStreamAndAppendResponseHeaders 9
(9 :
HttpResponse: F
responseG O
,O P
stringQ W
acceptEncodingX f
)f g
{ 
if 
( 
acceptEncoding 
== 
null 
) 
return %
;% &
var 
preferredEncoding 
= "
ParsePreferredEncoding 1
(1 2
acceptEncoding2 @
)@ A
;A B
if 
( 
preferredEncoding 
== 
null  
)  !
return" (
;( )
response 
. 
AppendHeader 
( 
$str +
,+ ,
preferredEncoding- >
)> ?
;? @
response 
. 
AppendHeader 
( 
$str 
,  
$str! 2
)2 3
;3 4
if 
( 
preferredEncoding 
== 
$str %
)% &
{ 
response 
. 
Filter 
= 
new 
DeflateStream '
(' (
response( 0
.0 1
Filter1 7
,7 8
CompressionMode9 H
.H I
CompressI Q
,Q R
trueS W
)W X
;X Y
} 
if 
( 
preferredEncoding 
== 
$str "
)" #
{ 
response 
. 
Filter 
= 
new 

GZipStream $
($ %
response% -
.- .
Filter. 4
,4 5
CompressionMode6 E
.E F
CompressF N
,N O
trueP T
)T U
;U V
}   
}!! 
static## 
readonly##	 
string## 
[## 
]## 
AllowedEncodings## +
=##, -
new##. 1
[##1 2
]##2 3
{##4 5
$str##6 <
,##< =
$str##> G
}##H I
;##I J
static%% 
string%%	 "
ParsePreferredEncoding%% &
(%%& '
string%%' -
acceptEncoding%%. <
)%%< =
{&& 
return'' 	
acceptEncoding''
 
.(( 
Split(( 

(((
 
new(( 
[(( 
](( 
{(( 
$char(( 
}(( 
,(( 
StringSplitOptions(( ,
.((, -
RemoveEmptyEntries((- ?
)((? @
.)) 
Select)) 
()) 
type)) 
=>)) 
type)) 
.)) 
Split)) 
()) 
$char)) "
)))" #
)))# $
.** 
Select** 
(** 
parts** 
=>** 
new** 
{++ 
encoding,, 
=,, 
parts,, 
[,, 
$num,, 
],, 
.,, 
Trim,, 
(,, 
),, 
,,,  
qvalue-- 
=-- -
!ParseQValueFromSecondArrayElement-- /
(--/ 0
parts--0 5
)--5 6
}.. 
).. 
.// 
Where// 

(//
 
x// 
=>// 
AllowedEncodings//  
.//  !
Contains//! )
(//) *
x//* +
.//+ ,
encoding//, 4
)//4 5
)//5 6
.00 
OrderByDescending00 
(00 
x00 
=>00 
x00 
.00 
qvalue00 $
)00$ %
.11 
Select11 
(11 
x11 
=>11 
x11 
.11 
encoding11 
)11 
.22 
FirstOrDefault22 
(22 
)22 
;22 
}33 
static55 
float55	 -
!ParseQValueFromSecondArrayElement55 0
(550 1
string551 7
[557 8
]558 9
parts55: ?
)55? @
{66 
const77 
float77	 
defaultQValue77 
=77 
$num77 !
;77! "
if88 
(88 
parts88 
.88 
Length88 
<88 
$num88 
)88 
return88 
defaultQValue88  -
;88- .
float:: 
qvalue::	 
;:: 
return;; 	
float;;
 
.;; 
TryParse;; 
(;; 
parts;; 
[;; 
$num;;  
];;  !
.;;! "
Trim;;" &
(;;& '
);;' (
,;;( )
out;;* -
qvalue;;. 4
);;4 5
?;;6 7
qvalue;;8 >
:;;? @
defaultQValue;;A N
;;;N O
}<< 
}== 
}>> Ù≠
VC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\MiniProfilerHandler.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

class 
MiniProfilerHandler $
:% &
IRouteHandler' 4
,4 5
IHttpHandler6 B
{ 
private 
static 
readonly  
ConcurrentDictionary  4
<4 5
string5 ;
,; <
string= C
>C D
ResourceCacheE R
=S T
newU X 
ConcurrentDictionaryY m
<m n
stringn t
,t u
stringv |
>| }
(} ~
)~ 
;	 Ä
public 
bool 

IsReusable 
{ 	
get 
{ 
return 
true 
; 
}  
} 	
public$$ 
static$$ 
void$$ 
RegisterRoutes$$ )
($$) *
)$$* +
{%% 	
var&& 
routes&& 
=&& 

RouteTable&& #
.&&# $
Routes&&$ *
;&&* +
var'' 
handler'' 
='' 
new'' 
MiniProfilerHandler'' 1
(''1 2
)''2 3
;''3 4
var(( 
prefix(( 
=(( 
MiniProfiler(( %
.((% &
Settings((& .
.((. /
RouteBasePath((/ <
.((< =
Replace((= D
(((D E
$str((E I
,((I J
string((K Q
.((Q R
Empty((R W
)((W X
.((X Y
EnsureTrailingSlash((Y l
(((l m
)((m n
;((n o
using** 
(** 
routes** 
.** 
GetWriteLock** &
(**& '
)**' (
)**( )
{++ 
var,, 
route,, 
=,, 
new,, 
Route,,  %
(,,% &
prefix,,& ,
+,,- .
$str,,/ ;
,,,; <
handler,,= D
),,D E
{-- 
Defaults// 
=// 
new// " 
RouteValueDictionary//# 7
(//7 8
new//8 ;
{//< =

controller//> H
=//I J
$str//K `
,//` a
action//b h
=//i j
$str//k {
}//| }
)//} ~
,//~ 
Constraints00 
=00  !
new00" % 
RouteValueDictionary00& :
(00: ;
new00; >
{00? @

controller00A K
=00L M
$str00N c
,00c d
action00e k
=00l m
$str00n ~
}	00 Ä
)
00Ä Å
}11 
;11 
routes44 
.44 
Insert44 
(44 
$num44 
,44  
route44! &
)44& '
;44' (
}55 
}66 	
IHttpHandler;; 
IRouteHandler;; "
.;;" #
GetHttpHandler;;# 1
(;;1 2
RequestContext;;2 @
requestContext;;A O
);;O P
{<< 	
return== 
this== 
;== 
}>> 	
publicCC 
voidCC 
ProcessRequestCC "
(CC" #
HttpContextCC# .
contextCC/ 6
)CC6 7
{DD 	
stringEE 
outputEE 
;EE 
stringFF 
pathFF 
=FF 
contextFF !
.FF! "
RequestFF" )
.FF) */
#AppRelativeCurrentExecutionFilePathFF* M
;FFM N
switchHH 
(HH 
PathHH 
.HH '
GetFileNameWithoutExtensionHH 4
(HH4 5
pathHH5 9
)HH9 :
.HH: ;
ToLowerInvariantHH; K
(HHK L
)HHL M
)HHM N
{II 
caseJJ 
$strJJ !
:JJ! "
caseKK 
$strKK #
:KK# $
caseLL 
$strLL "
:LL" #
caseMM 
$strMM 
:MM 
outputNN 
=NN 
IncludesNN %
(NN% &
contextNN& -
,NN- .
pathNN/ 3
)NN3 4
;NN4 5
breakOO 
;OO 
casePP 
$strPP 
:PP  
outputQQ 
=QQ 
IncludesQQ %
(QQ% &
contextQQ& -
,QQ- .
pathQQ/ 3
)QQ3 4
;QQ4 5
breakRR 
;RR 
caseTT 
$strTT $
:TT$ %
outputUU 
=UU 
IndexUU "
(UU" #
contextUU# *
)UU* +
;UU+ ,
breakVV 
;VV 
caseXX 
$strXX #
:XX# $
outputYY 
=YY 
GetListJsonYY (
(YY( )
contextYY) 0
)YY0 1
;YY1 2
breakZZ 
;ZZ 
case\\ 
$str\\ 
:\\ 
output]] 
=]] #
GetSingleProfilerResult]] 4
(]]4 5
context]]5 <
)]]< =
;]]= >
break^^ 
;^^ 
default`` 
:`` 
outputaa 
=aa 
NotFoundaa %
(aa% &
contextaa& -
)aa- .
;aa. /
breakbb 
;bb 
}cc 
ifee 
(ee 
MiniProfileree 
.ee 
Settingsee %
.ee% &
EnableCompressionee& 7
&&ee8 :
!ee; <
stringee< B
.eeB C
IsNullOrEmptyeeC P
(eeP Q
outputeeQ W
)eeW X
)eeX Y
{ff 
Compressiongg 
.gg 0
$EncodeStreamAndAppendResponseHeadersgg @
(gg@ A
contextggA H
.ggH I
RequestggI P
,ggP Q
contextggR Y
.ggY Z
ResponseggZ b
)ggb c
;ggc d
}hh 
contextjj 
.jj 
Responsejj 
.jj 
Writejj "
(jj" #
outputjj# )
)jj) *
;jj* +
}kk 	
internalpp 
staticpp 

HtmlStringpp "
RenderIncludespp# 1
(pp1 2
MiniProfilerqq 
profilerqq !
,qq! "
RenderPositionrr 
?rr 
positionrr $
=rr% &
nullrr' +
,rr+ ,
boolss 
?ss 
showTrivialss 
=ss 
nullss  $
,ss$ %
booltt 
?tt  
showTimeWithChildrentt &
=tt' (
nulltt) -
,tt- .
intuu 
?uu 
maxTracesToShowuu  
=uu! "
nulluu# '
,uu' (
boolvv 
?vv 
showControlsvv 
=vv  
nullvv! %
,vv% &
boolww 
?ww 
startHiddenww 
=ww 
nullww  $
)ww$ %
{xx 	
ifyy 
(yy 
profileryy 
==yy 
nullyy  
)yy  !
returnyy" (
newyy) ,

HtmlStringyy- 7
(yy7 8
$stryy8 :
)yy: ;
;yy; <
MiniProfiler{{ 
.{{ 
Settings{{ !
.{{! "!
EnsureStorageStrategy{{" 7
({{7 8
){{8 9
;{{9 :
var|| 

authorized|| 
=|| 
MiniProfiler|| )
.||) *
Settings||* 2
.||2 3
Results_Authorize||3 D
==||E G
null||H L
||}} 
MiniProfiler}} 
.}}  
Settings}}  (
.}}( )
Results_Authorize}}) :
(}}: ;
HttpContext}}; F
.}}F G
Current}}G N
.}}N O
Request}}O V
)}}V W
;}}W X
var
ÅÅ 
ids
ÅÅ 
=
ÅÅ 

authorized
ÅÅ  
?
ÅÅ! "
MiniProfiler
ÅÅ# /
.
ÅÅ/ 0
Settings
ÅÅ0 8
.
ÅÅ8 9
Storage
ÅÅ9 @
.
ÅÅ@ A
GetUnviewedIds
ÅÅA O
(
ÅÅO P
profiler
ÅÅP X
.
ÅÅX Y
User
ÅÅY ]
)
ÅÅ] ^
:
ÅÅ_ `
new
ÅÅa d
List
ÅÅe i
<
ÅÅi j
Guid
ÅÅj n
>
ÅÅn o
(
ÅÅo p
)
ÅÅp q
;
ÅÅq r
ids
ÇÇ 
.
ÇÇ 
Add
ÇÇ 
(
ÇÇ 
profiler
ÇÇ 
.
ÇÇ 
Id
ÇÇ 
)
ÇÇ  
;
ÇÇ  !
string
ÑÑ 
format
ÑÑ 
;
ÑÑ 
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 
TryGetResource
ÖÖ 
(
ÖÖ  
$str
ÖÖ  6
,
ÖÖ6 7
out
ÖÖ8 ;
format
ÖÖ< B
)
ÖÖB C
)
ÖÖC D
{
ÜÜ 
return
áá 
(
áá 
new
áá 

HtmlString
áá &
(
áá& '
$str
áá' W
)
ááW X
)
ááX Y
;
ááY Z
}
àà 
return
ää 
new
ää 

HtmlString
ää !
(
ää! "
format
ää" (
.
ää( )
Format
ää) /
(
ää/ 0
new
ää0 3
{
ãã 
path
åå 
=
åå  
VirtualPathUtility
åå )
.
åå) *

ToAbsolute
åå* 4
(
åå4 5
MiniProfiler
åå5 A
.
ååA B
Settings
ååB J
.
ååJ K
RouteBasePath
ååK X
)
ååX Y
.
ååY Z!
EnsureTrailingSlash
ååZ m
(
ååm n
)
åån o
,
ååo p
version
çç 
=
çç 
MiniProfiler
çç &
.
çç& '
Settings
çç' /
.
çç/ 0
Version
çç0 7
,
çç7 8
	currentId
éé 
=
éé 
profiler
éé $
.
éé$ %
Id
éé% '
,
éé' (
ids
èè 
=
èè 
string
èè 
.
èè 
Join
èè !
(
èè! "
$str
èè" %
,
èè% &
ids
èè' *
.
èè* +
Select
èè+ 1
(
èè1 2
guid
èè2 6
=>
èè7 9
guid
èè: >
.
èè> ?
ToString
èè? G
(
èèG H
)
èèH I
)
èèI J
)
èèJ K
,
èèK L
position
êê 
=
êê 
(
êê 
position
êê $
??
êê% '
MiniProfiler
êê( 4
.
êê4 5
Settings
êê5 =
.
êê= >!
PopupRenderPosition
êê> Q
)
êêQ R
.
êêR S
ToString
êêS [
(
êê[ \
)
êê\ ]
.
êê] ^
ToLower
êê^ e
(
êêe f
)
êêf g
,
êêg h
showTrivial
ëë 
=
ëë 
(
ëë 
showTrivial
ëë *
??
ëë+ -
MiniProfiler
ëë. :
.
ëë: ;
Settings
ëë; C
.
ëëC D
PopupShowTrivial
ëëD T
)
ëëT U
.
ëëU V
ToJs
ëëV Z
(
ëëZ [
)
ëë[ \
,
ëë\ ]
showChildren
íí 
=
íí 
(
íí  "
showTimeWithChildren
íí  4
??
íí5 7
MiniProfiler
íí8 D
.
ííD E
Settings
ííE M
.
ííM N'
PopupShowTimeWithChildren
ííN g
)
ííg h
.
ííh i
ToJs
ííi m
(
íím n
)
íín o
,
íío p
maxTracesToShow
ìì 
=
ìì  !
maxTracesToShow
ìì" 1
??
ìì2 4
MiniProfiler
ìì5 A
.
ììA B
Settings
ììB J
.
ììJ K"
PopupMaxTracesToShow
ììK _
,
ìì_ `
showControls
îî 
=
îî 
(
îî  
showControls
îî  ,
??
îî- /
MiniProfiler
îî0 <
.
îî< =
Settings
îî= E
.
îîE F
ShowControls
îîF R
)
îîR S
.
îîS T
ToJs
îîT X
(
îîX Y
)
îîY Z
,
îîZ [

authorized
ïï 
=
ïï 

authorized
ïï '
.
ïï' (
ToJs
ïï( ,
(
ïï, -
)
ïï- .
,
ïï. /
toggleShortcut
ññ 
=
ññ  
MiniProfiler
ññ! -
.
ññ- .
Settings
ññ. 6
.
ññ6 7)
PopupToggleKeyboardShortcut
ññ7 R
,
ññR S
startHidden
óó 
=
óó 
(
óó 
startHidden
óó *
??
óó+ -
MiniProfiler
óó. :
.
óó: ;
Settings
óó; C
.
óóC D
PopupStartHidden
óóD T
)
óóT U
.
óóU V
ToJs
óóV Z
(
óóZ [
)
óó[ \
,
óó\ ]!
trivialMilliseconds
òò #
=
òò$ %
MiniProfiler
òò& 2
.
òò2 3
Settings
òò3 ;
.
òò; <2
$TrivialDurationThresholdMilliseconds
òò< `
}
ôô 
)
ôô 
)
ôô 
;
ôô 
}
öö 	
private
üü 
static
üü 
string
üü 
Includes
üü &
(
üü& '
HttpContext
üü' 2
context
üü3 :
,
üü: ;
string
üü< B
path
üüC G
)
üüG H
{
†† 	
var
°° 
response
°° 
=
°° 
context
°° "
.
°°" #
Response
°°# +
;
°°+ ,
switch
¢¢ 
(
¢¢ 
Path
¢¢ 
.
¢¢ 
GetExtension
¢¢ %
(
¢¢% &
path
¢¢& *
)
¢¢* +
)
¢¢+ ,
{
££ 
case
§§ 
$str
§§ 
:
§§ 
response
•• 
.
•• 
ContentType
•• (
=
••) *
$str
••+ C
;
••C D
break
¶¶ 
;
¶¶ 
case
ßß 
$str
ßß 
:
ßß 
response
®® 
.
®® 
ContentType
®® (
=
®®) *
$str
®®+ 5
;
®®5 6
break
©© 
;
©© 
case
™™ 
$str
™™ 
:
™™ 
response
´´ 
.
´´ 
ContentType
´´ (
=
´´) *
$str
´´+ ?
;
´´? @
break
¨¨ 
;
¨¨ 
default
≠≠ 
:
≠≠ 
return
ÆÆ 
NotFound
ÆÆ #
(
ÆÆ# $
context
ÆÆ$ +
)
ÆÆ+ ,
;
ÆÆ, -
}
ØØ 
string
∂∂ 
resource
∂∂ 
;
∂∂ 
return
∑∑ 
TryGetResource
∑∑ !
(
∑∑! "
Path
∑∑" &
.
∑∑& '
GetFileName
∑∑' 2
(
∑∑2 3
path
∑∑3 7
)
∑∑7 8
,
∑∑8 9
out
∑∑: =
resource
∑∑> F
)
∑∑F G
?
∑∑H I
resource
∑∑J R
:
∑∑S T
NotFound
∑∑U ]
(
∑∑] ^
context
∑∑^ e
)
∑∑e f
;
∑∑f g
}
∏∏ 	
private
∫∫ 
static
∫∫ 
string
∫∫ 
Index
∫∫ #
(
∫∫# $
HttpContext
∫∫$ /
context
∫∫0 7
)
∫∫7 8
{
ªª 	
string
ºº 
message
ºº 
;
ºº 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
AuthorizeRequest
ΩΩ !
(
ΩΩ! "
context
ΩΩ" )
,
ΩΩ) *
isList
ΩΩ+ 1
:
ΩΩ1 2
true
ΩΩ3 7
,
ΩΩ7 8
message
ΩΩ9 @
:
ΩΩ@ A
out
ΩΩB E
message
ΩΩF M
)
ΩΩM N
)
ΩΩN O
{
ææ 
return
øø 
message
øø 
;
øø 
}
¿¿ 
context
¬¬ 
.
¬¬ 
Response
¬¬ 
.
¬¬ 
ContentType
¬¬ (
=
¬¬) *
$str
¬¬+ 6
;
¬¬6 7
var
ƒƒ 
path
ƒƒ 
=
ƒƒ  
VirtualPathUtility
ƒƒ )
.
ƒƒ) *

ToAbsolute
ƒƒ* 4
(
ƒƒ4 5
MiniProfiler
ƒƒ5 A
.
ƒƒA B
Settings
ƒƒB J
.
ƒƒJ K
RouteBasePath
ƒƒK X
)
ƒƒX Y
.
ƒƒY Z!
EnsureTrailingSlash
ƒƒZ m
(
ƒƒm n
)
ƒƒn o
;
ƒƒo p
return
≈≈ 
new
≈≈ 
StringBuilder
≈≈ $
(
≈≈$ %
)
≈≈% &
.
∆∆ 

AppendLine
∆∆ 
(
∆∆ 
$str
∆∆ *
)
∆∆* +
.
«« 

AppendLine
«« 
(
«« 
$str
«« G
)
««G H
.
»» 
AppendFormat
»» 
(
»» 
$str»» Ö
,»»Ö Ü
path»»á ã
,»»ã å
MiniProfiler»»ç ô
.»»ô ö
Settings»»ö ¢
.»»¢ £
Version»»£ ™
,»»™ ´
Environment»»¨ ∑
.»»∑ ∏
NewLine»»∏ ø
)»»ø ¿
.
…… 
AppendFormat
…… 
(
…… 
$str
…… g
,
……g h
path
……i m
,
……m n
MiniProfiler
……o {
.
……{ |
Settings……| Ñ
.……Ñ Ö
Version……Ö å
,……å ç
Environment……é ô
.……ô ö
NewLine……ö °
)……° ¢
.
   
AppendFormat
   
(
   
$str
   f
,
  f g
path
  h l
,
  l m
MiniProfiler
  n z
.
  z {
Settings  { É
.  É Ñ
Version  Ñ ã
,  ã å
Environment  ç ò
.  ò ô
NewLine  ô †
)  † °
.
ÀÀ 
AppendFormat
ÀÀ 
(
ÀÀ 
$strÀÀ Ç
,ÀÀÇ É
pathÀÀÑ à
,ÀÀà â
MiniProfilerÀÀä ñ
.ÀÀñ ó
SettingsÀÀó ü
.ÀÀü †
VersionÀÀ† ß
,ÀÀß ®
EnvironmentÀÀ© ¥
.ÀÀ¥ µ
NewLineÀÀµ º
)ÀÀº Ω
.
ÃÃ 

AppendLine
ÃÃ 
(
ÃÃ 
$str
ÃÃ ,
)
ÃÃ, -
.
ÕÕ 
ToString
ÕÕ 
(
ÕÕ 
)
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
private
”” 
static
”” 
bool
”” 
AuthorizeRequest
”” ,
(
””, -
HttpContext
””- 8
context
””9 @
,
””@ A
bool
””B F
isList
””G M
,
””M N
out
””O R
string
””S Y
message
””Z a
)
””a b
{
‘‘ 	
message
’’ 
=
’’ 
null
’’ 
;
’’ 
var
÷÷ 
	authorize
÷÷ 
=
÷÷ 
MiniProfiler
÷÷ (
.
÷÷( )
Settings
÷÷) 1
.
÷÷1 2
Results_Authorize
÷÷2 C
;
÷÷C D
var
◊◊ 
authorizeList
◊◊ 
=
◊◊ 
MiniProfiler
◊◊  ,
.
◊◊, -
Settings
◊◊- 5
.
◊◊5 6$
Results_List_Authorize
◊◊6 L
;
◊◊L M
if
ŸŸ 
(
ŸŸ 
(
ŸŸ 
	authorize
ŸŸ 
!=
ŸŸ 
null
ŸŸ "
&&
ŸŸ# %
!
ŸŸ& '
	authorize
ŸŸ' 0
(
ŸŸ0 1
context
ŸŸ1 8
.
ŸŸ8 9
Request
ŸŸ9 @
)
ŸŸ@ A
)
ŸŸA B
||
ŸŸC E
(
ŸŸF G
isList
ŸŸG M
&&
ŸŸN P
(
ŸŸQ R
authorizeList
ŸŸR _
==
ŸŸ` b
null
ŸŸc g
||
ŸŸh j
!
ŸŸk l
authorizeList
ŸŸl y
(
ŸŸy z
contextŸŸz Å
.ŸŸÅ Ç
RequestŸŸÇ â
)ŸŸâ ä
)ŸŸä ã
)ŸŸã å
)ŸŸå ç
{
⁄⁄ 
context
€€ 
.
€€ 
Response
€€  
.
€€  !

StatusCode
€€! +
=
€€, -
$num
€€. 1
;
€€1 2
context
‹‹ 
.
‹‹ 
Response
‹‹  
.
‹‹  !
ContentType
‹‹! ,
=
‹‹- .
$str
‹‹/ ;
;
‹‹; <
message
›› 
=
›› 
$str
›› (
;
››( )
return
ﬁﬁ 
false
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
return
·· 
true
·· 
;
·· 
}
‚‚ 	
private
‰‰ 
static
‰‰ 
string
‰‰ 
GetListJson
‰‰ )
(
‰‰) *
HttpContext
‰‰* 5
context
‰‰6 =
)
‰‰= >
{
ÂÂ 	
string
ÊÊ 
message
ÊÊ 
;
ÊÊ 
if
ÁÁ 
(
ÁÁ 
!
ÁÁ 
AuthorizeRequest
ÁÁ !
(
ÁÁ! "
context
ÁÁ" )
,
ÁÁ) *
isList
ÁÁ+ 1
:
ÁÁ1 2
true
ÁÁ3 7
,
ÁÁ7 8
message
ÁÁ9 @
:
ÁÁ@ A
out
ÁÁB E
message
ÁÁF M
)
ÁÁM N
)
ÁÁN O
{
ËË 
return
ÈÈ 
message
ÈÈ 
;
ÈÈ 
}
ÍÍ 
var
ÏÏ 
lastId
ÏÏ 
=
ÏÏ 
context
ÏÏ  
.
ÏÏ  !
Request
ÏÏ! (
[
ÏÏ( )
$str
ÏÏ) 2
]
ÏÏ2 3
;
ÏÏ3 4
Guid
ÌÌ 
lastGuid
ÌÌ 
=
ÌÌ 
Guid
ÌÌ  
.
ÌÌ  !
Empty
ÌÌ! &
;
ÌÌ& '
if
ÔÔ 
(
ÔÔ 
!
ÔÔ 
lastId
ÔÔ 
.
ÔÔ  
IsNullOrWhiteSpace
ÔÔ *
(
ÔÔ* +
)
ÔÔ+ ,
)
ÔÔ, -
{
 
Guid
ÒÒ 
.
ÒÒ 
TryParse
ÒÒ 
(
ÒÒ 
lastId
ÒÒ $
,
ÒÒ$ %
out
ÒÒ& )
lastGuid
ÒÒ* 2
)
ÒÒ2 3
;
ÒÒ3 4
}
ÚÚ 
if
ıı 
(
ıı 
MiniProfiler
ıı 
.
ıı 
Settings
ıı %
.
ıı% &
Storage
ıı& -
==
ıı. 0
null
ıı1 5
)
ıı5 6
{
ˆˆ 
MiniProfiler
˜˜ 
.
˜˜ 
Settings
˜˜ %
.
˜˜% &#
EnsureStorageStrategy
˜˜& ;
(
˜˜; <
)
˜˜< =
;
˜˜= >
}
¯¯ 
var
˙˙ 
guids
˙˙ 
=
˙˙ 
MiniProfiler
˙˙ $
.
˙˙$ %
Settings
˙˙% -
.
˙˙- .
Storage
˙˙. 5
.
˙˙5 6
List
˙˙6 :
(
˙˙: ;
$num
˙˙; >
)
˙˙> ?
;
˙˙? @
if
¸¸ 
(
¸¸ 
lastGuid
¸¸ 
!=
¸¸ 
Guid
¸¸  
.
¸¸  !
Empty
¸¸! &
)
¸¸& '
{
˝˝ 
guids
˛˛ 
=
˛˛ 
guids
˛˛ 
.
˛˛ 
	TakeWhile
˛˛ '
(
˛˛' (
g
˛˛( )
=>
˛˛* ,
g
˛˛- .
!=
˛˛/ 1
lastGuid
˛˛2 :
)
˛˛: ;
;
˛˛; <
}
ˇˇ 
guids
ÅÅ 
=
ÅÅ 
guids
ÅÅ 
.
ÅÅ 
Reverse
ÅÅ !
(
ÅÅ! "
)
ÅÅ" #
;
ÅÅ# $
return
ÉÉ 
guids
ÉÉ 
.
ÉÉ 
Select
ÉÉ 
(
ÉÉ  
g
ÑÑ 
=>
ÑÑ 
{
ÖÖ 
var
ÜÜ 
profiler
ÜÜ  
=
ÜÜ! "
MiniProfiler
ÜÜ# /
.
ÜÜ/ 0
Settings
ÜÜ0 8
.
ÜÜ8 9
Storage
ÜÜ9 @
.
ÜÜ@ A
Load
ÜÜA E
(
ÜÜE F
g
ÜÜF G
)
ÜÜG H
;
ÜÜH I
return
áá 
new
áá 
{
àà 
profiler
ââ  
.
ââ  !
Id
ââ! #
,
ââ# $
profiler
ää  
.
ää  !
Name
ää! %
,
ää% &
profiler
ãã  
.
ãã  !
ClientTimings
ãã! .
,
ãã. /
profiler
åå  
.
åå  !
Started
åå! (
,
åå( )
profiler
çç  
.
çç  !
HasUserViewed
çç! .
,
çç. /
profiler
éé  
.
éé  !
MachineName
éé! ,
,
éé, -
profiler
èè  
.
èè  !
User
èè! %
,
èè% &
profiler
êê  
.
êê  !"
DurationMilliseconds
êê! 5
}
ëë 
;
ëë 
}
íí 
)
íí 
.
íí 
ToJson
íí 
(
íí 
)
íí 
;
íí 
}
ìì 	
private
ôô 
static
ôô 
string
ôô %
GetSingleProfilerResult
ôô 5
(
ôô5 6
HttpContext
ôô6 A
context
ôôB I
)
ôôI J
{
öö 	
var
ùù 
isPopup
ùù 
=
ùù 
context
ùù !
.
ùù! "
Request
ùù" )
[
ùù) *
$str
ùù* 1
]
ùù1 2
.
ùù2 3
HasValue
ùù3 ;
(
ùù; <
)
ùù< =
;
ùù= >
Guid
¢¢ 
id
¢¢ 
;
¢¢ 
if
££ 
(
££ 
!
££ 
Guid
££ 
.
££ 
TryParse
££ 
(
££ 
context
££ &
.
££& '
Request
££' .
[
££. /
$str
££/ 3
]
££3 4
,
££4 5
out
££6 9
id
££: <
)
££< =
)
££= >
id
§§ 
=
§§ 
MiniProfiler
§§ !
.
§§! "
Settings
§§" *
.
§§* +
Storage
§§+ 2
.
§§2 3
List
§§3 7
(
§§7 8
$num
§§8 9
)
§§9 :
.
§§: ;
FirstOrDefault
§§; I
(
§§I J
)
§§J K
;
§§K L
if
¶¶ 
(
¶¶ 
id
¶¶ 
==
¶¶ 
default
¶¶ 
(
¶¶ 
Guid
¶¶ "
)
¶¶" #
)
¶¶# $
return
ßß 
isPopup
ßß 
?
ßß  
NotFound
ßß! )
(
ßß) *
context
ßß* 1
)
ßß1 2
:
ßß3 4
NotFound
ßß5 =
(
ßß= >
context
ßß> E
,
ßßE F
$str
ßßG S
,
ßßS T
$str
ßßU 
)ßß Ä
;ßßÄ Å
MiniProfiler
©© 
.
©© 
Settings
©© !
.
©©! "#
EnsureStorageStrategy
©©" 7
(
©©7 8
)
©©8 9
;
©©9 :
var
™™ 
profiler
™™ 
=
™™ 
MiniProfiler
™™ '
.
™™' (
Settings
™™( 0
.
™™0 1
Storage
™™1 8
.
™™8 9
Load
™™9 =
(
™™= >
id
™™> @
)
™™@ A
;
™™A B
var
¨¨ 
provider
¨¨ 
=
¨¨ (
WebRequestProfilerProvider
¨¨ 5
.
¨¨5 6
Settings
¨¨6 >
.
¨¨> ?
UserProvider
¨¨? K
;
¨¨K L
string
≠≠ 
user
≠≠ 
=
≠≠ 
null
≠≠ 
;
≠≠ 
if
ÆÆ 
(
ÆÆ 
provider
ÆÆ 
!=
ÆÆ 
null
ÆÆ  
)
ÆÆ  !
{
ØØ 
user
∞∞ 
=
∞∞ 
provider
∞∞ 
.
∞∞  
GetUser
∞∞  '
(
∞∞' (
context
∞∞( /
.
∞∞/ 0
Request
∞∞0 7
)
∞∞7 8
;
∞∞8 9
}
±± 
MiniProfiler
≥≥ 
.
≥≥ 
Settings
≥≥ !
.
≥≥! "
Storage
≥≥" )
.
≥≥) *
	SetViewed
≥≥* 3
(
≥≥3 4
user
≥≥4 8
,
≥≥8 9
id
≥≥: <
)
≥≥< =
;
≥≥= >
if
µµ 
(
µµ 
profiler
µµ 
==
µµ 
null
µµ  
)
µµ  !
{
∂∂ 
return
∑∑ 
isPopup
∑∑ 
?
∑∑  
NotFound
∑∑! )
(
∑∑) *
context
∑∑* 1
)
∑∑1 2
:
∑∑3 4
NotFound
∑∑5 =
(
∑∑= >
context
∑∑> E
,
∑∑E F
$str
∑∑G S
,
∑∑S T
$str
∑∑U }
+
∑∑~ 
id∑∑Ä Ç
.∑∑Ç É
ToString∑∑É ã
(∑∑ã å
)∑∑å ç
)∑∑ç é
;∑∑é è
}
∏∏ 
bool
∫∫ 
	needsSave
∫∫ 
=
∫∫ 
false
∫∫ "
;
∫∫" #
if
ªª 
(
ªª 
profiler
ªª 
.
ªª 
ClientTimings
ªª &
==
ªª' )
null
ªª* .
)
ªª. /
{
ºº 
profiler
ΩΩ 
.
ΩΩ 
ClientTimings
ΩΩ &
=
ΩΩ' (
ClientTimings
ΩΩ) 6
.
ΩΩ6 7
FromRequest
ΩΩ7 B
(
ΩΩB C
context
ΩΩC J
.
ΩΩJ K
Request
ΩΩK R
)
ΩΩR S
;
ΩΩS T
if
ææ 
(
ææ 
profiler
ææ 
.
ææ 
ClientTimings
ææ *
!=
ææ+ -
null
ææ. 2
)
ææ2 3
{
øø 
	needsSave
¿¿ 
=
¿¿ 
true
¿¿  $
;
¿¿$ %
}
¡¡ 
}
¬¬ 
if
ƒƒ 
(
ƒƒ 
!
ƒƒ 
profiler
ƒƒ 
.
ƒƒ 
HasUserViewed
ƒƒ '
)
ƒƒ' (
{
≈≈ 
profiler
∆∆ 
.
∆∆ 
HasUserViewed
∆∆ &
=
∆∆' (
true
∆∆) -
;
∆∆- .
	needsSave
«« 
=
«« 
true
««  
;
««  !
}
»» 
if
   
(
   
	needsSave
   
)
   
{
ÀÀ 
MiniProfiler
ÃÃ 
.
ÃÃ 
Settings
ÃÃ %
.
ÃÃ% &
Storage
ÃÃ& -
.
ÃÃ- .
Save
ÃÃ. 2
(
ÃÃ2 3
profiler
ÃÃ3 ;
)
ÃÃ; <
;
ÃÃ< =
}
ÕÕ 
var
œœ 
	authorize
œœ 
=
œœ 
MiniProfiler
œœ (
.
œœ( )
Settings
œœ) 1
.
œœ1 2
Results_Authorize
œœ2 C
;
œœC D
if
–– 
(
–– 
	authorize
–– 
!=
–– 
null
–– !
&&
––" $
!
––% &
	authorize
––& /
(
––/ 0
context
––0 7
.
––7 8
Request
––8 ?
)
––? @
)
––@ A
{
—— 
context
““ 
.
““ 
Response
““  
.
““  !
ContentType
““! ,
=
““- .
$str
““/ A
;
““A B
return
”” 
$str
”” 
.
””  
ToJson
””  &
(
””& '
)
””' (
;
””( )
}
‘‘ 
return
÷÷ 
isPopup
÷÷ 
?
÷÷ 
ResultsJson
÷÷ (
(
÷÷( )
context
÷÷) 0
,
÷÷0 1
profiler
÷÷2 :
)
÷÷: ;
:
÷÷< =
ResultsFullPage
÷÷> M
(
÷÷M N
context
÷÷N U
,
÷÷U V
profiler
÷÷W _
)
÷÷_ `
;
÷÷` a
}
◊◊ 	
private
ŸŸ 
static
ŸŸ 
string
ŸŸ 
ResultsJson
ŸŸ )
(
ŸŸ) *
HttpContext
ŸŸ* 5
context
ŸŸ6 =
,
ŸŸ= >
MiniProfiler
ŸŸ? K
profiler
ŸŸL T
)
ŸŸT U
{
⁄⁄ 	
context
€€ 
.
€€ 
Response
€€ 
.
€€ 
ContentType
€€ (
=
€€) *
$str
€€+ =
;
€€= >
return
‹‹ 
MiniProfiler
‹‹ 
.
‹‹  
ToJson
‹‹  &
(
‹‹& '
profiler
‹‹' /
)
‹‹/ 0
;
‹‹0 1
}
›› 	
private
ﬂﬂ 
static
ﬂﬂ 
string
ﬂﬂ 
ResultsFullPage
ﬂﬂ -
(
ﬂﬂ- .
HttpContext
ﬂﬂ. 9
context
ﬂﬂ: A
,
ﬂﬂA B
MiniProfiler
ﬂﬂC O
profiler
ﬂﬂP X
)
ﬂﬂX Y
{
‡‡ 	
context
·· 
.
·· 
Response
·· 
.
·· 
ContentType
·· (
=
··) *
$str
··+ 6
;
··6 7
string
„„ 
template
„„ 
;
„„ 
if
‰‰ 
(
‰‰ 
!
‰‰ 
TryGetResource
‰‰ 
(
‰‰  
$str
‰‰  ,
,
‰‰, -
out
‰‰. 1
template
‰‰2 :
)
‰‰: ;
)
‰‰; <
return
ÂÂ 
NotFound
ÂÂ 
(
ÂÂ  
context
ÂÂ  '
)
ÂÂ' (
;
ÂÂ( )
return
ÊÊ 
template
ÊÊ 
.
ÊÊ 
Format
ÊÊ "
(
ÊÊ" #
new
ÊÊ# &
{
ÁÁ 
name
ËË 
=
ËË 
profiler
ËË 
.
ËË  
Name
ËË  $
,
ËË$ %
duration
ÈÈ 
=
ÈÈ 
profiler
ÈÈ #
.
ÈÈ# $"
DurationMilliseconds
ÈÈ$ 8
.
ÈÈ8 9
ToString
ÈÈ9 A
(
ÈÈA B
CultureInfo
ÈÈB M
.
ÈÈM N
InvariantCulture
ÈÈN ^
)
ÈÈ^ _
,
ÈÈ_ `
path
ÍÍ 
=
ÍÍ  
VirtualPathUtility
ÍÍ )
.
ÍÍ) *

ToAbsolute
ÍÍ* 4
(
ÍÍ4 5
MiniProfiler
ÍÍ5 A
.
ÍÍA B
Settings
ÍÍB J
.
ÍÍJ K
RouteBasePath
ÍÍK X
)
ÍÍX Y
.
ÍÍY Z!
EnsureTrailingSlash
ÍÍZ m
(
ÍÍm n
)
ÍÍn o
,
ÍÍo p
json
ÎÎ 
=
ÎÎ 
MiniProfiler
ÎÎ #
.
ÎÎ# $
ToJson
ÎÎ$ *
(
ÎÎ* +
profiler
ÎÎ+ 3
)
ÎÎ3 4
,
ÎÎ4 5
includes
ÏÏ 
=
ÏÏ 
RenderIncludes
ÏÏ )
(
ÏÏ) *
profiler
ÏÏ* 2
)
ÏÏ2 3
,
ÏÏ3 4
version
ÌÌ 
=
ÌÌ 
MiniProfiler
ÌÌ &
.
ÌÌ& '
Settings
ÌÌ' /
.
ÌÌ/ 0
Version
ÌÌ0 7
}
ÓÓ 
)
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
private
ÒÒ 
static
ÒÒ 
bool
ÒÒ 
TryGetResource
ÒÒ *
(
ÒÒ* +
string
ÒÒ+ 1
filename
ÒÒ2 :
,
ÒÒ: ;
out
ÒÒ< ?
string
ÒÒ@ F
resource
ÒÒG O
)
ÒÒO P
{
ÚÚ 	
filename
ÛÛ 
=
ÛÛ 
filename
ÛÛ 
.
ÛÛ  
ToLower
ÛÛ  '
(
ÛÛ' (
)
ÛÛ( )
;
ÛÛ) *
if
˜˜ 
(
˜˜ 
!
˜˜ 
BypassLocalLoad
˜˜  
)
˜˜  !
{
¯¯ 
var
˙˙ 
trace
˙˙ 
=
˙˙ 
new
˙˙ 
System
˙˙  &
.
˙˙& '
Diagnostics
˙˙' 2
.
˙˙2 3

StackTrace
˙˙3 =
(
˙˙= >
true
˙˙> B
)
˙˙B C
;
˙˙C D
var
˚˚ 
path
˚˚ 
=
˚˚ 
Path
˚˚ 
.
˚˚  
GetDirectoryName
˚˚  0
(
˚˚0 1
trace
˚˚1 6
.
˚˚6 7
	GetFrames
˚˚7 @
(
˚˚@ A
)
˚˚A B
[
˚˚B C
$num
˚˚C D
]
˚˚D E
.
˚˚E F
GetFileName
˚˚F Q
(
˚˚Q R
)
˚˚R S
)
˚˚S T
+
˚˚U V
$str
˚˚W _
+
˚˚` a
filename
˚˚b j
;
˚˚j k
try
¸¸ 
{
˝˝ 
resource
˛˛ 
=
˛˛ 
File
˛˛ #
.
˛˛# $
ReadAllText
˛˛$ /
(
˛˛/ 0
path
˛˛0 4
)
˛˛4 5
;
˛˛5 6
return
ˇˇ 
true
ˇˇ 
;
ˇˇ  
}
ÄÄ 
catch
ÅÅ 
{
ÇÇ 
BypassLocalLoad
ÉÉ #
=
ÉÉ$ %
true
ÉÉ& *
;
ÉÉ* +
}
ÑÑ 
}
ÖÖ 
if
àà 
(
àà 
!
àà 
ResourceCache
àà 
.
àà 
TryGetValue
àà *
(
àà* +
filename
àà+ 3
,
àà3 4
out
àà5 8
resource
àà9 A
)
ààA B
)
ààB C
{
ââ 
string
ää !
customTemplatesPath
ää *
=
ää+ ,
HttpContext
ää- 8
.
ää8 9
Current
ää9 @
.
ää@ A
Server
ääA G
.
ääG H
MapPath
ääH O
(
ääO P
MiniProfiler
ääP \
.
ää\ ]
Settings
ää] e
.
ääe f
CustomUITemplates
ääf w
)
ääw x
;
ääx y
string
ãã  
customTemplateFile
ãã )
=
ãã* +
Path
ãã, 0
.
ãã0 1
Combine
ãã1 8
(
ãã8 9!
customTemplatesPath
ãã9 L
,
ããL M
filename
ããN V
)
ããV W
;
ããW X
if
çç 
(
çç 
File
çç 
.
çç 
Exists
çç 
(
çç   
customTemplateFile
çç  2
)
çç2 3
)
çç3 4
{
éé 
resource
èè 
=
èè 
File
èè #
.
èè# $
ReadAllText
èè$ /
(
èè/ 0 
customTemplateFile
èè0 B
)
èèB C
;
èèC D
}
êê 
else
ëë 
{
íí 
using
ìì 
(
ìì 
var
ìì 
stream
ìì %
=
ìì& '
typeof
ìì( .
(
ìì. /!
MiniProfilerHandler
ìì/ B
)
ììB C
.
ììC D
Assembly
ììD L
.
ììL M'
GetManifestResourceStream
ììM f
(
ììf g
$strììg Ñ
+ììÖ Ü
filenameììá è
)ììè ê
)ììê ë
{
îî 
if
ïï 
(
ïï 
stream
ïï "
==
ïï# %
null
ïï& *
)
ïï* +
{
ññ 
return
óó "
false
óó# (
;
óó( )
}
òò 
using
ôô 
(
ôô 
var
ôô "
reader
ôô# )
=
ôô* +
new
ôô, /
StreamReader
ôô0 <
(
ôô< =
stream
ôô= C
)
ôôC D
)
ôôD E
{
öö 
resource
õõ $
=
õõ% &
reader
õõ' -
.
õõ- .
	ReadToEnd
õõ. 7
(
õõ7 8
)
õõ8 9
;
õõ9 :
}
úú 
}
ùù 
}
ûû 
ResourceCache
†† 
[
†† 
filename
†† &
]
††& '
=
††( )
resource
††* 2
;
††2 3
}
°° 
return
££ 
true
££ 
;
££ 
}
§§ 	
private
ßß 
static
ßß 
bool
ßß 
BypassLocalLoad
ßß +
=
ßß, -
false
ßß. 3
;
ßß3 4
private
™™ 
static
™™ 
string
™™ 
NotFound
™™ &
(
™™& '
HttpContext
™™' 2
context
™™3 :
,
™™: ;
string
™™< B
contentType
™™C N
=
™™O P
$str
™™Q ]
,
™™] ^
string
™™_ e
message
™™f m
=
™™n o
null
™™p t
)
™™t u
{
´´ 	
context
¨¨ 
.
¨¨ 
Response
¨¨ 
.
¨¨ 

StatusCode
¨¨ '
=
¨¨( )
$num
¨¨* -
;
¨¨- .
context
≠≠ 
.
≠≠ 
Response
≠≠ 
.
≠≠ 
ContentType
≠≠ (
=
≠≠) *
contentType
≠≠+ 6
;
≠≠6 7
return
ØØ 
message
ØØ 
;
ØØ 
}
∞∞ 	
}
≤≤ 
}≥≥ Ò
fC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\IAdvancedSqlFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{ 
public		 

	interface		 !
IAdvancedSqlFormatter		 *
:		+ ,
ISqlFormatter		- :
{

 
string 
	FormatSql 
( 
string 
commandText  +
,+ ,
List- 1
<1 2
SqlTimingParameter2 D
>D E

parametersF P
,P Q

IDbCommandR \
command] d
=e f
nullg k
)k l
;l m
} 
} à
gC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\SqlFormatterExtensions.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{ 
public		 

static		 
class		 "
SqlFormatterExtensions		 .
{

 
public 
static 
string 
GetFormattedSql ,
(, -
this- 1
ISqlFormatter2 ?
sqlFormatter@ L
,L M
stringN T
commandTextU `
,` a
Listb f
<f g
SqlTimingParameterg y
>y z

parameters	{ Ö
,
Ö Ü

IDbCommand
á ë
command
í ô
=
ö õ
null
ú †
)
† °
{ 	
var 
advancedFormatter !
=" #
sqlFormatter$ 0
as1 3!
IAdvancedSqlFormatter4 I
;I J
return 
advancedFormatter $
!=% '
null( ,
?- .
advancedFormatter/ @
.@ A
	FormatSqlA J
(J K
commandTextK V
,V W

parametersX b
,b c
commandd k
)k l
:m n
sqlFormattero {
.{ |
	FormatSql	| Ö
(
Ö Ü
commandText
Ü ë
,
ë í

parameters
ì ù
)
ù û
;
û ü
} 	
} 
} °
jC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\VerboseSqlServerFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{ 
public 

class %
VerboseSqlServerFormatter *
:+ ,
SqlServerFormatter- ?
,? @!
IAdvancedSqlFormatterA V
{ 
public 
bool 
IncludeMetaData #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public %
VerboseSqlServerFormatter (
(( )
bool) -
includeMetaData. =
=> ?
false@ E
)E F
{ 	
IncludeMetaData 
= 
includeMetaData -
;- .
} 	
public 
string 
	FormatSql 
(  
string  &
commandText' 2
,2 3
List4 8
<8 9
SqlTimingParameter9 K
>K L

parametersM W
,W X

IDbCommandY c
commandd k
=l m
nulln r
)r s
{   	
StringBuilder!! 
buffer!!  
=!!! "
new!!# &
StringBuilder!!' 4
(!!4 5
)!!5 6
;!!6 7
if## 
(## 
command## 
!=## 
null## 
&&##  "
IncludeMetaData### 2
)##2 3
{$$ 
buffer%% 
.%% 

AppendLine%% !
(%%! "
$str%%" 5
+%%6 7
command%%8 ?
.%%? @
CommandType%%@ K
)%%K L
;%%L M
buffer&& 
.&& 

AppendLine&& !
(&&! "
$str&&" 1
+&&2 3
command&&4 ;
.&&; <

Connection&&< F
.&&F G
Database&&G O
)&&O P
;&&P Q
if'' 
('' 
command'' 
.'' 
Transaction'' '
!=''( *
null''+ /
)''/ 0
{(( 
buffer)) 
.)) 

AppendLine)) %
())% &
$str))& J
+))K L
command))M T
.))T U
Transaction))U `
.))` a
IsolationLevel))a o
)))o p
;))p q
}** 
if++ 
(++ 
Transaction++ 
.++ 
Current++ 
!=++ 
null++ #
)++# $
{,, 
buffer.. 
... 

AppendLine.. 
(.. 
$str.. 9
+..: ;
Transaction..< G
...G H
Current..H O
...O P
IsolationLevel..P ^
)..^ _
;.._ `
}// 
buffer00 
.00 

AppendLine00 !
(00! "
)00" #
;00# $
}11 
string33	 

baseOutput33 
=33 
base33 !
.33! "
	FormatSql33" +
(33+ ,
commandText33, 7
,337 8

parameters339 C
,33C D
command33E L
)33L M
;33M N
buffer55	 
.55 
Append55 
(55 

baseOutput55 !
)55! "
;55" #
return77	 
buffer77 
.77 
ToString77 
(77  
)77  !
;77! "
}88 	
}99 
}:: ı]
LC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlTiming.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

class 
	SqlTiming 
{ 
private 
const 
int  
MaxByteParameterSize .
=/ 0
$num1 4
;4 5
private 
readonly 
MiniProfiler %
	_profiler& /
;/ 0
private 
readonly 
CustomTiming %
_customTiming& 3
;3 4
public 
	SqlTiming 
( 

IDbCommand #
command$ +
,+ ,
SqlExecuteType- ;
type< @
,@ A
MiniProfilerB N
profilerO W
)W X
{ 	
if 
( 
profiler 
== 
null  
)  !
throw" '
new( +!
ArgumentNullException, A
(A B
$strB L
)L M
;M N
	_profiler   
=   
profiler    
;    !
var"" 
commandText"" 
="" !
AddSpacesToParameters"" 3
(""3 4
command""4 ;
.""; <
CommandText""< G
)""G H
;""H I
var## 

parameters## 
=##  
GetCommandParameters## 1
(##1 2
command##2 9
)##9 :
;##: ;
if%% 
(%% 
MiniProfiler%% 
.%% 
Settings%% %
.%%% &
SqlFormatter%%& 2
!=%%3 5
null%%6 :
)%%: ;
{&& 
commandText'' 
='' 
MiniProfiler'' *
.''* +
Settings''+ 3
.''3 4
SqlFormatter''4 @
.''@ A
GetFormattedSql''A P
(''P Q
commandText''Q \
,''\ ]

parameters''^ h
,''h i
command''j q
)''q r
;''r s
}(( 
_customTiming** 
=** 
profiler** $
.**$ %
CustomTiming**% 1
(**1 2
$str**2 7
,**7 8
commandText**9 D
,**D E
type**F J
.**J K
ToString**K S
(**S T
)**T U
)**U V
;**V W
if++ 
(++ 
_customTiming++ 
==++  
null++! %
)++% &
throw++' ,
new++- 0%
InvalidOperationException++1 J
(++J K
)++K L
;++L M
},, 	
public11 
decimal11 
StartMilliseconds11 (
{11) *
get11+ .
{11/ 0
return111 7
_customTiming118 E
.11E F
StartMilliseconds11F W
;11W X
}11Y Z
}11[ \
public66 
override66 
string66 
ToString66 '
(66' (
)66( )
{77 	
return88 
_customTiming88  
.88  !
CommandString88! .
.88. /
Truncate88/ 7
(887 8
$num888 :
)88: ;
+88< =
$str88> B
+88C D
_customTiming88E R
.88R S 
DurationMilliseconds88S g
+88h i
$str88j p
;88p q
}99 	
public>> 
override>> 
bool>> 
Equals>> #
(>># $
object>>$ *
other>>+ 0
)>>0 1
{?? 	
return@@ 
other@@ 
is@@ 
	SqlTiming@@ %
&&@@& (
_customTiming@@) 6
.@@6 7
Id@@7 9
.@@9 :
Equals@@: @
(@@@ A
(@@A B
(@@B C
	SqlTiming@@C L
)@@L M
other@@M R
)@@R S
.@@S T
_customTiming@@T a
.@@a b
Id@@b d
)@@d e
;@@e f
}AA 	
publicFF 
overrideFF 
intFF 
GetHashCodeFF '
(FF' (
)FF( )
{GG 	
returnHH 
_customTimingHH  
.HH  !
IdHH! #
.HH# $
GetHashCodeHH$ /
(HH/ 0
)HH0 1
;HH1 2
}II 	
publicNN 
voidNN 
ExecutionCompleteNN %
(NN% &
boolNN& *
isReaderNN+ 3
)NN3 4
{OO 	
ifPP 
(PP 
isReaderPP 
)PP 
{QQ 
_customTimingRR 
.RR 
FirstFetchCompletedRR 1
(RR1 2
)RR2 3
;RR3 4
}SS 
elseTT 
{UU 
_customTimingVV 
.VV 
StopVV "
(VV" #
)VV# $
;VV$ %
}WW 
}XX 	
public^^ 
void^^ 
ReaderFetchComplete^^ '
(^^' (
)^^( )
{__ 	
_customTiming`` 
.`` 
Stop`` 
(`` 
)``  
;``  !
}aa 	
privateff 
staticff 
stringff 
GetValueff &
(ff& '
IDataParameterff' 5
	parameterff6 ?
)ff? @
{gg 	
objecthh 
rawValuehh 
=hh 
	parameterhh '
.hh' (
Valuehh( -
;hh- .
ifii 
(ii 
rawValueii 
==ii 
nullii  
||ii! #
rawValueii$ ,
==ii- /
DBNullii0 6
.ii6 7
Valueii7 <
)ii< =
{jj 
returnkk 
nullkk 
;kk 
}ll 
ifoo 
(oo 
	parameteroo 
.oo 
DbTypeoo  
==oo! #
DbTypeoo$ *
.oo* +
Binaryoo+ 1
)oo1 2
{pp 
varqq 
bytesqq 
=qq 
rawValueqq $
asqq% '
byteqq( ,
[qq, -
]qq- .
;qq. /
ifrr 
(rr 
bytesrr 
!=rr 
nullrr !
&&rr" $
bytesrr% *
.rr* +
Lengthrr+ 1
<=rr2 4 
MaxByteParameterSizerr5 I
)rrI J
{ss 
returntt 
$strtt 
+tt  !
BitConvertertt" .
.tt. /
ToStringtt/ 7
(tt7 8
bytestt8 =
)tt= >
.tt> ?
Replacett? F
(ttF G
$strttG J
,ttJ K
stringttL R
.ttR S
EmptyttS X
)ttX Y
;ttY Z
}uu 
returnxx 
nullxx 
;xx 
}yy 
if{{ 
({{ 
rawValue{{ 
is{{ 
DateTime{{ $
){{$ %
{|| 
return}} 
(}} 
(}} 
DateTime}} !
)}}! "
rawValue}}" *
)}}* +
.}}+ ,
ToString}}, 4
(}}4 5
$str}}5 8
,}}8 9
System}}: @
.}}@ A
Globalization}}A N
.}}N O
CultureInfo}}O Z
.}}Z [
InvariantCulture}}[ k
)}}k l
;}}l m
}~~ 
var
ÅÅ 
rawType
ÅÅ 
=
ÅÅ 
rawValue
ÅÅ "
.
ÅÅ" #
GetType
ÅÅ# *
(
ÅÅ* +
)
ÅÅ+ ,
;
ÅÅ, -
if
ÇÇ 
(
ÇÇ 
rawType
ÇÇ 
.
ÇÇ 
IsEnum
ÇÇ 
)
ÇÇ 
{
ÉÉ 
return
ÖÖ 
Convert
ÖÖ 
.
ÖÖ 

ChangeType
ÖÖ )
(
ÖÖ) *
rawValue
ÖÖ* 2
,
ÖÖ2 3
Enum
ÖÖ4 8
.
ÖÖ8 9
GetUnderlyingType
ÖÖ9 J
(
ÖÖJ K
rawType
ÖÖK R
)
ÖÖR S
)
ÖÖS T
.
ÖÖT U
ToString
ÖÖU ]
(
ÖÖ] ^
)
ÖÖ^ _
;
ÖÖ_ `
}
ÜÜ 
return
àà 
rawValue
àà 
.
àà 
ToString
àà $
(
àà$ %
)
àà% &
;
àà& '
}
ââ 	
private
ãã 
static
ãã 
int
ãã 
GetParameterSize
ãã +
(
ãã+ ,
IDbDataParameter
ãã, <
	parameter
ãã= F
)
ããF G
{
åå 	
var
çç 
value
çç 
=
çç 
	parameter
çç !
.
çç! "
Value
çç" '
as
çç( *
	INullable
çç+ 4
;
çç4 5
if
éé 
(
éé 
value
éé 
!=
éé 
null
éé 
)
éé 
{
èè 
var
êê 
nullable
êê 
=
êê 
value
êê $
;
êê$ %
if
ëë 
(
ëë 
nullable
ëë 
.
ëë 
IsNull
ëë #
)
ëë# $
{
íí 
return
ìì 
$num
ìì 
;
ìì 
}
îî 
}
ïï 
return
óó 
	parameter
óó 
.
óó 
Size
óó !
;
óó! "
}
òò 	
private
ùù 
string
ùù #
AddSpacesToParameters
ùù ,
(
ùù, -
string
ùù- 3
commandString
ùù4 A
)
ùùA B
{
ûû 	
return
üü 
Regex
üü 
.
üü 
Replace
üü  
(
üü  !
commandString
üü! .
,
üü. /
$str
üü0 ;
,
üü; <
$str
üü= C
)
üüC D
;
üüD E
}
†† 	
public
•• 
static
•• 
List
•• 
<
••  
SqlTimingParameter
•• -
>
••- ."
GetCommandParameters
••/ C
(
••C D

IDbCommand
••D N
command
••O V
)
••V W
{
¶¶ 	
if
ßß 
(
ßß 
command
ßß 
.
ßß 

Parameters
ßß "
==
ßß# %
null
ßß& *
||
ßß+ -
command
ßß. 5
.
ßß5 6

Parameters
ßß6 @
.
ßß@ A
Count
ßßA F
==
ßßG I
$num
ßßJ K
)
ßßK L
return
ßßM S
null
ßßT X
;
ßßX Y
var
©© 
result
©© 
=
©© 
new
©© 
List
©© !
<
©©! " 
SqlTimingParameter
©©" 4
>
©©4 5
(
©©5 6
)
©©6 7
;
©©7 8
foreach
´´ 
(
´´ 
DbParameter
´´  
	parameter
´´! *
in
´´+ -
command
´´. 5
.
´´5 6

Parameters
´´6 @
)
´´@ A
{
¨¨ 
if
≠≠ 
(
≠≠ 
	parameter
≠≠ 
.
≠≠ 
ParameterName
≠≠ +
.
≠≠+ ,
HasValue
≠≠, 4
(
≠≠4 5
)
≠≠5 6
)
≠≠6 7
{
ÆÆ 
result
ØØ 
.
ØØ 
Add
ØØ 
(
ØØ 
new
ØØ " 
SqlTimingParameter
ØØ# 5
{
∞∞ 
Name
±± 
=
±± 
	parameter
±± (
.
±±( )
ParameterName
±±) 6
.
±±6 7
Trim
±±7 ;
(
±±; <
)
±±< =
,
±±= >
Value
≤≤ 
=
≤≤ 
GetValue
≤≤  (
(
≤≤( )
	parameter
≤≤) 2
)
≤≤2 3
,
≤≤3 4
DbType
≥≥ 
=
≥≥  
	parameter
≥≥! *
.
≥≥* +
DbType
≥≥+ 1
.
≥≥1 2
ToString
≥≥2 :
(
≥≥: ;
)
≥≥; <
,
≥≥< =
Size
¥¥ 
=
¥¥ 
GetParameterSize
¥¥ /
(
¥¥/ 0
	parameter
¥¥0 9
)
¥¥9 :
,
¥¥: ;
	Direction
µµ !
=
µµ" #
	parameter
µµ$ -
.
µµ- .
	Direction
µµ. 7
.
µµ7 8
ToString
µµ8 @
(
µµ@ A
)
µµA B
,
µµB C

IsNullable
∂∂ "
=
∂∂# $
	parameter
∂∂% .
.
∂∂. /

IsNullable
∂∂/ 9
}
∑∑ 
)
∑∑ 
;
∑∑ 
}
∏∏ 
}
ππ 
return
ªª 
result
ªª 
;
ªª 
}
ºº 	
}
ΩΩ 
}ææ Ü
UC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlTimingParameter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
[ 
DataContract 
] 
public		 

class		 
SqlTimingParameter		 #
{

 
[ 	

DataMember	 
( 
Order 
= 
$num 
) 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	

DataMember	 
( 
Order 
= 
$num 
) 
] 
public 
string 
Value 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

DataMember	 
( 
Order 
= 
$num 
) 
] 
public 
string 
DbType 
{ 
get "
;" #
set$ '
;' (
}) *
[   	

DataMember  	 
(   
Order   
=   
$num   
)   
]   
public!! 
int!! 
Size!! 
{!! 
get!! 
;!! 
set!! "
;!!" #
}!!$ %
[&& 	

DataMember&&	 
(&& 
Order&& 
=&& 
$num&& 
)&& 
]&& 
public'' 
string'' 
	Direction'' 
{''  !
get''" %
;''% &
set''' *
;''* +
}'', -
[,, 	

DataMember,,	 
(,, 
Order,, 
=,, 
$num,, 
),, 
],, 
public-- 
bool-- 

IsNullable-- 
{--  
get--! $
;--$ %
set--& )
;--) *
}--+ ,
public33 
override33 
bool33 
Equals33 #
(33# $
object33$ *
obj33+ .
)33. /
{44 	
var55 
other55 
=55 
obj55 
as55 
SqlTimingParameter55 1
;551 2
return66 
other66 
!=66 
null66  
&&77 
string77 
.77 
Equals77  
(77  !
Name77! %
,77% &
other77' ,
.77, -
Name77- 1
)771 2
&&88 
string88 
.88 
Equals88  
(88  !
Value88! &
,88& '
other88( -
.88- .
Value88. 3
)883 4
;884 5
}99 	
public>> 
override>> 
int>> 
GetHashCode>> '
(>>' (
)>>( )
{?? 	
int@@ 
hashcode@@ 
=@@ 
Name@@ 
.@@  
GetHashCode@@  +
(@@+ ,
)@@, -
;@@- .
ifBB 
(BB 
ValueBB 
!=BB 
nullBB 
)BB 
hashcodeCC 
^=CC 
ValueCC !
.CC! "
GetHashCodeCC" -
(CC- .
)CC. /
;CC/ 0
returnEE 
hashcodeEE 
;EE 
}FF 	
publicKK 
overrideKK 
stringKK 
ToStringKK '
(KK' (
)KK( )
{LL 	
returnMM 
stringMM 
.MM 
FormatMM  
(MM  !
$strMM! 2
,MM2 3
NameMM4 8
,MM8 9
ValueMM: ?
,MM? @
DbTypeMMA G
)MMG H
;MMH I
}NN 	
}OO 
}PP Ú
^C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Storage\DatabaseStorageBase.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Storage" )
{ 
public

 

abstract

 
class

 
DatabaseStorageBase

 -
:

. /
IStorage

0 8
{ 
	protected 
string 
ConnectionString )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
	protected 
DatabaseStorageBase %
(% &
string& ,
connectionString- =
)= >
{ 	
ConnectionString 
= 
connectionString /
;/ 0
} 	
	protected"" 
DatabaseStorageBase"" %
(""% &$
ConnectionStringSettings""& >$
connectionStringSettings""? W
)""W X
{## 	
if$$ 
($$ $
connectionStringSettings$$ (
==$$) +
null$$, 0
)$$0 1
{%% 
throw&& 
new&& !
ArgumentNullException&& /
(&&/ 0
$str&&0 J
)&&J K
;&&K L
}'' 
this)) 
.)) 
ConnectionString)) !
=))" #$
connectionStringSettings))$ <
.))< =
ConnectionString))= M
;))M N
}** 	
public00 
abstract00 
void00 
Save00 !
(00! "
MiniProfiler00" .
profiler00/ 7
)007 8
;008 9
public99 
abstract99 
MiniProfiler99 $
Load99% )
(99) *
Guid99* .
id99/ 1
)991 2
;992 3
public@@ 
abstract@@ 
void@@ 
SetUnviewed@@ (
(@@( )
string@@) /
user@@0 4
,@@4 5
Guid@@6 :
id@@; =
)@@= >
;@@> ?
publicGG 
abstractGG 
voidGG 
	SetViewedGG &
(GG& '
stringGG' -
userGG. 2
,GG2 3
GuidGG4 8
idGG9 ;
)GG; <
;GG< =
publicPP 
abstractPP 
ListPP 
<PP 
GuidPP !
>PP! "
GetUnviewedIdsPP# 1
(PP1 2
stringPP2 8
userPP9 =
)PP= >
;PP> ?
publicZZ 
abstractZZ 
IEnumerableZZ #
<ZZ# $
GuidZZ$ (
>ZZ( )
ListZZ* .
(ZZ. /
intZZ/ 2

maxResultsZZ3 =
,ZZ= >
DateTimeZZ? G
?ZZG H
startZZI N
=ZZO P
nullZZQ U
,ZZU V
DateTimeZZW _
?ZZ_ `
finishZZa g
=ZZh i
nullZZj n
,ZZn o
ListResultsOrder	ZZp Ä
orderBy
ZZÅ à
=
ZZâ ä
ListResultsOrder
ZZã õ
.
ZZõ ú

Descending
ZZú ¶
)
ZZ¶ ß
;
ZZß ®
}[[ 
}__ —I
_C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Storage\MultiStorageProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Storage" )
{ 
public 

class  
MultiStorageProvider %
:& '
IStorage( 0
{ 
public 
List 
< 
IStorage 
> 
Stores $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
bool 
AllowParallelOps $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public  
MultiStorageProvider #
(# $
params$ *
IStorage+ 3
[3 4
]4 5
stores6 <
)< =
{   	
Stores!! 
=!! 
stores!! 
.!! 
Where!! !
(!!! "
x!!" #
=>!!$ &
x!!' (
!=!!) +
null!!, 0
)!!0 1
.!!1 2
ToList!!2 8
(!!8 9
)!!9 :
;!!: ;
if"" 
("" 
!"" 
Stores"" 
."" 
Any"" 
("" 
)"" 
)"" 
{## 
throw$$ 
new$$ !
ArgumentNullException$$ /
($$/ 0
$str$$0 8
,$$8 9
$str	$$: ê
)
$$ê ë
;
$$ë í
}%% 
}&& 	
public,, 
IEnumerable,, 
<,, 
Guid,, 
>,,  
List,,! %
(,,% &
int,,& )

maxResults,,* 4
,,,4 5
DateTime,,6 >
?,,> ?
start,,@ E
=,,F G
null,,H L
,,,L M
DateTime,,N V
?,,V W
finish,,X ^
=,,_ `
null,,a e
,,,e f
ListResultsOrder,,g w
orderBy,,x 
=
,,Ä Å
ListResultsOrder
,,Ç í
.
,,í ì

Descending
,,ì ù
)
,,ù û
{-- 	
if.. 
(.. 
Stores.. 
!=.. 
null.. 
).. 
{// 
foreach00 
(00 
var00 
store00 "
in00# %
Stores00& ,
)00, -
{11 
var22 
results22 
=22  !
store22" '
.22' (
List22( ,
(22, -

maxResults22- 7
,227 8
start229 >
,22> ?
finish22@ F
,22F G
orderBy22H O
)22O P
;22P Q
if33 
(33 
results33 
!=33  "
null33# '
&&33( *
results33+ 2
.332 3
Any333 6
(336 7
)337 8
)338 9
{44 
return55 
results55 &
;55& '
}66 
}77 
}88 
return99 
new99 
List99 
<99 
Guid99  
>99  !
(99! "
)99" #
;99# $
}:: 	
publicCC 
voidCC 
SaveCC 
(CC 
MiniProfilerCC %
profilerCC& .
)CC. /
{DD 	
ifEE 
(EE 
StoresEE 
!=EE 
nullEE 
)EE 
{FF 
ifGG 
(GG 
AllowParallelOpsGG $
)GG$ %
{HH 
ParallelII 
.II 
ForEachII $
(II$ %
StoresII% +
,II+ ,
xII- .
=>II/ 1
xII2 3
.II3 4
SaveII4 8
(II8 9
profilerII9 A
)IIA B
)IIB C
;IIC D
}JJ 
elseKK 
{LL 
StoresMM 
.MM 
ForEachMM "
(MM" #
xMM# $
=>MM% '
xMM( )
.MM) *
SaveMM* .
(MM. /
profilerMM/ 7
)MM7 8
)MM8 9
;MM9 :
}NN 
}OO 
}PP 	
public[[ 
MiniProfiler[[ 
Load[[  
([[  !
Guid[[! %
id[[& (
)[[( )
{\\ 	
if]] 
(]] 
Stores]] 
!=]] 
null]] 
)]] 
{^^ 
foreach__ 
(__ 
var__ 
store__ "
in__# %
Stores__& ,
)__, -
{`` 
varaa 
resultaa 
=aa  
storeaa! &
.aa& '
Loadaa' +
(aa+ ,
idaa, .
)aa. /
;aa/ 0
ifbb 
(bb 
resultbb 
!=bb !
nullbb" &
)bb& '
{cc 
returndd 
resultdd %
;dd% &
}ee 
}ff 
}gg 
returnhh 
nullhh 
;hh 
}ii 	
publicoo 
voidoo 
SetUnviewedoo 
(oo  
stringoo  &
useroo' +
,oo+ ,
Guidoo- 1
idoo2 4
)oo4 5
{pp 	
ifqq 
(qq 
Storesqq 
!=qq 
nullqq 
)qq 
{rr 
ifss 
(ss 
AllowParallelOpsss $
)ss$ %
{tt 
Paralleluu 
.uu 
ForEachuu $
(uu$ %
Storesuu% +
,uu+ ,
xuu- .
=>uu/ 1
xuu2 3
.uu3 4
SetUnvieweduu4 ?
(uu? @
useruu@ D
,uuD E
iduuF H
)uuH I
)uuI J
;uuJ K
}vv 
elseww 
{xx 
Storesyy 
.yy 
ForEachyy "
(yy" #
xyy# $
=>yy% '
xyy( )
.yy) *
SetUnviewedyy* 5
(yy5 6
useryy6 :
,yy: ;
idyy< >
)yy> ?
)yy? @
;yy@ A
}zz 
}{{ 
}|| 	
public
ÇÇ 
void
ÇÇ 
	SetViewed
ÇÇ 
(
ÇÇ 
string
ÇÇ $
user
ÇÇ% )
,
ÇÇ) *
Guid
ÇÇ+ /
id
ÇÇ0 2
)
ÇÇ2 3
{
ÉÉ 	
if
ÑÑ 
(
ÑÑ 
Stores
ÑÑ 
!=
ÑÑ 
null
ÑÑ 
)
ÑÑ 
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
AllowParallelOps
ÜÜ $
)
ÜÜ$ %
{
áá 
Parallel
àà 
.
àà 
ForEach
àà $
(
àà$ %
Stores
àà% +
,
àà+ ,
x
àà- .
=>
àà/ 1
x
àà2 3
.
àà3 4
	SetViewed
àà4 =
(
àà= >
user
àà> B
,
ààB C
id
ààD F
)
ààF G
)
ààG H
;
ààH I
}
ââ 
else
ää 
{
ãã 
Stores
åå 
.
åå 
ForEach
åå "
(
åå" #
x
åå# $
=>
åå% '
x
åå( )
.
åå) *
	SetViewed
åå* 3
(
åå3 4
user
åå4 8
,
åå8 9
id
åå: <
)
åå< =
)
åå= >
;
åå> ?
}
çç 
}
éé 
}
èè 	
public
óó 
List
óó 
<
óó 
Guid
óó 
>
óó 
GetUnviewedIds
óó (
(
óó( )
string
óó) /
user
óó0 4
)
óó4 5
{
òò 	
var
ôô 
results
ôô 
=
ôô 
new
ôô 
List
ôô "
<
ôô" #
Guid
ôô# '
>
ôô' (
(
ôô( )
)
ôô) *
;
ôô* +
if
öö 
(
öö 
Stores
öö 
!=
öö 
null
öö 
)
öö 
{
õõ 
if
úú 
(
úú 
AllowParallelOps
úú $
)
úú$ %
{
ùù 
var
ûû 
locker
ûû 
=
ûû  
new
ûû! $
object
ûû% +
(
ûû+ ,
)
ûû, -
;
ûû- .
Parallel
üü 
.
üü 
ForEach
üü $
(
üü$ %
Stores
üü% +
,
üü+ ,
x
üü- .
=>
üü/ 1
{
†† 
var
°° 
result
°° "
=
°°# $
x
°°% &
.
°°& '
GetUnviewedIds
°°' 5
(
°°5 6
user
°°6 :
)
°°: ;
;
°°; <
lock
¢¢ 
(
¢¢ 
locker
¢¢ $
)
¢¢$ %
{
££ 
results
§§ #
.
§§# $
AddRange
§§$ ,
(
§§, -
result
§§- 3
)
§§3 4
;
§§4 5
}
•• 
}
¶¶ 
)
¶¶ 
;
¶¶ 
}
ßß 
else
®® 
{
©© 
Stores
™™ 
.
™™ 
ForEach
™™ "
(
™™" #
x
™™# $
=>
™™% '
results
™™( /
.
™™/ 0
AddRange
™™0 8
(
™™8 9
x
™™9 :
.
™™: ;
GetUnviewedIds
™™; I
(
™™I J
user
™™J N
)
™™N O
)
™™O P
)
™™P Q
;
™™Q R
}
´´ 
results
¨¨ 
=
¨¨ 
results
¨¨ !
.
¨¨! "
Distinct
¨¨" *
(
¨¨* +
)
¨¨+ ,
.
¨¨, -
ToList
¨¨- 3
(
¨¨3 4
)
¨¨4 5
;
¨¨5 6
}
≠≠ 
return
ÆÆ 
results
ÆÆ 
;
ÆÆ 
}
ØØ 	
}
∞∞ 
}±± «≥
[C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Storage\SqlServerStorage.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Storage" )
{ 
public 

class 
SqlServerStorage !
:" #
DatabaseStorageBase$ 7
{ 
private 
const 
string 
SqlStatements *
=+ ,
$str- S
;S T
public!! 
SqlServerStorage!! 
(!!  
string!!  &
connectionString!!' 7
)!!7 8
:"" 
base"" 
("" 
connectionString"" #
)""# $
{## 	
}$$ 	
public,, 
SqlServerStorage,, 
(,,  $
ConnectionStringSettings,,  8$
connectionStringSettings,,9 Q
),,Q R
:-- 
base-- 
(-- $
connectionStringSettings-- *
.--* +
ConnectionString--+ ;
)--; <
{.. 	
}// 	
public55 
override55 
void55 
Save55 !
(55! "
MiniProfiler55" .
profiler55/ 7
)557 8
{66 	
const77 
string77 
sql77 
=77 
$str8K >
;KK> ?
usingMM 
(MM 
varMM 
connMM 
=MM 
GetOpenConnectionMM /
(MM/ 0
)MM0 1
)MM1 2
{NN 
connOO 
.OO 
ExecuteOO 
(OO 
sqlPP 
,PP 
newQQ 
{RR 
profilerSS $
.SS$ %
IdSS% '
,SS' (
profilerTT $
.TT$ %
StartedTT% ,
,TT, -
UserUU  
=UU! "
profilerUU# +
.UU+ ,
UserUU, 0
.UU0 1
TruncateUU1 9
(UU9 :
$numUU: =
)UU= >
,UU> ?
RootTimingIdVV (
=VV) *
profilerVV+ 3
.VV3 4
RootVV4 8
!=VV9 ;
nullVV< @
?VVA B
profilerVVC K
.VVK L
RootVVL P
.VVP Q
IdVVQ S
:VVT U
(VVV W
GuidVVW [
?VV[ \
)VV\ ]
nullVV] a
,VVa b
profilerWW $
.WW$ % 
DurationMillisecondsWW% 9
,WW9 :
profilerXX $
.XX$ %
HasUserViewedXX% 2
,XX2 3
MachineNameYY '
=YY( )
profilerYY* 2
.YY2 3
MachineNameYY3 >
.YY> ?
TruncateYY? G
(YYG H
$numYYH K
)YYK L
,YYL M
profilerZZ $
.ZZ$ %
CustomLinksJsonZZ% 4
,ZZ4 5&
ClientTimingsRedirectCount[[ 6
=[[7 8
profiler[[9 A
.[[A B
ClientTimings[[B O
!=[[P R
null[[S W
?[[X Y
profiler[[Z b
.[[b c
ClientTimings[[c p
.[[p q
RedirectCount[[q ~
:	[[ Ä
(
[[Å Ç
int
[[Ç Ö
?
[[Ö Ü
)
[[Ü á
null
[[á ã
}\\ 
)\\ 
;\\ 
var^^ 
timings^^ 
=^^ 
new^^ !
List^^" &
<^^& '
Timing^^' -
>^^- .
(^^. /
)^^/ 0
;^^0 1
if__ 
(__ 
profiler__ 
.__ 
Root__ !
!=__" $
null__% )
)__) *
{`` 
profileraa 
.aa 
Rootaa !
.aa! "
MiniProfilerIdaa" 0
=aa1 2
profileraa3 ;
.aa; <
Idaa< >
;aa> ?
FlattenTimingsbb "
(bb" #
profilerbb# +
.bb+ ,
Rootbb, 0
,bb0 1
timingsbb2 9
)bb9 :
;bb: ;
}cc 
SaveTimingsee 
(ee 
timingsee #
,ee# $
connee% )
)ee) *
;ee* +
ifff 
(ff 
profilerff 
.ff 
ClientTimingsff *
!=ff+ -
nullff. 2
&&ff3 5
profilerff6 >
.ff> ?
ClientTimingsff? L
.ffL M
TimingsffM T
!=ffU W
nullffX \
&&ff] _
profilerff` h
.ffh i
ClientTimingsffi v
.ffv w
Timingsffw ~
.ff~ 
Any	ff Ç
(
ffÇ É
)
ffÉ Ñ
)
ffÑ Ö
{gg 
profilerii 
.ii 
ClientTimingsii *
.ii* +
Timingsii+ 2
.ii2 3
ForEachii3 :
(ii: ;
xii; <
=>ii= ?
{jj 
xkk 
.kk 
MiniProfilerIdkk (
=kk) *
profilerkk+ 3
.kk3 4
Idkk4 6
;kk6 7
xll 
.ll 
Idll 
=ll 
Guidll #
.ll# $
NewGuidll$ +
(ll+ ,
)ll, -
;ll- .
}mm 
)mm 
;mm 
SaveClientTimingsnn %
(nn% &
profilernn& .
.nn. /
ClientTimingsnn/ <
.nn< =
Timingsnn= D
,nnD E
connnnF J
)nnJ K
;nnK L
}oo 
}pp 
}qq 	
privatess 
voidss 
SaveTimingsss  
(ss  !
Listss! %
<ss% &
Timingss& ,
>ss, -
timingsss. 5
,ss5 6
DbConnectionss7 C
connssD H
)ssH I
{tt 	
constuu 
stringuu 
sqluu 
=uu 
$str	uà D
;
ààD E
foreach
ää 
(
ää 
var
ää 
timing
ää 
in
ää  "
timings
ää# *
)
ää* +
{
ãã 
conn
åå 
.
åå 
Execute
åå 
(
åå 
sql
çç 
,
çç 
new
éé 
{
èè 
timing
êê "
.
êê" #
Id
êê# %
,
êê% &
timing
ëë "
.
ëë" #
MiniProfilerId
ëë# 1
,
ëë1 2
timing
íí "
.
íí" #
ParentTimingId
íí# 1
,
íí1 2
Name
ìì  
=
ìì! "
timing
ìì# )
.
ìì) *
Name
ìì* .
.
ìì. /
Truncate
ìì/ 7
(
ìì7 8
$num
ìì8 ;
)
ìì; <
,
ìì< =
timing
îî "
.
îî" #"
DurationMilliseconds
îî# 7
,
îî7 8
timing
ïï "
.
ïï" #
StartMilliseconds
ïï# 4
,
ïï4 5
timing
ññ "
.
ññ" #
IsRoot
ññ# )
,
ññ) *
timing
óó "
.
óó" #
Depth
óó# (
,
óó( )
timing
òò "
.
òò" #
CustomTimingsJson
òò# 4
}
ôô 
)
ôô 
;
ôô 
}
öö 
}
õõ 	
private
ùù 
void
ùù 
SaveClientTimings
ùù &
(
ùù& '
List
ùù' +
<
ùù+ ,
ClientTimings
ùù, 9
.
ùù9 :
ClientTiming
ùù: F
>
ùùF G
timings
ùùH O
,
ùùO P
DbConnection
ùùQ ]
conn
ùù^ b
)
ùùb c
{
ûû 	
const
üü 
string
üü 
sql
üü 
=
üü 
$str
ü™ J
;
™™J K
foreach
¨¨ 
(
¨¨ 
var
¨¨ 
timing
¨¨ 
in
¨¨  "
timings
¨¨# *
)
¨¨* +
{
≠≠ 
conn
ÆÆ 
.
ÆÆ 
Execute
ÆÆ 
(
ÆÆ 
sql
ØØ 
,
ØØ 
new
∞∞ 
{
±± 
timing
≤≤ 
.
≤≤ 
Id
≤≤ !
,
≤≤! "
timing
≥≥ 
.
≥≥ 
MiniProfilerId
≥≥ -
,
≥≥- .
Name
¥¥ 
=
¥¥ 
timing
¥¥ %
.
¥¥% &
Name
¥¥& *
.
¥¥* +
Truncate
¥¥+ 3
(
¥¥3 4
$num
¥¥4 7
)
¥¥7 8
,
¥¥8 9
timing
µµ 
.
µµ 
Start
µµ $
,
µµ$ %
timing
∂∂ 
.
∂∂ 
Duration
∂∂ '
}
∑∑ 
)
∑∑ 
;
∑∑ 
}
∏∏ 
}
ππ 	
private
ªª 
void
ªª 
FlattenTimings
ªª #
(
ªª# $
Timing
ªª$ *
timing
ªª+ 1
,
ªª1 2
List
ªª3 7
<
ªª7 8
Timing
ªª8 >
>
ªª> ?
timingsCollection
ªª@ Q
)
ªªQ R
{
ºº 	
timingsCollection
ΩΩ 
.
ΩΩ 
Add
ΩΩ !
(
ΩΩ! "
timing
ΩΩ" (
)
ΩΩ( )
;
ΩΩ) *
if
ææ 
(
ææ 
timing
ææ 
.
ææ 
HasChildren
ææ "
)
ææ" #
{
øø 
timing
¿¿ 
.
¿¿ 
Children
¿¿ 
.
¿¿  
ForEach
¿¿  '
(
¿¿' (
x
¿¿( )
=>
¿¿* ,
FlattenTimings
¿¿- ;
(
¿¿; <
x
¿¿< =
,
¿¿= >
timingsCollection
¿¿? P
)
¿¿P Q
)
¿¿Q R
;
¿¿R S
}
¡¡ 
}
¬¬ 	
public
…… 
override
…… 
MiniProfiler
…… $
Load
……% )
(
……) *
Guid
……* .
id
……/ 1
)
……1 2
{
   	
using
ÀÀ 
(
ÀÀ 
var
ÀÀ 
conn
ÀÀ 
=
ÀÀ 
GetOpenConnection
ÀÀ /
(
ÀÀ/ 0
)
ÀÀ0 1
)
ÀÀ1 2
{
ÃÃ 
var
ÕÕ 
idParameter
ÕÕ 
=
ÕÕ  !
new
ÕÕ" %
{
ÕÕ& '
id
ÕÕ( *
}
ÕÕ+ ,
;
ÕÕ, -
var
ŒŒ 
result
ŒŒ 
=
ŒŒ  
LoadProfilerRecord
ŒŒ /
(
ŒŒ/ 0
conn
ŒŒ0 4
,
ŒŒ4 5
idParameter
ŒŒ6 A
)
ŒŒA B
;
ŒŒB C
if
–– 
(
–– 
result
–– 
!=
–– 
null
–– "
)
––" #
{
—— 
result
”” 
.
”” 
Started
”” "
=
””# $
new
””% (
DateTime
””) 1
(
””1 2
result
””2 8
.
””8 9
Started
””9 @
.
””@ A
Ticks
””A F
,
””F G
DateTimeKind
””H T
.
””T U
Utc
””U X
)
””X Y
;
””Y Z
}
‘‘ 
return
÷÷ 
result
÷÷ 
;
÷÷ 
}
◊◊ 
}
ÿÿ 	
public
ﬂﬂ 
override
ﬂﬂ 
void
ﬂﬂ 
SetUnviewed
ﬂﬂ (
(
ﬂﬂ( )
string
ﬂﬂ) /
user
ﬂﬂ0 4
,
ﬂﬂ4 5
Guid
ﬂﬂ6 :
id
ﬂﬂ; =
)
ﬂﬂ= >
{
‡‡ 	
using
·· 
(
·· 
var
·· 
conn
·· 
=
·· 
GetOpenConnection
·· /
(
··/ 0
)
··0 1
)
··1 2
{
‚‚ 
conn
„„ 
.
„„ 
Execute
„„ 
(
„„ 
$str
„„ k
,
„„k l
new
„„m p
{
„„q r
id
„„s u
,
„„u v
user
„„w {
}
„„| }
)
„„} ~
;
„„~ 
}
‰‰ 
}
ÂÂ 	
public
ÏÏ 
override
ÏÏ 
void
ÏÏ 
	SetViewed
ÏÏ &
(
ÏÏ& '
string
ÏÏ' -
user
ÏÏ. 2
,
ÏÏ2 3
Guid
ÏÏ4 8
id
ÏÏ9 ;
)
ÏÏ; <
{
ÌÌ 	
using
ÓÓ 
(
ÓÓ 
var
ÓÓ 
conn
ÓÓ 
=
ÓÓ 
GetOpenConnection
ÓÓ /
(
ÓÓ/ 0
)
ÓÓ0 1
)
ÓÓ1 2
{
ÔÔ 
conn
 
.
 
Execute
 
(
 
$str
 k
,
k l
new
m p
{
q r
id
s u
,
u v
user
w {
}
| }
)
} ~
;
~ 
}
ÒÒ 
}
ÚÚ 	
public
˘˘ 
override
˘˘ 
List
˘˘ 
<
˘˘ 
Guid
˘˘ !
>
˘˘! "
GetUnviewedIds
˘˘# 1
(
˘˘1 2
string
˘˘2 8
user
˘˘9 =
)
˘˘= >
{
˙˙ 	
const
˚˚ 
string
˚˚ 
Sql
˚˚ 
=
˚˚ 
$str
¸Ä "
;
ÄÄ" #
using
ÇÇ 
(
ÇÇ 
var
ÇÇ 
conn
ÇÇ 
=
ÇÇ 
GetOpenConnection
ÇÇ /
(
ÇÇ/ 0
)
ÇÇ0 1
)
ÇÇ1 2
{
ÉÉ 
return
ÑÑ 
conn
ÑÑ 
.
ÑÑ 
Query
ÑÑ !
<
ÑÑ! "
Guid
ÑÑ" &
>
ÑÑ& '
(
ÑÑ' (
Sql
ÑÑ( +
,
ÑÑ+ ,
new
ÑÑ- 0
{
ÑÑ1 2
user
ÑÑ3 7
}
ÑÑ8 9
)
ÑÑ9 :
.
ÑÑ: ;
ToList
ÑÑ; A
(
ÑÑA B
)
ÑÑB C
;
ÑÑC D
}
ÖÖ 
}
ÜÜ 	
public
êê 
override
êê 
IEnumerable
êê #
<
êê# $
Guid
êê$ (
>
êê( )
List
êê* .
(
êê. /
int
êê/ 2

maxResults
êê3 =
,
êê= >
DateTime
êê? G
?
êêG H
start
êêI N
=
êêO P
null
êêQ U
,
êêU V
DateTime
êêW _
?
êê_ `
finish
êêa g
=
êêh i
null
êêj n
,
êên o
ListResultsOrderêêp Ä
orderByêêÅ à
=êêâ ä 
ListResultsOrderêêã õ
.êêõ ú

Descendingêêú ¶
)êê¶ ß
{
ëë 	
var
íí 
builder
íí 
=
íí 
new
íí 

SqlBuilder
íí (
(
íí( )
)
íí) *
;
íí* +
var
ìì 
t
ìì 
=
ìì 
builder
ìì 
.
ìì 
AddTemplate
ìì '
(
ìì' (
$str
ìì( 5
+
ìì6 7

maxResults
ìì8 B
+
ììC D
$str
ììE w
)
ììw x
;
ììx y
if
ïï 
(
ïï 
finish
ïï 
!=
ïï 
null
ïï 
)
ïï 
{
ññ 
builder
óó 
.
óó 
Where
óó 
(
óó 
$str
óó 1
,
óó1 2
new
óó3 6
{
óó7 8
finish
óó9 ?
}
óó@ A
)
óóA B
;
óóB C
}
òò 
if
öö 
(
öö 
start
öö 
!=
öö 
null
öö 
)
öö 
{
õõ 
builder
úú 
.
úú 
Where
úú 
(
úú 
$str
úú 0
,
úú0 1
new
úú2 5
{
úú6 7
start
úú8 =
}
úú> ?
)
úú? @
;
úú@ A
}
ùù 
builder
üü 
.
üü 
OrderBy
üü 
(
üü 
orderBy
üü #
==
üü$ &
ListResultsOrder
üü' 7
.
üü7 8

Descending
üü8 B
?
üüC D
$str
üüE S
:
üüT U
$str
üüV c
)
üüc d
;
üüd e
using
°° 
(
°° 
var
°° 
conn
°° 
=
°° 
GetOpenConnection
°° /
(
°°/ 0
)
°°0 1
)
°°1 2
{
¢¢ 
return
££ 
conn
££ 
.
££ 
Query
££ !
<
££! "
Guid
££" &
>
££& '
(
££' (
t
££( )
.
££) *
RawSql
££* 0
,
££0 1
t
££2 3
.
££3 4

Parameters
££4 >
)
££> ?
.
££? @
ToList
££@ F
(
££F G
)
££G H
;
££H I
}
§§ 
}
•• 	
private
≠≠ 
MiniProfiler
≠≠  
LoadProfilerRecord
≠≠ /
(
≠≠/ 0
DbConnection
≠≠0 <

connection
≠≠= G
,
≠≠G H
object
≠≠I O
keyParameter
≠≠P \
)
≠≠\ ]
{
ÆÆ 	
MiniProfiler
ØØ 
profiler
ØØ !
;
ØØ! "
using
∞∞ 
(
∞∞ 
var
∞∞ 
multi
∞∞ 
=
∞∞ 

connection
∞∞ )
.
∞∞) *
QueryMultiple
∞∞* 7
(
∞∞7 8
SqlStatements
∞∞8 E
,
∞∞E F
keyParameter
∞∞G S
)
∞∞S T
)
∞∞T U
{
±± 
profiler
≤≤ 
=
≤≤ 
multi
≤≤  
.
≤≤  !
Read
≤≤! %
<
≤≤% &
MiniProfiler
≤≤& 2
>
≤≤2 3
(
≤≤3 4
)
≤≤4 5
.
≤≤5 6
SingleOrDefault
≤≤6 E
(
≤≤E F
)
≤≤F G
;
≤≤G H
var
≥≥ 
timings
≥≥ 
=
≥≥ 
multi
≥≥ #
.
≥≥# $
Read
≥≥$ (
<
≥≥( )
Timing
≥≥) /
>
≥≥/ 0
(
≥≥0 1
)
≥≥1 2
.
≥≥2 3
ToList
≥≥3 9
(
≥≥9 :
)
≥≥: ;
;
≥≥; <
var
¥¥ 
clientTimings
¥¥ !
=
¥¥" #
multi
¥¥$ )
.
¥¥) *
Read
¥¥* .
<
¥¥. /
ClientTimings
¥¥/ <
.
¥¥< =
ClientTiming
¥¥= I
>
¥¥I J
(
¥¥J K
)
¥¥K L
.
¥¥L M
ToList
¥¥M S
(
¥¥S T
)
¥¥T U
;
¥¥U V
if
∂∂ 
(
∂∂ 
profiler
∂∂ 
!=
∂∂ 
null
∂∂  $
&&
∂∂% '
profiler
∂∂( 0
.
∂∂0 1
RootTimingId
∂∂1 =
.
∂∂= >
HasValue
∂∂> F
&&
∂∂G I
timings
∂∂J Q
.
∂∂Q R
Any
∂∂R U
(
∂∂U V
)
∂∂V W
)
∂∂W X
{
∑∑ 
var
∏∏ 

rootTiming
∏∏ "
=
∏∏# $
timings
∏∏% ,
.
∏∏, -
SingleOrDefault
∏∏- <
(
∏∏< =
x
∏∏= >
=>
∏∏? A
x
∏∏B C
.
∏∏C D
Id
∏∏D F
==
∏∏G I
profiler
∏∏J R
.
∏∏R S
RootTimingId
∏∏S _
.
∏∏_ `
Value
∏∏` e
)
∏∏e f
;
∏∏f g
if
ππ 
(
ππ 

rootTiming
ππ "
!=
ππ# %
null
ππ& *
)
ππ* +
{
∫∫ 
profiler
ªª  
.
ªª  !
Root
ªª! %
=
ªª& '

rootTiming
ªª( 2
;
ªª2 3
timings
ºº 
.
ºº  
ForEach
ºº  '
(
ºº' (
x
ºº( )
=>
ºº* ,
x
ºº- .
.
ºº. /
Profiler
ºº/ 7
=
ºº8 9
profiler
ºº: B
)
ººB C
;
ººC D
timings
ΩΩ 
.
ΩΩ  
Remove
ΩΩ  &
(
ΩΩ& '

rootTiming
ΩΩ' 1
)
ΩΩ1 2
;
ΩΩ2 3
var
ææ #
timingsLookupByParent
ææ 1
=
ææ2 3
timings
ææ4 ;
.
ææ; <
ToLookup
ææ< D
(
ææD E
x
ææE F
=>
ææG I
x
ææJ K
.
ææK L
ParentTimingId
ææL Z
,
ææZ [
x
ææ\ ]
=>
ææ^ `
x
ææa b
)
ææb c
;
ææc d"
PopulateChildTimings
øø ,
(
øø, -

rootTiming
øø- 7
,
øø7 8#
timingsLookupByParent
øø9 N
)
øøN O
;
øøO P
}
¿¿ 
if
¡¡ 
(
¡¡ 
clientTimings
¡¡ %
.
¡¡% &
Any
¡¡& )
(
¡¡) *
)
¡¡* +
||
¡¡, .
profiler
¡¡/ 7
.
¡¡7 8(
ClientTimingsRedirectCount
¡¡8 R
.
¡¡R S
HasValue
¡¡S [
)
¡¡[ \
{
¬¬ 
profiler
√√  
.
√√  !
ClientTimings
√√! .
=
√√/ 0
new
√√1 4
ClientTimings
√√5 B
{
ƒƒ 
RedirectCount
≈≈ )
=
≈≈* +
profiler
≈≈, 4
.
≈≈4 5(
ClientTimingsRedirectCount
≈≈5 O
??
≈≈P R
$num
≈≈S T
,
≈≈T U
Timings
∆∆ #
=
∆∆$ %
clientTimings
∆∆& 3
}
«« 
;
«« 
}
»» 
}
…… 
}
   
return
ÀÀ 
profiler
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
private
‘‘ 
void
‘‘ "
PopulateChildTimings
‘‘ )
(
‘‘) *
Timing
‘‘* 0
parent
‘‘1 7
,
‘‘7 8
ILookup
‘‘9 @
<
‘‘@ A
Guid
‘‘A E
,
‘‘E F
Timing
‘‘G M
>
‘‘M N#
timingsLookupByParent
‘‘O d
)
‘‘d e
{
’’ 	
if
÷÷ 
(
÷÷ #
timingsLookupByParent
÷÷ %
.
÷÷% &
Contains
÷÷& .
(
÷÷. /
parent
÷÷/ 5
.
÷÷5 6
Id
÷÷6 8
)
÷÷8 9
)
÷÷9 :
{
◊◊ 
foreach
ÿÿ 
(
ÿÿ 
var
ÿÿ 
timing
ÿÿ #
in
ÿÿ$ &#
timingsLookupByParent
ÿÿ' <
[
ÿÿ< =
parent
ÿÿ= C
.
ÿÿC D
Id
ÿÿD F
]
ÿÿF G
.
ÿÿG H
OrderBy
ÿÿH O
(
ÿÿO P
x
ÿÿP Q
=>
ÿÿR T
x
ÿÿU V
.
ÿÿV W
StartMilliseconds
ÿÿW h
)
ÿÿh i
)
ÿÿi j
{
ŸŸ 
parent
⁄⁄ 
.
⁄⁄ 
AddChild
⁄⁄ #
(
⁄⁄# $
timing
⁄⁄$ *
)
⁄⁄* +
;
⁄⁄+ ,"
PopulateChildTimings
€€ (
(
€€( )
timing
€€) /
,
€€/ 0#
timingsLookupByParent
€€1 F
)
€€F G
;
€€G H
}
‹‹ 
}
›› 
}
ﬁﬁ 	
	protected
„„ 
virtual
„„ 
DbConnection
„„ &
GetConnection
„„' 4
(
„„4 5
)
„„5 6
{
‰‰ 	
return
ÂÂ 
new
ÂÂ 
SqlConnection
ÂÂ $
(
ÂÂ$ %
ConnectionString
ÂÂ% 5
)
ÂÂ5 6
;
ÂÂ6 7
}
ÊÊ 	
	protected
ÎÎ 
DbConnection
ÎÎ 
GetOpenConnection
ÎÎ 0
(
ÎÎ0 1
)
ÎÎ1 2
{
ÏÏ 	
var
ÌÌ 
result
ÌÌ 
=
ÌÌ 
GetConnection
ÌÌ &
(
ÌÌ& '
)
ÌÌ' (
;
ÌÌ( )
if
ÓÓ 
(
ÓÓ 
result
ÓÓ 
.
ÓÓ 
State
ÓÓ 
!=
ÓÓ 
System
ÓÓ  &
.
ÓÓ& '
Data
ÓÓ' +
.
ÓÓ+ ,
ConnectionState
ÓÓ, ;
.
ÓÓ; <
Open
ÓÓ< @
)
ÓÓ@ A
result
ÔÔ 
.
ÔÔ 
Open
ÔÔ 
(
ÔÔ 
)
ÔÔ 
;
ÔÔ 
return
 
result
 
;
 
}
ÒÒ 	
[
˘˘ 	
SuppressMessage
˘˘	 
(
˘˘ 
$str
˘˘ 8
,
˘˘8 9
$str
˘˘: `
,
˘˘` a
Justification
˘˘b o
=
˘˘p q
$str˘˘r ï
)˘˘ï ñ
]˘˘ñ ó
public
˙˙ 
static
˙˙ 
readonly
˙˙ 
string
˙˙ %!
TableCreationScript
˙˙& 9
=
˙˙: ;
$str
˚≠ 
;
≠≠ 
}
ØØ 
}∞∞ 
NC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Suppression.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
[		 
DataContract		 
]		 
public

 

class

 
Suppression

 
:

 
IDisposable

 *
{ 
private 
readonly 
bool 
_wasSuppressed ,
;, -
[ 	
Obsolete	 
( 
$str *
)* +
]+ ,
public 
Suppression 
( 
) 
{ 	
} 	
public 
Suppression 
( 
MiniProfiler '
profiler( 0
)0 1
{ 	
if 
( 
profiler 
== 
null  
)  !
{ 
throw   
new   !
ArgumentNullException   /
(  / 0
$str  0 :
)  : ;
;  ; <
}!! 
Profiler## 
=## 
profiler## 
;##  
if$$ 
($$ 
!$$ 
Profiler$$ 
.$$ 
IsActive$$ "
)$$" #
{%% 
return&& 
;&& 
}'' 
Profiler)) 
.)) 
IsActive)) 
=)) 
false))  %
;))% &
_wasSuppressed** 
=** 
true** !
;**! "
}++ 	
internal00 
MiniProfiler00 
Profiler00 &
{00' (
get00) ,
;00, -
private00. 5
set006 9
;009 :
}00; <
void22 
IDisposable22 
.22 
Dispose22  
(22  !
)22! "
{33 	
if44 
(44 
Profiler44 
!=44 
null44 
&&44  "
_wasSuppressed44# 1
)441 2
{55 
Profiler66 
.66 
IsActive66 !
=66" #
true66$ (
;66( )
}77 
}88 	
}99 
}:: Ë
SC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ExecuteType.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public 

enum 
SqlExecuteType 
:  
byte! %
{ 
None 
= 
$num 
, 
NonQuery 
= 
$num 
, 
Scalar 
= 
$num 
, 
Reader 
= 
$num 
} 
} ¶

SC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\IDbProfiler.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public

 

	interface

 
IDbProfiler

  
{ 
bool 
IsActive 
{ 
get 
; 
} 
void 
ExecuteStart 
( 

IDbCommand $
profiledDbCommand% 6
,6 7
SqlExecuteType8 F
executeTypeG R
)R S
;S T
void"" 
ExecuteFinish"" 
("" 

IDbCommand"" %
profiledDbCommand""& 7
,""7 8
SqlExecuteType""9 G
executeType""H S
,""S T
DbDataReader""U a
reader""b h
)""h i
;""i j
void(( 
ReaderFinish(( 
((( 
IDataReader(( %
reader((& ,
)((, -
;((- .
void00 
OnError00 
(00 

IDbCommand00 
profiledDbCommand00  1
,001 2
SqlExecuteType003 A
executeType00B M
,00M N
	Exception00O X
	exception00Y b
)00b c
;00c d
}11 
}22 Éb
]C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\SimpleProfiledCommand.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public 

class !
SimpleProfiledCommand &
:' (

IDbCommand) 3
,3 4

ICloneable5 ?
{ 
private 

IDbCommand 
_command #
;# $
private 
IDbConnection 
_connection )
;) *
private 
IDbProfiler 
	_profiler %
;% &
private 
IDbTransaction 
_transaction +
;+ ,
public(( !
SimpleProfiledCommand(( $
((($ %

IDbCommand((% /
command((0 7
,((7 8
IDbConnection((9 F

connection((G Q
,((Q R
IDbProfiler((S ^
profiler((_ g
)((g h
{)) 	
if** 
(** 
command** 
==** 
null** 
)**  
throw**! &
new**' *!
ArgumentNullException**+ @
(**@ A
$str**A J
)**J K
;**K L
_command,, 
=,, 
command,, 
;,, 
_connection-- 
=-- 

connection-- $
;--$ %
if// 
(// 
profiler// 
!=// 
null//  
)//  !
{00 
	_profiler11 
=11 
profiler11 $
;11$ %
}22 
}33 	
public88 
void88 
Prepare88 
(88 
)88 
{99 	
_command:: 
.:: 
Prepare:: 
(:: 
):: 
;:: 
};; 	
public@@ 
void@@ 
Cancel@@ 
(@@ 
)@@ 
{AA 	
_commandBB 
.BB 
CancelBB 
(BB 
)BB 
;BB 
}CC 	
publicII 
IDbDataParameterII 
CreateParameterII  /
(II/ 0
)II0 1
{JJ 	
returnKK 
_commandKK 
.KK 
CreateParameterKK +
(KK+ ,
)KK, -
;KK- .
}LL 	
publicRR 
intRR 
ExecuteNonQueryRR "
(RR" #
)RR# $
{SS 	
returnTT 
ProfileWithTT 
(TT 
SqlExecuteTypeTT -
.TT- .
NonQueryTT. 6
,TT6 7
_commandTT8 @
.TT@ A
ExecuteNonQueryTTA P
)TTP Q
;TTQ R
}UU 	
public[[ 
IDataReader[[ 
ExecuteReader[[ (
([[( )
)[[) *
{\\ 	
return]] 
ProfileWith]] 
(]] 
SqlExecuteType^^ 
.^^ 
Reader^^ %
,^^% &
(^^' (
)^^( )
=>^^* ,
new^^- 0$
SimpleProfiledDataReader^^1 I
(^^I J
_command^^J R
.^^R S
ExecuteReader^^S `
(^^` a
)^^a b
,^^b c
	_profiler^^d m
)^^m n
)^^n o
;^^o p
}__ 	
publicff 
IDataReaderff 
ExecuteReaderff (
(ff( )
CommandBehaviorff) 8
behaviorff9 A
)ffA B
{gg 	
returnhh 
ProfileWithhh 
(hh 
SqlExecuteTypeii 
.ii 
Readerii %
,ii% &
(ii' (
)ii( )
=>ii* ,
newii- 0$
SimpleProfiledDataReaderii1 I
(iiI J
_commandiiJ R
.iiR S
ExecuteReaderiiS `
(ii` a
behavioriia i
)iii j
,iij k
	_profileriil u
)iiu v
)iiv w
;iiw x
}jj 	
publicpp 
objectpp 
ExecuteScalarpp #
(pp# $
)pp$ %
{qq 	
returnrr 
ProfileWithrr 
(rr 
SqlExecuteTyperr -
.rr- .
Scalarrr. 4
,rr4 5
(rr6 7
)rr7 8
=>rr9 ;
_commandrr< D
.rrD E
ExecuteScalarrrE R
(rrR S
)rrS T
)rrT U
;rrU V
}ss 	
private{{ 
TResult{{ 
ProfileWith{{ #
<{{# $
TResult{{$ +
>{{+ ,
({{, -
SqlExecuteType{{- ;
type{{< @
,{{@ A
Func{{B F
<{{F G
TResult{{G N
>{{N O
func{{P T
){{T U
{|| 	
if}} 
(}} 
	_profiler}} 
==}} 
null}} !
||}}" $
!}}% &
	_profiler}}& /
.}}/ 0
IsActive}}0 8
)}}8 9
{~~ 
return 
func 
( 
) 
; 
}
ÄÄ 
TResult
ÇÇ 
result
ÇÇ 
;
ÇÇ 
	_profiler
ÉÉ 
.
ÉÉ 
ExecuteStart
ÉÉ "
(
ÉÉ" #
this
ÉÉ# '
,
ÉÉ' (
type
ÉÉ) -
)
ÉÉ- .
;
ÉÉ. /
try
ÑÑ 
{
ÖÖ 
result
ÜÜ 
=
ÜÜ 
func
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ  
}
áá 
catch
àà 
(
àà 
	Exception
àà 
e
àà 
)
àà 
{
ââ 
	_profiler
ää 
.
ää 
OnError
ää !
(
ää! "
this
ää" &
,
ää& '
type
ää( ,
,
ää, -
e
ää. /
)
ää/ 0
;
ää0 1
throw
ãã 
;
ãã 
}
åå 
finally
çç 
{
éé 
	_profiler
èè 
.
èè 
ExecuteFinish
èè '
(
èè' (
this
èè( ,
,
èè, -
type
èè. 2
,
èè2 3
null
èè4 8
)
èè8 9
;
èè9 :
}
êê 
return
ëë 
result
ëë 
;
ëë 
}
íí 	
public
óó 
IDbConnection
óó 

Connection
óó '
{
òò 	
get
ôô 
{
öö 
return
õõ 
_connection
õõ "
;
õõ" #
}
úú 
set
ùù 
{
ûû 
if
üü 
(
üü 
MiniProfiler
üü  
.
üü  !
Current
üü! (
!=
üü) +
null
üü, 0
)
üü0 1
{
†† 
	_profiler
°° 
=
°° 
MiniProfiler
°°  ,
.
°°, -
Current
°°- 4
;
°°4 5
}
¢¢ 
_connection
§§ 
=
§§ 
value
§§ #
;
§§# $
var
¶¶ 
wrapped
¶¶ 
=
¶¶ 
value
¶¶ #
as
¶¶$ &&
SimpleProfiledConnection
¶¶' ?
;
¶¶? @
_command
ßß 
.
ßß 

Connection
ßß #
=
ßß$ %
wrapped
ßß& -
!=
ßß. 0
null
ßß1 5
?
ßß6 7
wrapped
ßß8 ?
.
ßß? @
WrappedConnection
ßß@ Q
:
ßßR S
value
ßßT Y
;
ßßY Z
}
®® 
}
©© 	
public
ÆÆ 
IDbTransaction
ÆÆ 
Transaction
ÆÆ )
{
ØØ 	
get
∞∞ 
{
±± 
return
≤≤ 
_transaction
≤≤ #
;
≤≤# $
}
≥≥ 
set
¥¥ 
{
µµ 
_transaction
∂∂ 
=
∂∂ 
value
∂∂ $
;
∂∂$ %
var
∑∑ 
wrapped
∑∑ 
=
∑∑ 
value
∑∑ #
as
∑∑$ &'
SimpleProfiledTransaction
∑∑' @
;
∑∑@ A
_command
∏∏ 
.
∏∏ 
Transaction
∏∏ $
=
∏∏% &
wrapped
∏∏' .
!=
∏∏/ 1
null
∏∏2 6
?
∏∏7 8
wrapped
∏∏9 @
.
∏∏@ A 
WrappedTransaction
∏∏A S
:
∏∏T U
value
∏∏V [
;
∏∏[ \
}
ππ 
}
∫∫ 	
[
øø 	
SuppressMessage
øø	 
(
øø 
$str
øø -
,
øø- .
$str
øø/ g
,
øøg h
Justification
øøi v
=
øøw x
$strøøy ç
)øøç é
]øøé è
public
¿¿ 
string
¿¿ 
CommandText
¿¿ !
{
¡¡ 	
get
¬¬ 
{
¬¬ 
return
¬¬ 
_command
¬¬ !
.
¬¬! "
CommandText
¬¬" -
;
¬¬- .
}
¬¬/ 0
set
√√ 
{
√√ 
_command
√√ 
.
√√ 
CommandText
√√ &
=
√√' (
value
√√) .
;
√√. /
}
√√0 1
}
ƒƒ 	
public
…… 
int
…… 
CommandTimeout
…… !
{
   	
get
ÀÀ 
{
ÀÀ 
return
ÀÀ 
_command
ÀÀ !
.
ÀÀ! "
CommandTimeout
ÀÀ" 0
;
ÀÀ0 1
}
ÀÀ2 3
set
ÃÃ 
{
ÃÃ 
_command
ÃÃ 
.
ÃÃ 
CommandTimeout
ÃÃ )
=
ÃÃ* +
value
ÃÃ, 1
;
ÃÃ1 2
}
ÃÃ3 4
}
ÕÕ 	
public
““ 
CommandType
““ 
CommandType
““ &
{
”” 	
get
‘‘ 
{
‘‘ 
return
‘‘ 
_command
‘‘ !
.
‘‘! "
CommandType
‘‘" -
;
‘‘- .
}
‘‘/ 0
set
’’ 
{
’’ 
_command
’’ 
.
’’ 
CommandType
’’ &
=
’’' (
value
’’) .
;
’’. /
}
’’0 1
}
÷÷ 	
public
€€ &
IDataParameterCollection
€€ '

Parameters
€€( 2
{
‹‹ 	
get
›› 
{
›› 
return
›› 
_command
›› !
.
››! "

Parameters
››" ,
;
››, -
}
››. /
}
ﬁﬁ 	
public
„„ 
UpdateRowSource
„„ 
UpdatedRowSource
„„ /
{
‰‰ 	
get
ÂÂ 
{
ÂÂ 
return
ÂÂ 
_command
ÂÂ !
.
ÂÂ! "
UpdatedRowSource
ÂÂ" 2
;
ÂÂ2 3
}
ÂÂ4 5
set
ÊÊ 
{
ÊÊ 
_command
ÊÊ 
.
ÊÊ 
UpdatedRowSource
ÊÊ +
=
ÊÊ, -
value
ÊÊ. 3
;
ÊÊ3 4
}
ÊÊ5 6
}
ÁÁ 	
public
ÏÏ 
void
ÏÏ 
Dispose
ÏÏ 
(
ÏÏ 
)
ÏÏ 
{
ÌÌ 	
Dispose
ÓÓ 
(
ÓÓ 
true
ÓÓ 
)
ÓÓ 
;
ÓÓ 
GC
ÔÔ 
.
ÔÔ 
SuppressFinalize
ÔÔ 
(
ÔÔ  
this
ÔÔ  $
)
ÔÔ$ %
;
ÔÔ% &
}
 	
	protected
ˆˆ 
virtual
ˆˆ 
void
ˆˆ 
Dispose
ˆˆ &
(
ˆˆ& '
bool
ˆˆ' +
	disposing
ˆˆ, 5
)
ˆˆ5 6
{
˜˜ 	
if
¯¯ 
(
¯¯ 
	disposing
¯¯ 
&&
¯¯ 
_command
¯¯ %
!=
¯¯& (
null
¯¯) -
)
¯¯- .
_command
¯¯/ 7
.
¯¯7 8
Dispose
¯¯8 ?
(
¯¯? @
)
¯¯@ A
;
¯¯A B
_command
˙˙ 
=
˙˙ 
null
˙˙ 
;
˙˙ 
_connection
˚˚ 
=
˚˚ 
null
˚˚ 
;
˚˚ 
	_profiler
¸¸ 
=
¸¸ 
null
¸¸ 
;
¸¸ 
}
˝˝ 	
public
ÉÉ 
object
ÉÉ 
Clone
ÉÉ 
(
ÉÉ 
)
ÉÉ 
{
ÑÑ 	
var
ÖÖ 
tail
ÖÖ 
=
ÖÖ 
_command
ÖÖ 
as
ÖÖ  "

ICloneable
ÖÖ# -
;
ÖÖ- .
if
ÜÜ 
(
ÜÜ 
tail
ÜÜ 
==
ÜÜ 
null
ÜÜ 
)
ÜÜ 
throw
áá 
new
áá #
NotSupportedException
áá /
(
áá/ 0
$str
áá0 =
+
áá> ?
_command
áá@ H
.
ááH I
GetType
ááI P
(
ááP Q
)
ááQ R
.
ááR S
Name
ááS W
+
ááX Y
$str
ááZ n
)
áán o
;
ááo p
return
ââ 
new
ââ #
SimpleProfiledCommand
ââ ,
(
ââ, -
(
ââ- .

IDbCommand
ââ. 8
)
ââ8 9
tail
ââ9 =
.
ââ= >
Clone
ââ> C
(
ââC D
)
ââD E
,
ââE F
_connection
ââG R
,
ââR S
	_profiler
ââT ]
)
ââ] ^
;
ââ^ _
}
ää 	
}
ãã 
}åå º,
`C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\SimpleProfiledConnection.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public

 

class

 $
SimpleProfiledConnection

 )
:

* +
IDbConnection

, 9
{ 
private 
IDbProfiler 
	_profiler %
;% &
private 
IDbConnection 
_connection )
;) *
public 
string 
ConnectionString &
{ 	
get 
{ 
return 
_connection $
.$ %
ConnectionString% 5
;5 6
}7 8
set 
{ 
_connection 
. 
ConnectionString .
=/ 0
value1 6
;6 7
}8 9
} 	
public"" 
int"" 
ConnectionTimeout"" $
{## 	
get$$ 
{$$ 
return$$ 
_connection$$ $
.$$$ %
ConnectionTimeout$$% 6
;$$6 7
}$$8 9
}%% 	
public** 
string** 
Database** 
{++ 	
get,, 
{,, 
return,, 
_connection,, $
.,,$ %
Database,,% -
;,,- .
},,/ 0
}-- 	
public22 
ConnectionState22 
State22 $
{33 	
get44 
{44 
return44 
_connection44 $
.44$ %
State44% *
;44* +
}44, -
}55 	
public:: 
IDbConnection:: 
WrappedConnection:: .
{;; 	
get<< 
{<< 
return<< 
_connection<< $
;<<$ %
}<<& '
}== 	
publicII $
SimpleProfiledConnectionII '
(II' (
IDbConnectionII( 5

connectionII6 @
,II@ A
IDbProfilerIIB M
profilerIIN V
)IIV W
{JJ 	
_connectionKK 
=KK 

connectionKK $
;KK$ %
ifLL 
(LL 
profilerLL 
!=LL 
nullLL  
)LL  !
{MM 
	_profilerNN 
=NN 
profilerNN $
;NN$ %
}OO 
}PP 	
publicVV 
IDbTransactionVV 
BeginTransactionVV .
(VV. /
)VV/ 0
{WW 	
returnXX 
newXX %
SimpleProfiledTransactionXX 0
(XX0 1
_connectionXX1 <
.XX< =
BeginTransactionXX= M
(XXM N
)XXN O
,XXO P
thisXXQ U
)XXU V
;XXV W
}YY 	
public`` 
IDbTransaction`` 
BeginTransaction`` .
(``. /
IsolationLevel``/ =
isolationLevel``> L
)``L M
{aa 	
returnbb 
newbb %
SimpleProfiledTransactionbb 0
(bb0 1
_connectionbb1 <
.bb< =
BeginTransactionbb= M
(bbM N
isolationLevelbbN \
)bb\ ]
,bb] ^
thisbb_ c
)bbc d
;bbd e
}cc 	
publicii 
voidii 
ChangeDatabaseii "
(ii" #
stringii# )
databaseNameii* 6
)ii6 7
{jj 	
_connectionkk 
.kk 
ChangeDatabasekk &
(kk& '
databaseNamekk' 3
)kk3 4
;kk4 5
}ll 	
publicrr 

IDbCommandrr 
CreateCommandrr '
(rr' (
)rr( )
{ss 	
returntt 
newtt !
SimpleProfiledCommandtt ,
(tt, -
_connectiontt- 8
.tt8 9
CreateCommandtt9 F
(ttF G
)ttG H
,ttH I
thisttJ N
,ttN O
	_profilerttP Y
)ttY Z
;ttZ [
}uu 	
publiczz 
voidzz 
Closezz 
(zz 
)zz 
{{{ 	
_connection|| 
.|| 
Close|| 
(|| 
)|| 
;||  
}}} 	
public
ÇÇ 
void
ÇÇ 
Open
ÇÇ 
(
ÇÇ 
)
ÇÇ 
{
ÉÉ 	
_connection
ÑÑ 
.
ÑÑ 
Open
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ää 
void
ää 
Dispose
ää 
(
ää 
)
ää 
{
ãã 	
Dispose
åå 
(
åå 
true
åå 
)
åå 
;
åå 
GC
çç 
.
çç 
SuppressFinalize
çç 
(
çç  
this
çç  $
)
çç$ %
;
çç% &
}
éé 	
private
îî 
void
îî 
Dispose
îî 
(
îî 
bool
îî !
	disposing
îî" +
)
îî+ ,
{
ïï 	
if
ññ 
(
ññ 
	disposing
ññ 
&&
ññ 
_connection
ññ (
!=
ññ) +
null
ññ, 0
&&
ññ1 3
_connection
ññ4 ?
.
ññ? @
State
ññ@ E
!=
ññF H
ConnectionState
ññI X
.
ññX Y
Closed
ññY _
)
ññ_ `
{
óó 
_connection
òò 
.
òò 
Dispose
òò #
(
òò# $
)
òò$ %
;
òò% &
}
ôô 
_connection
öö 
=
öö 
null
öö 
;
öö 
	_profiler
õõ 
=
õõ 
null
õõ 
;
õõ 
}
úú 	
}
ùù 
}ûû ¯h
`C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\SimpleProfiledDataReader.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public		 

class		 $
SimpleProfiledDataReader		 )
:		* +
IDataReader		, 7
{

 
private 
readonly 
IDataReader $
_reader% ,
;, -
private 
readonly 
IDbProfiler $
	_profiler% .
;. /
public $
SimpleProfiledDataReader '
(' (
IDataReader( 3
reader4 :
,: ;
IDbProfiler< G
profilerH P
)P Q
{ 	
if 
( 
reader 
== 
null 
) 
throw  %
new& )!
ArgumentNullException* ?
(? @
$str@ H
)H I
;I J
_reader 
= 
reader 
; 
if   
(   
profiler   
!=   
null    
)    !
{!! 
	_profiler"" 
="" 
profiler"" $
;""$ %
}## 
}$$ 	
public++ 
string++ 
GetName++ 
(++ 
int++ !
index++" '
)++' (
{,, 	
return-- 
_reader-- 
.-- 
GetName-- "
(--" #
index--# (
)--( )
;--) *
}.. 	
public55 
string55 
GetDataTypeName55 %
(55% &
int55& )
index55* /
)55/ 0
{66 	
return77 
_reader77 
.77 
GetDataTypeName77 *
(77* +
index77+ 0
)770 1
;771 2
}88 	
public?? 
Type?? 
GetFieldType??  
(??  !
int??! $
index??% *
)??* +
{@@ 	
returnAA 
_readerAA 
.AA 
GetFieldTypeAA '
(AA' (
indexAA( -
)AA- .
;AA. /
}BB 	
publicII 
objectII 
GetValueII 
(II 
intII "
indexII# (
)II( )
{JJ 	
returnKK 
_readerKK 
.KK 
GetValueKK #
(KK# $
indexKK$ )
)KK) *
;KK* +
}LL 	
publicSS 
intSS 
	GetValuesSS 
(SS 
objectSS #
[SS# $
]SS$ %
valuesSS& ,
)SS, -
{TT 	
returnUU 
_readerUU 
.UU 
	GetValuesUU $
(UU$ %
valuesUU% +
)UU+ ,
;UU, -
}VV 	
public]] 
int]] 

GetOrdinal]] 
(]] 
string]] $
name]]% )
)]]) *
{^^ 	
return__ 
_reader__ 
.__ 

GetOrdinal__ %
(__% &
name__& *
)__* +
;__+ ,
}`` 	
publickk 
boolkk 

GetBooleankk 
(kk 
intkk "
indexkk# (
)kk( )
{ll 	
returnmm 
_readermm 
.mm 

GetBooleanmm %
(mm% &
indexmm& +
)mm+ ,
;mm, -
}nn 	
publicyy 
byteyy 
GetByteyy 
(yy 
intyy 
indexyy  %
)yy% &
{zz 	
return{{ 
_reader{{ 
.{{ 
GetByte{{ "
({{" #
index{{# (
){{( )
;{{) *
}|| 	
public
áá 
long
áá 
GetBytes
áá 
(
áá 
int
áá  
index
áá! &
,
áá& '
long
áá( ,
fieldOffset
áá- 8
,
áá8 9
byte
áá: >
[
áá> ?
]
áá? @
buffer
ááA G
,
ááG H
int
ááI L
bufferoffset
ááM Y
,
ááY Z
int
áá[ ^
length
áá_ e
)
ááe f
{
àà 	
return
ââ 
_reader
ââ 
.
ââ 
GetBytes
ââ #
(
ââ# $
index
ââ$ )
,
ââ) *
fieldOffset
ââ+ 6
,
ââ6 7
buffer
ââ8 >
,
ââ> ?
bufferoffset
ââ@ L
,
ââL M
length
ââN T
)
ââT U
;
ââU V
}
ää 	
public
ïï 
char
ïï 
GetChar
ïï 
(
ïï 
int
ïï 
index
ïï  %
)
ïï% &
{
ññ 	
return
óó 
_reader
óó 
.
óó 
GetChar
óó "
(
óó" #
index
óó# (
)
óó( )
;
óó) *
}
òò 	
public
££ 
long
££ 
GetChars
££ 
(
££ 
int
££  
index
££! &
,
££& '
long
££( ,
fieldoffset
££- 8
,
££8 9
char
££: >
[
££> ?
]
££? @
buffer
££A G
,
££G H
int
££I L
bufferoffset
££M Y
,
££Y Z
int
££[ ^
length
££_ e
)
££e f
{
§§ 	
return
•• 
_reader
•• 
.
•• 
GetChars
•• #
(
••# $
index
••$ )
,
••) *
fieldoffset
••+ 6
,
••6 7
buffer
••8 >
,
••> ?
bufferoffset
••@ L
,
••L M
length
••N T
)
••T U
;
••U V
}
¶¶ 	
public
≠≠ 
Guid
≠≠ 
GetGuid
≠≠ 
(
≠≠ 
int
≠≠ 
index
≠≠  %
)
≠≠% &
{
ÆÆ 	
return
ØØ 
_reader
ØØ 
.
ØØ 
GetGuid
ØØ "
(
ØØ" #
index
ØØ# (
)
ØØ( )
;
ØØ) *
}
∞∞ 	
public
ªª 
short
ªª 
GetInt16
ªª 
(
ªª 
int
ªª !
index
ªª" '
)
ªª' (
{
ºº 	
return
ΩΩ 
_reader
ΩΩ 
.
ΩΩ 
GetInt16
ΩΩ #
(
ΩΩ# $
index
ΩΩ$ )
)
ΩΩ) *
;
ΩΩ* +
}
ææ 	
public
…… 
int
…… 
GetInt32
…… 
(
…… 
int
…… 
index
……  %
)
……% &
{
   	
return
ÀÀ 
_reader
ÀÀ 
.
ÀÀ 
GetInt32
ÀÀ #
(
ÀÀ# $
index
ÀÀ$ )
)
ÀÀ) *
;
ÀÀ* +
}
ÃÃ 	
public
◊◊ 
long
◊◊ 
GetInt64
◊◊ 
(
◊◊ 
int
◊◊  
index
◊◊! &
)
◊◊& '
{
ÿÿ 	
return
ŸŸ 
_reader
ŸŸ 
.
ŸŸ 
GetInt64
ŸŸ #
(
ŸŸ# $
index
ŸŸ$ )
)
ŸŸ) *
;
ŸŸ* +
}
⁄⁄ 	
public
ÂÂ 
float
ÂÂ 
GetFloat
ÂÂ 
(
ÂÂ 
int
ÂÂ !
index
ÂÂ" '
)
ÂÂ' (
{
ÊÊ 	
return
ÁÁ 
_reader
ÁÁ 
.
ÁÁ 
GetFloat
ÁÁ #
(
ÁÁ# $
index
ÁÁ$ )
)
ÁÁ) *
;
ÁÁ* +
}
ËË 	
public
ÛÛ 
double
ÛÛ 
	GetDouble
ÛÛ 
(
ÛÛ  
int
ÛÛ  #
index
ÛÛ$ )
)
ÛÛ) *
{
ÙÙ 	
return
ıı 
_reader
ıı 
.
ıı 
	GetDouble
ıı $
(
ıı$ %
index
ıı% *
)
ıı* +
;
ıı+ ,
}
ˆˆ 	
public
ÅÅ 
string
ÅÅ 
	GetString
ÅÅ 
(
ÅÅ  
int
ÅÅ  #
index
ÅÅ$ )
)
ÅÅ) *
{
ÇÇ 	
return
ÉÉ 
_reader
ÉÉ 
.
ÉÉ 
	GetString
ÉÉ $
(
ÉÉ$ %
index
ÉÉ% *
)
ÉÉ* +
;
ÉÉ+ ,
}
ÑÑ 	
public
èè 
decimal
èè 

GetDecimal
èè !
(
èè! "
int
èè" %
index
èè& +
)
èè+ ,
{
êê 	
return
ëë 
_reader
ëë 
.
ëë 

GetDecimal
ëë %
(
ëë% &
index
ëë& +
)
ëë+ ,
;
ëë, -
}
íí 	
public
ùù 
DateTime
ùù 
GetDateTime
ùù #
(
ùù# $
int
ùù$ '
index
ùù( -
)
ùù- .
{
ûû 	
return
üü 
_reader
üü 
.
üü 
GetDateTime
üü &
(
üü& '
index
üü' ,
)
üü, -
;
üü- .
}
†† 	
public
´´ 
IDataReader
´´ 
GetData
´´ "
(
´´" #
int
´´# &
index
´´' ,
)
´´, -
{
¨¨ 	
return
≠≠ 
_reader
≠≠ 
.
≠≠ 
GetData
≠≠ "
(
≠≠" #
index
≠≠# (
)
≠≠( )
;
≠≠) *
}
ÆÆ 	
public
ππ 
bool
ππ 
IsDBNull
ππ 
(
ππ 
int
ππ  
index
ππ! &
)
ππ& '
{
∫∫ 	
return
ªª 
_reader
ªª 
.
ªª 
IsDBNull
ªª #
(
ªª# $
index
ªª$ )
)
ªª) *
;
ªª* +
}
ºº 	
public
¡¡ 
int
¡¡ 

FieldCount
¡¡ 
{
¬¬ 	
get
√√ 
{
√√ 
return
√√ 
_reader
√√  
.
√√  !

FieldCount
√√! +
;
√√+ ,
}
√√- .
}
ƒƒ 	
public
œœ 
object
œœ 
this
œœ 
[
œœ 
int
œœ 
index
œœ $
]
œœ$ %
{
–– 	
get
—— 
{
—— 
return
—— 
_reader
——  
[
——  !
index
——! &
]
——& '
;
——' (
}
——) *
}
““ 	
public
›› 
object
›› 
this
›› 
[
›› 
string
›› !
name
››" &
]
››& '
{
ﬁﬁ 	
get
ﬂﬂ 
{
ﬂﬂ 
return
ﬂﬂ 
_reader
ﬂﬂ  
[
ﬂﬂ  !
name
ﬂﬂ! %
]
ﬂﬂ% &
;
ﬂﬂ& '
}
ﬂﬂ( )
}
‡‡ 	
public
ÂÂ 
void
ÂÂ 
Close
ÂÂ 
(
ÂÂ 
)
ÂÂ 
{
ÊÊ 	
if
ÈÈ 
(
ÈÈ 
_reader
ÈÈ 
!=
ÈÈ 
null
ÈÈ 
)
ÈÈ  
{
ÍÍ 
_reader
ÎÎ 
.
ÎÎ 
Close
ÎÎ 
(
ÎÎ 
)
ÎÎ 
;
ÎÎ  
}
ÏÏ 
if
ÓÓ 
(
ÓÓ 
	_profiler
ÓÓ 
!=
ÓÓ 
null
ÓÓ !
)
ÓÓ! "
{
ÔÔ 
	_profiler
 
.
 
ReaderFinish
 &
(
& '
this
' +
)
+ ,
;
, -
}
ÒÒ 
}
ÚÚ 	
public
˙˙ 
	DataTable
˙˙ 
GetSchemaTable
˙˙ '
(
˙˙' (
)
˙˙( )
{
˚˚ 	
return
¸¸ 
_reader
¸¸ 
.
¸¸ 
GetSchemaTable
¸¸ )
(
¸¸) *
)
¸¸* +
;
¸¸+ ,
}
˝˝ 	
public
ÖÖ 
bool
ÖÖ 

NextResult
ÖÖ 
(
ÖÖ 
)
ÖÖ  
{
ÜÜ 	
return
áá 
_reader
áá 
.
áá 

NextResult
áá %
(
áá% &
)
áá& '
;
áá' (
}
àà 	
public
èè 
bool
èè 
Read
èè 
(
èè 
)
èè 
{
êê 	
return
ëë 
_reader
ëë 
.
ëë 
Read
ëë 
(
ëë  
)
ëë  !
;
ëë! "
}
íí 	
public
óó 
int
óó 
Depth
óó 
{
òò 	
get
ôô 
{
ôô 
return
ôô 
_reader
ôô  
.
ôô  !
Depth
ôô! &
;
ôô& '
}
ôô( )
}
öö 	
public
üü 
bool
üü 
IsClosed
üü 
{
†† 	
get
°° 
{
°° 
return
°° 
_reader
°°  
.
°°  !
IsClosed
°°! )
;
°°) *
}
°°+ ,
}
¢¢ 	
public
ßß 
int
ßß 
RecordsAffected
ßß "
{
®® 	
get
©© 
{
©© 
return
©© 
_reader
©©  
.
©©  !
RecordsAffected
©©! 0
;
©©0 1
}
©©2 3
}
™™ 	
public
ØØ 
void
ØØ 
Dispose
ØØ 
(
ØØ 
)
ØØ 
{
∞∞ 	
Dispose
±± 
(
±± 
true
±± 
)
±± 
;
±± 
GC
≤≤ 
.
≤≤ 
SuppressFinalize
≤≤ 
(
≤≤  
this
≤≤  $
)
≤≤$ %
;
≤≤% &
}
≥≥ 	
private
ππ 
void
ππ 
Dispose
ππ 
(
ππ 
bool
ππ !
	disposing
ππ" +
)
ππ+ ,
{
∫∫ 	
if
ªª 
(
ªª 
	disposing
ªª 
&&
ªª 
_reader
ªª $
!=
ªª% '
null
ªª( ,
)
ªª, -
{
ºº 
_reader
ΩΩ 
.
ΩΩ 
Dispose
ΩΩ 
(
ΩΩ  
)
ΩΩ  !
;
ΩΩ! "
}
ææ 
}
øø 	
}
¿¿ 
}¡¡ ïp
]C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbDataAdapter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public

 

class

 !
ProfiledDbDataAdapter

 &
:

' (
DbDataAdapter

) 6
{ 
private 
static 
readonly 
DbDataReader  ,
TokenReader- 8
=9 :
new; >
DataTableReader? N
(N O
newO R
	DataTableS \
(\ ]
)] ^
)^ _
;_ `
private 
readonly 
IDbProfiler $
	_profiler% .
;. /
private 
readonly 
IDbDataAdapter '
_adapter( 0
;0 1
private 

IDbCommand 
_selectCommand )
;) *
private## 

IDbCommand## 
_insertCommand## )
;##) *
private(( 

IDbCommand(( 
_updateCommand(( )
;(() *
private-- 

IDbCommand-- 
_deleteCommand-- )
;--) *
public22 
IDbDataAdapter22 
InternalAdapter22 -
{33 	
get44 
{44 
return44 
_adapter44 !
;44! "
}44# $
}55 	
public<< !
ProfiledDbDataAdapter<< $
(<<$ %
IDbDataAdapter<<% 3
wrappedAdapter<<4 B
,<<B C
IDbProfiler<<D O
profiler<<P X
=<<Y Z
null<<[ _
)<<_ `
{== 	
if>> 
(>> 
wrappedAdapter>> 
==>> !
null>>" &
)>>& '
{?? 
throw@@ 
new@@ !
ArgumentNullException@@ /
(@@/ 0
$str@@0 @
)@@@ A
;@@A B
}AA 
_adapterCC 
=CC 
wrappedAdapterCC %
;CC% &
	_profilerDD 
=DD 
profilerDD  
??DD! #
MiniProfilerDD$ 0
.DD0 1
CurrentDD1 8
;DD8 9
InitCommandsFF 
(FF 
wrappedAdapterFF '
)FF' (
;FF( )
}GG 	
privateII 
voidII 
InitCommandsII !
(II! "
IDbDataAdapterII" 0
wrappedAdapterII1 ?
)II? @
{JJ 	
ifKK 
(KK 
wrappedAdapterKK 
.KK 
SelectCommandKK ,
!=KK- /
nullKK0 4
)KK4 5
{LL 
_selectCommandMM 
=MM  
wrappedAdapterMM! /
.MM/ 0
SelectCommandMM0 =
;MM= >
}NN 
ifOO 
(OO 
wrappedAdapterOO 
.OO 
DeleteCommandOO ,
!=OO- /
nullOO0 4
)OO4 5
{PP 
_deleteCommandQQ 
=QQ  
wrappedAdapterQQ! /
.QQ/ 0
DeleteCommandQQ0 =
;QQ= >
}RR 
ifSS 
(SS 
wrappedAdapterSS 
.SS 
UpdateCommandSS ,
!=SS- /
nullSS0 4
)SS4 5
{TT 
_updateCommandUU 
=UU  
wrappedAdapterUU! /
.UU/ 0
UpdateCommandUU0 =
;UU= >
}VV 
ifWW 
(WW 
wrappedAdapterWW 
.WW 
InsertCommandWW ,
!=WW- /
nullWW0 4
)WW4 5
{XX 
_insertCommandYY 
=YY  
wrappedAdapterYY! /
.YY/ 0
InsertCommandYY0 =
;YY= >
}ZZ 
}[[ 	
publicee 
newee 
	DataTableee 
[ee 
]ee 

FillSchemaee )
(ee) *
DataSetee* 1
dataSetee2 9
,ee9 :

SchemaTypeee; E

schemaTypeeeF P
)eeP Q
{ff 	
returngg 
_adaptergg 
.gg 

FillSchemagg &
(gg& '
dataSetgg' .
,gg. /

schemaTypegg0 :
)gg: ;
;gg; <
}hh 	
publicqq 
newqq 
intqq 
Fillqq 
(qq 
DataSetqq #
dataSetqq$ +
)qq+ ,
{rr 	
if}} 
(}} 
	_profiler}} 
==}} 
null}} !
||}}" $
!}}% &
	_profiler}}& /
.}}/ 0
IsActive}}0 8
||}}9 ;
!}}< =
(}}= >
_selectCommand}}> L
is}}M O
	DbCommand}}P Y
)}}Y Z
)}}Z [
{~~ 
return 
_adapter 
.  
Fill  $
($ %
dataSet% ,
), -
;- .
}
ÄÄ 
int
ÇÇ 
result
ÇÇ 
;
ÇÇ 
var
ÉÉ 
cmd
ÉÉ 
=
ÉÉ 
(
ÉÉ 
	DbCommand
ÉÉ  
)
ÉÉ  !
_selectCommand
ÉÉ! /
;
ÉÉ/ 0
	_profiler
ÑÑ 
.
ÑÑ 
ExecuteStart
ÑÑ "
(
ÑÑ" #
cmd
ÑÑ# &
,
ÑÑ& '
SqlExecuteType
ÑÑ( 6
.
ÑÑ6 7
Reader
ÑÑ7 =
)
ÑÑ= >
;
ÑÑ> ?
try
ÖÖ 
{
ÜÜ 
result
áá 
=
áá 
_adapter
áá !
.
áá! "
Fill
áá" &
(
áá& '
dataSet
áá' .
)
áá. /
;
áá/ 0
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
e
ââ 
)
ââ 
{
ää 
	_profiler
ãã 
.
ãã 
OnError
ãã !
(
ãã! "
cmd
ãã" %
,
ãã% &
SqlExecuteType
ãã' 5
.
ãã5 6
Reader
ãã6 <
,
ãã< =
e
ãã> ?
)
ãã? @
;
ãã@ A
throw
åå 
;
åå 
}
çç 
finally
éé 
{
èè 
	_profiler
êê 
.
êê 
ExecuteFinish
êê '
(
êê' (
cmd
êê( +
,
êê+ ,
SqlExecuteType
êê- ;
.
êê; <
Reader
êê< B
,
êêB C
TokenReader
êêD O
)
êêO P
;
êêP Q
}
ëë 
return
ìì 
result
ìì 
;
ìì 
}
îî 	
public
¢¢ 
new
¢¢ 
int
¢¢ 
Fill
¢¢ 
(
¢¢ 
	DataTable
¢¢ %
	dataTable
¢¢& /
)
¢¢/ 0
{
££ 	
var
§§ 
dbDataAdapter
§§ 
=
§§ 
_adapter
§§  (
as
§§) +
DbDataAdapter
§§, 9
;
§§9 :
if
•• 
(
•• 
dbDataAdapter
•• 
==
••  
null
••! %
)
••% &
{
¶¶ 
throw
ßß 
new
ßß '
InvalidOperationException
ßß 3
(
ßß3 4
$str
ßß4 }
+
ßß~ 
$str®® ú
)®®ú ù
;®®ù û
}
©© 
if
´´ 
(
´´ 
	_profiler
´´ 
==
´´ 
null
´´ !
||
´´" $
!
´´% &
	_profiler
´´& /
.
´´/ 0
IsActive
´´0 8
||
´´9 ;
!
´´< =
(
´´= >
_selectCommand
´´> L
is
´´M O
	DbCommand
´´P Y
)
´´Y Z
)
´´Z [
{
¨¨ 
return
≠≠ 
dbDataAdapter
≠≠ $
.
≠≠$ %
Fill
≠≠% )
(
≠≠) *
	dataTable
≠≠* 3
)
≠≠3 4
;
≠≠4 5
}
ÆÆ 
int
∞∞ 
result
∞∞ 
;
∞∞ 
var
±± 
cmd
±± 
=
±± 
(
±± 
	DbCommand
±±  
)
±±  !
_selectCommand
±±! /
;
±±/ 0
	_profiler
≤≤ 
.
≤≤ 
ExecuteStart
≤≤ "
(
≤≤" #
cmd
≤≤# &
,
≤≤& '
SqlExecuteType
≤≤( 6
.
≤≤6 7
Reader
≤≤7 =
)
≤≤= >
;
≤≤> ?
try
≥≥ 
{
¥¥ 
result
µµ 
=
µµ 
dbDataAdapter
µµ &
.
µµ& '
Fill
µµ' +
(
µµ+ ,
	dataTable
µµ, 5
)
µµ5 6
;
µµ6 7
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
e
∑∑ 
)
∑∑ 
{
∏∏ 
	_profiler
ππ 
.
ππ 
OnError
ππ !
(
ππ! "
cmd
ππ" %
,
ππ% &
SqlExecuteType
ππ' 5
.
ππ5 6
Reader
ππ6 <
,
ππ< =
e
ππ> ?
)
ππ? @
;
ππ@ A
throw
∫∫ 
;
∫∫ 
}
ªª 
finally
ºº 
{
ΩΩ 
	_profiler
ææ 
.
ææ 
ExecuteFinish
ææ '
(
ææ' (
cmd
ææ( +
,
ææ+ ,
SqlExecuteType
ææ- ;
.
ææ; <
Reader
ææ< B
,
ææB C
TokenReader
ææD O
)
ææO P
;
ææP Q
}
øø 
return
¡¡ 
result
¡¡ 
;
¡¡ 
}
¬¬ 	
public
   
new
   
IDataParameter
   !
[
  ! "
]
  " #
GetFillParameters
  $ 5
(
  5 6
)
  6 7
{
ÀÀ 	
return
ÃÃ 
_adapter
ÃÃ 
.
ÃÃ 
GetFillParameters
ÃÃ -
(
ÃÃ- .
)
ÃÃ. /
;
ÃÃ/ 0
}
ÕÕ 	
public
◊◊ 
new
◊◊ 
int
◊◊ 
Update
◊◊ 
(
◊◊ 
DataSet
◊◊ %
dataSet
◊◊& -
)
◊◊- .
{
ÿÿ 	
throw
‹‹ 
new
‹‹ %
NotImplementedException
‹‹ -
(
‹‹- .
)
‹‹. /
;
‹‹/ 0
}
›› 	
public
„„ 
new
„„ "
MissingMappingAction
„„ '"
MissingMappingAction
„„( <
{
‰‰ 	
get
ÂÂ 
{
ÂÂ 
return
ÂÂ 
_adapter
ÂÂ !
.
ÂÂ! ""
MissingMappingAction
ÂÂ" 6
;
ÂÂ6 7
}
ÂÂ8 9
set
ÊÊ 
{
ÊÊ 
_adapter
ÊÊ 
.
ÊÊ "
MissingMappingAction
ÊÊ /
=
ÊÊ0 1
value
ÊÊ2 7
;
ÊÊ7 8
}
ÊÊ9 :
}
ÁÁ 	
public
ÓÓ 
new
ÓÓ !
MissingSchemaAction
ÓÓ &!
MissingSchemaAction
ÓÓ' :
{
ÔÔ 	
get
 
{
 
return
 
_adapter
 !
.
! "!
MissingSchemaAction
" 5
;
5 6
}
7 8
set
ÒÒ 
{
ÒÒ 
_adapter
ÒÒ 
.
ÒÒ !
MissingSchemaAction
ÒÒ .
=
ÒÒ/ 0
value
ÒÒ1 6
;
ÒÒ6 7
}
ÒÒ8 9
}
ÚÚ 	
public
¯¯ 
new
¯¯ %
ITableMappingCollection
¯¯ *
TableMappings
¯¯+ 8
{
˘˘ 	
get
˙˙ 
{
˙˙ 
return
˙˙ 
_adapter
˙˙ !
.
˙˙! "
TableMappings
˙˙" /
;
˙˙/ 0
}
˙˙1 2
}
˚˚ 	
public
ÅÅ 
new
ÅÅ 

IDbCommand
ÅÅ 
SelectCommand
ÅÅ +
{
ÇÇ 	
get
ÉÉ 
{
ÑÑ 
return
ÖÖ 
_selectCommand
ÖÖ %
;
ÖÖ% &
}
ÜÜ 
set
áá 
{
àà 
_selectCommand
ââ 
=
ââ  
value
ââ! &
;
ââ& '
var
ãã 
cmd
ãã 
=
ãã 
value
ãã 
as
ãã  "
ProfiledDbCommand
ãã# 4
;
ãã4 5
_adapter
åå 
.
åå 
SelectCommand
åå &
=
åå' (
cmd
åå) ,
==
åå- /
null
åå0 4
?
åå5 6
value
åå7 <
:
åå= >
cmd
åå? B
.
ååB C
InternalCommand
ååC R
;
ååR S
}
çç 
}
éé 	
public
îî 
new
îî 

IDbCommand
îî 
InsertCommand
îî +
{
ïï 	
get
ññ 
{
óó 
return
òò 
_insertCommand
òò %
;
òò% &
}
ôô 
set
öö 
{
õõ 
_insertCommand
úú 
=
úú  
value
úú! &
;
úú& '
var
ûû 
cmd
ûû 
=
ûû 
value
ûû 
as
ûû  "
ProfiledDbCommand
ûû# 4
;
ûû4 5
_adapter
üü 
.
üü 
InsertCommand
üü &
=
üü' (
cmd
üü) ,
==
üü- /
null
üü0 4
?
üü5 6
value
üü7 <
:
üü= >
cmd
üü? B
.
üüB C
InternalCommand
üüC R
;
üüR S
}
†† 
}
°° 	
public
ßß 
new
ßß 

IDbCommand
ßß 
UpdateCommand
ßß +
{
®® 	
get
©© 
{
™™ 
return
´´ 
_updateCommand
´´ %
;
´´% &
}
¨¨ 
set
≠≠ 
{
ÆÆ 
_updateCommand
ØØ 
=
ØØ  
value
ØØ! &
;
ØØ& '
var
±± 
cmd
±± 
=
±± 
value
±± 
as
±±  "
ProfiledDbCommand
±±# 4
;
±±4 5
_adapter
≤≤ 
.
≤≤ 
UpdateCommand
≤≤ &
=
≤≤' (
cmd
≤≤) ,
==
≤≤- /
null
≤≤0 4
?
≤≤5 6
value
≤≤7 <
:
≤≤= >
cmd
≤≤? B
.
≤≤B C
InternalCommand
≤≤C R
;
≤≤R S
}
≥≥ 
}
¥¥ 	
public
∫∫ 
new
∫∫ 

IDbCommand
∫∫ 
DeleteCommand
∫∫ +
{
ªª 	
get
ºº 
{
ΩΩ 
return
ææ 
_deleteCommand
ææ %
;
ææ% &
}
øø 
set
¿¿ 
{
¡¡ 
_deleteCommand
¬¬ 
=
¬¬  
value
¬¬! &
;
¬¬& '
var
ƒƒ 
cmd
ƒƒ 
=
ƒƒ 
value
ƒƒ 
as
ƒƒ  "
ProfiledDbCommand
ƒƒ# 4
;
ƒƒ4 5
_adapter
≈≈ 
.
≈≈ 
DeleteCommand
≈≈ &
=
≈≈' (
cmd
≈≈) ,
==
≈≈- /
null
≈≈0 4
?
≈≈5 6
value
≈≈7 <
:
≈≈= >
cmd
≈≈? B
.
≈≈B C
InternalCommand
≈≈C R
;
≈≈R S
}
∆∆ 
}
«« 	
}
»» 
}…… Ì.
aC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbProviderFactory.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public

 

class

 %
ProfiledDbProviderFactory

 *
:

+ ,
DbProviderFactory

- >
{ 
[ 	
SuppressMessage	 
( 
$str ?
,? @
$strA ]
,] ^
Justification_ l
=m n
$str	o ≤
)
≤ ≥
]
≥ ¥
public 
static %
ProfiledDbProviderFactory /
Instance0 8
=9 :
new; >%
ProfiledDbProviderFactory? X
(X Y
)Y Z
;Z [
private 
DbProviderFactory !
_tail" '
;' (
public %
ProfiledDbProviderFactory (
(( )
DbProviderFactory) :
tail; ?
)? @
{ 	
_tail 
= 
tail 
; 
} 	
private%% %
ProfiledDbProviderFactory%% )
(%%) *
)%%* +
{&& 	
}'' 	
public,, 
override,, 
bool,, )
CanCreateDataSourceEnumerator,, :
{-- 	
get.. 
{// 
return00 
_tail00 
.00 )
CanCreateDataSourceEnumerator00 :
;00: ;
}11 
}22 	
public88 
override88 
	DbCommand88 !
CreateCommand88" /
(88/ 0
)880 1
{99 	
var:: 
profiler:: 
=:: 
MiniProfiler:: '
.::' (
Current::( /
;::/ 0
var<< 
command<< 
=<< 
_tail<< 
.<<  
CreateCommand<<  -
(<<- .
)<<. /
;<</ 0
return>> 
profiler>> 
!=>> 
null>> #
??? 
new?? 
ProfiledDbCommand?? '
(??' (
command??( /
,??/ 0
null??1 5
,??5 6
MiniProfiler??7 C
.??C D
Current??D K
)??K L
:@@ 
command@@ 
;@@ 
}AA 	
publicII 
overrideII 
DbCommandBuilderII ( 
CreateCommandBuilderII) =
(II= >
)II> ?
{JJ 	
returnKK 
_tailKK 
.KK  
CreateCommandBuilderKK -
(KK- .
)KK. /
;KK/ 0
}LL 	
publicRR 
overrideRR 
DbConnectionRR $
CreateConnectionRR% 5
(RR5 6
)RR6 7
{SS 	
varTT 
profilerTT 
=TT 
MiniProfilerTT '
.TT' (
CurrentTT( /
;TT/ 0
varVV 

connectionVV 
=VV 
_tailVV "
.VV" #
CreateConnectionVV# 3
(VV3 4
)VV4 5
;VV5 6
returnXX 
profilerXX 
!=XX 
nullXX #
?YY 
newYY  
ProfiledDbConnectionYY *
(YY* +

connectionYY+ 5
,YY5 6
MiniProfilerYY7 C
.YYC D
CurrentYYD K
)YYK L
:ZZ 

connectionZZ 
;ZZ 
}[[ 	
publiccc 
overridecc %
DbConnectionStringBuildercc 1)
CreateConnectionStringBuildercc2 O
(ccO P
)ccP Q
{dd 	
returnee 
_tailee 
.ee )
CreateConnectionStringBuilderee 6
(ee6 7
)ee7 8
;ee8 9
}ff 	
publicnn 
overridenn 
DbDataAdapternn %
CreateDataAdapternn& 7
(nn7 8
)nn8 9
{oo 	
varpp 
profilerpp 
=pp 
MiniProfilerpp '
.pp' (
Currentpp( /
;pp/ 0
varrr 
dataAdapterrr 
=rr 
_tailrr #
.rr# $
CreateDataAdapterrr$ 5
(rr5 6
)rr6 7
;rr7 8
returntt 
profilertt 
!=tt 
nulltt #
?uu 
newuu !
ProfiledDbDataAdapteruu +
(uu+ ,
dataAdapteruu, 7
,uu7 8
MiniProfileruu9 E
.uuE F
CurrentuuF M
)uuM N
:vv 
dataAdaptervv 
;vv 
}ww 	
public}} 
override}} "
DbDataSourceEnumerator}} .&
CreateDataSourceEnumerator}}/ I
(}}I J
)}}J K
{~~ 	
return 
_tail 
. &
CreateDataSourceEnumerator 3
(3 4
)4 5
;5 6
}
ÄÄ 	
public
ÜÜ 
override
ÜÜ 
DbParameter
ÜÜ #
CreateParameter
ÜÜ$ 3
(
ÜÜ3 4
)
ÜÜ4 5
{
áá 	
return
àà 
_tail
àà 
.
àà 
CreateParameter
àà (
(
àà( )
)
àà) *
;
àà* +
}
ââ 	
public
êê 
override
êê "
CodeAccessPermission
êê ,
CreatePermission
êê- =
(
êê= >
System
êê> D
.
êêD E
Security
êêE M
.
êêM N
Permissions
êêN Y
.
êêY Z
PermissionState
êêZ i
state
êêj o
)
êêo p
{
ëë 	
return
íí 
_tail
íí 
.
íí 
CreatePermission
íí )
(
íí) *
state
íí* /
)
íí/ 0
;
íí0 1
}
ìì 	
public
ôô 
void
ôô +
InitProfiledDbProviderFactory
ôô 1
(
ôô1 2
DbProviderFactory
ôô2 C
tail
ôôD H
)
ôôH I
{
öö 	
_tail
õõ 
=
õõ 
tail
õõ 
;
õõ 
}
úú 	
}
ùù 
}ûû €
aC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\SimpleProfiledTransaction.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public

 

class

 %
SimpleProfiledTransaction

 *
:

+ ,
IDbTransaction

- ;
{ 
private 
readonly 
IDbTransaction '
_transaction( 4
;4 5
private 
readonly $
SimpleProfiledConnection 1
_connection2 =
;= >
public %
SimpleProfiledTransaction (
(( )
IDbTransaction) 7
transaction8 C
,C D$
SimpleProfiledConnectionE ]

connection^ h
)h i
{ 	
if 
( 
transaction 
== 
null #
)# $
throw% *
new+ .!
ArgumentNullException/ D
(D E
$strE R
)R S
;S T
if 
( 

connection 
== 
null "
)" #
throw$ )
new* -!
ArgumentNullException. C
(C D
$strD P
)P Q
;Q R
_transaction 
= 
transaction &
;& '
_connection 
= 

connection $
;$ %
} 	
public$$ 
IDbTransaction$$ 
WrappedTransaction$$ 0
{%% 	
get&& 
{&& 
return&& 
_transaction&& %
;&&% &
}&&' (
}'' 	
public,, 
IDbConnection,, 

Connection,, '
{-- 	
get.. 
{.. 
return.. 
_connection.. $
;..$ %
}..& '
}// 	
public44 
IsolationLevel44 
IsolationLevel44 ,
{55 	
get66 
{66 
return66 
_transaction66 %
.66% &
IsolationLevel66& 4
;664 5
}666 7
}77 	
public<< 
void<< 
Commit<< 
(<< 
)<< 
{== 	
_transaction>> 
.>> 
Commit>> 
(>>  
)>>  !
;>>! "
}?? 	
publicDD 
voidDD 
RollbackDD 
(DD 
)DD 
{EE 	
_transactionFF 
.FF 
RollbackFF !
(FF! "
)FF" #
;FF# $
}GG 	
publicLL 
voidLL 
DisposeLL 
(LL 
)LL 
{MM 	
DisposeNN 
(NN 
trueNN 
)NN 
;NN 
GCOO 
.OO 
SuppressFinalizeOO 
(OO  
thisOO  $
)OO$ %
;OO% &
}PP 	
privateRR 
voidRR 
DisposeRR 
(RR 
boolRR !
	disposingRR" +
)RR+ ,
{SS 	
ifTT 
(TT 
	disposingTT 
&&TT 
_transactionTT )
!=TT* ,
nullTT- 1
)TT1 2
{UU 
_transactionVV 
.VV 
DisposeVV $
(VV$ %
)VV% &
;VV& '
}WW 
}XX 	
}YY 
}ZZ †+
[C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\ExtensionMethods.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
{ 
public

 

static

 
class

 
ExtensionMethods

 (
{ 
internal 
static 
bool 
IsNullOrWhiteSpace /
(/ 0
this0 4
string5 ;
value< A
)A B
{ 	
return 
string 
. 
IsNullOrWhiteSpace ,
(, -
value- 2
)2 3
;3 4
} 	
internal 
static 
bool 
HasValue %
(% &
this& *
string+ 1
value2 7
)7 8
{ 	
return 
! 
string 
. 
IsNullOrWhiteSpace -
(- .
value. 3
)3 4
;4 5
} 	
public"" 
static"" 
string"" 
Truncate"" %
(""% &
this""& *
string""+ 1
s""2 3
,""3 4
int""5 8
	maxLength""9 B
)""B C
{## 	
return$$ 
s$$ 
!=$$ 
null$$ 
&&$$ 
s$$  !
.$$! "
Length$$" (
>$$) *
	maxLength$$+ 4
?$$5 6
s$$7 8
.$$8 9
	Substring$$9 B
($$B C
$num$$C D
,$$D E
	maxLength$$F O
)$$O P
:$$Q R
s$$S T
;$$T U
}%% 	
internal** 
static** 
string** 
EnsureTrailingSlash** 2
(**2 3
this**3 7
string**8 >
input**? D
)**D E
{++ 	
if,, 
(,, 
string,, 
.,, 
IsNullOrEmpty,, $
(,,$ %
input,,% *
),,* +
),,+ ,
return,,- 3
string,,4 :
.,,: ;
Empty,,; @
;,,@ A
return-- 
Regex-- 
.-- 
Replace--  
(--  !
input--! &
,--& '
$str--( -
,--- .
string--/ 5
.--5 6
Empty--6 ;
)--; <
+--= >
$str--? B
;--B C
}.. 	
internal33 
static33 
string33 
RemoveLeadingSlash33 1
(331 2
this332 6
string337 =
input33> C
)33C D
{44 	
if55 
(55 
string55 
.55 
IsNullOrEmpty55 $
(55$ %
input55% *
)55* +
)55+ ,
return55- 3
string554 :
.55: ;
Empty55; @
;55@ A
return66 
Regex66 
.66 
Replace66  
(66  !
input66! &
,66& '
$str66( -
,66- .
string66/ 5
.665 6
Empty666 ;
)66; <
;66< =
}77 	
internal<< 
static<< 
string<< 
RemoveTrailingSlash<< 2
(<<2 3
this<<3 7
string<<8 >
input<<? D
)<<D E
{== 	
if>> 
(>> 
string>> 
.>> 
IsNullOrEmpty>> $
(>>$ %
input>>% *
)>>* +
)>>+ ,
return>>- 3
string>>4 :
.>>: ;
Empty>>; @
;>>@ A
return?? 
Regex?? 
.?? 
Replace??  
(??  !
input??! &
,??& '
$str??( -
,??- .
string??/ 5
.??5 6
Empty??6 ;
)??; <
;??< =
}@@ 	
internalGG 
staticGG 
stringGG 
ToJsonGG %
(GG% &
thisGG& *
objectGG+ 1
oGG2 3
)GG3 4
{HH 	
varII 
jsII 
=II 
newII  
JavaScriptSerializerII -
(II- .
)II. /
;II/ 0
jsJJ 
.JJ 
MaxJsonLengthJJ 
=JJ 
intJJ "
.JJ" #
MaxValueJJ# +
;JJ+ ,
returnKK 
oKK 
==KK 
nullKK 
?KK 
nullKK #
:KK$ %
jsKK& (
.KK( )
	SerializeKK) 2
(KK2 3
oKK3 4
)KK4 5
;KK5 6
}LL 	
internalSS 
staticSS 
TSS 
FromJsonSS "
<SS" #
TSS# $
>SS$ %
(SS% &
thisSS& *
stringSS+ 1
sSS2 3
)SS3 4
whereSS5 :
TSS; <
:SS= >
classSS? D
{TT 	
returnUU 
sUU 
.UU 
HasValueUU 
(UU 
)UU 
?UU  !
newUU" % 
JavaScriptSerializerUU& :
(UU: ;
)UU; <
.UU< =
DeserializeUU= H
<UUH I
TUUI J
>UUJ K
(UUK L
sUUL M
)UUM N
:UUO P
nullUUQ U
;UUU V
}VV 	
internal[[ 
static[[ 
string[[ 
ToJs[[ #
([[# $
this[[$ (
bool[[) -
b[[. /
)[[/ 0
{\\ 	
return]] 
b]] 
?]] 
$str]] 
:]] 
$str]]  '
;]]' (
}^^ 	
}`` 
}aa ¥%
LC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\Link.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public 

class 
Link 
< 
TKey 
, 
TValue "
>" #
where$ )
TKey* .
:/ 0
class1 6
{ 
private 
Link 
( 
TKey 
key 
, 
TValue %
value& +
,+ ,
Link- 1
<1 2
TKey2 6
,6 7
TValue8 >
>> ?
tail@ D
)D E
{ 	
this 
. 
Key 
= 
key 
; 
this 
. 
Value 
= 
value 
; 
this 
. 
Tail 
= 
tail 
; 
} 	
public$$ 
TKey$$ 
Key$$ 
{$$ 
get$$ 
;$$ 
private$$ &
set$$' *
;$$* +
}$$, -
public)) 
TValue)) 
Value)) 
{)) 
get)) !
;))! "
private))# *
set))+ .
;)). /
}))0 1
public.. 
Link.. 
<.. 
TKey.. 
,.. 
TValue..  
>..  !
Tail.." &
{..' (
get..) ,
;.., -
private... 5
set..6 9
;..9 :
}..; <
public99 
static99 
bool99 
TryGet99 !
(99! "
Link99" &
<99& '
TKey99' +
,99+ ,
TValue99- 3
>993 4
link995 9
,999 :
TKey99; ?
key99@ C
,99C D
out99E H
TValue99I O
value99P U
)99U V
{:: 	
while;; 
(;; 
link;; 
!=;; 
null;; 
);;  
{<< 
if== 
(== 
(== 
object== 
)== 
key== 
====  "
(==# $
object==$ *
)==* +
link==+ /
.==/ 0
Key==0 3
)==3 4
{>> 
value?? 
=?? 
link??  
.??  !
Value??! &
;??& '
return@@ 
true@@ 
;@@  
}AA 
linkCC 
=CC 
linkCC 
.CC 
TailCC  
;CC  !
}DD 
valueFF 
=FF 
defaultFF 
(FF 
TValueFF "
)FF" #
;FF# $
returnGG 
falseGG 
;GG 
}HH 	
publicSS 
staticSS 
boolSS 
TryAddSS !
(SS! "
refSS" %
LinkSS& *
<SS* +
TKeySS+ /
,SS/ 0
TValueSS1 7
>SS7 8
headSS9 =
,SS= >
TKeySS? C
keySSD G
,SSG H
refSSI L
TValueSSM S
valueSST Y
)SSY Z
{TT 	
boolUU 
tryAgainUU 
;UU 
doVV 
{WW 
varXX 
snapshotXX 
=XX 
InterlockedXX *
.XX* +
CompareExchangeXX+ :
(XX: ;
refXX; >
headXX? C
,XXC D
nullXXE I
,XXI J
nullXXK O
)XXO P
;XXP Q
TValueYY 
foundYY 
;YY 
ifZZ 
(ZZ 
TryGetZZ 
(ZZ 
snapshotZZ #
,ZZ# $
keyZZ% (
,ZZ( )
outZZ* -
foundZZ. 3
)ZZ3 4
)ZZ4 5
{[[ 
value]] 
=]] 
found]] !
;]]! "
return^^ 
false^^  
;^^  !
}__ 
varaa 
newNodeaa 
=aa 
newaa !
Linkaa" &
<aa& '
TKeyaa' +
,aa+ ,
TValueaa- 3
>aa3 4
(aa4 5
keyaa5 8
,aa8 9
valueaa: ?
,aa? @
snapshotaaA I
)aaI J
;aaJ K
tryAgaindd 
=dd 
Interlockeddd &
.dd& '
CompareExchangedd' 6
(dd6 7
refdd7 :
headdd; ?
,dd? @
newNodeddA H
,ddH I
snapshotddJ R
)ddR S
!=ddT V
snapshotddW _
;dd_ `
}ee 
whilegg 
(gg 
tryAgaingg 
)gg 
;gg 
returnhh 
truehh 
;hh 
}ii 	
}jj 
}kk µ¨
YC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbCommand.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
[ 
System 
. 
ComponentModel 
. 
DesignerCategory +
(+ ,
$str, .
). /
]/ 0
public 

class 
ProfiledDbCommand "
:# $
	DbCommand% .
,. /

ICloneable0 :
{ 
private 
static 
Link 
< 
Type  
,  !
Action" (
<( )

IDbCommand) 3
,3 4
bool5 9
>9 :
>: ;
bindByNameCache< K
;K L
private 
	DbCommand 
_command "
;" #
private 
DbConnection 
_connection (
;( )
private!! 
DbTransaction!! 
_transaction!! *
;!!* +
private&& 
IDbProfiler&& 
	_profiler&& %
;&&% &
private++ 
bool++ 
_bindByName++  
;++  !
public22 
bool22 

BindByName22 
{33 	
get44 
{55 
return66 
_bindByName66 "
;66" #
}77 
set99 
{:: 
if;; 
(;; 
_bindByName;; 
!=;;  "
value;;# (
);;( )
{<< 
if== 
(== 
_command==  
!===! #
null==$ (
)==( )
{>> 
var?? 
inner?? !
=??" #
GetBindByName??$ 1
(??1 2
_command??2 :
.??: ;
GetType??; B
(??B C
)??C D
)??D E
;??E F
if@@ 
(@@ 
inner@@ !
!=@@" $
null@@% )
)@@) *
inner@@+ 0
(@@0 1
_command@@1 9
,@@9 :
value@@; @
)@@@ A
;@@A B
}AA 
_bindByNameCC 
=CC  !
valueCC" '
;CC' (
}DD 
}EE 
}FF 	
publicNN 
ProfiledDbCommandNN  
(NN  !
	DbCommandNN! *
commandNN+ 2
,NN2 3
DbConnectionNN4 @

connectionNNA K
,NNK L
IDbProfilerNNM X
profilerNNY a
)NNa b
{OO 	
ifPP 
(PP 
commandPP 
==PP 
nullPP 
)PP  
throwPP! &
newPP' *!
ArgumentNullExceptionPP+ @
(PP@ A
$strPPA J
)PPJ K
;PPK L
_commandRR 
=RR 
commandRR 
;RR 
_connectionSS 
=SS 

connectionSS $
;SS$ %
ifUU 
(UU 
profilerUU 
!=UU 
nullUU  
)UU  !
{VV 
	_profilerWW 
=WW 
profilerWW $
;WW$ %
}XX 
}YY 	
private`` 
static`` 
Action`` 
<`` 

IDbCommand`` (
,``( )
bool``* .
>``. /
GetBindByName``0 =
(``= >
Type``> B
commandType``C N
)``N O
{aa 	
ifbb 
(bb 
commandTypebb 
==bb 
nullbb #
)bb# $
returnbb% +
nullbb, 0
;bb0 1
Actioncc 
<cc 

IDbCommandcc 
,cc 
boolcc #
>cc# $
actioncc% +
;cc+ ,
ifdd 
(dd 
Linkdd 
<dd 
Typedd 
,dd 
Actiondd !
<dd! "

IDbCommanddd" ,
,dd, -
booldd. 2
>dd2 3
>dd3 4
.dd4 5
TryGetdd5 ;
(dd; <
bindByNameCachedd< K
,ddK L
commandTypeddM X
,ddX Y
outddZ ]
actiondd^ d
)ddd e
)dde f
{ee 
returnff 
actionff 
;ff 
}gg 
varii 
propii 
=ii 
commandTypeii "
.ii" #
GetPropertyii# .
(ii. /
$strii/ ;
,ii; <
BindingFlagsii= I
.iiI J
PubliciiJ P
|iiQ R
BindingFlagsiiS _
.ii_ `
Instanceii` h
)iih i
;iii j
actionjj 
=jj 
nulljj 
;jj 
ParameterInfokk 
[kk 
]kk 
indexerskk $
;kk$ %

MethodInfoll 
setterll 
;ll 
ifmm 
(mm 
propmm 
!=mm 
nullmm 
&&mm 
propmm  $
.mm$ %
CanWritemm% -
&&mm. 0
propmm1 5
.mm5 6
PropertyTypemm6 B
==mmC E
typeofmmF L
(mmL M
boolmmM Q
)mmQ R
&&nn 
(nn 
(nn 
indexersnn 
=nn 
propnn  $
.nn$ %
GetIndexParametersnn% 7
(nn7 8
)nn8 9
)nn9 :
==nn; =
nullnn> B
||nnC E
indexersnnF N
.nnN O
LengthnnO U
==nnV X
$numnnY Z
)nnZ [
&&oo 
(oo 
setteroo 
=oo 
propoo !
.oo! "
GetSetMethodoo" .
(oo. /
)oo/ 0
)oo0 1
!=oo2 4
nulloo5 9
)oo9 :
{pp 
varqq 
methodqq 
=qq 
newqq  
DynamicMethodqq! .
(qq. /
commandTypeqq/ :
.qq: ;
Nameqq; ?
+qq@ A
$strqqB O
,qqO P
nullqqQ U
,qqU V
newqqW Z
[qqZ [
]qq[ \
{qq] ^
typeofqq_ e
(qqe f

IDbCommandqqf p
)qqp q
,qqq r
typeofqqs y
(qqy z
boolqqz ~
)qq~ 
}
qqÄ Å
)
qqÅ Ç
;
qqÇ É
varrr 
ilrr 
=rr 
methodrr 
.rr  
GetILGeneratorrr  .
(rr. /
)rr/ 0
;rr0 1
ilss 
.ss 
Emitss 
(ss 
OpCodesss 
.ss  
Ldarg_0ss  '
)ss' (
;ss( )
iltt 
.tt 
Emittt 
(tt 
OpCodestt 
.tt  
	Castclasstt  )
,tt) *
commandTypett+ 6
)tt6 7
;tt7 8
iluu 
.uu 
Emituu 
(uu 
OpCodesuu 
.uu  
Ldarg_1uu  '
)uu' (
;uu( )
ilvv 
.vv 
EmitCallvv 
(vv 
OpCodesvv #
.vv# $
Callvirtvv$ ,
,vv, -
settervv. 4
,vv4 5
nullvv6 :
)vv: ;
;vv; <
ilww 
.ww 
Emitww 
(ww 
OpCodesww 
.ww  
Retww  #
)ww# $
;ww$ %
actionxx 
=xx 
(xx 
Actionxx  
<xx  !

IDbCommandxx! +
,xx+ ,
boolxx- 1
>xx1 2
)xx2 3
methodxx3 9
.xx9 :
CreateDelegatexx: H
(xxH I
typeofxxI O
(xxO P
ActionxxP V
<xxV W

IDbCommandxxW a
,xxa b
boolxxc g
>xxg h
)xxh i
)xxi j
;xxj k
}yy 
Link|| 
<|| 
Type|| 
,|| 
Action|| 
<|| 

IDbCommand|| (
,||( )
bool||* .
>||. /
>||/ 0
.||0 1
TryAdd||1 7
(||7 8
ref||8 ;
bindByNameCache||< K
,||K L
commandType||M X
,||X Y
ref||Z ]
action||^ d
)||d e
;||e f
return}} 
action}} 
;}} 
}~~ 	
public
ÉÉ 
override
ÉÉ 
string
ÉÉ 
CommandText
ÉÉ *
{
ÑÑ 	
get
ÖÖ 
{
ÖÖ 
return
ÖÖ 
_command
ÖÖ !
.
ÖÖ! "
CommandText
ÖÖ" -
;
ÖÖ- .
}
ÖÖ/ 0
set
ÜÜ 
{
ÜÜ 
_command
ÜÜ 
.
ÜÜ 
CommandText
ÜÜ &
=
ÜÜ' (
value
ÜÜ) .
;
ÜÜ. /
}
ÜÜ0 1
}
áá 	
public
åå 
override
åå 
int
åå 
CommandTimeout
åå *
{
çç 	
get
éé 
{
éé 
return
éé 
_command
éé !
.
éé! "
CommandTimeout
éé" 0
;
éé0 1
}
éé2 3
set
èè 
{
èè 
_command
èè 
.
èè 
CommandTimeout
èè )
=
èè* +
value
èè, 1
;
èè1 2
}
èè3 4
}
êê 	
public
ïï 
override
ïï 
CommandType
ïï #
CommandType
ïï$ /
{
ññ 	
get
óó 
{
óó 
return
óó 
_command
óó !
.
óó! "
CommandType
óó" -
;
óó- .
}
óó/ 0
set
òò 
{
òò 
_command
òò 
.
òò 
CommandType
òò &
=
òò' (
value
òò) .
;
òò. /
}
òò0 1
}
ôô 	
	protected
ûû 
override
ûû 
DbConnection
ûû '
DbConnection
ûû( 4
{
üü 	
get
†† 
{
°° 
return
¢¢ 
_connection
¢¢ "
;
¢¢" #
}
££ 
set
•• 
{
¶¶ 
if
©© 
(
©© 
MiniProfiler
©©  
.
©©  !
Current
©©! (
!=
©©) +
null
©©, 0
)
©©0 1
{
™™ 
	_profiler
´´ 
=
´´ 
MiniProfiler
´´  ,
.
´´, -
Current
´´- 4
;
´´4 5
}
¨¨ 
_connection
ÆÆ 
=
ÆÆ 
value
ÆÆ #
;
ÆÆ# $
var
ØØ 
awesomeConn
ØØ 
=
ØØ  !
value
ØØ" '
as
ØØ( *"
ProfiledDbConnection
ØØ+ ?
;
ØØ? @
_command
∞∞ 
.
∞∞ 

Connection
∞∞ #
=
∞∞$ %
awesomeConn
∞∞& 1
==
∞∞2 4
null
∞∞5 9
?
∞∞: ;
value
∞∞< A
:
∞∞B C
awesomeConn
∞∞D O
.
∞∞O P
WrappedConnection
∞∞P a
;
∞∞a b
}
±± 
}
≤≤ 	
	protected
∑∑ 
override
∑∑ #
DbParameterCollection
∑∑ 0#
DbParameterCollection
∑∑1 F
{
∏∏ 	
get
ππ 
{
ππ 
return
ππ 
_command
ππ !
.
ππ! "

Parameters
ππ" ,
;
ππ, -
}
ππ. /
}
∫∫ 	
	protected
øø 
override
øø 
DbTransaction
øø (
DbTransaction
øø) 6
{
¿¿ 	
get
¡¡ 
{
¬¬ 
return
√√ 
_transaction
√√ #
;
√√# $
}
ƒƒ 
set
∆∆ 
{
«« 
_transaction
»» 
=
»» 
value
»» $
;
»»$ %
var
…… 
awesomeTran
…… 
=
……  !
value
……" '
as
……( *#
ProfiledDbTransaction
……+ @
;
……@ A
_command
   
.
   
Transaction
   $
=
  % &
awesomeTran
  ' 2
==
  3 5
null
  6 :
?
  ; <
value
  = B
:
  C D
awesomeTran
  E P
.
  P Q 
WrappedTransaction
  Q c
;
  c d
}
ÀÀ 
}
ÃÃ 	
public
—— 
override
—— 
bool
—— 
DesignTimeVisible
—— .
{
““ 	
get
”” 
{
”” 
return
”” 
_command
”” !
.
””! "
DesignTimeVisible
””" 3
;
””3 4
}
””5 6
set
‘‘ 
{
‘‘ 
_command
‘‘ 
.
‘‘ 
DesignTimeVisible
‘‘ ,
=
‘‘- .
value
‘‘/ 4
;
‘‘4 5
}
‘‘6 7
}
’’ 	
public
⁄⁄ 
override
⁄⁄ 
UpdateRowSource
⁄⁄ '
UpdatedRowSource
⁄⁄( 8
{
€€ 	
get
‹‹ 
{
‹‹ 
return
‹‹ 
_command
‹‹ !
.
‹‹! "
UpdatedRowSource
‹‹" 2
;
‹‹2 3
}
‹‹4 5
set
›› 
{
›› 
_command
›› 
.
›› 
UpdatedRowSource
›› +
=
››, -
value
››. 3
;
››3 4
}
››5 6
}
ﬁﬁ 	
	protected
ÂÂ 
override
ÂÂ 
DbDataReader
ÂÂ '!
ExecuteDbDataReader
ÂÂ( ;
(
ÂÂ; <
CommandBehavior
ÂÂ< K
behavior
ÂÂL T
)
ÂÂT U
{
ÊÊ 	
if
ÁÁ 
(
ÁÁ 
	_profiler
ÁÁ 
==
ÁÁ 
null
ÁÁ !
||
ÁÁ" $
!
ÁÁ% &
	_profiler
ÁÁ& /
.
ÁÁ/ 0
IsActive
ÁÁ0 8
)
ÁÁ8 9
{
ËË 
return
ÈÈ 
_command
ÈÈ 
.
ÈÈ  
ExecuteReader
ÈÈ  -
(
ÈÈ- .
behavior
ÈÈ. 6
)
ÈÈ6 7
;
ÈÈ7 8
}
ÍÍ 
DbDataReader
ÏÏ 
result
ÏÏ 
=
ÏÏ  !
null
ÏÏ" &
;
ÏÏ& '
	_profiler
ÌÌ 
.
ÌÌ 
ExecuteStart
ÌÌ "
(
ÌÌ" #
this
ÌÌ# '
,
ÌÌ' (
SqlExecuteType
ÌÌ) 7
.
ÌÌ7 8
Reader
ÌÌ8 >
)
ÌÌ> ?
;
ÌÌ? @
try
ÓÓ 
{
ÔÔ 
result
 
=
 
_command
 !
.
! "
ExecuteReader
" /
(
/ 0
behavior
0 8
)
8 9
;
9 :
result
ÒÒ 
=
ÒÒ 
new
ÒÒ "
ProfiledDbDataReader
ÒÒ 1
(
ÒÒ1 2
result
ÒÒ2 8
,
ÒÒ8 9
_connection
ÒÒ: E
,
ÒÒE F
	_profiler
ÒÒG P
)
ÒÒP Q
;
ÒÒQ R
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
e
ÛÛ 
)
ÛÛ 
{
ÙÙ 
	_profiler
ıı 
.
ıı 
OnError
ıı !
(
ıı! "
this
ıı" &
,
ıı& '
SqlExecuteType
ıı( 6
.
ıı6 7
Reader
ıı7 =
,
ıı= >
e
ıı? @
)
ıı@ A
;
ııA B
throw
ˆˆ 
;
ˆˆ 
}
˜˜ 
finally
¯¯ 
{
˘˘ 
	_profiler
˙˙ 
.
˙˙ 
ExecuteFinish
˙˙ '
(
˙˙' (
this
˙˙( ,
,
˙˙, -
SqlExecuteType
˙˙. <
.
˙˙< =
Reader
˙˙= C
,
˙˙C D
result
˙˙E K
)
˙˙K L
;
˙˙L M
}
˚˚ 
return
˝˝ 
result
˝˝ 
;
˝˝ 
}
˛˛ 	
public
ÑÑ 
override
ÑÑ 
int
ÑÑ 
ExecuteNonQuery
ÑÑ +
(
ÑÑ+ ,
)
ÑÑ, -
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
	_profiler
ÜÜ 
==
ÜÜ 
null
ÜÜ !
||
ÜÜ" $
!
ÜÜ% &
	_profiler
ÜÜ& /
.
ÜÜ/ 0
IsActive
ÜÜ0 8
)
ÜÜ8 9
{
áá 
return
àà 
_command
àà 
.
àà  
ExecuteNonQuery
àà  /
(
àà/ 0
)
àà0 1
;
àà1 2
}
ââ 
int
ãã 
result
ãã 
;
ãã 
	_profiler
çç 
.
çç 
ExecuteStart
çç "
(
çç" #
this
çç# '
,
çç' (
SqlExecuteType
çç) 7
.
çç7 8
NonQuery
çç8 @
)
çç@ A
;
ççA B
try
éé 
{
èè 
result
êê 
=
êê 
_command
êê !
.
êê! "
ExecuteNonQuery
êê" 1
(
êê1 2
)
êê2 3
;
êê3 4
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
e
íí 
)
íí 
{
ìì 
	_profiler
îî 
.
îî 
OnError
îî !
(
îî! "
this
îî" &
,
îî& '
SqlExecuteType
îî( 6
.
îî6 7
NonQuery
îî7 ?
,
îî? @
e
îîA B
)
îîB C
;
îîC D
throw
ïï 
;
ïï 
}
ññ 
finally
óó 
{
òò 
	_profiler
ôô 
.
ôô 
ExecuteFinish
ôô '
(
ôô' (
this
ôô( ,
,
ôô, -
SqlExecuteType
ôô. <
.
ôô< =
NonQuery
ôô= E
,
ôôE F
null
ôôG K
)
ôôK L
;
ôôL M
}
öö 
return
úú 
result
úú 
;
úú 
}
ùù 	
public
•• 
override
•• 
object
•• 
ExecuteScalar
•• ,
(
••, -
)
••- .
{
¶¶ 	
if
ßß 
(
ßß 
	_profiler
ßß 
==
ßß 
null
ßß !
||
ßß" $
!
ßß% &
	_profiler
ßß& /
.
ßß/ 0
IsActive
ßß0 8
)
ßß8 9
{
®® 
return
©© 
_command
©© 
.
©©  
ExecuteScalar
©©  -
(
©©- .
)
©©. /
;
©©/ 0
}
™™ 
object
¨¨ 
result
¨¨ 
;
¨¨ 
	_profiler
≠≠ 
.
≠≠ 
ExecuteStart
≠≠ "
(
≠≠" #
this
≠≠# '
,
≠≠' (
SqlExecuteType
≠≠) 7
.
≠≠7 8
Scalar
≠≠8 >
)
≠≠> ?
;
≠≠? @
try
ÆÆ 
{
ØØ 
result
∞∞ 
=
∞∞ 
_command
∞∞ !
.
∞∞! "
ExecuteScalar
∞∞" /
(
∞∞/ 0
)
∞∞0 1
;
∞∞1 2
}
±± 
catch
≤≤ 
(
≤≤ 
	Exception
≤≤ 
e
≤≤ 
)
≤≤ 
{
≥≥ 
	_profiler
¥¥ 
.
¥¥ 
OnError
¥¥ !
(
¥¥! "
this
¥¥" &
,
¥¥& '
SqlExecuteType
¥¥( 6
.
¥¥6 7
Scalar
¥¥7 =
,
¥¥= >
e
¥¥? @
)
¥¥@ A
;
¥¥A B
throw
µµ 
;
µµ 
}
∂∂ 
finally
∑∑ 
{
∏∏ 
	_profiler
ππ 
.
ππ 
ExecuteFinish
ππ '
(
ππ' (
this
ππ( ,
,
ππ, -
SqlExecuteType
ππ. <
.
ππ< =
Scalar
ππ= C
,
ππC D
null
ππE I
)
ππI J
;
ππJ K
}
∫∫ 
return
ºº 
result
ºº 
;
ºº 
}
ΩΩ 	
public
¬¬ 
override
¬¬ 
void
¬¬ 
Cancel
¬¬ #
(
¬¬# $
)
¬¬$ %
{
√√ 	
_command
ƒƒ 
.
ƒƒ 
Cancel
ƒƒ 
(
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
≈≈ 	
public
   
override
   
void
   
Prepare
   $
(
  $ %
)
  % &
{
ÀÀ 	
_command
ÃÃ 
.
ÃÃ 
Prepare
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
	protected
”” 
override
”” 
DbParameter
”” &
CreateDbParameter
””' 8
(
””8 9
)
””9 :
{
‘‘ 	
return
’’ 
_command
’’ 
.
’’ 
CreateParameter
’’ +
(
’’+ ,
)
’’, -
;
’’- .
}
÷÷ 	
	protected
‹‹ 
override
‹‹ 
void
‹‹ 
Dispose
‹‹  '
(
‹‹' (
bool
‹‹( ,
	disposing
‹‹- 6
)
‹‹6 7
{
›› 	
if
ﬁﬁ 
(
ﬁﬁ 
	disposing
ﬁﬁ 
&&
ﬁﬁ 
_command
ﬁﬁ %
!=
ﬁﬁ& (
null
ﬁﬁ) -
)
ﬁﬁ- .
{
ﬂﬂ 
_command
‡‡ 
.
‡‡ 
Dispose
‡‡  
(
‡‡  !
)
‡‡! "
;
‡‡" #
}
·· 
_command
‚‚ 
=
‚‚ 
null
‚‚ 
;
‚‚ 
base
„„ 
.
„„ 
Dispose
„„ 
(
„„ 
	disposing
„„ "
)
„„" #
;
„„# $
}
‰‰ 	
public
ÈÈ 
	DbCommand
ÈÈ 
InternalCommand
ÈÈ (
{
ÍÍ 	
get
ÎÎ 
{
ÏÏ 
return
ÌÌ 
_command
ÌÌ 
;
ÌÌ  
}
ÓÓ 
}
ÔÔ 	
public
ıı 
ProfiledDbCommand
ıı  
Clone
ıı! &
(
ıı& '
)
ıı' (
{
ˆˆ 	
var
˜˜ 
tail
˜˜ 
=
˜˜ 
_command
˜˜ 
as
˜˜  "

ICloneable
˜˜# -
;
˜˜- .
if
¯¯ 
(
¯¯ 
tail
¯¯ 
==
¯¯ 
null
¯¯ 
)
¯¯ 
throw
¯¯ #
new
¯¯$ '#
NotSupportedException
¯¯( =
(
¯¯= >
$str
¯¯> K
+
¯¯L M
_command
¯¯N V
.
¯¯V W
GetType
¯¯W ^
(
¯¯^ _
)
¯¯_ `
.
¯¯` a
Name
¯¯a e
+
¯¯f g
$str
¯¯h {
)
¯¯{ |
;
¯¯| }
return
˘˘ 
new
˘˘ 
ProfiledDbCommand
˘˘ (
(
˘˘( )
(
˘˘) *
	DbCommand
˘˘* 3
)
˘˘3 4
tail
˘˘4 8
.
˘˘8 9
Clone
˘˘9 >
(
˘˘> ?
)
˘˘? @
,
˘˘@ A
_connection
˘˘B M
,
˘˘M N
	_profiler
˘˘O X
)
˘˘X Y
;
˘˘Y Z
}
˙˙ 	
object
ÇÇ 

ICloneable
ÇÇ 
.
ÇÇ 
Clone
ÇÇ 
(
ÇÇ  
)
ÇÇ  !
{
ÉÉ 	
return
ÑÑ 
Clone
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá ™V
\C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbConnection.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
[ 
System 
. 
ComponentModel 
. 
DesignerCategory +
(+ ,
$str, .
). /
]/ 0
public 

class  
ProfiledDbConnection %
:& '
DbConnection( 4
,4 5

ICloneable6 @
{ 
[ 	
SuppressMessage	 
( 
$str ?
,? @
$strA ]
,] ^
Justification_ l
=m n
$str	o î
)
î ï
]
ï ñ
	protected 
DbConnection 
_connection *
;* +
public 
DbConnection 
InnerConnection +
{ 	
get 
{ 
return 
_connection $
;$ %
}& '
} 	
[!! 	
SuppressMessage!!	 
(!! 
$str!! ?
,!!? @
$str!!A ]
,!!] ^
Justification!!_ l
=!!m n
$str	!!o í
)
!!í ì
]
!!ì î
	protected## 
IDbProfiler## 
	_profiler## '
;##' (
public)) 
IDbProfiler)) 
Profiler)) #
{** 	
get++ 
{++ 
return++ 
	_profiler++ "
;++" #
}++$ %
},, 	
public99  
ProfiledDbConnection99 #
(99# $
DbConnection99$ 0

connection991 ;
,99; <
IDbProfiler99= H
profiler99I Q
)99Q R
{:: 	
if;; 
(;; 

connection;; 
==;; 
null;; "
);;" #
throw;;$ )
new;;* -!
ArgumentNullException;;. C
(;;C D
$str;;D P
);;P Q
;;;Q R
_connection== 
=== 

connection== $
;==$ %
_connection>> 
.>> 
StateChange>> #
+=>>$ &
StateChangeHandler>>' 9
;>>9 :
if@@ 
(@@ 
profiler@@ 
!=@@ 
null@@  
)@@  !
{AA 
	_profilerBB 
=BB 
profilerBB $
;BB$ %
}CC 
}DD 	
publicII 
DbConnectionII 
WrappedConnectionII -
{JJ 	
getKK 
{KK 
returnKK 
_connectionKK $
;KK$ %
}KK& '
}LL 	
	protectedQQ 
overrideQQ 
boolQQ 
CanRaiseEventsQQ  .
{RR 	
getSS 
{SS 
returnSS 
trueSS 
;SS 
}SS  
}TT 	
publicYY 
overrideYY 
stringYY 
ConnectionStringYY /
{ZZ 	
get[[ 
{[[ 
return[[ 
_connection[[ $
.[[$ %
ConnectionString[[% 5
;[[5 6
}[[7 8
set\\ 
{\\ 
_connection\\ 
.\\ 
ConnectionString\\ .
=\\/ 0
value\\1 6
;\\6 7
}\\8 9
}]] 	
publicbb 
overridebb 
intbb 
ConnectionTimeoutbb -
{cc 	
getdd 
{dd 
returndd 
_connectiondd $
.dd$ %
ConnectionTimeoutdd% 6
;dd6 7
}dd8 9
}ee 	
publicjj 
overridejj 
stringjj 
Databasejj '
{kk 	
getll 
{ll 
returnll 
_connectionll $
.ll$ %
Databasell% -
;ll- .
}ll/ 0
}mm 	
publicrr 
overriderr 
stringrr 

DataSourcerr )
{ss 	
gettt 
{tt 
returntt 
_connectiontt $
.tt$ %

DataSourcett% /
;tt/ 0
}tt1 2
}uu 	
publiczz 
overridezz 
stringzz 
ServerVersionzz ,
{{{ 	
get|| 
{|| 
return|| 
_connection|| $
.||$ %
ServerVersion||% 2
;||2 3
}||4 5
}}} 	
public
ÇÇ 
override
ÇÇ 
ConnectionState
ÇÇ '
State
ÇÇ( -
{
ÉÉ 	
get
ÑÑ 
{
ÑÑ 
return
ÑÑ 
_connection
ÑÑ $
.
ÑÑ$ %
State
ÑÑ% *
;
ÑÑ* +
}
ÑÑ, -
}
ÖÖ 	
public
ãã 
override
ãã 
void
ãã 
ChangeDatabase
ãã +
(
ãã+ ,
string
ãã, 2
databaseName
ãã3 ?
)
ãã? @
{
åå 	
_connection
çç 
.
çç 
ChangeDatabase
çç &
(
çç& '
databaseName
çç' 3
)
çç3 4
;
çç4 5
}
éé 	
public
ìì 
override
ìì 
void
ìì 
Close
ìì "
(
ìì" #
)
ìì# $
{
îî 	
_connection
ïï 
.
ïï 
Close
ïï 
(
ïï 
)
ïï 
;
ïï  
}
ññ 	
public
úú 
override
úú 
void
úú 
EnlistTransaction
úú .
(
úú. /
System
úú/ 5
.
úú5 6
Transactions
úú6 B
.
úúB C
Transaction
úúC N
transaction
úúO Z
)
úúZ [
{
ùù 	
_connection
ûû 
.
ûû 
EnlistTransaction
ûû )
(
ûû) *
transaction
ûû* 5
)
ûû5 6
;
ûû6 7
}
üü 	
public
•• 
override
•• 
	DataTable
•• !
	GetSchema
••" +
(
••+ ,
)
••, -
{
¶¶ 	
return
ßß 
_connection
ßß 
.
ßß 
	GetSchema
ßß (
(
ßß( )
)
ßß) *
;
ßß* +
}
®® 	
public
ØØ 
override
ØØ 
	DataTable
ØØ !
	GetSchema
ØØ" +
(
ØØ+ ,
string
ØØ, 2
collectionName
ØØ3 A
)
ØØA B
{
∞∞ 	
return
±± 
_connection
±± 
.
±± 
	GetSchema
±± (
(
±±( )
collectionName
±±) 7
)
±±7 8
;
±±8 9
}
≤≤ 	
public
∫∫ 
override
∫∫ 
	DataTable
∫∫ !
	GetSchema
∫∫" +
(
∫∫+ ,
string
∫∫, 2
collectionName
∫∫3 A
,
∫∫A B
string
∫∫C I
[
∫∫I J
]
∫∫J K
restrictionValues
∫∫L ]
)
∫∫] ^
{
ªª 	
return
ºº 
_connection
ºº 
.
ºº 
	GetSchema
ºº (
(
ºº( )
collectionName
ºº) 7
,
ºº7 8
restrictionValues
ºº9 J
)
ººJ K
;
ººK L
}
ΩΩ 	
public
¬¬ 
override
¬¬ 
void
¬¬ 
Open
¬¬ !
(
¬¬! "
)
¬¬" #
{
√√ 	
_connection
ƒƒ 
.
ƒƒ 
Open
ƒƒ 
(
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
≈≈ 	
	protected
ÃÃ 
override
ÃÃ 
DbTransaction
ÃÃ ( 
BeginDbTransaction
ÃÃ) ;
(
ÃÃ; <
IsolationLevel
ÃÃ< J
isolationLevel
ÃÃK Y
)
ÃÃY Z
{
ÕÕ 	
return
ŒŒ 
new
ŒŒ #
ProfiledDbTransaction
ŒŒ ,
(
ŒŒ, -
_connection
ŒŒ- 8
.
ŒŒ8 9
BeginTransaction
ŒŒ9 I
(
ŒŒI J
isolationLevel
ŒŒJ X
)
ŒŒX Y
,
ŒŒY Z
this
ŒŒ[ _
)
ŒŒ_ `
;
ŒŒ` a
}
œœ 	
	protected
’’ 
override
’’ 
	DbCommand
’’ $
CreateDbCommand
’’% 4
(
’’4 5
)
’’5 6
{
÷÷ 	
return
◊◊ 
new
◊◊ 
ProfiledDbCommand
◊◊ (
(
◊◊( )
_connection
◊◊) 4
.
◊◊4 5
CreateCommand
◊◊5 B
(
◊◊B C
)
◊◊C D
,
◊◊D E
this
◊◊F J
,
◊◊J K
	_profiler
◊◊L U
)
◊◊U V
;
◊◊V W
}
ÿÿ 	
	protected
ﬁﬁ 
override
ﬁﬁ 
void
ﬁﬁ 
Dispose
ﬁﬁ  '
(
ﬁﬁ' (
bool
ﬁﬁ( ,
	disposing
ﬁﬁ- 6
)
ﬁﬁ6 7
{
ﬂﬂ 	
if
‡‡ 
(
‡‡ 
	disposing
‡‡ 
&&
‡‡ 
_connection
‡‡ (
!=
‡‡) +
null
‡‡, 0
)
‡‡0 1
{
·· 
_connection
‚‚ 
.
‚‚ 
StateChange
‚‚ '
-=
‚‚( * 
StateChangeHandler
‚‚+ =
;
‚‚= >
_connection
„„ 
.
„„ 
Dispose
„„ #
(
„„# $
)
„„$ %
;
„„% &
}
‰‰ 
_connection
ÂÂ 
=
ÂÂ 
null
ÂÂ 
;
ÂÂ 
	_profiler
ÊÊ 
=
ÊÊ 
null
ÊÊ 
;
ÊÊ 
base
ÁÁ 
.
ÁÁ 
Dispose
ÁÁ 
(
ÁÁ 
	disposing
ÁÁ "
)
ÁÁ" #
;
ÁÁ# $
}
ËË 	
private
ÔÔ 
void
ÔÔ  
StateChangeHandler
ÔÔ '
(
ÔÔ' (
object
ÔÔ( .
sender
ÔÔ/ 5
,
ÔÔ5 6"
StateChangeEventArgs
ÔÔ7 K'
stateChangeEventArguments
ÔÔL e
)
ÔÔe f
{
 	
OnStateChange
ÒÒ 
(
ÒÒ '
stateChangeEventArguments
ÒÒ 3
)
ÒÒ3 4
;
ÒÒ4 5
}
ÚÚ 	
public
¯¯ "
ProfiledDbConnection
¯¯ #
Clone
¯¯$ )
(
¯¯) *
)
¯¯* +
{
˘˘ 	
var
˙˙ 
tail
˙˙ 
=
˙˙ 
_connection
˙˙ "
as
˙˙# %

ICloneable
˙˙& 0
;
˙˙0 1
if
˚˚ 
(
˚˚ 
tail
˚˚ 
==
˚˚ 
null
˚˚ 
)
˚˚ 
throw
˚˚ #
new
˚˚$ '#
NotSupportedException
˚˚( =
(
˚˚= >
$str
˚˚> K
+
˚˚L M
_connection
˚˚N Y
.
˚˚Y Z
GetType
˚˚Z a
(
˚˚a b
)
˚˚b c
.
˚˚c d
Name
˚˚d h
+
˚˚i j
$str
˚˚k ~
)
˚˚~ 
;˚˚ Ä
return
¸¸ 
new
¸¸ "
ProfiledDbConnection
¸¸ +
(
¸¸+ ,
(
¸¸, -
DbConnection
¸¸- 9
)
¸¸9 :
tail
¸¸: >
.
¸¸> ?
Clone
¸¸? D
(
¸¸D E
)
¸¸E F
,
¸¸F G
	_profiler
¸¸H Q
)
¸¸Q R
;
¸¸R S
}
˝˝ 	
object
ÉÉ 

ICloneable
ÉÉ 
.
ÉÉ 
Clone
ÉÉ 
(
ÉÉ  
)
ÉÉ  !
{
ÑÑ 	
return
ÖÖ 
Clone
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
}
áá 
}àà Äm
\C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbDataReader.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public 

class  
ProfiledDbDataReader %
:& '
DbDataReader( 4
{ 
private 
readonly 
DbDataReader %
_reader& -
;- .
private 
readonly 
IDbProfiler $
	_profiler% .
;. /
public  
ProfiledDbDataReader #
(# $
DbDataReader$ 0
reader1 7
,7 8
DbConnection9 E

connectionF P
,P Q
IDbProfilerR ]
profiler^ f
)f g
{ 	
_reader 
= 
reader 
; 
if!! 
(!! 
profiler!! 
!=!! 
null!!  
)!!  !
{"" 
	_profiler## 
=## 
profiler## $
;##$ %
}$$ 
}%% 	
public** 
override** 
int** 
Depth** !
{++ 	
get,, 
{,, 
return,, 
_reader,,  
.,,  !
Depth,,! &
;,,& '
},,( )
}-- 	
public22 
override22 
int22 

FieldCount22 &
{33 	
get44 
{44 
return44 
_reader44  
.44  !

FieldCount44! +
;44+ ,
}44- .
}55 	
public:: 
override:: 
bool:: 
HasRows:: $
{;; 	
get<< 
{<< 
return<< 
_reader<<  
.<<  !
HasRows<<! (
;<<( )
}<<* +
}== 	
publicBB 
overrideBB 
boolBB 
IsClosedBB %
{CC 	
getDD 
{DD 
returnDD 
_readerDD  
.DD  !
IsClosedDD! )
;DD) *
}DD+ ,
}EE 	
publicJJ 
overrideJJ 
intJJ 
RecordsAffectedJJ +
{KK 	
getLL 
{LL 
returnLL 
_readerLL  
.LL  !
RecordsAffectedLL! 0
;LL0 1
}LL2 3
}MM 	
publicRR 
DbDataReaderRR 
WrappedReaderRR )
{SS 	
getTT 
{TT 
returnTT 
_readerTT  
;TT  !
}TT" #
}UU 	
public`` 
override`` 
object`` 
this`` #
[``# $
string``$ *
name``+ /
]``/ 0
{aa 	
getbb 
{bb 
returnbb 
_readerbb  
[bb  !
namebb! %
]bb% &
;bb& '
}bb( )
}cc 	
publicnn 
overridenn 
objectnn 
thisnn #
[nn# $
intnn$ '
ordinalnn( /
]nn/ 0
{oo 	
getpp 
{pp 
returnpp 
_readerpp  
[pp  !
ordinalpp! (
]pp( )
;pp) *
}pp+ ,
}qq 	
publicvv 
overridevv 
voidvv 
Closevv "
(vv" #
)vv# $
{ww 	
ifzz 
(zz 
_readerzz 
!=zz 
nullzz 
)zz  
{{{ 
_reader|| 
.|| 
Close|| 
(|| 
)|| 
;||  
}}} 
if 
( 
	_profiler 
!= 
null !
)! "
{
ÄÄ 
	_profiler
ÅÅ 
.
ÅÅ 
ReaderFinish
ÅÅ &
(
ÅÅ& '
this
ÅÅ' +
)
ÅÅ+ ,
;
ÅÅ, -
}
ÇÇ 
}
ÉÉ 	
public
éé 
override
éé 
bool
éé 

GetBoolean
éé '
(
éé' (
int
éé( +
ordinal
éé, 3
)
éé3 4
{
èè 	
return
êê 
_reader
êê 
.
êê 

GetBoolean
êê %
(
êê% &
ordinal
êê& -
)
êê- .
;
êê. /
}
ëë 	
public
úú 
override
úú 
byte
úú 
GetByte
úú $
(
úú$ %
int
úú% (
ordinal
úú) 0
)
úú0 1
{
ùù 	
return
ûû 
_reader
ûû 
.
ûû 
GetByte
ûû "
(
ûû" #
ordinal
ûû# *
)
ûû* +
;
ûû+ ,
}
üü 	
public
∂∂ 
override
∂∂ 
long
∂∂ 
GetBytes
∂∂ %
(
∂∂% &
int
∂∂& )
ordinal
∂∂* 1
,
∂∂1 2
long
∂∂3 7

dataOffset
∂∂8 B
,
∂∂B C
byte
∂∂D H
[
∂∂H I
]
∂∂I J
buffer
∂∂K Q
,
∂∂Q R
int
∂∂S V
bufferOffset
∂∂W c
,
∂∂c d
int
∂∂e h
length
∂∂i o
)
∂∂o p
{
∑∑ 	
return
∏∏ 
_reader
∏∏ 
.
∏∏ 
GetBytes
∏∏ #
(
∏∏# $
ordinal
∏∏$ +
,
∏∏+ ,

dataOffset
∏∏- 7
,
∏∏7 8
buffer
∏∏9 ?
,
∏∏? @
bufferOffset
∏∏A M
,
∏∏M N
length
∏∏O U
)
∏∏U V
;
∏∏V W
}
ππ 	
public
ƒƒ 
override
ƒƒ 
char
ƒƒ 
GetChar
ƒƒ $
(
ƒƒ$ %
int
ƒƒ% (
ordinal
ƒƒ) 0
)
ƒƒ0 1
{
≈≈ 	
return
∆∆ 
_reader
∆∆ 
.
∆∆ 
GetChar
∆∆ "
(
∆∆" #
ordinal
∆∆# *
)
∆∆* +
;
∆∆+ ,
}
«« 	
public
ﬁﬁ 
override
ﬁﬁ 
long
ﬁﬁ 
GetChars
ﬁﬁ %
(
ﬁﬁ% &
int
ﬁﬁ& )
ordinal
ﬁﬁ* 1
,
ﬁﬁ1 2
long
ﬁﬁ3 7

dataOffset
ﬁﬁ8 B
,
ﬁﬁB C
char
ﬁﬁD H
[
ﬁﬁH I
]
ﬁﬁI J
buffer
ﬁﬁK Q
,
ﬁﬁQ R
int
ﬁﬁS V
bufferOffset
ﬁﬁW c
,
ﬁﬁc d
int
ﬁﬁe h
length
ﬁﬁi o
)
ﬁﬁo p
{
ﬂﬂ 	
return
‡‡ 
_reader
‡‡ 
.
‡‡ 
GetChars
‡‡ #
(
‡‡# $
ordinal
‡‡$ +
,
‡‡+ ,

dataOffset
‡‡- 7
,
‡‡7 8
buffer
‡‡9 ?
,
‡‡? @
bufferOffset
‡‡A M
,
‡‡M N
length
‡‡O U
)
‡‡U V
;
‡‡V W
}
·· 	
public
ÏÏ 
override
ÏÏ 
string
ÏÏ 
GetDataTypeName
ÏÏ .
(
ÏÏ. /
int
ÏÏ/ 2
ordinal
ÏÏ3 :
)
ÏÏ: ;
{
ÌÌ 	
return
ÓÓ 
_reader
ÓÓ 
.
ÓÓ 
GetDataTypeName
ÓÓ *
(
ÓÓ* +
ordinal
ÓÓ+ 2
)
ÓÓ2 3
;
ÓÓ3 4
}
ÔÔ 	
public
˙˙ 
override
˙˙ 
DateTime
˙˙  
GetDateTime
˙˙! ,
(
˙˙, -
int
˙˙- 0
ordinal
˙˙1 8
)
˙˙8 9
{
˚˚ 	
return
¸¸ 
_reader
¸¸ 
.
¸¸ 
GetDateTime
¸¸ &
(
¸¸& '
ordinal
¸¸' .
)
¸¸. /
;
¸¸/ 0
}
˝˝ 	
public
àà 
override
àà 
decimal
àà 

GetDecimal
àà  *
(
àà* +
int
àà+ .
ordinal
àà/ 6
)
àà6 7
{
ââ 	
return
ää 
_reader
ää 
.
ää 

GetDecimal
ää %
(
ää% &
ordinal
ää& -
)
ää- .
;
ää. /
}
ãã 	
public
ññ 
override
ññ 
double
ññ 
	GetDouble
ññ (
(
ññ( )
int
ññ) ,
ordinal
ññ- 4
)
ññ4 5
{
óó 	
return
òò 
_reader
òò 
.
òò 
	GetDouble
òò $
(
òò$ %
ordinal
òò% ,
)
òò, -
;
òò- .
}
ôô 	
public
°° 
override
°° 
System
°° 
.
°° 
Collections
°° *
.
°°* +
IEnumerator
°°+ 6
GetEnumerator
°°7 D
(
°°D E
)
°°E F
{
¢¢ 	
return
££ 
(
££ 
(
££ 
System
££ 
.
££ 
Collections
££ '
.
££' (
IEnumerable
££( 3
)
££3 4
_reader
££4 ;
)
££; <
.
££< =
GetEnumerator
££= J
(
££J K
)
££K L
;
££L M
}
§§ 	
public
ØØ 
override
ØØ 
Type
ØØ 
GetFieldType
ØØ )
(
ØØ) *
int
ØØ* -
ordinal
ØØ. 5
)
ØØ5 6
{
∞∞ 	
return
±± 
_reader
±± 
.
±± 
GetFieldType
±± '
(
±±' (
ordinal
±±( /
)
±±/ 0
;
±±0 1
}
≤≤ 	
public
ΩΩ 
override
ΩΩ 
float
ΩΩ 
GetFloat
ΩΩ &
(
ΩΩ& '
int
ΩΩ' *
ordinal
ΩΩ+ 2
)
ΩΩ2 3
{
ææ 	
return
øø 
_reader
øø 
.
øø 
GetFloat
øø #
(
øø# $
ordinal
øø$ +
)
øø+ ,
;
øø, -
}
¿¿ 	
public
ÀÀ 
override
ÀÀ 
Guid
ÀÀ 
GetGuid
ÀÀ $
(
ÀÀ$ %
int
ÀÀ% (
ordinal
ÀÀ) 0
)
ÀÀ0 1
{
ÃÃ 	
return
ÕÕ 
_reader
ÕÕ 
.
ÕÕ 
GetGuid
ÕÕ "
(
ÕÕ" #
ordinal
ÕÕ# *
)
ÕÕ* +
;
ÕÕ+ ,
}
ŒŒ 	
public
’’ 
override
’’ 
short
’’ 
GetInt16
’’ &
(
’’& '
int
’’' *
ordinal
’’+ 2
)
’’2 3
{
÷÷ 	
return
◊◊ 
_reader
◊◊ 
.
◊◊ 
GetInt16
◊◊ #
(
◊◊# $
ordinal
◊◊$ +
)
◊◊+ ,
;
◊◊, -
}
ÿÿ 	
public
·· 
override
·· 
int
·· 
GetInt32
·· $
(
··$ %
int
··% (
ordinal
··) 0
)
··0 1
{
‚‚ 	
return
„„ 
_reader
„„ 
.
„„ 
GetInt32
„„ #
(
„„# $
ordinal
„„$ +
)
„„+ ,
;
„„, -
}
‰‰ 	
public
ÔÔ 
override
ÔÔ 
long
ÔÔ 
GetInt64
ÔÔ %
(
ÔÔ% &
int
ÔÔ& )
ordinal
ÔÔ* 1
)
ÔÔ1 2
{
 	
return
ÒÒ 
_reader
ÒÒ 
.
ÒÒ 
GetInt64
ÒÒ #
(
ÒÒ# $
ordinal
ÒÒ$ +
)
ÒÒ+ ,
;
ÒÒ, -
}
ÚÚ 	
public
˝˝ 
override
˝˝ 
string
˝˝ 
GetName
˝˝ &
(
˝˝& '
int
˝˝' *
ordinal
˝˝+ 2
)
˝˝2 3
{
˛˛ 	
return
ˇˇ 
_reader
ˇˇ 
.
ˇˇ 
GetName
ˇˇ "
(
ˇˇ" #
ordinal
ˇˇ# *
)
ˇˇ* +
;
ˇˇ+ ,
}
ÄÄ 	
public
ãã 
override
ãã 
int
ãã 

GetOrdinal
ãã &
(
ãã& '
string
ãã' -
name
ãã. 2
)
ãã2 3
{
åå 	
return
çç 
_reader
çç 
.
çç 

GetOrdinal
çç %
(
çç% &
name
çç& *
)
çç* +
;
çç+ ,
}
éé 	
public
ññ 
override
ññ 
	DataTable
ññ !
GetSchemaTable
ññ" 0
(
ññ0 1
)
ññ1 2
{
óó 	
return
òò 
_reader
òò 
.
òò 
GetSchemaTable
òò )
(
òò) *
)
òò* +
;
òò+ ,
}
ôô 	
public
§§ 
override
§§ 
string
§§ 
	GetString
§§ (
(
§§( )
int
§§) ,
ordinal
§§- 4
)
§§4 5
{
•• 	
return
¶¶ 
_reader
¶¶ 
.
¶¶ 
	GetString
¶¶ $
(
¶¶$ %
ordinal
¶¶% ,
)
¶¶, -
;
¶¶- .
}
ßß 	
public
≤≤ 
override
≤≤ 
object
≤≤ 
GetValue
≤≤ '
(
≤≤' (
int
≤≤( +
ordinal
≤≤, 3
)
≤≤3 4
{
≥≥ 	
return
¥¥ 
_reader
¥¥ 
.
¥¥ 
GetValue
¥¥ #
(
¥¥# $
ordinal
¥¥$ +
)
¥¥+ ,
;
¥¥, -
}
µµ 	
public
¿¿ 
override
¿¿ 
int
¿¿ 
	GetValues
¿¿ %
(
¿¿% &
object
¿¿& ,
[
¿¿, -
]
¿¿- .
values
¿¿/ 5
)
¿¿5 6
{
¡¡ 	
return
¬¬ 
_reader
¬¬ 
.
¬¬ 
	GetValues
¬¬ $
(
¬¬$ %
values
¬¬% +
)
¬¬+ ,
;
¬¬, -
}
√√ 	
public
ŒŒ 
override
ŒŒ 
bool
ŒŒ 
IsDBNull
ŒŒ %
(
ŒŒ% &
int
ŒŒ& )
ordinal
ŒŒ* 1
)
ŒŒ1 2
{
œœ 	
return
–– 
_reader
–– 
.
–– 
IsDBNull
–– #
(
––# $
ordinal
––$ +
)
––+ ,
;
––, -
}
—— 	
public
ŸŸ 
override
ŸŸ 
bool
ŸŸ 

NextResult
ŸŸ '
(
ŸŸ' (
)
ŸŸ( )
{
⁄⁄ 	
return
€€ 
_reader
€€ 
.
€€ 

NextResult
€€ %
(
€€% &
)
€€& '
;
€€' (
}
‹‹ 	
public
‰‰ 
override
‰‰ 
bool
‰‰ 
Read
‰‰ !
(
‰‰! "
)
‰‰" #
{
ÂÂ 	
return
ÊÊ 
_reader
ÊÊ 
.
ÊÊ 
Read
ÊÊ 
(
ÊÊ  
)
ÊÊ  !
;
ÊÊ! "
}
ÁÁ 	
}
ËË 
}ÈÈ —
]C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Data\ProfiledDbTransaction.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Data" &
{ 
public 

class !
ProfiledDbTransaction &
:' (
DbTransaction) 6
{ 
private  
ProfiledDbConnection $
_connection% 0
;0 1
private 
DbTransaction 
_transaction *
;* +
public !
ProfiledDbTransaction $
($ %
DbTransaction% 2
transaction3 >
,> ? 
ProfiledDbConnection@ T

connectionU _
)_ `
{ 	
if 
( 
transaction 
== 
null #
)# $
throw% *
new+ .!
ArgumentNullException/ D
(D E
$strE R
)R S
;S T
if   
(   

connection   
==   
null   "
)  " #
throw  $ )
new  * -!
ArgumentNullException  . C
(  C D
$str  D P
)  P Q
;  Q R
_transaction!! 
=!! 
transaction!! &
;!!& '
_connection"" 
="" 

connection"" $
;""$ %
}## 	
	protected(( 
override(( 
DbConnection(( '
DbConnection((( 4
{)) 	
get** 
{** 
return** 
_connection** $
;**$ %
}**& '
}++ 	
public00 
DbTransaction00 
WrappedTransaction00 /
{11 	
get22 
{22 
return22 
_transaction22 %
;22% &
}22' (
}33 	
public88 
override88 
IsolationLevel88 &
IsolationLevel88' 5
{99 	
get:: 
{:: 
return:: 
_transaction:: %
.::% &
IsolationLevel::& 4
;::4 5
}::6 7
};; 	
public@@ 
override@@ 
void@@ 
Commit@@ #
(@@# $
)@@$ %
{AA 	
_transactionBB 
.BB 
CommitBB 
(BB  
)BB  !
;BB! "
}CC 	
publicHH 
overrideHH 
voidHH 
RollbackHH %
(HH% &
)HH& '
{II 	
_transactionJJ 
.JJ 
RollbackJJ !
(JJ! "
)JJ" #
;JJ# $
}KK 	
	protectedQQ 
overrideQQ 
voidQQ 
DisposeQQ  '
(QQ' (
boolQQ( ,
	disposingQQ- 6
)QQ6 7
{RR 	
ifSS 
(SS 
	disposingSS 
&&SS 
_transactionSS )
!=SS* ,
nullSS- 1
)SS1 2
{TT 
_transactionUU 
.UU 
DisposeUU $
(UU$ %
)UU% &
;UU& '
}VV 
_transactionWW 
=WW 
nullWW 
;WW  
_connectionXX 
=XX 
nullXX 
;XX 
baseYY 
.YY 
DisposeYY 
(YY 
	disposingYY "
)YY" #
;YY# $
}ZZ 	
}[[ 
}\\ Ì
UC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\IStopwatch.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
{ 
internal 
	interface 

IStopwatch !
{		 
long 
ElapsedTicks 
{ 
get 
;  
}! "
long 
	Frequency 
{ 
get 
; 
} 
bool 
	IsRunning 
{ 
get 
; 
} 
void 
Stop 
( 
) 
; 
} 
internal"" 
class"" 
StopwatchWrapper"" #
:""$ %

IStopwatch""& 0
{## 
public** 
static** 

IStopwatch**  
StartNew**! )
(**) *
)*** +
{++ 	
return,, 
new,, 
StopwatchWrapper,, '
(,,' (
),,( )
;,,) *
}-- 	
private22 
readonly22 
	Stopwatch22 "

_stopwatch22# -
;22- .
private77 
StopwatchWrapper77  
(77  !
)77! "
{88 	

_stopwatch99 
=99 
	Stopwatch99 "
.99" #
StartNew99# +
(99+ ,
)99, -
;99- .
}:: 	
public?? 
long?? 
ElapsedTicks??  
{@@ 	
getAA 
{AA 
returnAA 

_stopwatchAA #
.AA# $
ElapsedTicksAA$ 0
;AA0 1
}AA2 3
}BB 	
publicGG 
longGG 
	FrequencyGG 
{HH 	
getII 
{II 
returnII 
	StopwatchII "
.II" #
	FrequencyII# ,
;II, -
}II. /
}JJ 	
publicOO 
boolOO 
	IsRunningOO 
{PP 	
getQQ 
{QQ 
returnQQ 

_stopwatchQQ #
.QQ# $
	IsRunningQQ$ -
;QQ- .
}QQ/ 0
}RR 	
publicWW 
voidWW 
StopWW 
(WW 
)WW 
{XX 	

_stopwatchYY 
.YY 
StopYY 
(YY 
)YY 
;YY 
}ZZ 	
}[[ 
}\\ ˝o
UC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\SqlBuilder.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
.) *
Dapper* 0
{ 
public		 

class		 

SqlBuilder		 
{

 

Dictionary 
< 
string 
, 
Clauses "
>" #
data$ (
=) *
new+ .

Dictionary/ 9
<9 :
string: @
,@ A
ClausesB I
>I J
(J K
)K L
;L M
int 
seq 
; 
class 
Clause 
{ 	
public 
string 
Sql 
{ 
get  #
;# $
set% (
;( )
}* +
public 
object 

Parameters $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 	
class 
Clauses 
: 
List 
< 
Clause #
># $
{ 	
string 
joiner 
; 
string 
prefix 
; 
string 
postfix 
; 
public 
Clauses 
( 
string !
joiner" (
,( )
string* 0
prefix1 7
=8 9
$str: <
,< =
string> D
postfixE L
=M N
$strO Q
)Q R
{ 
this 
. 
joiner 
= 
joiner $
;$ %
this 
. 
prefix 
= 
prefix $
;$ %
this 
. 
postfix 
= 
postfix &
;& '
} 
public!! 
string!! 
ResolveClauses!! (
(!!( )
DynamicParameters!!) :
p!!; <
)!!< =
{"" 
foreach## 
(## 
var## 
item## !
in##" $
this##% )
)##) *
{$$ 
p%% 
.%% 
AddDynamicParams%% &
(%%& '
item%%' +
.%%+ ,

Parameters%%, 6
)%%6 7
;%%7 8
}&& 
return'' 
prefix'' 
+'' 
string''  &
.''& '
Join''' +
(''+ ,
joiner'', 2
,''2 3
this''4 8
.''8 9
Select''9 ?
(''? @
c''@ A
=>''B D
c''E F
.''F G
Sql''G J
)''J K
)''K L
+''M N
postfix''O V
;''V W
}(( 
})) 	
public.. 
class.. 
Template.. 
{// 	
readonly00 
string00 
sql00 
;00  
readonly11 

SqlBuilder11 
builder11  '
;11' (
readonly22 
object22 

initParams22 &
;22& '
int33 
dataSeq33 
=33 
-33 
$num33 
;33 
public;; 
Template;; 
(;; 

SqlBuilder;; &
builder;;' .
,;;. /
string;;0 6
sql;;7 :
,;;: ;
dynamic;;< C

parameters;;D N
);;N O
{<< 
this== 
.== 

initParams== 
===  !

parameters==" ,
;==, -
this>> 
.>> 
sql>> 
=>> 
sql>> 
;>> 
this?? 
.?? 
builder?? 
=?? 
builder?? &
;??& '
}@@ 
staticBB 
readonlyBB 
SystemBB "
.BB" #
TextBB# '
.BB' (
RegularExpressionsBB( :
.BB: ;
RegexBB; @
regexBBA F
=BBG H
newCC 
SystemCC 
.CC 
TextCC 
.CC  
RegularExpressionsCC  2
.CC2 3
RegexCC3 8
(CC8 9
$strCC9 J
,CCJ K
SystemCCL R
.CCR S
TextCCS W
.CCW X
RegularExpressionsCCX j
.CCj k
RegexOptionsCCk w
.CCw x
Compiled	CCx Ä
|
CCÅ Ç
System
CCÉ â
.
CCâ ä
Text
CCä é
.
CCé è 
RegularExpressions
CCè °
.
CC° ¢
RegexOptions
CC¢ Æ
.
CCÆ Ø
	Multiline
CCØ ∏
)
CC∏ π
;
CCπ ∫
voidEE 

ResolveSqlEE 
(EE 
)EE 
{FF 
ifGG 
(GG 
dataSeqGG 
!=GG 
builderGG &
.GG& '
seqGG' *
)GG* +
{HH 
varII 
pII 
=II 
newII 
DynamicParametersII  1
(II1 2

initParamsII2 <
)II< =
;II= >
rawSqlKK 
=KK 
sqlKK  
;KK  !
foreachMM 
(MM 
varMM  
pairMM! %
inMM& (
builderMM) 0
.MM0 1
dataMM1 5
)MM5 6
{NN 
rawSqlOO 
=OO  
rawSqlOO! '
.OO' (
ReplaceOO( /
(OO/ 0
$strOO0 5
+OO6 7
pairOO8 <
.OO< =
KeyOO= @
+OOA B
$strOOC H
,OOH I
pairOOJ N
.OON O
ValueOOO T
.OOT U
ResolveClausesOOU c
(OOc d
pOOd e
)OOe f
)OOf g
;OOg h
}PP 

parametersQQ 
=QQ  
pQQ! "
;QQ" #
rawSqlTT 
=TT 
regexTT "
.TT" #
ReplaceTT# *
(TT* +
rawSqlTT+ 1
,TT1 2
$strTT3 5
)TT5 6
;TT6 7
dataSeqVV 
=VV 
builderVV %
.VV% &
seqVV& )
;VV) *
}WW 
}XX 
stringZZ 
rawSqlZZ 
;ZZ 
object[[ 

parameters[[ 
;[[ 
public`` 
string`` 
RawSql``  
{``! "
get``# &
{``' (

ResolveSql``) 3
(``3 4
)``4 5
;``5 6
return``7 =
rawSql``> D
;``D E
}``F G
}``H I
publicee 
objectee 

Parametersee $
{ee% &
getee' *
{ee+ ,

ResolveSqlee- 7
(ee7 8
)ee8 9
;ee9 :
returnee; A

parameterseeB L
;eeL M
}eeN O
}eeP Q
}ff 	
publicnn 
Templatenn 
AddTemplatenn #
(nn# $
stringnn$ *
sqlnn+ .
,nn. /
dynamicnn0 7

parametersnn8 B
=nnC D
nullnnE I
)nnI J
{oo 	
returnpp 
newpp 
Templatepp 
(pp  
thispp  $
,pp$ %
sqlpp& )
,pp) *

parameterspp+ 5
)pp5 6
;pp6 7
}qq 	
voidss 
	AddClausess 
(ss 
stringss 
namess "
,ss" #
stringss$ *
sqlss+ .
,ss. /
objectss0 6

parametersss7 A
,ssA B
stringssC I
joinerssJ P
,ssP Q
stringssR X
prefixssY _
=ss` a
$strssb d
,ssd e
stringssf l
postfixssm t
=ssu v
$strssw y
)ssy z
{tt 	
Clausesuu 
clausesuu 
;uu 
ifvv 
(vv 
!vv 
datavv 
.vv 
TryGetValuevv !
(vv! "
namevv" &
,vv& '
outvv( +
clausesvv, 3
)vv3 4
)vv4 5
{ww 
clausesxx 
=xx 
newxx 
Clausesxx %
(xx% &
joinerxx& ,
,xx, -
prefixxx. 4
,xx4 5
postfixxx6 =
)xx= >
;xx> ?
datayy 
[yy 
nameyy 
]yy 
=yy 
clausesyy $
;yy$ %
}zz 
clauses{{ 
.{{ 
Add{{ 
({{ 
new{{ 
Clause{{ "
{{{# $
Sql{{% (
={{) *
sql{{+ .
,{{. /

Parameters{{0 :
={{; <

parameters{{= G
}{{H I
){{I J
;{{J K
seq|| 
++|| 
;|| 
}}} 	
public
ÑÑ 

SqlBuilder
ÑÑ 
LeftJoin
ÑÑ "
(
ÑÑ" #
string
ÑÑ# )
sql
ÑÑ* -
,
ÑÑ- .
dynamic
ÑÑ/ 6

parameters
ÑÑ7 A
=
ÑÑB C
null
ÑÑD H
)
ÑÑH I
{
ÖÖ 	
	AddClause
ÜÜ 
(
ÜÜ 
$str
ÜÜ  
,
ÜÜ  !
sql
ÜÜ" %
,
ÜÜ% &

parameters
ÜÜ' 1
,
ÜÜ1 2
joiner
ÜÜ3 9
:
ÜÜ9 :
$str
ÜÜ; I
,
ÜÜI J
prefix
ÜÜK Q
:
ÜÜQ R
$str
ÜÜS a
,
ÜÜa b
postfix
ÜÜc j
:
ÜÜj k
$str
ÜÜl p
)
ÜÜp q
;
ÜÜq r
return
áá 
this
áá 
;
áá 
}
àà 	
public
éé 

SqlBuilder
éé 
Where
éé 
(
éé  
string
éé  &
sql
éé' *
,
éé* +
dynamic
éé, 3

parameters
éé4 >
=
éé? @
null
ééA E
)
ééE F
{
èè 	
	AddClause
êê 
(
êê 
$str
êê 
,
êê 
sql
êê "
,
êê" #

parameters
êê$ .
,
êê. /
$str
êê0 7
,
êê7 8
prefix
êê9 ?
:
êê? @
$str
êêA I
,
êêI J
postfix
êêK R
:
êêR S
$str
êêT X
)
êêX Y
;
êêY Z
return
ëë 
this
ëë 
;
ëë 
}
íí 	
public
òò 

SqlBuilder
òò 
OrderBy
òò !
(
òò! "
string
òò" (
sql
òò) ,
,
òò, -
dynamic
òò. 5

parameters
òò6 @
=
òòA B
null
òòC G
)
òòG H
{
ôô 	
	AddClause
öö 
(
öö 
$str
öö 
,
öö  
sql
öö! $
,
öö$ %

parameters
öö& 0
,
öö0 1
$str
öö2 7
,
öö7 8
prefix
öö9 ?
:
öö? @
$str
ööA L
,
ööL M
postfix
ööN U
:
ööU V
$str
ööW [
)
öö[ \
;
öö\ ]
return
õõ 
this
õõ 
;
õõ 
}
úú 	
public
¢¢ 

SqlBuilder
¢¢ 
Select
¢¢  
(
¢¢  !
string
¢¢! '
sql
¢¢( +
,
¢¢+ ,
dynamic
¢¢- 4

parameters
¢¢5 ?
=
¢¢@ A
null
¢¢B F
)
¢¢F G
{
££ 	
	AddClause
§§ 
(
§§ 
$str
§§ 
,
§§ 
sql
§§  #
,
§§# $

parameters
§§% /
,
§§/ 0
$str
§§1 6
,
§§6 7
prefix
§§8 >
:
§§> ?
$str
§§@ B
,
§§B C
postfix
§§D K
:
§§K L
$str
§§M Q
)
§§Q R
;
§§R S
return
•• 
this
•• 
;
•• 
}
¶¶ 	
public
¨¨ 

SqlBuilder
¨¨ 
AddParameters
¨¨ '
(
¨¨' (
dynamic
¨¨( /

parameters
¨¨0 :
)
¨¨: ;
{
≠≠ 	
	AddClause
ÆÆ 
(
ÆÆ 
$str
ÆÆ $
,
ÆÆ$ %
$str
ÆÆ& (
,
ÆÆ( )

parameters
ÆÆ* 4
,
ÆÆ4 5
$str
ÆÆ6 8
)
ÆÆ8 9
;
ÆÆ9 :
return
ØØ 
this
ØØ 
;
ØØ 
}
∞∞ 	
public
∂∂ 

SqlBuilder
∂∂ 
Join
∂∂ 
(
∂∂ 
string
∂∂ %
sql
∂∂& )
,
∂∂) *
dynamic
∂∂+ 2

parameters
∂∂3 =
=
∂∂> ?
null
∂∂@ D
)
∂∂D E
{
∑∑ 	
	AddClause
∏∏ 
(
∏∏ 
$str
∏∏ 
,
∏∏ 
sql
∏∏ !
,
∏∏! "

parameters
∏∏# -
,
∏∏- .
joiner
∏∏/ 5
:
∏∏5 6
$str
∏∏7 @
,
∏∏@ A
prefix
∏∏B H
:
∏∏H I
$str
∏∏J S
,
∏∏S T
postfix
∏∏U \
:
∏∏\ ]
$str
∏∏^ b
)
∏∏b c
;
∏∏c d
return
ππ 
this
ππ 
;
ππ 
}
∫∫ 	
public
¿¿ 

SqlBuilder
¿¿ 
GroupBy
¿¿ !
(
¿¿! "
string
¿¿" (
sql
¿¿) ,
,
¿¿, -
dynamic
¿¿. 5

parameters
¿¿6 @
=
¿¿A B
null
¿¿C G
)
¿¿G H
{
¡¡ 	
	AddClause
¬¬ 
(
¬¬ 
$str
¬¬ 
,
¬¬  
sql
¬¬! $
,
¬¬$ %

parameters
¬¬& 0
,
¬¬0 1
joiner
¬¬2 8
:
¬¬8 9
$str
¬¬: ?
,
¬¬? @
prefix
¬¬A G
:
¬¬G H
$str
¬¬I V
,
¬¬V W
postfix
¬¬X _
:
¬¬_ `
$str
¬¬a e
)
¬¬e f
;
¬¬f g
return
√√ 
this
√√ 
;
√√ 
}
ƒƒ 	
public
   

SqlBuilder
   
Having
    
(
    !
string
  ! '
sql
  ( +
,
  + ,
dynamic
  - 4

parameters
  5 ?
=
  @ A
null
  B F
)
  F G
{
ÀÀ 	
	AddClause
ÃÃ 
(
ÃÃ 
$str
ÃÃ 
,
ÃÃ 
sql
ÃÃ  #
,
ÃÃ# $

parameters
ÃÃ% /
,
ÃÃ/ 0
joiner
ÃÃ1 7
:
ÃÃ7 8
$str
ÃÃ9 A
,
ÃÃA B
prefix
ÃÃC I
:
ÃÃI J
$str
ÃÃK T
,
ÃÃT U
postfix
ÃÃV ]
:
ÃÃ] ^
$str
ÃÃ_ c
)
ÃÃc d
;
ÃÃd e
return
ÕÕ 
this
ÕÕ 
;
ÕÕ 
}
ŒŒ 	
}
œœ 
}–– …¥
TC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\SqlMapper.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
.) *
Dapper* 0
{ 
public 

static 
partial 
class 
	SqlMapper  )
{ 
public 
	interface 
IDynamicParameters +
{   	
void&& 
AddParameters&& 
(&& 

IDbCommand&& )
command&&* 1
,&&1 2
Identity&&3 ;
identity&&< D
)&&D E
;&&E F
}'' 	
static(( 
Link(( 
<(( 
Type(( 
,(( 
Action((  
<((  !

IDbCommand((! +
,((+ ,
bool((- 1
>((1 2
>((2 3
bindByNameCache((4 C
;((C D
static)) 
Action)) 
<)) 

IDbCommand))  
,))  !
bool))" &
>))& '
GetBindByName))( 5
())5 6
Type))6 :
commandType)); F
)))F G
{** 	
if++ 
(++ 
commandType++ 
==++ 
null++ #
)++# $
return++% +
null++, 0
;++0 1
Action,, 
<,, 

IDbCommand,, 
,,, 
bool,, #
>,,# $
action,,% +
;,,+ ,
if-- 
(-- 
Link-- 
<-- 
Type-- 
,-- 
Action-- !
<--! "

IDbCommand--" ,
,--, -
bool--. 2
>--2 3
>--3 4
.--4 5
TryGet--5 ;
(--; <
bindByNameCache--< K
,--K L
commandType--M X
,--X Y
out--Z ]
action--^ d
)--d e
)--e f
{.. 
return// 
action// 
;// 
}00 
var11 
prop11 
=11 
commandType11 "
.11" #
GetProperty11# .
(11. /
$str11/ ;
,11; <
BindingFlags11= I
.11I J
Public11J P
|11Q R
BindingFlags11S _
.11_ `
Instance11` h
)11h i
;11i j
action22 
=22 
null22 
;22 
ParameterInfo33 
[33 
]33 
indexers33 $
;33$ %

MethodInfo44 
setter44 
;44 
if55 
(55 
prop55 
!=55 
null55 
&&55 
prop55  $
.55$ %
CanWrite55% -
&&55. 0
prop551 5
.555 6
PropertyType556 B
==55C E
typeof55F L
(55L M
bool55M Q
)55Q R
&&66 
(66 
(66 
indexers66 
=66 
prop66  $
.66$ %
GetIndexParameters66% 7
(667 8
)668 9
)669 :
==66; =
null66> B
||66C E
indexers66F N
.66N O
Length66O U
==66V X
$num66Y Z
)66Z [
&&77 
(77 
setter77 
=77 
prop77 !
.77! "
GetSetMethod77" .
(77. /
)77/ 0
)770 1
!=772 4
null775 9
)88 
{99 
var:: 
method:: 
=:: 
new::  
DynamicMethod::! .
(::. /
commandType::/ :
.::: ;
Name::; ?
+::@ A
$str::B O
,::O P
null::Q U
,::U V
new::W Z
Type::[ _
[::_ `
]::` a
{::b c
typeof::d j
(::j k

IDbCommand::k u
)::u v
,::v w
typeof::x ~
(::~ 
bool	:: É
)
::É Ñ
}
::Ö Ü
)
::Ü á
;
::á à
var;; 
il;; 
=;; 
method;; 
.;;  
GetILGenerator;;  .
(;;. /
);;/ 0
;;;0 1
il<< 
.<< 
Emit<< 
(<< 
OpCodes<< 
.<<  
Ldarg_0<<  '
)<<' (
;<<( )
il== 
.== 
Emit== 
(== 
OpCodes== 
.==  
	Castclass==  )
,==) *
commandType==+ 6
)==6 7
;==7 8
il>> 
.>> 
Emit>> 
(>> 
OpCodes>> 
.>>  
Ldarg_1>>  '
)>>' (
;>>( )
il?? 
.?? 
EmitCall?? 
(?? 
OpCodes?? #
.??# $
Callvirt??$ ,
,??, -
setter??. 4
,??4 5
null??6 :
)??: ;
;??; <
il@@ 
.@@ 
Emit@@ 
(@@ 
OpCodes@@ 
.@@  
Ret@@  #
)@@# $
;@@$ %
actionAA 
=AA 
(AA 
ActionAA  
<AA  !

IDbCommandAA! +
,AA+ ,
boolAA- 1
>AA1 2
)AA2 3
methodAA3 9
.AA9 :
CreateDelegateAA: H
(AAH I
typeofAAI O
(AAO P
ActionAAP V
<AAV W

IDbCommandAAW a
,AAa b
boolAAc g
>AAg h
)AAh i
)AAi j
;AAj k
}BB 
LinkDD 
<DD 
TypeDD 
,DD 
ActionDD 
<DD 

IDbCommandDD (
,DD( )
boolDD* .
>DD. /
>DD/ 0
.DD0 1
TryAddDD1 7
(DD7 8
refDD8 ;
bindByNameCacheDD< K
,DDK L
commandTypeDDM X
,DDX Y
refDDZ ]
actionDD^ d
)DDd e
;DDe f
returnEE 
actionEE 
;EE 
}FF 	
classLL 
LinkLL 
<LL 
TKeyLL 
,LL 
TValueLL 
>LL  
whereLL! &
TKeyLL' +
:LL, -
classLL. 3
{MM 	
publicNN 
staticNN 
boolNN 
TryGetNN %
(NN% &
LinkNN& *
<NN* +
TKeyNN+ /
,NN/ 0
TValueNN1 7
>NN7 8
linkNN9 =
,NN= >
TKeyNN? C
keyNND G
,NNG H
outNNI L
TValueNNM S
valueNNT Y
)NNY Z
{OO 
whilePP 
(PP 
linkPP 
!=PP 
nullPP #
)PP# $
{QQ 
ifRR 
(RR 
(RR 
objectRR 
)RR  
keyRR  #
==RR$ &
(RR' (
objectRR( .
)RR. /
linkRR/ 3
.RR3 4
KeyRR4 7
)RR7 8
{SS 
valueTT 
=TT 
linkTT  $
.TT$ %
ValueTT% *
;TT* +
returnUU 
trueUU #
;UU# $
}VV 
linkWW 
=WW 
linkWW 
.WW  
TailWW  $
;WW$ %
}XX 
valueYY 
=YY 
defaultYY 
(YY  
TValueYY  &
)YY& '
;YY' (
returnZZ 
falseZZ 
;ZZ 
}[[ 
public\\ 
static\\ 
bool\\ 
TryAdd\\ %
(\\% &
ref\\& )
Link\\* .
<\\. /
TKey\\/ 3
,\\3 4
TValue\\5 ;
>\\; <
head\\= A
,\\A B
TKey\\C G
key\\H K
,\\K L
ref\\M P
TValue\\Q W
value\\X ]
)\\] ^
{]] 
bool^^ 
tryAgain^^ 
;^^ 
do__ 
{`` 
varaa 
snapshotaa  
=aa! "
Interlockedaa# .
.aa. /
CompareExchangeaa/ >
(aa> ?
refaa? B
headaaC G
,aaG H
nullaaI M
,aaM N
nullaaO S
)aaS T
;aaT U
TValuebb 
foundbb  
;bb  !
ifcc 
(cc 
TryGetcc 
(cc 
snapshotcc '
,cc' (
keycc) ,
,cc, -
outcc. 1
foundcc2 7
)cc7 8
)cc8 9
{dd 
valueee 
=ee 
foundee  %
;ee% &
returnff 
falseff $
;ff$ %
}gg 
varhh 
newNodehh 
=hh  !
newhh" %
Linkhh& *
<hh* +
TKeyhh+ /
,hh/ 0
TValuehh1 7
>hh7 8
(hh8 9
keyhh9 <
,hh< =
valuehh> C
,hhC D
snapshothhE M
)hhM N
;hhN O
tryAgainjj 
=jj 
Interlockedjj *
.jj* +
CompareExchangejj+ :
(jj: ;
refjj; >
headjj? C
,jjC D
newNodejjE L
,jjL M
snapshotjjN V
)jjV W
!=jjX Z
snapshotjj[ c
;jjc d
}kk 
whilekk 
(kk 
tryAgainkk !
)kk! "
;kk" #
returnll 
truell 
;ll 
}mm 
privatenn 
Linknn 
(nn 
TKeynn 
keynn !
,nn! "
TValuenn# )
valuenn* /
,nn/ 0
Linknn1 5
<nn5 6
TKeynn6 :
,nn: ;
TValuenn< B
>nnB C
tailnnD H
)nnH I
{oo 
Keypp 
=pp 
keypp 
;pp 
Valueqq 
=qq 
valueqq 
;qq 
Tailrr 
=rr 
tailrr 
;rr 
}ss 
publictt 
TKeytt 
Keytt 
{tt 
gettt !
;tt! "
privatett# *
settt+ .
;tt. /
}tt0 1
publicuu 
TValueuu 
Valueuu 
{uu  !
getuu" %
;uu% &
privateuu' .
setuu/ 2
;uu2 3
}uu4 5
publicvv 
Linkvv 
<vv 
TKeyvv 
,vv 
TValuevv $
>vv$ %
Tailvv& *
{vv+ ,
getvv- 0
;vv0 1
privatevv2 9
setvv: =
;vv= >
}vv? @
}ww 	
classxx 
	CacheInfoxx 
{yy 	
publiczz 
Funczz 
<zz 
IDataReaderzz #
,zz# $
objectzz% +
>zz+ ,
Deserializerzz- 9
{zz: ;
getzz< ?
;zz? @
setzzA D
;zzD E
}zzF G
public{{ 
Func{{ 
<{{ 
IDataReader{{ #
,{{# $
object{{% +
>{{+ ,
[{{, -
]{{- .
OtherDeserializers{{/ A
{{{B C
get{{D G
;{{G H
set{{I L
;{{L M
}{{N O
public|| 
Action|| 
<|| 

IDbCommand|| $
,||$ %
object||& ,
>||, -
ParamReader||. 9
{||: ;
get||< ?
;||? @
set||A D
;||D E
}||F G
private}} 
int}} 
hitCount}}  
;}}  !
public~~ 
int~~ 
GetHitCount~~ "
(~~" #
)~~# $
{~~% &
return~~' -
Interlocked~~. 9
.~~9 :
CompareExchange~~: I
(~~I J
ref~~J M
hitCount~~N V
,~~V W
$num~~X Y
,~~Y Z
$num~~[ \
)~~\ ]
;~~] ^
}~~_ `
public 
void 
	RecordHit !
(! "
)" #
{$ %
Interlocked& 1
.1 2
	Increment2 ;
(; <
ref< ?
hitCount@ H
)H I
;I J
}K L
}
ÄÄ 	
public
ÖÖ 
static
ÖÖ 
event
ÖÖ 
EventHandler
ÖÖ (
QueryCachePurged
ÖÖ) 9
;
ÖÖ9 :
private
ÜÜ 
static
ÜÜ 
void
ÜÜ  
OnQueryCachePurged
ÜÜ .
(
ÜÜ. /
)
ÜÜ/ 0
{
áá 	
var
àà 
handler
àà 
=
àà 
QueryCachePurged
àà *
;
àà* +
if
ââ 
(
ââ 
handler
ââ 
!=
ââ 
null
ââ 
)
ââ  
handler
ââ! (
(
ââ( )
null
ââ) -
,
ââ- .
	EventArgs
ââ/ 8
.
ââ8 9
Empty
ââ9 >
)
ââ> ?
;
ââ? @
}
ää 	
static
†† 
readonly
†† 
System
†† 
.
†† 
Collections
†† *
.
††* +

Concurrent
††+ 5
.
††5 6"
ConcurrentDictionary
††6 J
<
††J K
Identity
††K S
,
††S T
	CacheInfo
††U ^
>
††^ _
_queryCache
††` k
=
††l m
new
††n q
System
††r x
.
††x y
Collections††y Ñ
.††Ñ Ö

Concurrent††Ö è
.††è ê$
ConcurrentDictionary††ê §
<††§ •
Identity††• ≠
,††≠ Æ
	CacheInfo††Ø ∏
>††∏ π
(††π ∫
)††∫ ª
;††ª º
private
°° 
static
°° 
void
°° 
SetQueryCache
°° )
(
°°) *
Identity
°°* 2
key
°°3 6
,
°°6 7
	CacheInfo
°°8 A
value
°°B G
)
°°G H
{
¢¢ 	
if
££ 
(
££ 
Interlocked
££ 
.
££ 
	Increment
££ %
(
££% &
ref
££& )
collect
££* 1
)
££1 2
==
££3 5
COLLECT_PER_ITEMS
££6 G
)
££G H
{
§§ !
CollectCacheGarbage
•• #
(
••# $
)
••$ %
;
••% &
}
¶¶ 
_queryCache
ßß 
[
ßß 
key
ßß 
]
ßß 
=
ßß 
value
ßß $
;
ßß$ %
}
®® 	
private
™™ 
static
™™ 
void
™™ !
CollectCacheGarbage
™™ /
(
™™/ 0
)
™™0 1
{
´´ 	
try
¨¨ 
{
≠≠ 
foreach
ÆÆ 
(
ÆÆ 
var
ÆÆ 
pair
ÆÆ !
in
ÆÆ" $
_queryCache
ÆÆ% 0
)
ÆÆ0 1
{
ØØ 
if
∞∞ 
(
∞∞ 
pair
∞∞ 
.
∞∞ 
Value
∞∞ "
.
∞∞" #
GetHitCount
∞∞# .
(
∞∞. /
)
∞∞/ 0
<=
∞∞1 3#
COLLECT_HIT_COUNT_MIN
∞∞4 I
)
∞∞I J
{
±± 
	CacheInfo
≤≤ !
cache
≤≤" '
;
≤≤' (
_queryCache
≥≥ #
.
≥≥# $
	TryRemove
≥≥$ -
(
≥≥- .
pair
≥≥. 2
.
≥≥2 3
Key
≥≥3 6
,
≥≥6 7
out
≥≥8 ;
cache
≥≥< A
)
≥≥A B
;
≥≥B C
}
¥¥ 
}
µµ 
}
∂∂ 
finally
∏∏ 
{
ππ 
Interlocked
∫∫ 
.
∫∫ 
Exchange
∫∫ $
(
∫∫$ %
ref
∫∫% (
collect
∫∫) 0
,
∫∫0 1
$num
∫∫2 3
)
∫∫3 4
;
∫∫4 5
}
ªª 
}
ºº 	
private
ææ 
const
ææ 
int
ææ 
COLLECT_PER_ITEMS
ææ +
=
ææ, -
$num
ææ. 2
,
ææ2 3#
COLLECT_HIT_COUNT_MIN
ææ4 I
=
ææJ K
$num
ææL M
;
ææM N
private
øø 
static
øø 
int
øø 
collect
øø "
;
øø" #
private
¿¿ 
static
¿¿ 
bool
¿¿ 
TryGetQueryCache
¿¿ ,
(
¿¿, -
Identity
¿¿- 5
key
¿¿6 9
,
¿¿9 :
out
¿¿; >
	CacheInfo
¿¿? H
value
¿¿I N
)
¿¿N O
{
¡¡ 	
if
¬¬ 
(
¬¬ 
_queryCache
¬¬ 
.
¬¬ 
TryGetValue
¬¬ '
(
¬¬' (
key
¬¬( +
,
¬¬+ ,
out
¬¬- 0
value
¬¬1 6
)
¬¬6 7
)
¬¬7 8
{
√√ 
value
ƒƒ 
.
ƒƒ 
	RecordHit
ƒƒ 
(
ƒƒ  
)
ƒƒ  !
;
ƒƒ! "
return
≈≈ 
true
≈≈ 
;
≈≈ 
}
∆∆ 
value
«« 
=
«« 
null
«« 
;
«« 
return
»» 
false
»» 
;
»» 
}
…… 	
public
ŒŒ 
static
ŒŒ 
void
ŒŒ 
PurgeQueryCache
ŒŒ *
(
ŒŒ* +
)
ŒŒ+ ,
{
œœ 	
_queryCache
–– 
.
–– 
Clear
–– 
(
–– 
)
–– 
;
––   
OnQueryCachePurged
—— 
(
—— 
)
——  
;
——  !
}
““ 	
public
ÿÿ 
static
ÿÿ 
int
ÿÿ 
GetCachedSQLCount
ÿÿ +
(
ÿÿ+ ,
)
ÿÿ, -
{
ŸŸ 	
return
⁄⁄ 
_queryCache
⁄⁄ 
.
⁄⁄ 
Count
⁄⁄ $
;
⁄⁄$ %
}
€€ 	
public
‚‚ 
static
‚‚ 
IEnumerable
‚‚ !
<
‚‚! "
Tuple
‚‚" '
<
‚‚' (
string
‚‚( .
,
‚‚. /
string
‚‚0 6
,
‚‚6 7
int
‚‚8 ;
>
‚‚; <
>
‚‚< =
GetCachedSQL
‚‚> J
(
‚‚J K
int
‚‚K N!
ignoreHitCountAbove
‚‚O b
=
‚‚c d
int
‚‚e h
.
‚‚h i
MaxValue
‚‚i q
)
‚‚q r
{
„„ 	
var
‰‰ 
data
‰‰ 
=
‰‰ 
_queryCache
‰‰ "
.
‰‰" #
Select
‰‰# )
(
‰‰) *
pair
‰‰* .
=>
‰‰/ 1
Tuple
‰‰2 7
.
‰‰7 8
Create
‰‰8 >
(
‰‰> ?
pair
‰‰? C
.
‰‰C D
Key
‰‰D G
.
‰‰G H
connectionString
‰‰H X
,
‰‰X Y
pair
‰‰Z ^
.
‰‰^ _
Key
‰‰_ b
.
‰‰b c
sql
‰‰c f
,
‰‰f g
pair
‰‰h l
.
‰‰l m
Value
‰‰m r
.
‰‰r s
GetHitCount
‰‰s ~
(
‰‰~ 
)‰‰ Ä
)‰‰Ä Å
)‰‰Å Ç
;‰‰Ç É
if
ÂÂ 
(
ÂÂ !
ignoreHitCountAbove
ÂÂ #
<
ÂÂ$ %
int
ÂÂ& )
.
ÂÂ) *
MaxValue
ÂÂ* 2
)
ÂÂ2 3
data
ÂÂ4 8
=
ÂÂ9 :
data
ÂÂ; ?
.
ÂÂ? @
Where
ÂÂ@ E
(
ÂÂE F
tuple
ÂÂF K
=>
ÂÂL N
tuple
ÂÂO T
.
ÂÂT U
Item3
ÂÂU Z
<=
ÂÂ[ ]!
ignoreHitCountAbove
ÂÂ^ q
)
ÂÂq r
;
ÂÂr s
return
ÊÊ 
data
ÊÊ 
;
ÊÊ 
}
ÁÁ 	
public
ÌÌ 
static
ÌÌ 
IEnumerable
ÌÌ !
<
ÌÌ! "
Tuple
ÌÌ" '
<
ÌÌ' (
int
ÌÌ( +
,
ÌÌ+ ,
int
ÌÌ- 0
>
ÌÌ0 1
>
ÌÌ1 2 
GetHashCollissions
ÌÌ3 E
(
ÌÌE F
)
ÌÌF G
{
ÓÓ 	
var
ÔÔ 
counts
ÔÔ 
=
ÔÔ 
new
ÔÔ 

Dictionary
ÔÔ '
<
ÔÔ' (
int
ÔÔ( +
,
ÔÔ+ ,
int
ÔÔ- 0
>
ÔÔ0 1
(
ÔÔ1 2
)
ÔÔ2 3
;
ÔÔ3 4
foreach
 
(
 
var
 
key
 
in
 
_queryCache
  +
.
+ ,
Keys
, 0
)
0 1
{
ÒÒ 
int
ÚÚ 
count
ÚÚ 
;
ÚÚ 
if
ÛÛ 
(
ÛÛ 
!
ÛÛ 
counts
ÛÛ 
.
ÛÛ 
TryGetValue
ÛÛ '
(
ÛÛ' (
key
ÛÛ( +
.
ÛÛ+ ,
hashCode
ÛÛ, 4
,
ÛÛ4 5
out
ÛÛ6 9
count
ÛÛ: ?
)
ÛÛ? @
)
ÛÛ@ A
{
ÙÙ 
counts
ıı 
.
ıı 
Add
ıı 
(
ıı 
key
ıı "
.
ıı" #
hashCode
ıı# +
,
ıı+ ,
$num
ıı- .
)
ıı. /
;
ıı/ 0
}
ˆˆ 
else
˜˜ 
{
¯¯ 
counts
˘˘ 
[
˘˘ 
key
˘˘ 
.
˘˘ 
hashCode
˘˘ '
]
˘˘' (
=
˘˘) *
count
˘˘+ 0
+
˘˘1 2
$num
˘˘3 4
;
˘˘4 5
}
˙˙ 
}
˚˚ 
return
¸¸ 
from
¸¸ 
pair
¸¸ 
in
¸¸ 
counts
¸¸  &
where
˝˝ 
pair
˝˝ 
.
˝˝ 
Value
˝˝ #
>
˝˝$ %
$num
˝˝& '
select
˛˛ 
Tuple
˛˛ 
.
˛˛  
Create
˛˛  &
(
˛˛& '
pair
˛˛' +
.
˛˛+ ,
Key
˛˛, /
,
˛˛/ 0
pair
˛˛1 5
.
˛˛5 6
Value
˛˛6 ;
)
˛˛; <
;
˛˛< =
}
ÄÄ 	
static
ÑÑ 
readonly
ÑÑ 

Dictionary
ÑÑ "
<
ÑÑ" #
Type
ÑÑ# '
,
ÑÑ' (
DbType
ÑÑ) /
>
ÑÑ/ 0
typeMap
ÑÑ1 8
;
ÑÑ8 9
static
ÜÜ 
	SqlMapper
ÜÜ 
(
ÜÜ 
)
ÜÜ 
{
áá 	
typeMap
àà 
=
àà 
new
àà 

Dictionary
àà $
<
àà$ %
Type
àà% )
,
àà) *
DbType
àà+ 1
>
àà1 2
(
àà2 3
)
àà3 4
;
àà4 5
typeMap
ââ 
[
ââ 
typeof
ââ 
(
ââ 
byte
ââ 
)
ââ  
]
ââ  !
=
ââ" #
DbType
ââ$ *
.
ââ* +
Byte
ââ+ /
;
ââ/ 0
typeMap
ää 
[
ää 
typeof
ää 
(
ää 
sbyte
ää  
)
ää  !
]
ää! "
=
ää# $
DbType
ää% +
.
ää+ ,
SByte
ää, 1
;
ää1 2
typeMap
ãã 
[
ãã 
typeof
ãã 
(
ãã 
short
ãã  
)
ãã  !
]
ãã! "
=
ãã# $
DbType
ãã% +
.
ãã+ ,
Int16
ãã, 1
;
ãã1 2
typeMap
åå 
[
åå 
typeof
åå 
(
åå 
ushort
åå !
)
åå! "
]
åå" #
=
åå$ %
DbType
åå& ,
.
åå, -
UInt16
åå- 3
;
åå3 4
typeMap
çç 
[
çç 
typeof
çç 
(
çç 
int
çç 
)
çç 
]
çç  
=
çç! "
DbType
çç# )
.
çç) *
Int32
çç* /
;
çç/ 0
typeMap
éé 
[
éé 
typeof
éé 
(
éé 
uint
éé 
)
éé  
]
éé  !
=
éé" #
DbType
éé$ *
.
éé* +
UInt32
éé+ 1
;
éé1 2
typeMap
èè 
[
èè 
typeof
èè 
(
èè 
long
èè 
)
èè  
]
èè  !
=
èè" #
DbType
èè$ *
.
èè* +
Int64
èè+ 0
;
èè0 1
typeMap
êê 
[
êê 
typeof
êê 
(
êê 
ulong
êê  
)
êê  !
]
êê! "
=
êê# $
DbType
êê% +
.
êê+ ,
UInt64
êê, 2
;
êê2 3
typeMap
ëë 
[
ëë 
typeof
ëë 
(
ëë 
float
ëë  
)
ëë  !
]
ëë! "
=
ëë# $
DbType
ëë% +
.
ëë+ ,
Single
ëë, 2
;
ëë2 3
typeMap
íí 
[
íí 
typeof
íí 
(
íí 
double
íí !
)
íí! "
]
íí" #
=
íí$ %
DbType
íí& ,
.
íí, -
Double
íí- 3
;
íí3 4
typeMap
ìì 
[
ìì 
typeof
ìì 
(
ìì 
decimal
ìì "
)
ìì" #
]
ìì# $
=
ìì% &
DbType
ìì' -
.
ìì- .
Decimal
ìì. 5
;
ìì5 6
typeMap
îî 
[
îî 
typeof
îî 
(
îî 
bool
îî 
)
îî  
]
îî  !
=
îî" #
DbType
îî$ *
.
îî* +
Boolean
îî+ 2
;
îî2 3
typeMap
ïï 
[
ïï 
typeof
ïï 
(
ïï 
string
ïï !
)
ïï! "
]
ïï" #
=
ïï$ %
DbType
ïï& ,
.
ïï, -
String
ïï- 3
;
ïï3 4
typeMap
ññ 
[
ññ 
typeof
ññ 
(
ññ 
char
ññ 
)
ññ  
]
ññ  !
=
ññ" #
DbType
ññ$ *
.
ññ* +
StringFixedLength
ññ+ <
;
ññ< =
typeMap
óó 
[
óó 
typeof
óó 
(
óó 
Guid
óó 
)
óó  
]
óó  !
=
óó" #
DbType
óó$ *
.
óó* +
Guid
óó+ /
;
óó/ 0
typeMap
òò 
[
òò 
typeof
òò 
(
òò 
DateTime
òò #
)
òò# $
]
òò$ %
=
òò& '
DbType
òò( .
.
òò. /
DateTime
òò/ 7
;
òò7 8
typeMap
ôô 
[
ôô 
typeof
ôô 
(
ôô 
DateTimeOffset
ôô )
)
ôô) *
]
ôô* +
=
ôô, -
DbType
ôô. 4
.
ôô4 5
DateTimeOffset
ôô5 C
;
ôôC D
typeMap
öö 
[
öö 
typeof
öö 
(
öö 
byte
öö 
[
öö  
]
öö  !
)
öö! "
]
öö" #
=
öö$ %
DbType
öö& ,
.
öö, -
Binary
öö- 3
;
öö3 4
typeMap
õõ 
[
õõ 
typeof
õõ 
(
õõ 
byte
õõ 
?
õõ  
)
õõ  !
]
õõ! "
=
õõ# $
DbType
õõ% +
.
õõ+ ,
Byte
õõ, 0
;
õõ0 1
typeMap
úú 
[
úú 
typeof
úú 
(
úú 
sbyte
úú  
?
úú  !
)
úú! "
]
úú" #
=
úú$ %
DbType
úú& ,
.
úú, -
SByte
úú- 2
;
úú2 3
typeMap
ùù 
[
ùù 
typeof
ùù 
(
ùù 
short
ùù  
?
ùù  !
)
ùù! "
]
ùù" #
=
ùù$ %
DbType
ùù& ,
.
ùù, -
Int16
ùù- 2
;
ùù2 3
typeMap
ûû 
[
ûû 
typeof
ûû 
(
ûû 
ushort
ûû !
?
ûû! "
)
ûû" #
]
ûû# $
=
ûû% &
DbType
ûû' -
.
ûû- .
UInt16
ûû. 4
;
ûû4 5
typeMap
üü 
[
üü 
typeof
üü 
(
üü 
int
üü 
?
üü 
)
üü  
]
üü  !
=
üü" #
DbType
üü$ *
.
üü* +
Int32
üü+ 0
;
üü0 1
typeMap
†† 
[
†† 
typeof
†† 
(
†† 
uint
†† 
?
††  
)
††  !
]
††! "
=
††# $
DbType
††% +
.
††+ ,
UInt32
††, 2
;
††2 3
typeMap
°° 
[
°° 
typeof
°° 
(
°° 
long
°° 
?
°°  
)
°°  !
]
°°! "
=
°°# $
DbType
°°% +
.
°°+ ,
Int64
°°, 1
;
°°1 2
typeMap
¢¢ 
[
¢¢ 
typeof
¢¢ 
(
¢¢ 
ulong
¢¢  
?
¢¢  !
)
¢¢! "
]
¢¢" #
=
¢¢$ %
DbType
¢¢& ,
.
¢¢, -
UInt64
¢¢- 3
;
¢¢3 4
typeMap
££ 
[
££ 
typeof
££ 
(
££ 
float
££  
?
££  !
)
££! "
]
££" #
=
££$ %
DbType
££& ,
.
££, -
Single
££- 3
;
££3 4
typeMap
§§ 
[
§§ 
typeof
§§ 
(
§§ 
double
§§ !
?
§§! "
)
§§" #
]
§§# $
=
§§% &
DbType
§§' -
.
§§- .
Double
§§. 4
;
§§4 5
typeMap
•• 
[
•• 
typeof
•• 
(
•• 
decimal
•• "
?
••" #
)
••# $
]
••$ %
=
••& '
DbType
••( .
.
••. /
Decimal
••/ 6
;
••6 7
typeMap
¶¶ 
[
¶¶ 
typeof
¶¶ 
(
¶¶ 
bool
¶¶ 
?
¶¶  
)
¶¶  !
]
¶¶! "
=
¶¶# $
DbType
¶¶% +
.
¶¶+ ,
Boolean
¶¶, 3
;
¶¶3 4
typeMap
ßß 
[
ßß 
typeof
ßß 
(
ßß 
char
ßß 
?
ßß  
)
ßß  !
]
ßß! "
=
ßß# $
DbType
ßß% +
.
ßß+ ,
StringFixedLength
ßß, =
;
ßß= >
typeMap
®® 
[
®® 
typeof
®® 
(
®® 
Guid
®® 
?
®®  
)
®®  !
]
®®! "
=
®®# $
DbType
®®% +
.
®®+ ,
Guid
®®, 0
;
®®0 1
typeMap
©© 
[
©© 
typeof
©© 
(
©© 
DateTime
©© #
?
©©# $
)
©©$ %
]
©©% &
=
©©' (
DbType
©©) /
.
©©/ 0
DateTime
©©0 8
;
©©8 9
typeMap
™™ 
[
™™ 
typeof
™™ 
(
™™ 
DateTimeOffset
™™ )
?
™™) *
)
™™* +
]
™™+ ,
=
™™- .
DbType
™™/ 5
.
™™5 6
DateTimeOffset
™™6 D
;
™™D E
typeMap
´´ 
[
´´ 
typeof
´´ 
(
´´ 
System
´´ !
.
´´! "
Data
´´" &
.
´´& '
Linq
´´' +
.
´´+ ,
Binary
´´, 2
)
´´2 3
]
´´3 4
=
´´5 6
DbType
´´7 =
.
´´= >
Binary
´´> D
;
´´D E
}
¨¨ 	
private
ÆÆ 
static
ÆÆ 
DbType
ÆÆ 
LookupDbType
ÆÆ *
(
ÆÆ* +
Type
ÆÆ+ /
type
ÆÆ0 4
,
ÆÆ4 5
string
ÆÆ6 <
name
ÆÆ= A
)
ÆÆA B
{
ØØ 	
DbType
∞∞ 
dbType
∞∞ 
;
∞∞ 
var
±±  
nullUnderlyingType
±± "
=
±±# $
Nullable
±±% -
.
±±- .
GetUnderlyingType
±±. ?
(
±±? @
type
±±@ D
)
±±D E
;
±±E F
if
≤≤ 
(
≤≤  
nullUnderlyingType
≤≤ "
!=
≤≤# %
null
≤≤& *
)
≤≤* +
type
≤≤, 0
=
≤≤1 2 
nullUnderlyingType
≤≤3 E
;
≤≤E F
if
≥≥ 
(
≥≥ 
type
≥≥ 
.
≥≥ 
IsEnum
≥≥ 
)
≥≥ 
{
¥¥ 
type
µµ 
=
µµ 
Enum
µµ 
.
µµ 
GetUnderlyingType
µµ -
(
µµ- .
type
µµ. 2
)
µµ2 3
;
µµ3 4
}
∂∂ 
if
∑∑ 
(
∑∑ 
typeMap
∑∑ 
.
∑∑ 
TryGetValue
∑∑ #
(
∑∑# $
type
∑∑$ (
,
∑∑( )
out
∑∑* -
dbType
∑∑. 4
)
∑∑4 5
)
∑∑5 6
{
∏∏ 
return
ππ 
dbType
ππ 
;
ππ 
}
∫∫ 
if
ªª 
(
ªª 
typeof
ªª 
(
ªª 
IEnumerable
ªª "
)
ªª" #
.
ªª# $
IsAssignableFrom
ªª$ 4
(
ªª4 5
type
ªª5 9
)
ªª9 :
)
ªª: ;
{
ºº 
return
ææ 
DbType
ææ 
.
ææ 
Xml
ææ !
;
ææ! "
}
øø 
throw
¬¬ 
new
¬¬ #
NotSupportedException
¬¬ +
(
¬¬+ ,
string
¬¬, 2
.
¬¬2 3
Format
¬¬3 9
(
¬¬9 :
$str
¬¬: z
,
¬¬z {
name¬¬| Ä
,¬¬Ä Å
type¬¬Ç Ü
)¬¬Ü á
)¬¬á à
;¬¬à â
}
√√ 	
public
»» 
class
»» 
Identity
»» 
:
»» 

IEquatable
»»  *
<
»»* +
Identity
»»+ 3
>
»»3 4
{
…… 	
internal
   
Identity
   
ForGrid
   %
(
  % &
Type
  & *
primaryType
  + 6
,
  6 7
int
  8 ;
	gridIndex
  < E
)
  E F
{
ÀÀ 
return
ÃÃ 
new
ÃÃ 
Identity
ÃÃ #
(
ÃÃ# $
sql
ÃÃ$ '
,
ÃÃ' (
commandType
ÃÃ) 4
,
ÃÃ4 5
connectionString
ÃÃ6 F
,
ÃÃF G
primaryType
ÃÃH S
,
ÃÃS T
parametersType
ÃÃU c
,
ÃÃc d
null
ÃÃe i
,
ÃÃi j
	gridIndex
ÃÃk t
)
ÃÃt u
;
ÃÃu v
}
ÕÕ 
internal
œœ 
Identity
œœ 
ForGrid
œœ %
(
œœ% &
Type
œœ& *
primaryType
œœ+ 6
,
œœ6 7
Type
œœ8 <
[
œœ< =
]
œœ= >

otherTypes
œœ? I
,
œœI J
int
œœK N
	gridIndex
œœO X
)
œœX Y
{
–– 
return
—— 
new
—— 
Identity
—— #
(
——# $
sql
——$ '
,
——' (
commandType
——) 4
,
——4 5
connectionString
——6 F
,
——F G
primaryType
——H S
,
——S T
parametersType
——U c
,
——c d

otherTypes
——e o
,
——o p
	gridIndex
——q z
)
——z {
;
——{ |
}
““ 
public
ÿÿ 
Identity
ÿÿ "
ForDynamicParameters
ÿÿ 0
(
ÿÿ0 1
Type
ÿÿ1 5
type
ÿÿ6 :
)
ÿÿ: ;
{
ŸŸ 
return
⁄⁄ 
new
⁄⁄ 
Identity
⁄⁄ #
(
⁄⁄# $
sql
⁄⁄$ '
,
⁄⁄' (
commandType
⁄⁄) 4
,
⁄⁄4 5
connectionString
⁄⁄6 F
,
⁄⁄F G
this
⁄⁄H L
.
⁄⁄L M
type
⁄⁄M Q
,
⁄⁄Q R
type
⁄⁄S W
,
⁄⁄W X
null
⁄⁄Y ]
,
⁄⁄] ^
-
⁄⁄_ `
$num
⁄⁄` a
)
⁄⁄a b
;
⁄⁄b c
}
€€ 
internal
›› 
Identity
›› 
(
›› 
string
›› $
sql
››% (
,
››( )
CommandType
››* 5
?
››5 6
commandType
››7 B
,
››B C
IDbConnection
››D Q

connection
››R \
,
››\ ]
Type
››^ b
type
››c g
,
››g h
Type
››i m
parametersType
››n |
,
››| }
Type››~ Ç
[››Ç É
]››É Ñ

otherTypes››Ö è
)››è ê
:
ﬁﬁ 
this
ﬁﬁ 
(
ﬁﬁ 
sql
ﬁﬁ 
,
ﬁﬁ 
commandType
ﬁﬁ '
,
ﬁﬁ' (

connection
ﬁﬁ) 3
.
ﬁﬁ3 4
ConnectionString
ﬁﬁ4 D
,
ﬁﬁD E
type
ﬁﬁF J
,
ﬁﬁJ K
parametersType
ﬁﬁL Z
,
ﬁﬁZ [

otherTypes
ﬁﬁ\ f
,
ﬁﬁf g
$num
ﬁﬁh i
)
ﬁﬁi j
{
ﬂﬂ 
}
ﬂﬂ 
private
‡‡ 
Identity
‡‡ 
(
‡‡ 
string
‡‡ #
sql
‡‡$ '
,
‡‡' (
CommandType
‡‡) 4
?
‡‡4 5
commandType
‡‡6 A
,
‡‡A B
string
‡‡C I
connectionString
‡‡J Z
,
‡‡Z [
Type
‡‡\ `
type
‡‡a e
,
‡‡e f
Type
‡‡g k
parametersType
‡‡l z
,
‡‡z {
Type‡‡| Ä
[‡‡Ä Å
]‡‡Å Ç

otherTypes‡‡É ç
,‡‡ç é
int‡‡è í
	gridIndex‡‡ì ú
)‡‡ú ù
{
·· 
this
‚‚ 
.
‚‚ 
sql
‚‚ 
=
‚‚ 
sql
‚‚ 
;
‚‚ 
this
„„ 
.
„„ 
commandType
„„  
=
„„! "
commandType
„„# .
;
„„. /
this
‰‰ 
.
‰‰ 
connectionString
‰‰ %
=
‰‰& '
connectionString
‰‰( 8
;
‰‰8 9
this
ÂÂ 
.
ÂÂ 
type
ÂÂ 
=
ÂÂ 
type
ÂÂ  
;
ÂÂ  !
this
ÊÊ 
.
ÊÊ 
parametersType
ÊÊ #
=
ÊÊ$ %
parametersType
ÊÊ& 4
;
ÊÊ4 5
this
ÁÁ 
.
ÁÁ 
	gridIndex
ÁÁ 
=
ÁÁ  
	gridIndex
ÁÁ! *
;
ÁÁ* +
	unchecked
ËË 
{
ÈÈ 
hashCode
ÍÍ 
=
ÍÍ 
$num
ÍÍ !
;
ÍÍ! "
hashCode
ÎÎ 
=
ÎÎ 
hashCode
ÎÎ '
*
ÎÎ( )
$num
ÎÎ* ,
+
ÎÎ- .
commandType
ÎÎ/ :
.
ÎÎ: ;
GetHashCode
ÎÎ; F
(
ÎÎF G
)
ÎÎG H
;
ÎÎH I
hashCode
ÏÏ 
=
ÏÏ 
hashCode
ÏÏ '
*
ÏÏ( )
$num
ÏÏ* ,
+
ÏÏ- .
	gridIndex
ÏÏ/ 8
.
ÏÏ8 9
GetHashCode
ÏÏ9 D
(
ÏÏD E
)
ÏÏE F
;
ÏÏF G
hashCode
ÌÌ 
=
ÌÌ 
hashCode
ÌÌ '
*
ÌÌ( )
$num
ÌÌ* ,
+
ÌÌ- .
(
ÌÌ/ 0
sql
ÌÌ0 3
==
ÌÌ4 6
null
ÌÌ7 ;
?
ÌÌ< =
$num
ÌÌ> ?
:
ÌÌ@ A
sql
ÌÌB E
.
ÌÌE F
GetHashCode
ÌÌF Q
(
ÌÌQ R
)
ÌÌR S
)
ÌÌS T
;
ÌÌT U
hashCode
ÓÓ 
=
ÓÓ 
hashCode
ÓÓ '
*
ÓÓ( )
$num
ÓÓ* ,
+
ÓÓ- .
(
ÓÓ/ 0
type
ÓÓ0 4
==
ÓÓ5 7
null
ÓÓ8 <
?
ÓÓ= >
$num
ÓÓ? @
:
ÓÓA B
type
ÓÓC G
.
ÓÓG H
GetHashCode
ÓÓH S
(
ÓÓS T
)
ÓÓT U
)
ÓÓU V
;
ÓÓV W
if
ÔÔ 
(
ÔÔ 

otherTypes
ÔÔ "
!=
ÔÔ# %
null
ÔÔ& *
)
ÔÔ* +
{
 
foreach
ÒÒ 
(
ÒÒ  !
var
ÒÒ! $
t
ÒÒ% &
in
ÒÒ' )

otherTypes
ÒÒ* 4
)
ÒÒ4 5
{
ÚÚ 
hashCode
ÛÛ $
=
ÛÛ% &
hashCode
ÛÛ' /
*
ÛÛ0 1
$num
ÛÛ2 4
+
ÛÛ5 6
(
ÛÛ7 8
t
ÛÛ8 9
==
ÛÛ: <
null
ÛÛ= A
?
ÛÛB C
$num
ÛÛD E
:
ÛÛF G
t
ÛÛH I
.
ÛÛI J
GetHashCode
ÛÛJ U
(
ÛÛU V
)
ÛÛV W
)
ÛÛW X
;
ÛÛX Y
}
ÙÙ 
}
ıı 
hashCode
ˆˆ 
=
ˆˆ 
hashCode
ˆˆ '
*
ˆˆ( )
$num
ˆˆ* ,
+
ˆˆ- .
(
ˆˆ/ 0
connectionString
ˆˆ0 @
==
ˆˆA C
null
ˆˆD H
?
ˆˆI J
$num
ˆˆK L
:
ˆˆM N
connectionString
ˆˆO _
.
ˆˆ_ `
GetHashCode
ˆˆ` k
(
ˆˆk l
)
ˆˆl m
)
ˆˆm n
;
ˆˆn o
hashCode
˜˜ 
=
˜˜ 
hashCode
˜˜ '
*
˜˜( )
$num
˜˜* ,
+
˜˜- .
(
˜˜/ 0
parametersType
˜˜0 >
==
˜˜? A
null
˜˜B F
?
˜˜G H
$num
˜˜I J
:
˜˜K L
parametersType
˜˜M [
.
˜˜[ \
GetHashCode
˜˜\ g
(
˜˜g h
)
˜˜h i
)
˜˜i j
;
˜˜j k
}
¯¯ 
}
˘˘ 
public
ÄÄ 
override
ÄÄ 
bool
ÄÄ  
Equals
ÄÄ! '
(
ÄÄ' (
object
ÄÄ( .
obj
ÄÄ/ 2
)
ÄÄ2 3
{
ÅÅ 
return
ÇÇ 
Equals
ÇÇ 
(
ÇÇ 
obj
ÇÇ !
as
ÇÇ" $
Identity
ÇÇ% -
)
ÇÇ- .
;
ÇÇ. /
}
ÉÉ 
public
áá 
readonly
áá 
string
áá "
sql
áá# &
;
áá& '
public
ãã 
readonly
ãã 
CommandType
ãã '
?
ãã' (
commandType
ãã) 4
;
ãã4 5
public
êê 
readonly
êê 
int
êê 
hashCode
êê  (
,
êê( )
	gridIndex
êê* 3
;
êê3 4
private
ëë 
readonly
ëë 
Type
ëë !
type
ëë" &
;
ëë& '
public
ïï 
readonly
ïï 
string
ïï "
connectionString
ïï# 3
;
ïï3 4
public
ôô 
readonly
ôô 
Type
ôô  
parametersType
ôô! /
;
ôô/ 0
public
ûû 
override
ûû 
int
ûû 
GetHashCode
ûû  +
(
ûû+ ,
)
ûû, -
{
üü 
return
†† 
hashCode
†† 
;
††  
}
°° 
public
ßß 
bool
ßß 
Equals
ßß 
(
ßß 
Identity
ßß '
other
ßß( -
)
ßß- .
{
®® 
return
©© 
other
™™ 
!=
™™ 
null
™™ !
&&
™™" $
	gridIndex
´´ 
==
´´  
other
´´! &
.
´´& '
	gridIndex
´´' 0
&&
´´1 3
type
¨¨ 
==
¨¨ 
other
¨¨ !
.
¨¨! "
type
¨¨" &
&&
¨¨' )
sql
≠≠ 
==
≠≠ 
other
≠≠  
.
≠≠  !
sql
≠≠! $
&&
≠≠% '
commandType
ÆÆ 
==
ÆÆ  "
other
ÆÆ# (
.
ÆÆ( )
commandType
ÆÆ) 4
&&
ÆÆ5 7
connectionString
ØØ $
==
ØØ% '
other
ØØ( -
.
ØØ- .
connectionString
ØØ. >
&&
ØØ? A
parametersType
∞∞ "
==
∞∞# %
other
∞∞& +
.
∞∞+ ,
parametersType
∞∞, :
;
∞∞: ;
}
±± 
}
≤≤ 	
public
ŒŒ 
static
ŒŒ 
int
ŒŒ 
Execute
ŒŒ !
(
ŒŒ! "
this““ 
IDbConnection
““ 
cnn
““ 
,
““ 
string
““ 
sql
““ "
,
““" #
dynamic
““$ +
param
““, 1
=
““2 3
null
““4 8
,
““8 9
IDbTransaction
““: H
transaction
““I T
=
““U V
null
““W [
,
““[ \
int
““] `
?
““` a
commandTimeout
““b p
=
““q r
null
““s w
,
““w x
CommandType““y Ñ
?““Ñ Ö
commandType““Ü ë
=““í ì
null““î ò
)‘‘ 
{
’’ 	
IEnumerable
÷÷ 
	multiExec
÷÷ !
=
÷÷" #
(
÷÷$ %
object
÷÷% +
)
÷÷+ ,
param
÷÷, 1
as
÷÷2 4
IEnumerable
÷÷5 @
;
÷÷@ A
Identity
◊◊ 
identity
◊◊ 
;
◊◊ 
	CacheInfo
ÿÿ 
info
ÿÿ 
=
ÿÿ 
null
ÿÿ !
;
ÿÿ! "
if
ŸŸ 
(
ŸŸ 
	multiExec
ŸŸ 
!=
ŸŸ 
null
ŸŸ !
&&
ŸŸ" $
!
ŸŸ% &
(
ŸŸ& '
	multiExec
ŸŸ' 0
is
ŸŸ1 3
string
ŸŸ4 :
)
ŸŸ: ;
)
ŸŸ; <
{
⁄⁄ 
bool
€€ 
isFirst
€€ 
=
€€ 
true
€€ #
;
€€# $
int
‹‹ 
total
‹‹ 
=
‹‹ 
$num
‹‹ 
;
‹‹ 
using
›› 
(
›› 
var
›› 
cmd
›› 
=
››  
SetupCommand
››! -
(
››- .
cnn
››. 1
,
››1 2
transaction
››3 >
,
››> ?
sql
››@ C
,
››C D
null
››E I
,
››I J
null
››K O
,
››O P
commandTimeout
››Q _
,
››_ `
commandType
››a l
)
››l m
)
››m n
{
ﬁﬁ 
string
‡‡ 
	masterSql
‡‡ $
=
‡‡% &
null
‡‡' +
;
‡‡+ ,
foreach
·· 
(
·· 
var
··  
obj
··! $
in
··% '
	multiExec
··( 1
)
··1 2
{
‚‚ 
if
„„ 
(
„„ 
isFirst
„„ #
)
„„# $
{
‰‰ 
	masterSql
ÂÂ %
=
ÂÂ& '
cmd
ÂÂ( +
.
ÂÂ+ ,
CommandText
ÂÂ, 7
;
ÂÂ7 8
isFirst
ÊÊ #
=
ÊÊ$ %
false
ÊÊ& +
;
ÊÊ+ ,
identity
ÁÁ $
=
ÁÁ% &
new
ÁÁ' *
Identity
ÁÁ+ 3
(
ÁÁ3 4
sql
ÁÁ4 7
,
ÁÁ7 8
cmd
ÁÁ9 <
.
ÁÁ< =
CommandType
ÁÁ= H
,
ÁÁH I
cnn
ÁÁJ M
,
ÁÁM N
null
ÁÁO S
,
ÁÁS T
obj
ÁÁU X
.
ÁÁX Y
GetType
ÁÁY `
(
ÁÁ` a
)
ÁÁa b
,
ÁÁb c
null
ÁÁd h
)
ÁÁh i
;
ÁÁi j
info
ËË  
=
ËË! "
GetCacheInfo
ËË# /
(
ËË/ 0
identity
ËË0 8
)
ËË8 9
;
ËË9 :
}
ÈÈ 
else
ÍÍ 
{
ÎÎ 
cmd
ÏÏ 
.
ÏÏ  
CommandText
ÏÏ  +
=
ÏÏ, -
	masterSql
ÏÏ. 7
;
ÏÏ7 8
cmd
ÌÌ 
.
ÌÌ  

Parameters
ÌÌ  *
.
ÌÌ* +
Clear
ÌÌ+ 0
(
ÌÌ0 1
)
ÌÌ1 2
;
ÌÌ2 3
}
ÓÓ 
info
ÔÔ 
.
ÔÔ 
ParamReader
ÔÔ (
(
ÔÔ( )
cmd
ÔÔ) ,
,
ÔÔ, -
obj
ÔÔ. 1
)
ÔÔ1 2
;
ÔÔ2 3
total
 
+=
  
cmd
! $
.
$ %
ExecuteNonQuery
% 4
(
4 5
)
5 6
;
6 7
}
ÒÒ 
}
ÚÚ 
return
ÛÛ 
total
ÛÛ 
;
ÛÛ 
}
ÙÙ 
if
˜˜ 
(
˜˜ 
(
˜˜ 
object
˜˜ 
)
˜˜ 
param
˜˜ 
!=
˜˜  
null
˜˜! %
)
˜˜% &
{
¯¯ 
identity
˘˘ 
=
˘˘ 
new
˘˘ 
Identity
˘˘ '
(
˘˘' (
sql
˘˘( +
,
˘˘+ ,
commandType
˘˘- 8
,
˘˘8 9
cnn
˘˘: =
,
˘˘= >
null
˘˘? C
,
˘˘C D
(
˘˘E F
object
˘˘F L
)
˘˘L M
param
˘˘M R
==
˘˘S U
null
˘˘V Z
?
˘˘[ \
null
˘˘] a
:
˘˘b c
(
˘˘d e
(
˘˘e f
object
˘˘f l
)
˘˘l m
param
˘˘m r
)
˘˘r s
.
˘˘s t
GetType
˘˘t {
(
˘˘{ |
)
˘˘| }
,
˘˘} ~
null˘˘ É
)˘˘É Ñ
;˘˘Ñ Ö
info
˙˙ 
=
˙˙ 
GetCacheInfo
˙˙ #
(
˙˙# $
identity
˙˙$ ,
)
˙˙, -
;
˙˙- .
}
˚˚ 
return
¸¸ 
ExecuteCommand
¸¸ !
(
¸¸! "
cnn
¸¸" %
,
¸¸% &
transaction
¸¸' 2
,
¸¸2 3
sql
¸¸4 7
,
¸¸7 8
(
¸¸9 :
object
¸¸: @
)
¸¸@ A
param
¸¸A F
==
¸¸G I
null
¸¸J N
?
¸¸O P
null
¸¸Q U
:
¸¸V W
info
¸¸X \
.
¸¸\ ]
ParamReader
¸¸] h
,
¸¸h i
(
¸¸j k
object
¸¸k q
)
¸¸q r
param
¸¸r w
,
¸¸w x
commandTimeout¸¸y á
,¸¸á à
commandType¸¸â î
)¸¸î ï
;¸¸ï ñ
}
˝˝ 	
public
ÇÇ 
static
ÇÇ 
IEnumerable
ÇÇ !
<
ÇÇ! "
dynamic
ÇÇ" )
>
ÇÇ) *
Query
ÇÇ+ 0
(
ÇÇ0 1
this
ÇÇ1 5
IDbConnection
ÇÇ6 C
cnn
ÇÇD G
,
ÇÇG H
string
ÇÇI O
sql
ÇÇP S
,
ÇÇS T
dynamic
ÇÇU \
param
ÇÇ] b
=
ÇÇc d
null
ÇÇe i
,
ÇÇi j
IDbTransaction
ÇÇk y
transactionÇÇz Ö
=ÇÇÜ á
nullÇÇà å
,ÇÇå ç
boolÇÇé í
bufferedÇÇì õ
=ÇÇú ù
trueÇÇû ¢
,ÇÇ¢ £
intÇÇ§ ß
?ÇÇß ®
commandTimeoutÇÇ© ∑
=ÇÇ∏ π
nullÇÇ∫ æ
,ÇÇæ ø
CommandTypeÇÇ¿ À
?ÇÇÀ Ã
commandTypeÇÇÕ ÿ
=ÇÇŸ ⁄
nullÇÇ€ ﬂ
)ÇÇﬂ ‡
{
ÉÉ 	
return
ÑÑ 
Query
ÑÑ 
<
ÑÑ 
FastExpando
ÑÑ $
>
ÑÑ$ %
(
ÑÑ% &
cnn
ÑÑ& )
,
ÑÑ) *
sql
ÑÑ+ .
,
ÑÑ. /
param
ÑÑ0 5
as
ÑÑ6 8
object
ÑÑ9 ?
,
ÑÑ? @
transaction
ÑÑA L
,
ÑÑL M
buffered
ÑÑN V
,
ÑÑV W
commandTimeout
ÑÑX f
,
ÑÑf g
commandType
ÑÑh s
)
ÑÑs t
;
ÑÑt u
}
ÖÖ 	
public
èè 
static
èè 
IEnumerable
èè !
<
èè! "
T
èè" #
>
èè# $
Query
èè% *
<
èè* +
T
èè+ ,
>
èè, -
(
èè- .
thisìì 
IDbConnection
ìì 
cnn
ìì 
,
ìì 
string
ìì 
sql
ìì "
,
ìì" #
dynamic
ìì$ +
param
ìì, 1
=
ìì2 3
null
ìì4 8
,
ìì8 9
IDbTransaction
ìì: H
transaction
ììI T
=
ììU V
null
ììW [
,
ìì[ \
bool
ìì] a
buffered
ììb j
=
ììk l
true
ììm q
,
ììq r
int
ììs v
?
ììv w
commandTimeoutììx Ü
=ììá à
nullììâ ç
,ììç é
CommandTypeììè ö
?ììö õ
commandTypeììú ß
=ìì® ©
nullìì™ Æ
)ïï 
{
ññ 	
var
óó 
data
óó 
=
óó 
QueryInternal
óó $
<
óó$ %
T
óó% &
>
óó& '
(
óó' (
cnn
óó( +
,
óó+ ,
sql
óó- 0
,
óó0 1
param
óó2 7
as
óó8 :
object
óó; A
,
óóA B
transaction
óóC N
,
óóN O
commandTimeout
óóP ^
,
óó^ _
commandType
óó` k
)
óók l
;
óól m
return
òò 
buffered
òò 
?
òò 
data
òò "
.
òò" #
ToList
òò# )
(
òò) *
)
òò* +
:
òò, -
data
òò. 2
;
òò2 3
}
ôô 	
public
ûû 
static
ûû 

GridReader
ûû  
QueryMultiple
ûû! .
(
ûû. /
this¢¢ 
IDbConnection
¢¢ 
cnn
¢¢ 
,
¢¢ 
string
¢¢ 
sql
¢¢ "
,
¢¢" #
dynamic
¢¢$ +
param
¢¢, 1
=
¢¢2 3
null
¢¢4 8
,
¢¢8 9
IDbTransaction
¢¢: H
transaction
¢¢I T
=
¢¢U V
null
¢¢W [
,
¢¢[ \
int
¢¢] `
?
¢¢` a
commandTimeout
¢¢b p
=
¢¢q r
null
¢¢s w
,
¢¢w x
CommandType¢¢y Ñ
?¢¢Ñ Ö
commandType¢¢Ü ë
=¢¢í ì
null¢¢î ò
)§§ 
{
•• 	
Identity
¶¶ 
identity
¶¶ 
=
¶¶ 
new
¶¶  #
Identity
¶¶$ ,
(
¶¶, -
sql
¶¶- 0
,
¶¶0 1
commandType
¶¶2 =
,
¶¶= >
cnn
¶¶? B
,
¶¶B C
typeof
¶¶D J
(
¶¶J K

GridReader
¶¶K U
)
¶¶U V
,
¶¶V W
(
¶¶X Y
object
¶¶Y _
)
¶¶_ `
param
¶¶` e
==
¶¶f h
null
¶¶i m
?
¶¶n o
null
¶¶p t
:
¶¶u v
(
¶¶w x
(
¶¶x y
object
¶¶y 
)¶¶ Ä
param¶¶Ä Ö
)¶¶Ö Ü
.¶¶Ü á
GetType¶¶á é
(¶¶é è
)¶¶è ê
,¶¶ê ë
null¶¶í ñ
)¶¶ñ ó
;¶¶ó ò
	CacheInfo
ßß 
info
ßß 
=
ßß 
GetCacheInfo
ßß )
(
ßß) *
identity
ßß* 2
)
ßß2 3
;
ßß3 4

IDbCommand
©© 
cmd
©© 
=
©© 
null
©© !
;
©©! "
IDataReader
™™ 
reader
™™ 
=
™™  
null
™™! %
;
™™% &
try
´´ 
{
¨¨ 
cmd
≠≠ 
=
≠≠ 
SetupCommand
≠≠ "
(
≠≠" #
cnn
≠≠# &
,
≠≠& '
transaction
≠≠( 3
,
≠≠3 4
sql
≠≠5 8
,
≠≠8 9
info
≠≠: >
.
≠≠> ?
ParamReader
≠≠? J
,
≠≠J K
(
≠≠L M
object
≠≠M S
)
≠≠S T
param
≠≠T Y
,
≠≠Y Z
commandTimeout
≠≠[ i
,
≠≠i j
commandType
≠≠k v
)
≠≠v w
;
≠≠w x
reader
ÆÆ 
=
ÆÆ 
cmd
ÆÆ 
.
ÆÆ 
ExecuteReader
ÆÆ *
(
ÆÆ* +
)
ÆÆ+ ,
;
ÆÆ, -
return
ØØ 
new
ØØ 

GridReader
ØØ %
(
ØØ% &
cmd
ØØ& )
,
ØØ) *
reader
ØØ+ 1
,
ØØ1 2
identity
ØØ3 ;
)
ØØ; <
;
ØØ< =
}
∞∞ 
catch
±± 
{
≤≤ 
if
≥≥ 
(
≥≥ 
reader
≥≥ 
!=
≥≥ 
null
≥≥ "
)
≥≥" #
reader
≥≥$ *
.
≥≥* +
Dispose
≥≥+ 2
(
≥≥2 3
)
≥≥3 4
;
≥≥4 5
if
¥¥ 
(
¥¥ 
cmd
¥¥ 
!=
¥¥ 
null
¥¥ 
)
¥¥  
cmd
¥¥! $
.
¥¥$ %
Dispose
¥¥% ,
(
¥¥, -
)
¥¥- .
;
¥¥. /
throw
µµ 
;
µµ 
}
∂∂ 
}
∑∑ 	
private
ºº 
static
ºº 
IEnumerable
ºº "
<
ºº" #
T
ºº# $
>
ºº$ %
QueryInternal
ºº& 3
<
ºº3 4
T
ºº4 5
>
ºº5 6
(
ºº6 7
this
ºº7 ;
IDbConnection
ºº< I
cnn
ººJ M
,
ººM N
string
ººO U
sql
ººV Y
,
ººY Z
object
ºº[ a
param
ººb g
,
ººg h
IDbTransaction
ººi w
transactionººx É
,ººÉ Ñ
intººÖ à
?ººà â
commandTimeoutººä ò
,ººò ô
CommandTypeººö •
?ºº• ¶
commandTypeººß ≤
)ºº≤ ≥
{
ΩΩ 	
var
ææ 
identity
ææ 
=
ææ 
new
ææ 
Identity
ææ '
(
ææ' (
sql
ææ( +
,
ææ+ ,
commandType
ææ- 8
,
ææ8 9
cnn
ææ: =
,
ææ= >
typeof
ææ? E
(
ææE F
T
ææF G
)
ææG H
,
ææH I
param
ææJ O
==
ææP R
null
ææS W
?
ææX Y
null
ææZ ^
:
ææ_ `
param
ææa f
.
ææf g
GetType
ææg n
(
ææn o
)
ææo p
,
ææp q
null
æær v
)
ææv w
;
ææw x
var
øø 
info
øø 
=
øø 
GetCacheInfo
øø #
(
øø# $
identity
øø$ ,
)
øø, -
;
øø- .
using
¡¡ 
(
¡¡ 
var
¡¡ 
cmd
¡¡ 
=
¡¡ 
SetupCommand
¡¡ )
(
¡¡) *
cnn
¡¡* -
,
¡¡- .
transaction
¡¡/ :
,
¡¡: ;
sql
¡¡< ?
,
¡¡? @
info
¡¡A E
.
¡¡E F
ParamReader
¡¡F Q
,
¡¡Q R
param
¡¡S X
,
¡¡X Y
commandTimeout
¡¡Z h
,
¡¡h i
commandType
¡¡j u
)
¡¡u v
)
¡¡v w
{
¬¬ 
using
√√ 
(
√√ 
var
√√ 
reader
√√ !
=
√√" #
cmd
√√$ '
.
√√' (
ExecuteReader
√√( 5
(
√√5 6
)
√√6 7
)
√√7 8
{
ƒƒ 
Func
≈≈ 
<
≈≈ 
Func
≈≈ 
<
≈≈ 
IDataReader
≈≈ )
,
≈≈) *
object
≈≈+ 1
>
≈≈1 2
>
≈≈2 3
cacheDeserializer
≈≈4 E
=
≈≈F G
(
≈≈H I
)
≈≈I J
=>
≈≈K M
{
∆∆ 
info
«« 
.
«« 
Deserializer
«« )
=
««* +
GetDeserializer
««, ;
(
««; <
typeof
««< B
(
««B C
T
««C D
)
««D E
,
««E F
reader
««G M
,
««M N
$num
««O P
,
««P Q
-
««R S
$num
««S T
,
««T U
false
««V [
)
««[ \
;
««\ ]
SetQueryCache
»» %
(
»»% &
identity
»»& .
,
»». /
info
»»0 4
)
»»4 5
;
»»5 6
return
…… 
info
…… #
.
……# $
Deserializer
……$ 0
;
……0 1
}
   
;
   
if
ÃÃ 
(
ÃÃ 
info
ÃÃ 
.
ÃÃ 
Deserializer
ÃÃ )
==
ÃÃ* ,
null
ÃÃ- 1
)
ÃÃ1 2
{
ÕÕ 
cacheDeserializer
ŒŒ )
(
ŒŒ) *
)
ŒŒ* +
;
ŒŒ+ ,
}
œœ 
var
—— 
deserializer
—— $
=
——% &
info
——' +
.
——+ ,
Deserializer
——, 8
;
——8 9
while
”” 
(
”” 
reader
”” !
.
””! "
Read
””" &
(
””& '
)
””' (
)
””( )
{
‘‘ 
object
’’ 
next
’’ #
;
’’# $
try
÷÷ 
{
◊◊ 
next
ÿÿ  
=
ÿÿ! "
deserializer
ÿÿ# /
(
ÿÿ/ 0
reader
ÿÿ0 6
)
ÿÿ6 7
;
ÿÿ7 8
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
DataException
⁄⁄ ,
)
⁄⁄, -
{
€€ 
deserializer
›› (
=
››) *
cacheDeserializer
››+ <
(
››< =
)
››= >
;
››> ?
next
ﬁﬁ  
=
ﬁﬁ! "
deserializer
ﬁﬁ# /
(
ﬁﬁ/ 0
reader
ﬁﬁ0 6
)
ﬁﬁ6 7
;
ﬁﬁ7 8
}
ﬂﬂ 
yield
‡‡ 
return
‡‡ $
(
‡‡% &
T
‡‡& '
)
‡‡' (
next
‡‡( ,
;
‡‡, -
}
·· 
}
„„ 
}
‰‰ 
}
ÂÂ 	
public
˜˜ 
static
˜˜ 
IEnumerable
˜˜ !
<
˜˜! "
TReturn
˜˜" )
>
˜˜) *
Query
˜˜+ 0
<
˜˜0 1
TFirst
˜˜1 7
,
˜˜7 8
TSecond
˜˜9 @
,
˜˜@ A
TReturn
˜˜B I
>
˜˜I J
(
˜˜J K
this˚˚ 
IDbConnection
˚˚ 
cnn
˚˚ 
,
˚˚ 
string
˚˚ 
sql
˚˚ "
,
˚˚" #
Func
˚˚$ (
<
˚˚( )
TFirst
˚˚) /
,
˚˚/ 0
TSecond
˚˚1 8
,
˚˚8 9
TReturn
˚˚: A
>
˚˚A B
map
˚˚C F
,
˚˚F G
dynamic
˚˚H O
param
˚˚P U
=
˚˚V W
null
˚˚X \
,
˚˚\ ]
IDbTransaction
˚˚^ l
transaction
˚˚m x
=
˚˚y z
null
˚˚{ 
,˚˚ Ä
bool˚˚Å Ö
buffered˚˚Ü é
=˚˚è ê
true˚˚ë ï
,˚˚ï ñ
string˚˚ó ù
splitOn˚˚û •
=˚˚¶ ß
$str˚˚® ¨
,˚˚¨ ≠
int˚˚Æ ±
?˚˚± ≤
commandTimeout˚˚≥ ¡
=˚˚¬ √
null˚˚ƒ »
,˚˚» …
CommandType˚˚  ’
?˚˚’ ÷
commandType˚˚◊ ‚
=˚˚„ ‰
null˚˚Â È
)˝˝ 
{
˛˛ 	
return
ˇˇ 
MultiMap
ˇˇ 
<
ˇˇ 
TFirst
ˇˇ "
,
ˇˇ" #
TSecond
ˇˇ$ +
,
ˇˇ+ ,
DontMap
ˇˇ- 4
,
ˇˇ4 5
DontMap
ˇˇ6 =
,
ˇˇ= >
DontMap
ˇˇ? F
,
ˇˇF G
TReturn
ˇˇH O
>
ˇˇO P
(
ˇˇP Q
cnn
ˇˇQ T
,
ˇˇT U
sql
ˇˇV Y
,
ˇˇY Z
map
ˇˇ[ ^
,
ˇˇ^ _
param
ˇˇ` e
as
ˇˇf h
object
ˇˇi o
,
ˇˇo p
transaction
ˇˇq |
,
ˇˇ| }
bufferedˇˇ~ Ü
,ˇˇÜ á
splitOnˇˇà è
,ˇˇè ê
commandTimeoutˇˇë ü
,ˇˇü †
commandTypeˇˇ° ¨
)ˇˇ¨ ≠
;ˇˇ≠ Æ
}
ÄÄ 	
public
ìì 
static
ìì 
IEnumerable
ìì !
<
ìì! "
TReturn
ìì" )
>
ìì) *
Query
ìì+ 0
<
ìì0 1
TFirst
ìì1 7
,
ìì7 8
TSecond
ìì9 @
,
ìì@ A
TThird
ììB H
,
ììH I
TReturn
ììJ Q
>
ììQ R
(
ììR S
thisóó 
IDbConnection
óó 
cnn
óó 
,
óó 
string
óó 
sql
óó "
,
óó" #
Func
óó$ (
<
óó( )
TFirst
óó) /
,
óó/ 0
TSecond
óó1 8
,
óó8 9
TThird
óó: @
,
óó@ A
TReturn
óóB I
>
óóI J
map
óóK N
,
óóN O
dynamic
óóP W
param
óóX ]
=
óó^ _
null
óó` d
,
óód e
IDbTransaction
óóf t
transactionóóu Ä
=óóÅ Ç
nullóóÉ á
,óóá à
boolóóâ ç
bufferedóóé ñ
=óóó ò
trueóóô ù
,óóù û
stringóóü •
splitOnóó¶ ≠
=óóÆ Ø
$stróó∞ ¥
,óó¥ µ
intóó∂ π
?óóπ ∫
commandTimeoutóóª …
=óó  À
nullóóÃ –
,óó– —
CommandTypeóó“ ›
?óó› ﬁ
commandTypeóóﬂ Í
=óóÎ Ï
nullóóÌ Ò
)ôô 
{
öö 	
return
õõ 
MultiMap
õõ 
<
õõ 
TFirst
õõ "
,
õõ" #
TSecond
õõ$ +
,
õõ+ ,
TThird
õõ- 3
,
õõ3 4
DontMap
õõ5 <
,
õõ< =
DontMap
õõ> E
,
õõE F
TReturn
õõG N
>
õõN O
(
õõO P
cnn
õõP S
,
õõS T
sql
õõU X
,
õõX Y
map
õõZ ]
,
õõ] ^
param
õõ_ d
as
õõe g
object
õõh n
,
õõn o
transaction
õõp {
,
õõ{ |
bufferedõõ} Ö
,õõÖ Ü
splitOnõõá é
,õõé è
commandTimeoutõõê û
,õõû ü
commandTypeõõ† ´
)õõ´ ¨
;õõ¨ ≠
}
úú 	
public
∞∞ 
static
∞∞ 
IEnumerable
∞∞ !
<
∞∞! "
TReturn
∞∞" )
>
∞∞) *
Query
∞∞+ 0
<
∞∞0 1
TFirst
∞∞1 7
,
∞∞7 8
TSecond
∞∞9 @
,
∞∞@ A
TThird
∞∞B H
,
∞∞H I
TFourth
∞∞J Q
,
∞∞Q R
TReturn
∞∞S Z
>
∞∞Z [
(
∞∞[ \
this¥¥ 
IDbConnection
¥¥ 
cnn
¥¥ 
,
¥¥ 
string
¥¥ 
sql
¥¥ "
,
¥¥" #
Func
¥¥$ (
<
¥¥( )
TFirst
¥¥) /
,
¥¥/ 0
TSecond
¥¥1 8
,
¥¥8 9
TThird
¥¥: @
,
¥¥@ A
TFourth
¥¥B I
,
¥¥I J
TReturn
¥¥K R
>
¥¥R S
map
¥¥T W
,
¥¥W X
dynamic
¥¥Y `
param
¥¥a f
=
¥¥g h
null
¥¥i m
,
¥¥m n
IDbTransaction
¥¥o }
transaction¥¥~ â
=¥¥ä ã
null¥¥å ê
,¥¥ê ë
bool¥¥í ñ
buffered¥¥ó ü
=¥¥† °
true¥¥¢ ¶
,¥¥¶ ß
string¥¥® Æ
splitOn¥¥Ø ∂
=¥¥∑ ∏
$str¥¥π Ω
,¥¥Ω æ
int¥¥ø ¬
?¥¥¬ √
commandTimeout¥¥ƒ “
=¥¥” ‘
null¥¥’ Ÿ
,¥¥Ÿ ⁄
CommandType¥¥€ Ê
?¥¥Ê Á
commandType¥¥Ë Û
=¥¥Ù ı
null¥¥ˆ ˙
)∂∂ 
{
∑∑ 	
return
∏∏ 
MultiMap
∏∏ 
<
∏∏ 
TFirst
∏∏ "
,
∏∏" #
TSecond
∏∏$ +
,
∏∏+ ,
TThird
∏∏- 3
,
∏∏3 4
TFourth
∏∏5 <
,
∏∏< =
DontMap
∏∏> E
,
∏∏E F
TReturn
∏∏G N
>
∏∏N O
(
∏∏O P
cnn
∏∏P S
,
∏∏S T
sql
∏∏U X
,
∏∏X Y
map
∏∏Z ]
,
∏∏] ^
param
∏∏_ d
as
∏∏e g
object
∏∏h n
,
∏∏n o
transaction
∏∏p {
,
∏∏{ |
buffered∏∏} Ö
,∏∏Ö Ü
splitOn∏∏á é
,∏∏é è
commandTimeout∏∏ê û
,∏∏û ü
commandType∏∏† ´
)∏∏´ ¨
;∏∏¨ ≠
}
ππ 	
public
ŒŒ 
static
ŒŒ 
IEnumerable
ŒŒ !
<
ŒŒ! "
TReturn
ŒŒ" )
>
ŒŒ) *
Query
ŒŒ+ 0
<
ŒŒ0 1
TFirst
ŒŒ1 7
,
ŒŒ7 8
TSecond
ŒŒ9 @
,
ŒŒ@ A
TThird
ŒŒB H
,
ŒŒH I
TFourth
ŒŒJ Q
,
ŒŒQ R
TFifth
ŒŒS Y
,
ŒŒY Z
TReturn
ŒŒ[ b
>
ŒŒb c
(
ŒŒc d
this
ŒŒd h
IDbConnection
ŒŒi v
cnn
ŒŒw z
,
ŒŒz {
stringŒŒ| Ç
sqlŒŒÉ Ü
,ŒŒÜ á
FuncŒŒà å
<ŒŒå ç
TFirstŒŒç ì
,ŒŒì î
TSecondŒŒï ú
,ŒŒú ù
TThirdŒŒû §
,ŒŒ§ •
TFourthŒŒ¶ ≠
,ŒŒ≠ Æ
TFifthŒŒØ µ
,ŒŒµ ∂
TReturnŒŒ∑ æ
>ŒŒæ ø
mapŒŒ¿ √
,ŒŒ√ ƒ
dynamicŒŒ≈ Ã
paramŒŒÕ “
=ŒŒ” ‘
nullŒŒ’ Ÿ
,ŒŒŸ ⁄
IDbTransactionŒŒ€ È
transactionŒŒÍ ı
=ŒŒˆ ˜
nullŒŒ¯ ¸
,ŒŒ¸ ˝
boolŒŒ˛ Ç
bufferedŒŒÉ ã
=ŒŒå ç
trueŒŒé í
,ŒŒí ì
stringŒŒî ö
splitOnŒŒõ ¢
=ŒŒ£ §
$strŒŒ• ©
,ŒŒ© ™
intŒŒ´ Æ
?ŒŒÆ Ø
commandTimeoutŒŒ∞ æ
=ŒŒø ¿
nullŒŒ¡ ≈
,ŒŒ≈ ∆
CommandTypeŒŒ« “
?ŒŒ“ ”
commandTypeŒŒ‘ ﬂ
=ŒŒ‡ ·
nullŒŒ‚ Ê
)ŒŒÊ Á
{
œœ 	
return
–– 
MultiMap
–– 
<
–– 
TFirst
–– "
,
––" #
TSecond
––$ +
,
––+ ,
TThird
––- 3
,
––3 4
TFourth
––5 <
,
––< =
TFifth
––> D
,
––D E
TReturn
––F M
>
––M N
(
––N O
cnn
––O R
,
––R S
sql
––T W
,
––W X
map
––Y \
,
––\ ]
param
––^ c
as
––d f
object
––g m
,
––m n
transaction
––o z
,
––z {
buffered––| Ñ
,––Ñ Ö
splitOn––Ü ç
,––ç é
commandTimeout––è ù
,––ù û
commandType––ü ™
)––™ ´
;––´ ¨
}
—— 	
class
”” 
DontMap
”” 
{
”” 
}
”” 
static
‘‘ 
IEnumerable
‘‘ 
<
‘‘ 
TReturn
‘‘ "
>
‘‘" #
MultiMap
‘‘$ ,
<
‘‘, -
TFirst
‘‘- 3
,
‘‘3 4
TSecond
‘‘5 <
,
‘‘< =
TThird
‘‘> D
,
‘‘D E
TFourth
‘‘F M
,
‘‘M N
TFifth
‘‘O U
,
‘‘U V
TReturn
‘‘W ^
>
‘‘^ _
(
‘‘_ `
this
’’ 
IDbConnection
’’ 
cnn
’’ "
,
’’" #
string
’’$ *
sql
’’+ .
,
’’. /
object
’’0 6
map
’’7 :
,
’’: ;
object
’’< B
param
’’C H
,
’’H I
IDbTransaction
’’J X
transaction
’’Y d
,
’’d e
bool
’’f j
buffered
’’k s
,
’’s t
string
’’u {
splitOn’’| É
,’’É Ñ
int’’Ö à
?’’à â
commandTimeout’’ä ò
,’’ò ô
CommandType’’ö •
?’’• ¶
commandType’’ß ≤
)’’≤ ≥
{
÷÷ 	
var
◊◊ 
results
◊◊ 
=
◊◊ 
MultiMapImpl
◊◊ &
<
◊◊& '
TFirst
◊◊' -
,
◊◊- .
TSecond
◊◊/ 6
,
◊◊6 7
TThird
◊◊8 >
,
◊◊> ?
TFourth
◊◊@ G
,
◊◊G H
TFifth
◊◊I O
,
◊◊O P
TReturn
◊◊Q X
>
◊◊X Y
(
◊◊Y Z
cnn
◊◊Z ]
,
◊◊] ^
sql
◊◊_ b
,
◊◊b c
map
◊◊d g
,
◊◊g h
param
◊◊i n
,
◊◊n o
transaction
◊◊p {
,
◊◊{ |
splitOn◊◊} Ñ
,◊◊Ñ Ö
commandTimeout◊◊Ü î
,◊◊î ï
commandType◊◊ñ °
,◊◊° ¢
null◊◊£ ß
,◊◊ß ®
null◊◊© ≠
)◊◊≠ Æ
;◊◊Æ Ø
return
ÿÿ 
buffered
ÿÿ 
?
ÿÿ 
results
ÿÿ %
.
ÿÿ% &
ToList
ÿÿ& ,
(
ÿÿ, -
)
ÿÿ- .
:
ÿÿ/ 0
results
ÿÿ1 8
;
ÿÿ8 9
}
ŸŸ 	
static
‹‹ 
IEnumerable
‹‹ 
<
‹‹ 
TReturn
‹‹ "
>
‹‹" #
MultiMapImpl
‹‹$ 0
<
‹‹0 1
TFirst
‹‹1 7
,
‹‹7 8
TSecond
‹‹9 @
,
‹‹@ A
TThird
‹‹B H
,
‹‹H I
TFourth
‹‹J Q
,
‹‹Q R
TFifth
‹‹S Y
,
‹‹Y Z
TReturn
‹‹[ b
>
‹‹b c
(
‹‹c d
this
‹‹d h
IDbConnection
‹‹i v
cnn
‹‹w z
,
‹‹z {
string‹‹| Ç
sql‹‹É Ü
,‹‹Ü á
object‹‹à é
map‹‹è í
,‹‹í ì
object‹‹î ö
param‹‹õ †
,‹‹† °
IDbTransaction‹‹¢ ∞
transaction‹‹± º
,‹‹º Ω
string‹‹æ ƒ
splitOn‹‹≈ Ã
,‹‹Ã Õ
int‹‹Œ —
?‹‹— “
commandTimeout‹‹” ·
,‹‹· ‚
CommandType‹‹„ Ó
?‹‹Ó Ô
commandType‹‹ ˚
,‹‹˚ ¸
IDataReader‹‹˝ à
reader‹‹â è
,‹‹è ê
Identity‹‹ë ô
identity‹‹ö ¢
)‹‹¢ £
{
›› 	
identity
ﬁﬁ 
=
ﬁﬁ 
identity
ﬁﬁ 
??
ﬁﬁ  "
new
ﬁﬁ# &
Identity
ﬁﬁ' /
(
ﬁﬁ/ 0
sql
ﬁﬁ0 3
,
ﬁﬁ3 4
commandType
ﬁﬁ5 @
,
ﬁﬁ@ A
cnn
ﬁﬁB E
,
ﬁﬁE F
typeof
ﬁﬁG M
(
ﬁﬁM N
TFirst
ﬁﬁN T
)
ﬁﬁT U
,
ﬁﬁU V
(
ﬁﬁW X
object
ﬁﬁX ^
)
ﬁﬁ^ _
param
ﬁﬁ_ d
==
ﬁﬁe g
null
ﬁﬁh l
?
ﬁﬁm n
null
ﬁﬁo s
:
ﬁﬁt u
(
ﬁﬁv w
(
ﬁﬁw x
object
ﬁﬁx ~
)
ﬁﬁ~ 
paramﬁﬁ Ñ
)ﬁﬁÑ Ö
.ﬁﬁÖ Ü
GetTypeﬁﬁÜ ç
(ﬁﬁç é
)ﬁﬁé è
,ﬁﬁè ê
newﬁﬁë î
[ﬁﬁî ï
]ﬁﬁï ñ
{ﬁﬁó ò
typeofﬁﬁô ü
(ﬁﬁü †
TFirstﬁﬁ† ¶
)ﬁﬁ¶ ß
,ﬁﬁß ®
typeofﬁﬁ© Ø
(ﬁﬁØ ∞
TSecondﬁﬁ∞ ∑
)ﬁﬁ∑ ∏
,ﬁﬁ∏ π
typeofﬁﬁ∫ ¿
(ﬁﬁ¿ ¡
TThirdﬁﬁ¡ «
)ﬁﬁ« »
,ﬁﬁ» …
typeofﬁﬁ  –
(ﬁﬁ– —
TFourthﬁﬁ— ÿ
)ﬁﬁÿ Ÿ
,ﬁﬁŸ ⁄
typeofﬁﬁ€ ·
(ﬁﬁ· ‚
TFifthﬁﬁ‚ Ë
)ﬁﬁË È
}ﬁﬁÍ Î
)ﬁﬁÎ Ï
;ﬁﬁÏ Ì
	CacheInfo
ﬂﬂ 
cinfo
ﬂﬂ 
=
ﬂﬂ 
GetCacheInfo
ﬂﬂ *
(
ﬂﬂ* +
identity
ﬂﬂ+ 3
)
ﬂﬂ3 4
;
ﬂﬂ4 5

IDbCommand
·· 
ownedCommand
·· #
=
··$ %
null
··& *
;
··* +
IDataReader
‚‚ 
ownedReader
‚‚ #
=
‚‚$ %
null
‚‚& *
;
‚‚* +
try
‰‰ 
{
ÂÂ 
if
ÊÊ 
(
ÊÊ 
reader
ÊÊ 
==
ÊÊ 
null
ÊÊ "
)
ÊÊ" #
{
ÁÁ 
ownedCommand
ËË  
=
ËË! "
SetupCommand
ËË# /
(
ËË/ 0
cnn
ËË0 3
,
ËË3 4
transaction
ËË5 @
,
ËË@ A
sql
ËËB E
,
ËËE F
cinfo
ËËG L
.
ËËL M
ParamReader
ËËM X
,
ËËX Y
(
ËËZ [
object
ËË[ a
)
ËËa b
param
ËËb g
,
ËËg h
commandTimeout
ËËi w
,
ËËw x
commandTypeËËy Ñ
)ËËÑ Ö
;ËËÖ Ü
ownedReader
ÈÈ 
=
ÈÈ  !
ownedCommand
ÈÈ" .
.
ÈÈ. /
ExecuteReader
ÈÈ/ <
(
ÈÈ< =
)
ÈÈ= >
;
ÈÈ> ?
reader
ÍÍ 
=
ÍÍ 
ownedReader
ÍÍ (
;
ÍÍ( )
}
ÎÎ 
Func
ÏÏ 
<
ÏÏ 
IDataReader
ÏÏ  
,
ÏÏ  !
object
ÏÏ" (
>
ÏÏ( )
deserializer
ÏÏ* 6
=
ÏÏ7 8
null
ÏÏ9 =
;
ÏÏ= >
Func
ÌÌ 
<
ÌÌ 
IDataReader
ÌÌ  
,
ÌÌ  !
object
ÌÌ" (
>
ÌÌ( )
[
ÌÌ) *
]
ÌÌ* + 
otherDeserializers
ÌÌ, >
=
ÌÌ? @
null
ÌÌA E
;
ÌÌE F
Action
ÔÔ  
cacheDeserializers
ÔÔ )
=
ÔÔ* +
(
ÔÔ, -
)
ÔÔ- .
=>
ÔÔ/ 1
{
 
var
ÒÒ 
deserializers
ÒÒ %
=
ÒÒ& '#
GenerateDeserializers
ÒÒ( =
(
ÒÒ= >
new
ÒÒ> A
Type
ÒÒB F
[
ÒÒF G
]
ÒÒG H
{
ÒÒI J
typeof
ÒÒK Q
(
ÒÒQ R
TFirst
ÒÒR X
)
ÒÒX Y
,
ÒÒY Z
typeof
ÒÒ[ a
(
ÒÒa b
TSecond
ÒÒb i
)
ÒÒi j
,
ÒÒj k
typeof
ÒÒl r
(
ÒÒr s
TThird
ÒÒs y
)
ÒÒy z
,
ÒÒz {
typeofÒÒ| Ç
(ÒÒÇ É
TFourthÒÒÉ ä
)ÒÒä ã
,ÒÒã å
typeofÒÒç ì
(ÒÒì î
TFifthÒÒî ö
)ÒÒö õ
}ÒÒú ù
,ÒÒù û
splitOnÒÒü ¶
,ÒÒ¶ ß
readerÒÒ® Æ
)ÒÒÆ Ø
;ÒÒØ ∞
deserializer
ÚÚ  
=
ÚÚ! "
cinfo
ÚÚ# (
.
ÚÚ( )
Deserializer
ÚÚ) 5
=
ÚÚ6 7
deserializers
ÚÚ8 E
[
ÚÚE F
$num
ÚÚF G
]
ÚÚG H
;
ÚÚH I 
otherDeserializers
ÛÛ &
=
ÛÛ' (
cinfo
ÛÛ) .
.
ÛÛ. / 
OtherDeserializers
ÛÛ/ A
=
ÛÛB C
deserializers
ÛÛD Q
.
ÛÛQ R
Skip
ÛÛR V
(
ÛÛV W
$num
ÛÛW X
)
ÛÛX Y
.
ÛÛY Z
ToArray
ÛÛZ a
(
ÛÛa b
)
ÛÛb c
;
ÛÛc d
SetQueryCache
ÙÙ !
(
ÙÙ! "
identity
ÙÙ" *
,
ÙÙ* +
cinfo
ÙÙ, 1
)
ÙÙ1 2
;
ÙÙ2 3
}
ıı 
;
ıı 
if
˜˜ 
(
˜˜ 
(
˜˜ 
deserializer
˜˜ !
=
˜˜" #
cinfo
˜˜$ )
.
˜˜) *
Deserializer
˜˜* 6
)
˜˜6 7
==
˜˜8 :
null
˜˜; ?
||
˜˜@ B
(
˜˜C D 
otherDeserializers
˜˜D V
=
˜˜W X
cinfo
˜˜Y ^
.
˜˜^ _ 
OtherDeserializers
˜˜_ q
)
˜˜q r
==
˜˜s u
null
˜˜v z
)
˜˜z {
{
¯¯  
cacheDeserializers
˘˘ &
(
˘˘& '
)
˘˘' (
;
˘˘( )
}
˙˙ 
Func
¸¸ 
<
¸¸ 
IDataReader
¸¸  
,
¸¸  !
TReturn
¸¸" )
>
¸¸) *
mapIt
¸¸+ 0
=
¸¸1 2
GenerateMapper
¸¸3 A
<
¸¸A B
TFirst
¸¸B H
,
¸¸H I
TSecond
¸¸J Q
,
¸¸Q R
TThird
¸¸S Y
,
¸¸Y Z
TFourth
¸¸[ b
,
¸¸b c
TFifth
¸¸d j
,
¸¸j k
TReturn
¸¸l s
>
¸¸s t
(
¸¸t u
deserializer¸¸u Å
,¸¸Å Ç"
otherDeserializers¸¸É ï
,¸¸ï ñ
map¸¸ó ö
)¸¸ö õ
;¸¸õ ú
if
˛˛ 
(
˛˛ 
mapIt
˛˛ 
!=
˛˛ 
null
˛˛ !
)
˛˛! "
{
ˇˇ 
while
ÄÄ 
(
ÄÄ 
reader
ÄÄ !
.
ÄÄ! "
Read
ÄÄ" &
(
ÄÄ& '
)
ÄÄ' (
)
ÄÄ( )
{
ÅÅ 
TReturn
ÇÇ 
next
ÇÇ  $
;
ÇÇ$ %
try
ÉÉ 
{
ÑÑ 
next
ÖÖ  
=
ÖÖ! "
mapIt
ÖÖ# (
(
ÖÖ( )
reader
ÖÖ) /
)
ÖÖ/ 0
;
ÖÖ0 1
}
ÜÜ 
catch
áá 
(
áá 
DataException
áá ,
)
áá, -
{
àà  
cacheDeserializers
ââ .
(
ââ. /
)
ââ/ 0
;
ââ0 1
mapIt
ää !
=
ää" #
GenerateMapper
ää$ 2
<
ää2 3
TFirst
ää3 9
,
ää9 :
TSecond
ää; B
,
ääB C
TThird
ääD J
,
ääJ K
TFourth
ääL S
,
ääS T
TFifth
ääU [
,
ää[ \
TReturn
ää] d
>
ääd e
(
ääe f
deserializer
ääf r
,
äär s!
otherDeserializersäät Ü
,ääÜ á
mapääà ã
)ääã å
;ääå ç
next
ãã  
=
ãã! "
mapIt
ãã# (
(
ãã( )
reader
ãã) /
)
ãã/ 0
;
ãã0 1
}
åå 
yield
çç 
return
çç $
next
çç% )
;
çç) *
}
éé 
}
èè 
}
êê 
finally
ëë 
{
íí 
try
ìì 
{
îî 
if
ïï 
(
ïï 
ownedReader
ïï #
!=
ïï$ &
null
ïï' +
)
ïï+ ,
{
ññ 
ownedReader
óó #
.
óó# $
Dispose
óó$ +
(
óó+ ,
)
óó, -
;
óó- .
}
òò 
}
ôô 
finally
öö 
{
õõ 
if
úú 
(
úú 
ownedCommand
úú $
!=
úú% '
null
úú( ,
)
úú, -
{
ùù 
ownedCommand
ûû $
.
ûû$ %
Dispose
ûû% ,
(
ûû, -
)
ûû- .
;
ûû. /
}
üü 
}
†† 
}
°° 
}
¢¢ 	
private
§§ 
static
§§ 
Func
§§ 
<
§§ 
IDataReader
§§ '
,
§§' (
TReturn
§§) 0
>
§§0 1
GenerateMapper
§§2 @
<
§§@ A
TFirst
§§A G
,
§§G H
TSecond
§§I P
,
§§P Q
TThird
§§R X
,
§§X Y
TFourth
§§Z a
,
§§a b
TFifth
§§c i
,
§§i j
TReturn
§§k r
>
§§r s
(
§§s t
Func
§§t x
<
§§x y
IDataReader§§y Ñ
,§§Ñ Ö
object§§Ü å
>§§å ç
deserializer§§é ö
,§§ö õ
Func§§ú †
<§§† °
IDataReader§§° ¨
,§§¨ ≠
object§§Æ ¥
>§§¥ µ
[§§µ ∂
]§§∂ ∑"
otherDeserializers§§∏  
,§§  À
object§§Ã “
map§§” ÷
)§§÷ ◊
{
•• 	
switch
¶¶ 
(
¶¶  
otherDeserializers
¶¶ &
.
¶¶& '
Length
¶¶' -
)
¶¶- .
{
ßß 
case
®® 
$num
®® 
:
®® 
return
©© 
r
©© 
=>
©© 
(
©©  !
(
©©! "
Func
©©" &
<
©©& '
TFirst
©©' -
,
©©- .
TSecond
©©/ 6
,
©©6 7
TReturn
©©8 ?
>
©©? @
)
©©@ A
map
©©A D
)
©©D E
(
©©E F
(
©©F G
TFirst
©©G M
)
©©M N
deserializer
©©N Z
(
©©Z [
r
©©[ \
)
©©\ ]
,
©©] ^
(
©©_ `
TSecond
©©` g
)
©©g h 
otherDeserializers
©©h z
[
©©z {
$num
©©{ |
]
©©| }
(
©©} ~
r
©©~ 
)©© Ä
)©©Ä Å
;©©Å Ç
case
™™ 
$num
™™ 
:
™™ 
return
´´ 
r
´´ 
=>
´´ 
(
´´  !
(
´´! "
Func
´´" &
<
´´& '
TFirst
´´' -
,
´´- .
TSecond
´´/ 6
,
´´6 7
TThird
´´8 >
,
´´> ?
TReturn
´´@ G
>
´´G H
)
´´H I
map
´´I L
)
´´L M
(
´´M N
(
´´N O
TFirst
´´O U
)
´´U V
deserializer
´´V b
(
´´b c
r
´´c d
)
´´d e
,
´´e f
(
´´g h
TSecond
´´h o
)
´´o p!
otherDeserializers´´p Ç
[´´Ç É
$num´´É Ñ
]´´Ñ Ö
(´´Ö Ü
r´´Ü á
)´´á à
,´´à â
(´´ä ã
TThird´´ã ë
)´´ë í"
otherDeserializers´´í §
[´´§ •
$num´´• ¶
]´´¶ ß
(´´ß ®
r´´® ©
)´´© ™
)´´™ ´
;´´´ ¨
case
¨¨ 
$num
¨¨ 
:
¨¨ 
return
≠≠ 
r
≠≠ 
=>
≠≠ 
(
≠≠  !
(
≠≠! "
Func
≠≠" &
<
≠≠& '
TFirst
≠≠' -
,
≠≠- .
TSecond
≠≠/ 6
,
≠≠6 7
TThird
≠≠8 >
,
≠≠> ?
TFourth
≠≠@ G
,
≠≠G H
TReturn
≠≠I P
>
≠≠P Q
)
≠≠Q R
map
≠≠R U
)
≠≠U V
(
≠≠V W
(
≠≠W X
TFirst
≠≠X ^
)
≠≠^ _
deserializer
≠≠_ k
(
≠≠k l
r
≠≠l m
)
≠≠m n
,
≠≠n o
(
≠≠p q
TSecond
≠≠q x
)
≠≠x y!
otherDeserializers≠≠y ã
[≠≠ã å
$num≠≠å ç
]≠≠ç é
(≠≠é è
r≠≠è ê
)≠≠ê ë
,≠≠ë í
(≠≠ì î
TThird≠≠î ö
)≠≠ö õ"
otherDeserializers≠≠õ ≠
[≠≠≠ Æ
$num≠≠Æ Ø
]≠≠Ø ∞
(≠≠∞ ±
r≠≠± ≤
)≠≠≤ ≥
,≠≠≥ ¥
(≠≠µ ∂
TFourth≠≠∂ Ω
)≠≠Ω æ"
otherDeserializers≠≠æ –
[≠≠– —
$num≠≠— “
]≠≠“ ”
(≠≠” ‘
r≠≠‘ ’
)≠≠’ ÷
)≠≠÷ ◊
;≠≠◊ ÿ
case
ØØ 
$num
ØØ 
:
ØØ 
return
∞∞ 
r
∞∞ 
=>
∞∞ 
(
∞∞  !
(
∞∞! "
Func
∞∞" &
<
∞∞& '
TFirst
∞∞' -
,
∞∞- .
TSecond
∞∞/ 6
,
∞∞6 7
TThird
∞∞8 >
,
∞∞> ?
TFourth
∞∞@ G
,
∞∞G H
TFifth
∞∞I O
,
∞∞O P
TReturn
∞∞Q X
>
∞∞X Y
)
∞∞Y Z
map
∞∞Z ]
)
∞∞] ^
(
∞∞^ _
(
∞∞_ `
TFirst
∞∞` f
)
∞∞f g
deserializer
∞∞g s
(
∞∞s t
r
∞∞t u
)
∞∞u v
,
∞∞v w
(
∞∞x y
TSecond∞∞y Ä
)∞∞Ä Å"
otherDeserializers∞∞Å ì
[∞∞ì î
$num∞∞î ï
]∞∞ï ñ
(∞∞ñ ó
r∞∞ó ò
)∞∞ò ô
,∞∞ô ö
(∞∞õ ú
TThird∞∞ú ¢
)∞∞¢ £"
otherDeserializers∞∞£ µ
[∞∞µ ∂
$num∞∞∂ ∑
]∞∞∑ ∏
(∞∞∏ π
r∞∞π ∫
)∞∞∫ ª
,∞∞ª º
(∞∞Ω æ
TFourth∞∞æ ≈
)∞∞≈ ∆"
otherDeserializers∞∞∆ ÿ
[∞∞ÿ Ÿ
$num∞∞Ÿ ⁄
]∞∞⁄ €
(∞∞€ ‹
r∞∞‹ ›
)∞∞› ﬁ
,∞∞ﬁ ﬂ
(∞∞‡ ·
TFifth∞∞· Á
)∞∞Á Ë"
otherDeserializers∞∞Ë ˙
[∞∞˙ ˚
$num∞∞˚ ¸
]∞∞¸ ˝
(∞∞˝ ˛
r∞∞˛ ˇ
)∞∞ˇ Ä
)∞∞Ä Å
;∞∞Å Ç
default
≤≤ 
:
≤≤ 
throw
≥≥ 
new
≥≥ #
NotSupportedException
≥≥ 3
(
≥≥3 4
)
≥≥4 5
;
≥≥5 6
}
¥¥ 
}
µµ 	
private
∑∑ 
static
∑∑ 
Func
∑∑ 
<
∑∑ 
IDataReader
∑∑ '
,
∑∑' (
object
∑∑) /
>
∑∑/ 0
[
∑∑0 1
]
∑∑1 2#
GenerateDeserializers
∑∑3 H
(
∑∑H I
Type
∑∑I M
[
∑∑M N
]
∑∑N O
types
∑∑P U
,
∑∑U V
string
∑∑W ]
splitOn
∑∑^ e
,
∑∑e f
IDataReader
∑∑g r
reader
∑∑s y
)
∑∑y z
{
∏∏ 	
int
ππ 
current
ππ 
=
ππ 
$num
ππ 
;
ππ 
var
∫∫ 
splits
∫∫ 
=
∫∫ 
splitOn
∫∫  
.
∫∫  !
Split
∫∫! &
(
∫∫& '
$char
∫∫' *
)
∫∫* +
.
∫∫+ ,
ToArray
∫∫, 3
(
∫∫3 4
)
∫∫4 5
;
∫∫5 6
var
ªª 

splitIndex
ªª 
=
ªª 
$num
ªª 
;
ªª 
Func
ΩΩ 
<
ΩΩ 
Type
ΩΩ 
,
ΩΩ 
int
ΩΩ 
>
ΩΩ 
	nextSplit
ΩΩ %
=
ΩΩ& '
type
ΩΩ( ,
=>
ΩΩ- /
{
ææ 
var
øø 
currentSplit
øø  
=
øø! "
splits
øø# )
[
øø) *

splitIndex
øø* 4
]
øø4 5
;
øø5 6
if
¿¿ 
(
¿¿ 
splits
¿¿ 
.
¿¿ 
Length
¿¿ !
>
¿¿" #

splitIndex
¿¿$ .
+
¿¿/ 0
$num
¿¿1 2
)
¿¿2 3
{
¡¡ 

splitIndex
¬¬ 
++
¬¬  
;
¬¬  !
}
√√ 
bool
≈≈ 
	skipFirst
≈≈ 
=
≈≈  
false
≈≈! &
;
≈≈& '
int
∆∆ 
startingPos
∆∆ 
=
∆∆  !
current
∆∆" )
+
∆∆* +
$num
∆∆, -
;
∆∆- .
if
»» 
(
»» 
type
»» 
!=
»» 
typeof
»» "
(
»»" #
Object
»»# )
)
»») *
)
»»* +
{
…… 
var
   
props
   
=
   
GetSettableProps
    0
(
  0 1
type
  1 5
)
  5 6
;
  6 7
var
ÀÀ 
fields
ÀÀ 
=
ÀÀ  
GetSettableFields
ÀÀ! 2
(
ÀÀ2 3
type
ÀÀ3 7
)
ÀÀ7 8
;
ÀÀ8 9
foreach
ÕÕ 
(
ÕÕ 
var
ÕÕ  
name
ÕÕ! %
in
ÕÕ& (
props
ÕÕ) .
.
ÕÕ. /
Select
ÕÕ/ 5
(
ÕÕ5 6
p
ÕÕ6 7
=>
ÕÕ8 :
p
ÕÕ; <
.
ÕÕ< =
Name
ÕÕ= A
)
ÕÕA B
.
ÕÕB C
Concat
ÕÕC I
(
ÕÕI J
fields
ÕÕJ P
.
ÕÕP Q
Select
ÕÕQ W
(
ÕÕW X
f
ÕÕX Y
=>
ÕÕZ \
f
ÕÕ] ^
.
ÕÕ^ _
Name
ÕÕ_ c
)
ÕÕc d
)
ÕÕd e
)
ÕÕe f
{
ŒŒ 
if
œœ 
(
œœ 
string
œœ "
.
œœ" #
Equals
œœ# )
(
œœ) *
name
œœ* .
,
œœ. /
currentSplit
œœ0 <
,
œœ< =
StringComparison
œœ> N
.
œœN O
OrdinalIgnoreCase
œœO `
)
œœ` a
)
œœa b
{
–– 
	skipFirst
—— %
=
——& '
true
——( ,
;
——, -
startingPos
““ '
=
““( )
current
““* 1
;
““1 2
break
”” !
;
””! "
}
‘‘ 
}
’’ 
}
◊◊ 
int
ŸŸ 
pos
ŸŸ 
;
ŸŸ 
for
⁄⁄ 
(
⁄⁄ 
pos
⁄⁄ 
=
⁄⁄ 
startingPos
⁄⁄ &
;
⁄⁄& '
pos
⁄⁄( +
<
⁄⁄, -
reader
⁄⁄. 4
.
⁄⁄4 5

FieldCount
⁄⁄5 ?
;
⁄⁄? @
pos
⁄⁄A D
++
⁄⁄D F
)
⁄⁄F G
{
€€ 
if
›› 
(
›› 
splitOn
›› 
==
››  "
$str
››# &
)
››& '
{
ﬁﬁ 
break
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
if
·· 
(
·· 
string
·· 
.
·· 
Equals
·· %
(
··% &
reader
··& ,
.
··, -
GetName
··- 4
(
··4 5
pos
··5 8
)
··8 9
,
··9 :
currentSplit
··; G
,
··G H
StringComparison
··I Y
.
··Y Z
OrdinalIgnoreCase
··Z k
)
··k l
)
··l m
{
‚‚ 
if
„„ 
(
„„ 
	skipFirst
„„ %
)
„„% &
{
‰‰ 
	skipFirst
ÂÂ %
=
ÂÂ& '
false
ÂÂ( -
;
ÂÂ- .
}
ÊÊ 
else
ÁÁ 
{
ËË 
break
ÈÈ !
;
ÈÈ! "
}
ÍÍ 
}
ÎÎ 
}
ÏÏ 
current
ÌÌ 
=
ÌÌ 
pos
ÌÌ 
;
ÌÌ 
return
ÓÓ 
pos
ÓÓ 
;
ÓÓ 
}
ÔÔ 
;
ÔÔ 
var
ÒÒ 
deserializers
ÒÒ 
=
ÒÒ 
new
ÒÒ  #
List
ÒÒ$ (
<
ÒÒ( )
Func
ÒÒ) -
<
ÒÒ- .
IDataReader
ÒÒ. 9
,
ÒÒ9 :
object
ÒÒ; A
>
ÒÒA B
>
ÒÒB C
(
ÒÒC D
)
ÒÒD E
;
ÒÒE F
int
ÚÚ 
split
ÚÚ 
=
ÚÚ 
$num
ÚÚ 
;
ÚÚ 
bool
ÛÛ 
first
ÛÛ 
=
ÛÛ 
true
ÛÛ 
;
ÛÛ 
foreach
ÙÙ 
(
ÙÙ 
var
ÙÙ 
type
ÙÙ 
in
ÙÙ  
types
ÙÙ! &
)
ÙÙ& '
{
ıı 
if
ˆˆ 
(
ˆˆ 
type
ˆˆ 
!=
ˆˆ 
typeof
ˆˆ "
(
ˆˆ" #
DontMap
ˆˆ# *
)
ˆˆ* +
)
ˆˆ+ ,
{
˜˜ 
int
¯¯ 
next
¯¯ 
=
¯¯ 
	nextSplit
¯¯ (
(
¯¯( )
type
¯¯) -
)
¯¯- .
;
¯¯. /
deserializers
˘˘ !
.
˘˘! "
Add
˘˘" %
(
˘˘% &
GetDeserializer
˘˘& 5
(
˘˘5 6
type
˘˘6 :
,
˘˘: ;
reader
˘˘< B
,
˘˘B C
split
˘˘D I
,
˘˘I J
next
˘˘K O
-
˘˘P Q
split
˘˘R W
,
˘˘W X
!
˘˘y z
first
˘˘z 
)˘˘ Ä
)˘˘Ä Å
;˘˘Å Ç
first
˙˙ 
=
˙˙ 
false
˙˙ !
;
˙˙! "
split
˚˚ 
=
˚˚ 
next
˚˚  
;
˚˚  !
}
¸¸ 
}
˝˝ 
return
ˇˇ 
deserializers
ˇˇ  
.
ˇˇ  !
ToArray
ˇˇ! (
(
ˇˇ( )
)
ˇˇ) *
;
ˇˇ* +
}
ÄÄ 	
private
ÇÇ 
static
ÇÇ 
	CacheInfo
ÇÇ  
GetCacheInfo
ÇÇ! -
(
ÇÇ- .
Identity
ÇÇ. 6
identity
ÇÇ7 ?
)
ÇÇ? @
{
ÉÉ 	
	CacheInfo
ÑÑ 
info
ÑÑ 
;
ÑÑ 
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 
TryGetQueryCache
ÖÖ !
(
ÖÖ! "
identity
ÖÖ" *
,
ÖÖ* +
out
ÖÖ, /
info
ÖÖ0 4
)
ÖÖ4 5
)
ÖÖ5 6
{
ÜÜ 
info
áá 
=
áá 
new
áá 
	CacheInfo
áá $
(
áá$ %
)
áá% &
;
áá& '
if
àà 
(
àà 
identity
àà 
.
àà 
parametersType
àà +
!=
àà, .
null
àà/ 3
)
àà3 4
{
ââ 
if
ää 
(
ää 
typeof
ää 
(
ää  
IDynamicParameters
ää 1
)
ää1 2
.
ää2 3
IsAssignableFrom
ää3 C
(
ääC D
identity
ääD L
.
ääL M
parametersType
ääM [
)
ää[ \
)
ää\ ]
{
ãã 
info
åå 
.
åå 
ParamReader
åå (
=
åå) *
(
åå+ ,
cmd
åå, /
,
åå/ 0
obj
åå1 4
)
åå4 5
=>
åå6 8
{
åå9 :
(
åå; <
obj
åå< ?
as
åå@ B 
IDynamicParameters
ååC U
)
ååU V
.
ååV W
AddParameters
ååW d
(
ååd e
cmd
ååe h
,
ååh i
identity
ååj r
)
åår s
;
åås t
}
ååu v
;
ååv w
}
çç 
else
éé 
{
èè 
info
êê 
.
êê 
ParamReader
êê (
=
êê) *&
CreateParamInfoGenerator
êê+ C
(
êêC D
identity
êêD L
)
êêL M
;
êêM N
}
ëë 
}
íí 
SetQueryCache
ìì 
(
ìì 
identity
ìì &
,
ìì& '
info
ìì( ,
)
ìì, -
;
ìì- .
}
îî 
return
ïï 
info
ïï 
;
ïï 
}
ññ 	
private
òò 
static
òò 
Func
òò 
<
òò 
IDataReader
òò '
,
òò' (
object
òò) /
>
òò/ 0
GetDeserializer
òò1 @
(
òò@ A
Type
òòA E
type
òòF J
,
òòJ K
IDataReader
òòL W
reader
òòX ^
,
òò^ _
int
òò` c

startBound
òòd n
,
òòn o
int
òòp s
length
òòt z
,
òòz {
boolòò| Ä(
returnNullIfFirstMissingòòÅ ô
)òòô ö
{
ôô 	
if
úú 
(
úú 
type
úú 
==
úú 
typeof
úú 
(
úú 
object
úú %
)
úú% &
||
ùù 
type
ùù 
==
ùù 
typeof
ùù !
(
ùù! "
FastExpando
ùù" -
)
ùù- .
)
ùù. /
{
ûû 
return
üü $
GetDynamicDeserializer
üü -
(
üü- .
reader
üü. 4
,
üü4 5

startBound
üü6 @
,
üü@ A
length
üüB H
,
üüH I&
returnNullIfFirstMissing
üüJ b
)
üüb c
;
üüc d
}
†† 
if
££ 
(
££ 
type
££ 
.
££ 
IsClass
££ 
&&
££ 
type
££  $
!=
££% '
typeof
££( .
(
££. /
string
££/ 5
)
££5 6
&&
££7 9
type
££: >
!=
££? A
typeof
££B H
(
££H I
byte
££I M
[
££M N
]
££N O
)
££O P
&&
££Q S
type
££T X
!=
££Y [
typeof
££\ b
(
££b c
System
££c i
.
££i j
Data
££j n
.
££n o
Linq
££o s
.
££s t
Binary
££t z
)
££z {
)
££{ |
{
§§ 
return
•• "
GetClassDeserializer
•• +
(
••+ ,
type
••, 0
,
••0 1
reader
••2 8
,
••8 9

startBound
••: D
,
••D E
length
••F L
,
••L M&
returnNullIfFirstMissing
••N f
)
••f g
;
••g h
}
¶¶ 
return
ßß #
GetStructDeserializer
ßß (
(
ßß( )
type
ßß) -
,
ßß- .

startBound
ßß/ 9
)
ßß9 :
;
ßß: ;
}
©© 	
private
´´ 
class
´´ 
FastExpando
´´ !
:
´´" #
System
´´$ *
.
´´* +
Dynamic
´´+ 2
.
´´2 3
DynamicObject
´´3 @
,
´´@ A
IDictionary
´´B M
<
´´M N
string
´´N T
,
´´T U
object
´´V \
>
´´\ ]
{
¨¨ 	
IDictionary
≠≠ 
<
≠≠ 
string
≠≠ 
,
≠≠ 
object
≠≠  &
>
≠≠& '
data
≠≠( ,
;
≠≠, -
public
ØØ 
static
ØØ 
FastExpando
ØØ %
Attach
ØØ& ,
(
ØØ, -
IDictionary
ØØ- 8
<
ØØ8 9
string
ØØ9 ?
,
ØØ? @
object
ØØA G
>
ØØG H
data
ØØI M
)
ØØM N
{
∞∞ 
return
±± 
new
±± 
FastExpando
±± &
{
±±' (
data
±±) -
=
±±. /
data
±±0 4
}
±±5 6
;
±±6 7
}
≤≤ 
public
¥¥ 
override
¥¥ 
bool
¥¥  
TrySetMember
¥¥! -
(
¥¥- .
System
¥¥. 4
.
¥¥4 5
Dynamic
¥¥5 <
.
¥¥< =
SetMemberBinder
¥¥= L
binder
¥¥M S
,
¥¥S T
object
¥¥U [
value
¥¥\ a
)
¥¥a b
{
µµ 
data
∂∂ 
[
∂∂ 
binder
∂∂ 
.
∂∂ 
Name
∂∂  
]
∂∂  !
=
∂∂" #
value
∂∂$ )
;
∂∂) *
return
∑∑ 
true
∑∑ 
;
∑∑ 
}
∏∏ 
public
∫∫ 
override
∫∫ 
bool
∫∫  
TryGetMember
∫∫! -
(
∫∫- .
System
∫∫. 4
.
∫∫4 5
Dynamic
∫∫5 <
.
∫∫< =
GetMemberBinder
∫∫= L
binder
∫∫M S
,
∫∫S T
out
∫∫U X
object
∫∫Y _
result
∫∫` f
)
∫∫f g
{
ªª 
return
ºº 
data
ºº 
.
ºº 
TryGetValue
ºº '
(
ºº' (
binder
ºº( .
.
ºº. /
Name
ºº/ 3
,
ºº3 4
out
ºº5 8
result
ºº9 ?
)
ºº? @
;
ºº@ A
}
ΩΩ 
public
øø 
override
øø 
IEnumerable
øø '
<
øø' (
string
øø( .
>
øø. /#
GetDynamicMemberNames
øø0 E
(
øøE F
)
øøF G
{
¿¿ 
return
¡¡ 
data
¡¡ 
.
¡¡ 
Keys
¡¡  
;
¡¡  !
}
¬¬ 
void
∆∆ 
IDictionary
∆∆ 
<
∆∆ 
string
∆∆ #
,
∆∆# $
object
∆∆% +
>
∆∆+ ,
.
∆∆, -
Add
∆∆- 0
(
∆∆0 1
string
∆∆1 7
key
∆∆8 ;
,
∆∆; <
object
∆∆= C
value
∆∆D I
)
∆∆I J
{
«« 
throw
»» 
new
»» %
NotImplementedException
»» 1
(
»»1 2
)
»»2 3
;
»»3 4
}
…… 
bool
ÀÀ 
IDictionary
ÀÀ 
<
ÀÀ 
string
ÀÀ #
,
ÀÀ# $
object
ÀÀ% +
>
ÀÀ+ ,
.
ÀÀ, -
ContainsKey
ÀÀ- 8
(
ÀÀ8 9
string
ÀÀ9 ?
key
ÀÀ@ C
)
ÀÀC D
{
ÃÃ 
return
ÕÕ 
data
ÕÕ 
.
ÕÕ 
ContainsKey
ÕÕ '
(
ÕÕ' (
key
ÕÕ( +
)
ÕÕ+ ,
;
ÕÕ, -
}
ŒŒ 
ICollection
–– 
<
–– 
string
–– 
>
–– 
IDictionary
––  +
<
––+ ,
string
––, 2
,
––2 3
object
––4 :
>
––: ;
.
––; <
Keys
––< @
{
—— 
get
““ 
{
““ 
return
““ 
data
““ !
.
““! "
Keys
““" &
;
““& '
}
““( )
}
”” 
bool
’’ 
IDictionary
’’ 
<
’’ 
string
’’ #
,
’’# $
object
’’% +
>
’’+ ,
.
’’, -
Remove
’’- 3
(
’’3 4
string
’’4 :
key
’’; >
)
’’> ?
{
÷÷ 
throw
◊◊ 
new
◊◊ %
NotImplementedException
◊◊ 1
(
◊◊1 2
)
◊◊2 3
;
◊◊3 4
}
ÿÿ 
bool
⁄⁄ 
IDictionary
⁄⁄ 
<
⁄⁄ 
string
⁄⁄ #
,
⁄⁄# $
object
⁄⁄% +
>
⁄⁄+ ,
.
⁄⁄, -
TryGetValue
⁄⁄- 8
(
⁄⁄8 9
string
⁄⁄9 ?
key
⁄⁄@ C
,
⁄⁄C D
out
⁄⁄E H
object
⁄⁄I O
value
⁄⁄P U
)
⁄⁄U V
{
€€ 
return
‹‹ 
data
‹‹ 
.
‹‹ 
TryGetValue
‹‹ '
(
‹‹' (
key
‹‹( +
,
‹‹+ ,
out
‹‹- 0
value
‹‹1 6
)
‹‹6 7
;
‹‹7 8
}
›› 
ICollection
ﬂﬂ 
<
ﬂﬂ 
object
ﬂﬂ 
>
ﬂﬂ 
IDictionary
ﬂﬂ  +
<
ﬂﬂ+ ,
string
ﬂﬂ, 2
,
ﬂﬂ2 3
object
ﬂﬂ4 :
>
ﬂﬂ: ;
.
ﬂﬂ; <
Values
ﬂﬂ< B
{
‡‡ 
get
·· 
{
·· 
return
·· 
data
·· !
.
··! "
Values
··" (
;
··( )
}
··* +
}
‚‚ 
object
‰‰ 
IDictionary
‰‰ 
<
‰‰ 
string
‰‰ %
,
‰‰% &
object
‰‰' -
>
‰‰- .
.
‰‰. /
this
‰‰/ 3
[
‰‰3 4
string
‰‰4 :
key
‰‰; >
]
‰‰> ?
{
ÂÂ 
get
ÊÊ 
{
ÁÁ 
return
ËË 
data
ËË 
[
ËË  
key
ËË  #
]
ËË# $
;
ËË$ %
}
ÈÈ 
set
ÍÍ 
{
ÎÎ 
if
ÏÏ 
(
ÏÏ 
!
ÏÏ 
data
ÏÏ 
.
ÏÏ 
ContainsKey
ÏÏ )
(
ÏÏ) *
key
ÏÏ* -
)
ÏÏ- .
)
ÏÏ. /
{
ÌÌ 
throw
ÓÓ 
new
ÓÓ !%
NotImplementedException
ÓÓ" 9
(
ÓÓ9 :
)
ÓÓ: ;
;
ÓÓ; <
}
ÔÔ 
data
 
[
 
key
 
]
 
=
 
value
  %
;
% &
}
ÒÒ 
}
ÚÚ 
void
¯¯ 
ICollection
¯¯ 
<
¯¯ 
KeyValuePair
¯¯ )
<
¯¯) *
string
¯¯* 0
,
¯¯0 1
object
¯¯2 8
>
¯¯8 9
>
¯¯9 :
.
¯¯: ;
Add
¯¯; >
(
¯¯> ?
KeyValuePair
¯¯? K
<
¯¯K L
string
¯¯L R
,
¯¯R S
object
¯¯T Z
>
¯¯Z [
item
¯¯\ `
)
¯¯` a
{
˘˘ 
throw
˙˙ 
new
˙˙ %
NotImplementedException
˙˙ 1
(
˙˙1 2
)
˙˙2 3
;
˙˙3 4
}
˚˚ 
void
˝˝ 
ICollection
˝˝ 
<
˝˝ 
KeyValuePair
˝˝ )
<
˝˝) *
string
˝˝* 0
,
˝˝0 1
object
˝˝2 8
>
˝˝8 9
>
˝˝9 :
.
˝˝: ;
Clear
˝˝; @
(
˝˝@ A
)
˝˝A B
{
˛˛ 
throw
ˇˇ 
new
ˇˇ %
NotImplementedException
ˇˇ 1
(
ˇˇ1 2
)
ˇˇ2 3
;
ˇˇ3 4
}
ÄÄ 
bool
ÇÇ 
ICollection
ÇÇ 
<
ÇÇ 
KeyValuePair
ÇÇ )
<
ÇÇ) *
string
ÇÇ* 0
,
ÇÇ0 1
object
ÇÇ2 8
>
ÇÇ8 9
>
ÇÇ9 :
.
ÇÇ: ;
Contains
ÇÇ; C
(
ÇÇC D
KeyValuePair
ÇÇD P
<
ÇÇP Q
string
ÇÇQ W
,
ÇÇW X
object
ÇÇY _
>
ÇÇ_ `
item
ÇÇa e
)
ÇÇe f
{
ÉÉ 
return
ÑÑ 
data
ÑÑ 
.
ÑÑ 
Contains
ÑÑ $
(
ÑÑ$ %
item
ÑÑ% )
)
ÑÑ) *
;
ÑÑ* +
}
ÖÖ 
void
áá 
ICollection
áá 
<
áá 
KeyValuePair
áá )
<
áá) *
string
áá* 0
,
áá0 1
object
áá2 8
>
áá8 9
>
áá9 :
.
áá: ;
CopyTo
áá; A
(
ááA B
KeyValuePair
ááB N
<
ááN O
string
ááO U
,
ááU V
object
ááW ]
>
áá] ^
[
áá^ _
]
áá_ `
array
ááa f
,
ááf g
int
ááh k

arrayIndex
áál v
)
ááv w
{
àà 
data
ââ 
.
ââ 
CopyTo
ââ 
(
ââ 
array
ââ !
,
ââ! "

arrayIndex
ââ# -
)
ââ- .
;
ââ. /
}
ää 
int
åå 
ICollection
åå 
<
åå 
KeyValuePair
åå (
<
åå( )
string
åå) /
,
åå/ 0
object
åå1 7
>
åå7 8
>
åå8 9
.
åå9 :
Count
åå: ?
{
çç 
get
éé 
{
éé 
return
éé 
data
éé !
.
éé! "
Count
éé" '
;
éé' (
}
éé) *
}
èè 
bool
ëë 
ICollection
ëë 
<
ëë 
KeyValuePair
ëë )
<
ëë) *
string
ëë* 0
,
ëë0 1
object
ëë2 8
>
ëë8 9
>
ëë9 :
.
ëë: ;

IsReadOnly
ëë; E
{
íí 
get
ìì 
{
ìì 
return
ìì 
true
ìì !
;
ìì! "
}
ìì# $
}
îî 
bool
ññ 
ICollection
ññ 
<
ññ 
KeyValuePair
ññ )
<
ññ) *
string
ññ* 0
,
ññ0 1
object
ññ2 8
>
ññ8 9
>
ññ9 :
.
ññ: ;
Remove
ññ; A
(
ññA B
KeyValuePair
ññB N
<
ññN O
string
ññO U
,
ññU V
object
ññW ]
>
ññ] ^
item
ññ_ c
)
ññc d
{
óó 
throw
òò 
new
òò %
NotImplementedException
òò 1
(
òò1 2
)
òò2 3
;
òò3 4
}
ôô 
IEnumerator
üü 
<
üü 
KeyValuePair
üü $
<
üü$ %
string
üü% +
,
üü+ ,
object
üü- 3
>
üü3 4
>
üü4 5
IEnumerable
üü6 A
<
üüA B
KeyValuePair
üüB N
<
üüN O
string
üüO U
,
üüU V
object
üüW ]
>
üü] ^
>
üü^ _
.
üü_ `
GetEnumerator
üü` m
(
üüm n
)
üün o
{
†† 
return
°° 
data
°° 
.
°° 
GetEnumerator
°° )
(
°°) *
)
°°* +
;
°°+ ,
}
¢¢ 
IEnumerator
®® 
IEnumerable
®® #
.
®®# $
GetEnumerator
®®$ 1
(
®®1 2
)
®®2 3
{
©© 
return
™™ 
data
™™ 
.
™™ 
GetEnumerator
™™ )
(
™™) *
)
™™* +
;
™™+ ,
}
´´ 
}
ÆÆ 	
private
±± 
static
±± 
Func
±± 
<
±± 
IDataReader
±± '
,
±±' (
object
±±) /
>
±±/ 0$
GetDynamicDeserializer
±±1 G
(
±±G H
IDataRecord
±±H S
reader
±±T Z
,
±±Z [
int
±±\ _

startBound
±±` j
,
±±j k
int
±±l o
length
±±p v
,
±±v w
bool
±±x |'
returnNullIfFirstMissing±±} ï
)±±ï ñ
{
≤≤ 	
var
≥≥ 

fieldCount
≥≥ 
=
≥≥ 
reader
≥≥ #
.
≥≥# $

FieldCount
≥≥$ .
;
≥≥. /
if
¥¥ 
(
¥¥ 
length
¥¥ 
==
¥¥ 
-
¥¥ 
$num
¥¥ 
)
¥¥ 
{
µµ 
length
∂∂ 
=
∂∂ 

fieldCount
∂∂ #
-
∂∂$ %

startBound
∂∂& 0
;
∂∂0 1
}
∑∑ 
if
ππ 
(
ππ 

fieldCount
ππ 
<=
ππ 

startBound
ππ (
)
ππ( )
{
∫∫ 
throw
ªª 
new
ªª 
ArgumentException
ªª +
(
ªª+ ,
$strªª, è
,ªªè ê
$strªªë ö
)ªªö õ
;ªªõ ú
}
ºº 
return
ææ 
r
øø 
=>
øø 
{
¿¿ 
IDictionary
¡¡  
<
¡¡  !
string
¡¡! '
,
¡¡' (
object
¡¡) /
>
¡¡/ 0
row
¡¡1 4
=
¡¡5 6
new
¡¡7 :

Dictionary
¡¡; E
<
¡¡E F
string
¡¡F L
,
¡¡L M
object
¡¡N T
>
¡¡T U
(
¡¡U V
length
¡¡V \
)
¡¡\ ]
;
¡¡] ^
for
¬¬ 
(
¬¬ 
var
¬¬ 
i
¬¬ 
=
¬¬  !

startBound
¬¬" ,
;
¬¬, -
i
¬¬. /
<
¬¬0 1

startBound
¬¬2 <
+
¬¬= >
length
¬¬? E
;
¬¬E F
i
¬¬G H
++
¬¬H J
)
¬¬J K
{
√√ 
var
ƒƒ 
tmp
ƒƒ  
=
ƒƒ! "
r
ƒƒ# $
.
ƒƒ$ %
GetValue
ƒƒ% -
(
ƒƒ- .
i
ƒƒ. /
)
ƒƒ/ 0
;
ƒƒ0 1
tmp
≈≈ 
=
≈≈ 
tmp
≈≈ "
==
≈≈# %
DBNull
≈≈& ,
.
≈≈, -
Value
≈≈- 2
?
≈≈3 4
null
≈≈5 9
:
≈≈: ;
tmp
≈≈< ?
;
≈≈? @
row
∆∆ 
[
∆∆ 
r
∆∆ 
.
∆∆ 
GetName
∆∆ &
(
∆∆& '
i
∆∆' (
)
∆∆( )
]
∆∆) *
=
∆∆+ ,
tmp
∆∆- 0
;
∆∆0 1
if
«« 
(
«« &
returnNullIfFirstMissing
«« 5
&&
««6 8
i
««9 :
==
««; =

startBound
««> H
&&
««I K
tmp
««L O
==
««P R
null
««S W
)
««W X
{
»» 
return
…… #
null
……$ (
;
……( )
}
   
}
ÀÀ 
return
ÕÕ 
FastExpando
ÕÕ '
.
ÕÕ' (
Attach
ÕÕ( .
(
ÕÕ. /
row
ÕÕ/ 2
)
ÕÕ2 3
;
ÕÕ3 4
}
ŒŒ 
;
ŒŒ 
}
œœ 	
[
÷÷ 	
	Browsable
÷÷	 
(
÷÷ 
false
÷÷ 
)
÷÷ 
,
÷÷ 
EditorBrowsable
÷÷ *
(
÷÷* +"
EditorBrowsableState
÷÷+ ?
.
÷÷? @
Never
÷÷@ E
)
÷÷E F
]
÷÷F G
[
◊◊ 	
Obsolete
◊◊	 
(
◊◊ 
$str
◊◊ :
,
◊◊: ;
false
◊◊< A
)
◊◊A B
]
◊◊B C
public
ÿÿ 
static
ÿÿ 
char
ÿÿ 
ReadChar
ÿÿ #
(
ÿÿ# $
object
ÿÿ$ *
value
ÿÿ+ 0
)
ÿÿ0 1
{
ŸŸ 	
if
⁄⁄ 
(
⁄⁄ 
value
⁄⁄ 
==
⁄⁄ 
null
⁄⁄ 
||
⁄⁄  
value
⁄⁄! &
is
⁄⁄' )
DBNull
⁄⁄* 0
)
⁄⁄0 1
throw
⁄⁄2 7
new
⁄⁄8 ;#
ArgumentNullException
⁄⁄< Q
(
⁄⁄Q R
$str
⁄⁄R Y
)
⁄⁄Y Z
;
⁄⁄Z [
string
€€ 
s
€€ 
=
€€ 
value
€€ 
as
€€ 
string
€€  &
;
€€& '
if
‹‹ 
(
‹‹ 
s
‹‹ 
==
‹‹ 
null
‹‹ 
||
‹‹ 
s
‹‹ 
.
‹‹ 
Length
‹‹ %
!=
‹‹& (
$num
‹‹) *
)
‹‹* +
throw
‹‹, 1
new
‹‹2 5
ArgumentException
‹‹6 G
(
‹‹G H
$str
‹‹H i
,
‹‹i j
$str
‹‹k r
)
‹‹r s
;
‹‹s t
return
›› 
s
›› 
[
›› 
$num
›› 
]
›› 
;
›› 
}
ﬁﬁ 	
[
„„ 	
	Browsable
„„	 
(
„„ 
false
„„ 
)
„„ 
,
„„ 
EditorBrowsable
„„ *
(
„„* +"
EditorBrowsableState
„„+ ?
.
„„? @
Never
„„@ E
)
„„E F
]
„„F G
[
‰‰ 	
Obsolete
‰‰	 
(
‰‰ 
$str
‰‰ :
,
‰‰: ;
false
‰‰< A
)
‰‰A B
]
‰‰B C
public
ÂÂ 
static
ÂÂ 
char
ÂÂ 
?
ÂÂ 
ReadNullableChar
ÂÂ ,
(
ÂÂ, -
object
ÂÂ- 3
value
ÂÂ4 9
)
ÂÂ9 :
{
ÊÊ 	
if
ÁÁ 
(
ÁÁ 
value
ÁÁ 
==
ÁÁ 
null
ÁÁ 
||
ÁÁ  
value
ÁÁ! &
is
ÁÁ' )
DBNull
ÁÁ* 0
)
ÁÁ0 1
return
ÁÁ2 8
null
ÁÁ9 =
;
ÁÁ= >
string
ËË 
s
ËË 
=
ËË 
value
ËË 
as
ËË 
string
ËË  &
;
ËË& '
if
ÈÈ 
(
ÈÈ 
s
ÈÈ 
==
ÈÈ 
null
ÈÈ 
||
ÈÈ 
s
ÈÈ 
.
ÈÈ 
Length
ÈÈ %
!=
ÈÈ& (
$num
ÈÈ) *
)
ÈÈ* +
throw
ÈÈ, 1
new
ÈÈ2 5
ArgumentException
ÈÈ6 G
(
ÈÈG H
$str
ÈÈH i
,
ÈÈi j
$str
ÈÈk r
)
ÈÈr s
;
ÈÈs t
return
ÍÍ 
s
ÍÍ 
[
ÍÍ 
$num
ÍÍ 
]
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
[
ÔÔ 	
	Browsable
ÔÔ	 
(
ÔÔ 
false
ÔÔ 
)
ÔÔ 
,
ÔÔ 
EditorBrowsable
ÔÔ *
(
ÔÔ* +"
EditorBrowsableState
ÔÔ+ ?
.
ÔÔ? @
Never
ÔÔ@ E
)
ÔÔE F
]
ÔÔF G
[
 	
Obsolete
	 
(
 
$str
 :
,
: ;
true
< @
)
@ A
]
A B
public
ÒÒ 
static
ÒÒ 
void
ÒÒ  
PackListParameters
ÒÒ -
(
ÒÒ- .

IDbCommand
ÒÒ. 8
command
ÒÒ9 @
,
ÒÒ@ A
string
ÒÒB H

namePrefix
ÒÒI S
,
ÒÒS T
object
ÒÒU [
value
ÒÒ\ a
)
ÒÒa b
{
ÚÚ 	
var
ˆˆ 
list
ˆˆ 
=
ˆˆ 
value
ˆˆ 
as
ˆˆ 
IEnumerable
ˆˆ  +
;
ˆˆ+ ,
var
˜˜ 
count
˜˜ 
=
˜˜ 
$num
˜˜ 
;
˜˜ 
if
˘˘ 
(
˘˘ 
list
˘˘ 
!=
˘˘ 
null
˘˘ 
)
˘˘ 
{
˙˙ 
bool
˚˚ 
isString
˚˚ 
=
˚˚ 
value
˚˚  %
is
˚˚& (
IEnumerable
˚˚) 4
<
˚˚4 5
string
˚˚5 ;
>
˚˚; <
;
˚˚< =
foreach
¸¸ 
(
¸¸ 
var
¸¸ 
item
¸¸ !
in
¸¸" $
list
¸¸% )
)
¸¸) *
{
˝˝ 
count
˛˛ 
++
˛˛ 
;
˛˛ 
var
ˇˇ 
	listParam
ˇˇ !
=
ˇˇ" #
command
ˇˇ$ +
.
ˇˇ+ ,
CreateParameter
ˇˇ, ;
(
ˇˇ; <
)
ˇˇ< =
;
ˇˇ= >
	listParam
Ä	Ä	 
.
Ä	Ä	 
ParameterName
Ä	Ä	 +
=
Ä	Ä	, -

namePrefix
Ä	Ä	. 8
+
Ä	Ä	9 :
count
Ä	Ä	; @
;
Ä	Ä	@ A
	listParam
Å	Å	 
.
Å	Å	 
Value
Å	Å	 #
=
Å	Å	$ %
item
Å	Å	& *
??
Å	Å	+ -
DBNull
Å	Å	. 4
.
Å	Å	4 5
Value
Å	Å	5 :
;
Å	Å	: ;
if
Ç	Ç	 
(
Ç	Ç	 
isString
Ç	Ç	  
)
Ç	Ç	  !
{
É	É	 
	listParam
Ñ	Ñ	 !
.
Ñ	Ñ	! "
Size
Ñ	Ñ	" &
=
Ñ	Ñ	' (
$num
Ñ	Ñ	) -
;
Ñ	Ñ	- .
if
Ö	Ö	 
(
Ö	Ö	 
item
Ö	Ö	  
!=
Ö	Ö	! #
null
Ö	Ö	$ (
&&
Ö	Ö	) +
(
Ö	Ö	, -
(
Ö	Ö	- .
string
Ö	Ö	. 4
)
Ö	Ö	4 5
item
Ö	Ö	5 9
)
Ö	Ö	9 :
.
Ö	Ö	: ;
Length
Ö	Ö	; A
>
Ö	Ö	B C
$num
Ö	Ö	D H
)
Ö	Ö	H I
{
Ü	Ü	 
	listParam
á	á	 %
.
á	á	% &
Size
á	á	& *
=
á	á	+ ,
-
á	á	- .
$num
á	á	. /
;
á	á	/ 0
}
à	à	 
}
â	â	 
command
ä	ä	 
.
ä	ä	 

Parameters
ä	ä	 &
.
ä	ä	& '
Add
ä	ä	' *
(
ä	ä	* +
	listParam
ä	ä	+ 4
)
ä	ä	4 5
;
ä	ä	5 6
}
ã	ã	 
if
ç	ç	 
(
ç	ç	 
count
ç	ç	 
==
ç	ç	 
$num
ç	ç	 
)
ç	ç	 
{
é	é	 
command
è	è	 
.
è	è	 
CommandText
è	è	 '
=
è	è	( )
Regex
è	è	* /
.
è	è	/ 0
Replace
è	è	0 7
(
è	è	7 8
command
è	è	8 ?
.
è	è	? @
CommandText
è	è	@ K
,
è	è	K L
$str
è	è	M U
+
è	è	V W
Regex
è	è	X ]
.
è	è	] ^
Escape
è	è	^ d
(
è	è	d e

namePrefix
è	è	e o
)
è	è	o p
,
è	è	p q
$strè	è	r ç
)è	è	ç é
;è	è	é è
}
ê	ê	 
else
ë	ë	 
{
í	í	 
command
ì	ì	 
.
ì	ì	 
CommandText
ì	ì	 '
=
ì	ì	( )
Regex
ì	ì	* /
.
ì	ì	/ 0
Replace
ì	ì	0 7
(
ì	ì	7 8
command
ì	ì	8 ?
.
ì	ì	? @
CommandText
ì	ì	@ K
,
ì	ì	K L
$str
ì	ì	M U
+
ì	ì	V W
Regex
ì	ì	X ]
.
ì	ì	] ^
Escape
ì	ì	^ d
(
ì	ì	d e

namePrefix
ì	ì	e o
)
ì	ì	o p
,
ì	ì	p q
match
ì	ì	r w
=>
ì	ì	x z
{
î	î	 
var
ï	ï	 
grp
ï	ï	 
=
ï	ï	  !
match
ï	ï	" '
.
ï	ï	' (
Value
ï	ï	( -
;
ï	ï	- .
var
ñ	ñ	 
sb
ñ	ñ	 
=
ñ	ñ	  
new
ñ	ñ	! $
StringBuilder
ñ	ñ	% 2
(
ñ	ñ	2 3
$str
ñ	ñ	3 6
)
ñ	ñ	6 7
.
ñ	ñ	7 8
Append
ñ	ñ	8 >
(
ñ	ñ	> ?
grp
ñ	ñ	? B
)
ñ	ñ	B C
.
ñ	ñ	C D
Append
ñ	ñ	D J
(
ñ	ñ	J K
$num
ñ	ñ	K L
)
ñ	ñ	L M
;
ñ	ñ	M N
for
ó	ó	 
(
ó	ó	 
int
ó	ó	  
i
ó	ó	! "
=
ó	ó	# $
$num
ó	ó	% &
;
ó	ó	& '
i
ó	ó	( )
<=
ó	ó	* ,
count
ó	ó	- 2
;
ó	ó	2 3
i
ó	ó	4 5
++
ó	ó	5 7
)
ó	ó	7 8
{
ò	ò	 
sb
ô	ô	 
.
ô	ô	 
Append
ô	ô	 %
(
ô	ô	% &
$char
ô	ô	& )
)
ô	ô	) *
.
ô	ô	* +
Append
ô	ô	+ 1
(
ô	ô	1 2
grp
ô	ô	2 5
)
ô	ô	5 6
.
ô	ô	6 7
Append
ô	ô	7 =
(
ô	ô	= >
i
ô	ô	> ?
)
ô	ô	? @
;
ô	ô	@ A
}
ö	ö	 
return
õ	õ	 
sb
õ	õ	 !
.
õ	õ	! "
Append
õ	õ	" (
(
õ	õ	( )
$char
õ	õ	) ,
)
õ	õ	, -
.
õ	õ	- .
ToString
õ	õ	. 6
(
õ	õ	6 7
)
õ	õ	7 8
;
õ	õ	8 9
}
ú	ú	 
)
ú	ú	 
;
ú	ú	 
}
ù	ù	 
}
û	û	 
}
†	†	 	
private
¢	¢	 
static
¢	¢	 
IEnumerable
¢	¢	 "
<
¢	¢	" #
PropertyInfo
¢	¢	# /
>
¢	¢	/ 0
FilterParameters
¢	¢	1 A
(
¢	¢	A B
IEnumerable
¢	¢	B M
<
¢	¢	M N
PropertyInfo
¢	¢	N Z
>
¢	¢	Z [

parameters
¢	¢	\ f
,
¢	¢	f g
string
¢	¢	h n
sql
¢	¢	o r
)
¢	¢	r s
{
£	£	 	
return
§	§	 

parameters
§	§	 
.
§	§	 
Where
§	§	 #
(
§	§	# $
p
§	§	$ %
=>
§	§	& (
Regex
§	§	) .
.
§	§	. /
IsMatch
§	§	/ 6
(
§	§	6 7
sql
§	§	7 :
,
§	§	: ;
$str
§	§	< B
+
§	§	C D
p
§	§	E F
.
§	§	F G
Name
§	§	G K
+
§	§	L M
$str
§	§	N b
,
§	§	b c
RegexOptions
§	§	d p
.
§	§	p q

IgnoreCase
§	§	q {
|
§	§	| }
RegexOptions§	§	~ ä
.§	§	ä ã
	Multiline§	§	ã î
)§	§	î ï
)§	§	ï ñ
;§	§	ñ ó
}
•	•	 	
public
™	™	 
static
™	™	 
Action
™	™	 
<
™	™	 

IDbCommand
™	™	 '
,
™	™	' (
object
™	™	) /
>
™	™	/ 0&
CreateParamInfoGenerator
™	™	1 I
(
™	™	I J
Identity
™	™	J R
identity
™	™	S [
)
™	™	[ \
{
´	´	 	
Type
¨	¨	 
type
¨	¨	 
=
¨	¨	 
identity
¨	¨	  
.
¨	¨	  !
parametersType
¨	¨	! /
;
¨	¨	/ 0
bool
≠	≠	 
filterParams
≠	≠	 
=
≠	≠	 
identity
≠	≠	  (
.
≠	≠	( )
commandType
≠	≠	) 4
.
≠	≠	4 5
GetValueOrDefault
≠	≠	5 F
(
≠	≠	F G
CommandType
≠	≠	G R
.
≠	≠	R S
Text
≠	≠	S W
)
≠	≠	W X
==
≠	≠	Y [
CommandType
≠	≠	\ g
.
≠	≠	g h
Text
≠	≠	h l
;
≠	≠	l m
var
Ø	Ø	 
dm
Ø	Ø	 
=
Ø	Ø	 
new
Ø	Ø	 
DynamicMethod
Ø	Ø	 &
(
Ø	Ø	& '
string
Ø	Ø	' -
.
Ø	Ø	- .
Format
Ø	Ø	. 4
(
Ø	Ø	4 5
$str
Ø	Ø	5 C
,
Ø	Ø	C D
Guid
Ø	Ø	E I
.
Ø	Ø	I J
NewGuid
Ø	Ø	J Q
(
Ø	Ø	Q R
)
Ø	Ø	R S
)
Ø	Ø	S T
,
Ø	Ø	T U
null
Ø	Ø	V Z
,
Ø	Ø	Z [
new
Ø	Ø	\ _
[
Ø	Ø	_ `
]
Ø	Ø	` a
{
Ø	Ø	b c
typeof
Ø	Ø	d j
(
Ø	Ø	j k

IDbCommand
Ø	Ø	k u
)
Ø	Ø	u v
,
Ø	Ø	v w
typeof
Ø	Ø	x ~
(
Ø	Ø	~ 
objectØ	Ø	 Ö
)Ø	Ø	Ö Ü
}Ø	Ø	á à
,Ø	Ø	à â
typeØ	Ø	ä é
,Ø	Ø	é è
trueØ	Ø	ê î
)Ø	Ø	î ï
;Ø	Ø	ï ñ
var
±	±	 
il
±	±	 
=
±	±	 
dm
±	±	 
.
±	±	 
GetILGenerator
±	±	 &
(
±	±	& '
)
±	±	' (
;
±	±	( )
il
≥	≥	 
.
≥	≥	 
DeclareLocal
≥	≥	 
(
≥	≥	 
type
≥	≥	  
)
≥	≥	  !
;
≥	≥	! "
bool
¥	¥	 
haveInt32Arg1
¥	¥	 
=
¥	¥	  
false
¥	¥	! &
;
¥	¥	& '
il
µ	µ	 
.
µ	µ	 
Emit
µ	µ	 
(
µ	µ	 
OpCodes
µ	µ	 
.
µ	µ	 
Ldarg_1
µ	µ	 #
)
µ	µ	# $
;
µ	µ	$ %
il
∂	∂	 
.
∂	∂	 
Emit
∂	∂	 
(
∂	∂	 
OpCodes
∂	∂	 
.
∂	∂	 
	Unbox_Any
∂	∂	 %
,
∂	∂	% &
type
∂	∂	' +
)
∂	∂	+ ,
;
∂	∂	, -
il
∑	∑	 
.
∑	∑	 
Emit
∑	∑	 
(
∑	∑	 
OpCodes
∑	∑	 
.
∑	∑	 
Stloc_0
∑	∑	 #
)
∑	∑	# $
;
∑	∑	$ %
il
π	π	 
.
π	π	 
Emit
π	π	 
(
π	π	 
OpCodes
π	π	 
.
π	π	 
Ldarg_0
π	π	 #
)
π	π	# $
;
π	π	$ %
il
∫	∫	 
.
∫	∫	 
EmitCall
∫	∫	 
(
∫	∫	 
OpCodes
∫	∫	 
.
∫	∫	  
Callvirt
∫	∫	  (
,
∫	∫	( )
typeof
∫	∫	* 0
(
∫	∫	0 1

IDbCommand
∫	∫	1 ;
)
∫	∫	; <
.
∫	∫	< =
GetProperty
∫	∫	= H
(
∫	∫	H I
$str
∫	∫	I U
)
∫	∫	U V
.
∫	∫	V W
GetGetMethod
∫	∫	W c
(
∫	∫	c d
)
∫	∫	d e
,
∫	∫	e f
null
∫	∫	g k
)
∫	∫	k l
;
∫	∫	l m
IEnumerable
º	º	 
<
º	º	 
PropertyInfo
º	º	 $
>
º	º	$ %
props
º	º	& +
=
º	º	, -
type
º	º	. 2
.
º	º	2 3
GetProperties
º	º	3 @
(
º	º	@ A
)
º	º	A B
.
º	º	B C
OrderBy
º	º	C J
(
º	º	J K
p
º	º	K L
=>
º	º	M O
p
º	º	P Q
.
º	º	Q R
Name
º	º	R V
)
º	º	V W
;
º	º	W X
if
Ω	Ω	 
(
Ω	Ω	 
filterParams
Ω	Ω	 
)
Ω	Ω	 
{
æ	æ	 
props
ø	ø	 
=
ø	ø	 
FilterParameters
ø	ø	 (
(
ø	ø	( )
props
ø	ø	) .
,
ø	ø	. /
identity
ø	ø	0 8
.
ø	ø	8 9
sql
ø	ø	9 <
)
ø	ø	< =
;
ø	ø	= >
}
¿	¿	 
foreach
¡	¡	 
(
¡	¡	 
var
¡	¡	 
prop
¡	¡	 
in
¡	¡	  
props
¡	¡	! &
)
¡	¡	& '
{
¬	¬	 
if
√	√	 
(
√	√	 
filterParams
√	√	  
)
√	√	  !
{
ƒ	ƒ	 
if
≈	≈	 
(
≈	≈	 
identity
≈	≈	  
.
≈	≈	  !
sql
≈	≈	! $
.
≈	≈	$ %
IndexOf
≈	≈	% ,
(
≈	≈	, -
$str
≈	≈	- 0
+
≈	≈	1 2
prop
≈	≈	3 7
.
≈	≈	7 8
Name
≈	≈	8 <
,
≈	≈	< =
StringComparison
≈	≈	> N
.
≈	≈	N O(
InvariantCultureIgnoreCase
≈	≈	O i
)
≈	≈	i j
<
≈	≈	k l
$num
≈	≈	m n
&&
∆	∆	 
identity
∆	∆	 #
.
∆	∆	# $
sql
∆	∆	$ '
.
∆	∆	' (
IndexOf
∆	∆	( /
(
∆	∆	/ 0
$str
∆	∆	0 3
+
∆	∆	4 5
prop
∆	∆	6 :
.
∆	∆	: ;
Name
∆	∆	; ?
,
∆	∆	? @
StringComparison
∆	∆	A Q
.
∆	∆	Q R(
InvariantCultureIgnoreCase
∆	∆	R l
)
∆	∆	l m
<
∆	∆	n o
$num
∆	∆	p q
)
∆	∆	q r
{
«	«	 
continue
»	»	  
;
»	»	  !
}
…	…	 
}
 	 	 
if
À	À	 
(
À	À	 
prop
À	À	 
.
À	À	 
PropertyType
À	À	 %
==
À	À	& (
typeof
À	À	) /
(
À	À	/ 0
DbString
À	À	0 8
)
À	À	8 9
)
À	À	9 :
{
Ã	Ã	 
il
Õ	Õ	 
.
Õ	Õ	 
Emit
Õ	Õ	 
(
Õ	Õ	 
OpCodes
Õ	Õ	 #
.
Õ	Õ	# $
Ldloc_0
Õ	Õ	$ +
)
Õ	Õ	+ ,
;
Õ	Õ	, -
il
Œ	Œ	 
.
Œ	Œ	 
Emit
Œ	Œ	 
(
Œ	Œ	 
OpCodes
Œ	Œ	 #
.
Œ	Œ	# $
Callvirt
Œ	Œ	$ ,
,
Œ	Œ	, -
prop
Œ	Œ	. 2
.
Œ	Œ	2 3
GetGetMethod
Œ	Œ	3 ?
(
Œ	Œ	? @
)
Œ	Œ	@ A
)
Œ	Œ	A B
;
Œ	Œ	B C
il
œ	œ	 
.
œ	œ	 
Emit
œ	œ	 
(
œ	œ	 
OpCodes
œ	œ	 #
.
œ	œ	# $
Ldarg_0
œ	œ	$ +
)
œ	œ	+ ,
;
œ	œ	, -
il
–	–	 
.
–	–	 
Emit
–	–	 
(
–	–	 
OpCodes
–	–	 #
.
–	–	# $
Ldstr
–	–	$ )
,
–	–	) *
prop
–	–	+ /
.
–	–	/ 0
Name
–	–	0 4
)
–	–	4 5
;
–	–	5 6
il
—	—	 
.
—	—	 
EmitCall
—	—	 
(
—	—	  
OpCodes
—	—	  '
.
—	—	' (
Callvirt
—	—	( 0
,
—	—	0 1
typeof
—	—	2 8
(
—	—	8 9
DbString
—	—	9 A
)
—	—	A B
.
—	—	B C
	GetMethod
—	—	C L
(
—	—	L M
$str
—	—	M [
)
—	—	[ \
,
—	—	\ ]
null
—	—	^ b
)
—	—	b c
;
—	—	c d
continue
“	“	 
;
“	“	 
}
”	”	 
DbType
‘	‘	 
dbType
‘	‘	 
=
‘	‘	 
LookupDbType
‘	‘	  ,
(
‘	‘	, -
prop
‘	‘	- 1
.
‘	‘	1 2
PropertyType
‘	‘	2 >
,
‘	‘	> ?
prop
‘	‘	@ D
.
‘	‘	D E
Name
‘	‘	E I
)
‘	‘	I J
;
‘	‘	J K
if
’	’	 
(
’	’	 
dbType
’	’	 
==
’	’	 
DbType
’	’	 $
.
’	’	$ %
Xml
’	’	% (
)
’	’	( )
{
÷	÷	 
il
ÿ	ÿ	 
.
ÿ	ÿ	 
Emit
ÿ	ÿ	 
(
ÿ	ÿ	 
OpCodes
ÿ	ÿ	 #
.
ÿ	ÿ	# $
Ldarg_0
ÿ	ÿ	$ +
)
ÿ	ÿ	+ ,
;
ÿ	ÿ	, -
il
Ÿ	Ÿ	 
.
Ÿ	Ÿ	 
Emit
Ÿ	Ÿ	 
(
Ÿ	Ÿ	 
OpCodes
Ÿ	Ÿ	 #
.
Ÿ	Ÿ	# $
Ldstr
Ÿ	Ÿ	$ )
,
Ÿ	Ÿ	) *
prop
Ÿ	Ÿ	+ /
.
Ÿ	Ÿ	/ 0
Name
Ÿ	Ÿ	0 4
)
Ÿ	Ÿ	4 5
;
Ÿ	Ÿ	5 6
il
⁄	⁄	 
.
⁄	⁄	 
Emit
⁄	⁄	 
(
⁄	⁄	 
OpCodes
⁄	⁄	 #
.
⁄	⁄	# $
Ldloc_0
⁄	⁄	$ +
)
⁄	⁄	+ ,
;
⁄	⁄	, -
il
€	€	 
.
€	€	 
Emit
€	€	 
(
€	€	 
OpCodes
€	€	 #
.
€	€	# $
Callvirt
€	€	$ ,
,
€	€	, -
prop
€	€	. 2
.
€	€	2 3
GetGetMethod
€	€	3 ?
(
€	€	? @
)
€	€	@ A
)
€	€	A B
;
€	€	B C
if
‹	‹	 
(
‹	‹	 
prop
‹	‹	 
.
‹	‹	 
PropertyType
‹	‹	 )
.
‹	‹	) *
IsValueType
‹	‹	* 5
)
‹	‹	5 6
{
›	›	 
il
ﬁ	ﬁ	 
.
ﬁ	ﬁ	 
Emit
ﬁ	ﬁ	 
(
ﬁ	ﬁ	  
OpCodes
ﬁ	ﬁ	  '
.
ﬁ	ﬁ	' (
Box
ﬁ	ﬁ	( +
,
ﬁ	ﬁ	+ ,
prop
ﬁ	ﬁ	- 1
.
ﬁ	ﬁ	1 2
PropertyType
ﬁ	ﬁ	2 >
)
ﬁ	ﬁ	> ?
;
ﬁ	ﬁ	? @
}
ﬂ	ﬂ	 
il
‡	‡	 
.
‡	‡	 
EmitCall
‡	‡	 
(
‡	‡	  
OpCodes
‡	‡	  '
.
‡	‡	' (
Call
‡	‡	( ,
,
‡	‡	, -
typeof
‡	‡	. 4
(
‡	‡	4 5
	SqlMapper
‡	‡	5 >
)
‡	‡	> ?
.
‡	‡	? @
	GetMethod
‡	‡	@ I
(
‡	‡	I J
$str
‡	‡	J ^
)
‡	‡	^ _
,
‡	‡	_ `
null
‡	‡	a e
)
‡	‡	e f
;
‡	‡	f g
continue
·	·	 
;
·	·	 
}
‚	‚	 
il
„	„	 
.
„	„	 
Emit
„	„	 
(
„	„	 
OpCodes
„	„	 
.
„	„	  
Dup
„	„	  #
)
„	„	# $
;
„	„	$ %
il
Â	Â	 
.
Â	Â	 
Emit
Â	Â	 
(
Â	Â	 
OpCodes
Â	Â	 
.
Â	Â	  
Ldarg_0
Â	Â	  '
)
Â	Â	' (
;
Â	Â	( )
il
Ê	Ê	 
.
Ê	Ê	 
EmitCall
Ê	Ê	 
(
Ê	Ê	 
OpCodes
Ê	Ê	 #
.
Ê	Ê	# $
Callvirt
Ê	Ê	$ ,
,
Ê	Ê	, -
typeof
Ê	Ê	. 4
(
Ê	Ê	4 5

IDbCommand
Ê	Ê	5 ?
)
Ê	Ê	? @
.
Ê	Ê	@ A
	GetMethod
Ê	Ê	A J
(
Ê	Ê	J K
$str
Ê	Ê	K \
)
Ê	Ê	\ ]
,
Ê	Ê	] ^
null
Ê	Ê	_ c
)
Ê	Ê	c d
;
Ê	Ê	d e
il
Ë	Ë	 
.
Ë	Ë	 
Emit
Ë	Ë	 
(
Ë	Ë	 
OpCodes
Ë	Ë	 
.
Ë	Ë	  
Dup
Ë	Ë	  #
)
Ë	Ë	# $
;
Ë	Ë	$ %
il
È	È	 
.
È	È	 
Emit
È	È	 
(
È	È	 
OpCodes
È	È	 
.
È	È	  
Ldstr
È	È	  %
,
È	È	% &
prop
È	È	' +
.
È	È	+ ,
Name
È	È	, 0
)
È	È	0 1
;
È	È	1 2
il
Í	Í	 
.
Í	Í	 
EmitCall
Í	Í	 
(
Í	Í	 
OpCodes
Í	Í	 #
.
Í	Í	# $
Callvirt
Í	Í	$ ,
,
Í	Í	, -
typeof
Í	Í	. 4
(
Í	Í	4 5
IDataParameter
Í	Í	5 C
)
Í	Í	C D
.
Í	Í	D E
GetProperty
Í	Í	E P
(
Í	Í	P Q
$str
Í	Í	Q `
)
Í	Í	` a
.
Í	Í	a b
GetSetMethod
Í	Í	b n
(
Í	Í	n o
)
Í	Í	o p
,
Í	Í	p q
null
Í	Í	r v
)
Í	Í	v w
;
Í	Í	w x
il
Ï	Ï	 
.
Ï	Ï	 
Emit
Ï	Ï	 
(
Ï	Ï	 
OpCodes
Ï	Ï	 
.
Ï	Ï	  
Dup
Ï	Ï	  #
)
Ï	Ï	# $
;
Ï	Ï	$ %
	EmitInt32
Ì	Ì	 
(
Ì	Ì	 
il
Ì	Ì	 
,
Ì	Ì	 
(
Ì	Ì	 
int
Ì	Ì	 "
)
Ì	Ì	" #
dbType
Ì	Ì	# )
)
Ì	Ì	) *
;
Ì	Ì	* +
il
Ô	Ô	 
.
Ô	Ô	 
EmitCall
Ô	Ô	 
(
Ô	Ô	 
OpCodes
Ô	Ô	 #
.
Ô	Ô	# $
Callvirt
Ô	Ô	$ ,
,
Ô	Ô	, -
typeof
Ô	Ô	. 4
(
Ô	Ô	4 5
IDataParameter
Ô	Ô	5 C
)
Ô	Ô	C D
.
Ô	Ô	D E
GetProperty
Ô	Ô	E P
(
Ô	Ô	P Q
$str
Ô	Ô	Q Y
)
Ô	Ô	Y Z
.
Ô	Ô	Z [
GetSetMethod
Ô	Ô	[ g
(
Ô	Ô	g h
)
Ô	Ô	h i
,
Ô	Ô	i j
null
Ô	Ô	k o
)
Ô	Ô	o p
;
Ô	Ô	p q
il
Ò	Ò	 
.
Ò	Ò	 
Emit
Ò	Ò	 
(
Ò	Ò	 
OpCodes
Ò	Ò	 
.
Ò	Ò	  
Dup
Ò	Ò	  #
)
Ò	Ò	# $
;
Ò	Ò	$ %
	EmitInt32
Ú	Ú	 
(
Ú	Ú	 
il
Ú	Ú	 
,
Ú	Ú	 
(
Ú	Ú	 
int
Ú	Ú	 "
)
Ú	Ú	" # 
ParameterDirection
Ú	Ú	# 5
.
Ú	Ú	5 6
Input
Ú	Ú	6 ;
)
Ú	Ú	; <
;
Ú	Ú	< =
il
Û	Û	 
.
Û	Û	 
EmitCall
Û	Û	 
(
Û	Û	 
OpCodes
Û	Û	 #
.
Û	Û	# $
Callvirt
Û	Û	$ ,
,
Û	Û	, -
typeof
Û	Û	. 4
(
Û	Û	4 5
IDataParameter
Û	Û	5 C
)
Û	Û	C D
.
Û	Û	D E
GetProperty
Û	Û	E P
(
Û	Û	P Q
$str
Û	Û	Q \
)
Û	Û	\ ]
.
Û	Û	] ^
GetSetMethod
Û	Û	^ j
(
Û	Û	j k
)
Û	Û	k l
,
Û	Û	l m
null
Û	Û	n r
)
Û	Û	r s
;
Û	Û	s t
il
ı	ı	 
.
ı	ı	 
Emit
ı	ı	 
(
ı	ı	 
OpCodes
ı	ı	 
.
ı	ı	  
Dup
ı	ı	  #
)
ı	ı	# $
;
ı	ı	$ %
il
ˆ	ˆ	 
.
ˆ	ˆ	 
Emit
ˆ	ˆ	 
(
ˆ	ˆ	 
OpCodes
ˆ	ˆ	 
.
ˆ	ˆ	  
Ldloc_0
ˆ	ˆ	  '
)
ˆ	ˆ	' (
;
ˆ	ˆ	( )
il
˜	˜	 
.
˜	˜	 
Emit
˜	˜	 
(
˜	˜	 
OpCodes
˜	˜	 
.
˜	˜	  
Callvirt
˜	˜	  (
,
˜	˜	( )
prop
˜	˜	* .
.
˜	˜	. /
GetGetMethod
˜	˜	/ ;
(
˜	˜	; <
)
˜	˜	< =
)
˜	˜	= >
;
˜	˜	> ?
bool
¯	¯	 
checkForNull
¯	¯	 !
=
¯	¯	" #
true
¯	¯	$ (
;
¯	¯	( )
if
˘	˘	 
(
˘	˘	 
prop
˘	˘	 
.
˘	˘	 
PropertyType
˘	˘	 %
.
˘	˘	% &
IsValueType
˘	˘	& 1
)
˘	˘	1 2
{
˙	˙	 
il
˚	˚	 
.
˚	˚	 
Emit
˚	˚	 
(
˚	˚	 
OpCodes
˚	˚	 #
.
˚	˚	# $
Box
˚	˚	$ '
,
˚	˚	' (
prop
˚	˚	) -
.
˚	˚	- .
PropertyType
˚	˚	. :
)
˚	˚	: ;
;
˚	˚	; <
if
¸	¸	 
(
¸	¸	 
Nullable
¸	¸	  
.
¸	¸	  !
GetUnderlyingType
¸	¸	! 2
(
¸	¸	2 3
prop
¸	¸	3 7
.
¸	¸	7 8
PropertyType
¸	¸	8 D
)
¸	¸	D E
==
¸	¸	F H
null
¸	¸	I M
)
¸	¸	M N
{
˝	˝	 
checkForNull
˛	˛	 $
=
˛	˛	% &
false
˛	˛	' ,
;
˛	˛	, -
}
ˇ	ˇ	 
}
Ä
Ä
 
if
Å
Å
 
(
Å
Å
 
checkForNull
Å
Å
  
)
Å
Å
  !
{
Ç
Ç
 
if
É
É
 
(
É
É
 
dbType
É
É
 
==
É
É
 !
DbType
É
É
" (
.
É
É
( )
String
É
É
) /
&&
É
É
0 2
!
É
É
3 4
haveInt32Arg1
É
É
4 A
)
É
É
A B
{
Ñ
Ñ
 
il
Ö
Ö
 
.
Ö
Ö
 
DeclareLocal
Ö
Ö
 '
(
Ö
Ö
' (
typeof
Ö
Ö
( .
(
Ö
Ö
. /
int
Ö
Ö
/ 2
)
Ö
Ö
2 3
)
Ö
Ö
3 4
;
Ö
Ö
4 5
haveInt32Arg1
Ü
Ü
 %
=
Ü
Ü
& '
true
Ü
Ü
( ,
;
Ü
Ü
, -
}
á
á
 
il
â
â
 
.
â
â
 
Emit
â
â
 
(
â
â
 
OpCodes
â
â
 #
.
â
â
# $
Dup
â
â
$ '
)
â
â
' (
;
â
â
( )
Label
ä
ä
 
notNull
ä
ä
 !
=
ä
ä
" #
il
ä
ä
$ &
.
ä
ä
& '
DefineLabel
ä
ä
' 2
(
ä
ä
2 3
)
ä
ä
3 4
;
ä
ä
4 5
Label
ã
ã
 
?
ã
ã
 
allDone
ã
ã
 "
=
ã
ã
# $
dbType
ã
ã
% +
==
ã
ã
, .
DbType
ã
ã
/ 5
.
ã
ã
5 6
String
ã
ã
6 <
?
ã
ã
= >
il
ã
ã
? A
.
ã
ã
A B
DefineLabel
ã
ã
B M
(
ã
ã
M N
)
ã
ã
N O
:
ã
ã
P Q
(
ã
ã
R S
Label
ã
ã
S X
?
ã
ã
X Y
)
ã
ã
Y Z
null
ã
ã
Z ^
;
ã
ã
^ _
il
å
å
 
.
å
å
 
Emit
å
å
 
(
å
å
 
OpCodes
å
å
 #
.
å
å
# $
Brtrue_S
å
å
$ ,
,
å
å
, -
notNull
å
å
. 5
)
å
å
5 6
;
å
å
6 7
il
é
é
 
.
é
é
 
Emit
é
é
 
(
é
é
 
OpCodes
é
é
 #
.
é
é
# $
Pop
é
é
$ '
)
é
é
' (
;
é
é
( )
il
è
è
 
.
è
è
 
Emit
è
è
 
(
è
è
 
OpCodes
è
è
 #
.
è
è
# $
Ldsfld
è
è
$ *
,
è
è
* +
typeof
è
è
, 2
(
è
è
2 3
DBNull
è
è
3 9
)
è
è
9 :
.
è
è
: ;
GetField
è
è
; C
(
è
è
C D
$str
è
è
D K
)
è
è
K L
)
è
è
L M
;
è
è
M N
if
ê
ê
 
(
ê
ê
 
dbType
ê
ê
 
==
ê
ê
 !
DbType
ê
ê
" (
.
ê
ê
( )
String
ê
ê
) /
)
ê
ê
/ 0
{
ë
ë
 
	EmitInt32
í
í
 !
(
í
í
! "
il
í
í
" $
,
í
í
$ %
$num
í
í
& '
)
í
í
' (
;
í
í
( )
il
ì
ì
 
.
ì
ì
 
Emit
ì
ì
 
(
ì
ì
  
OpCodes
ì
ì
  '
.
ì
ì
' (
Stloc_1
ì
ì
( /
)
ì
ì
/ 0
;
ì
ì
0 1
}
î
î
 
if
ï
ï
 
(
ï
ï
 
allDone
ï
ï
 
!=
ï
ï
  "
null
ï
ï
# '
)
ï
ï
' (
il
ï
ï
) +
.
ï
ï
+ ,
Emit
ï
ï
, 0
(
ï
ï
0 1
OpCodes
ï
ï
1 8
.
ï
ï
8 9
Br_S
ï
ï
9 =
,
ï
ï
= >
allDone
ï
ï
? F
.
ï
ï
F G
Value
ï
ï
G L
)
ï
ï
L M
;
ï
ï
M N
il
ñ
ñ
 
.
ñ
ñ
 
	MarkLabel
ñ
ñ
  
(
ñ
ñ
  !
notNull
ñ
ñ
! (
)
ñ
ñ
( )
;
ñ
ñ
) *
if
ó
ó
 
(
ó
ó
 
prop
ó
ó
 
.
ó
ó
 
PropertyType
ó
ó
 )
==
ó
ó
* ,
typeof
ó
ó
- 3
(
ó
ó
3 4
string
ó
ó
4 :
)
ó
ó
: ;
)
ó
ó
; <
{
ò
ò
 
il
ô
ô
 
.
ô
ô
 
Emit
ô
ô
 
(
ô
ô
  
OpCodes
ô
ô
  '
.
ô
ô
' (
Dup
ô
ô
( +
)
ô
ô
+ ,
;
ô
ô
, -
il
ö
ö
 
.
ö
ö
 
EmitCall
ö
ö
 #
(
ö
ö
# $
OpCodes
ö
ö
$ +
.
ö
ö
+ ,
Callvirt
ö
ö
, 4
,
ö
ö
4 5
typeof
ö
ö
6 <
(
ö
ö
< =
string
ö
ö
= C
)
ö
ö
C D
.
ö
ö
D E
GetProperty
ö
ö
E P
(
ö
ö
P Q
$str
ö
ö
Q Y
)
ö
ö
Y Z
.
ö
ö
Z [
GetGetMethod
ö
ö
[ g
(
ö
ö
g h
)
ö
ö
h i
,
ö
ö
i j
null
ö
ö
k o
)
ö
ö
o p
;
ö
ö
p q
	EmitInt32
õ
õ
 !
(
õ
õ
! "
il
õ
õ
" $
,
õ
õ
$ %
$num
õ
õ
& *
)
õ
õ
* +
;
õ
õ
+ ,
il
ú
ú
 
.
ú
ú
 
Emit
ú
ú
 
(
ú
ú
  
OpCodes
ú
ú
  '
.
ú
ú
' (
Cgt
ú
ú
( +
)
ú
ú
+ ,
;
ú
ú
, -
Label
ù
ù
 
isLong
ù
ù
 $
=
ù
ù
% &
il
ù
ù
' )
.
ù
ù
) *
DefineLabel
ù
ù
* 5
(
ù
ù
5 6
)
ù
ù
6 7
,
ù
ù
7 8
lenDone
ù
ù
9 @
=
ù
ù
A B
il
ù
ù
C E
.
ù
ù
E F
DefineLabel
ù
ù
F Q
(
ù
ù
Q R
)
ù
ù
R S
;
ù
ù
S T
il
û
û
 
.
û
û
 
Emit
û
û
 
(
û
û
  
OpCodes
û
û
  '
.
û
û
' (
Brtrue_S
û
û
( 0
,
û
û
0 1
isLong
û
û
2 8
)
û
û
8 9
;
û
û
9 :
	EmitInt32
ü
ü
 !
(
ü
ü
! "
il
ü
ü
" $
,
ü
ü
$ %
$num
ü
ü
& *
)
ü
ü
* +
;
ü
ü
+ ,
il
†
†
 
.
†
†
 
Emit
†
†
 
(
†
†
  
OpCodes
†
†
  '
.
†
†
' (
Br_S
†
†
( ,
,
†
†
, -
lenDone
†
†
. 5
)
†
†
5 6
;
†
†
6 7
il
°
°
 
.
°
°
 
	MarkLabel
°
°
 $
(
°
°
$ %
isLong
°
°
% +
)
°
°
+ ,
;
°
°
, -
	EmitInt32
¢
¢
 !
(
¢
¢
! "
il
¢
¢
" $
,
¢
¢
$ %
-
¢
¢
& '
$num
¢
¢
' (
)
¢
¢
( )
;
¢
¢
) *
il
£
£
 
.
£
£
 
	MarkLabel
£
£
 $
(
£
£
$ %
lenDone
£
£
% ,
)
£
£
, -
;
£
£
- .
il
§
§
 
.
§
§
 
Emit
§
§
 
(
§
§
  
OpCodes
§
§
  '
.
§
§
' (
Stloc_1
§
§
( /
)
§
§
/ 0
;
§
§
0 1
}
•
•
 
if
¶
¶
 
(
¶
¶
 
prop
¶
¶
 
.
¶
¶
 
PropertyType
¶
¶
 )
==
¶
¶
* ,
typeof
¶
¶
- 3
(
¶
¶
3 4
System
¶
¶
4 :
.
¶
¶
: ;
Data
¶
¶
; ?
.
¶
¶
? @
Linq
¶
¶
@ D
.
¶
¶
D E
Binary
¶
¶
E K
)
¶
¶
K L
)
¶
¶
L M
{
ß
ß
 
il
®
®
 
.
®
®
 
EmitCall
®
®
 #
(
®
®
# $
OpCodes
®
®
$ +
.
®
®
+ ,
Callvirt
®
®
, 4
,
®
®
4 5
typeof
®
®
6 <
(
®
®
< =
System
®
®
= C
.
®
®
C D
Data
®
®
D H
.
®
®
H I
Linq
®
®
I M
.
®
®
M N
Binary
®
®
N T
)
®
®
T U
.
®
®
U V
	GetMethod
®
®
V _
(
®
®
_ `
$str
®
®
` i
,
®
®
i j
BindingFlags
®
®
k w
.
®
®
w x
Public
®
®
x ~
|®
®
 Ä
BindingFlags®
®
Å ç
.®
®
ç é
Instance®
®
é ñ
)®
®
ñ ó
,®
®
ó ò
null®
®
ô ù
)®
®
ù û
;®
®
û ü
}
©
©
 
if
™
™
 
(
™
™
 
allDone
™
™
 
!=
™
™
  "
null
™
™
# '
)
™
™
' (
il
™
™
) +
.
™
™
+ ,
	MarkLabel
™
™
, 5
(
™
™
5 6
allDone
™
™
6 =
.
™
™
= >
Value
™
™
> C
)
™
™
C D
;
™
™
D E
}
¨
¨
 
il
≠
≠
 
.
≠
≠
 
EmitCall
≠
≠
 
(
≠
≠
 
OpCodes
≠
≠
 #
.
≠
≠
# $
Callvirt
≠
≠
$ ,
,
≠
≠
, -
typeof
≠
≠
. 4
(
≠
≠
4 5
IDataParameter
≠
≠
5 C
)
≠
≠
C D
.
≠
≠
D E
GetProperty
≠
≠
E P
(
≠
≠
P Q
$str
≠
≠
Q X
)
≠
≠
X Y
.
≠
≠
Y Z
GetSetMethod
≠
≠
Z f
(
≠
≠
f g
)
≠
≠
g h
,
≠
≠
h i
null
≠
≠
j n
)
≠
≠
n o
;
≠
≠
o p
if
Ø
Ø
 
(
Ø
Ø
 
prop
Ø
Ø
 
.
Ø
Ø
 
PropertyType
Ø
Ø
 %
==
Ø
Ø
& (
typeof
Ø
Ø
) /
(
Ø
Ø
/ 0
string
Ø
Ø
0 6
)
Ø
Ø
6 7
)
Ø
Ø
7 8
{
∞
∞
 
var
±
±
 
	endOfSize
±
±
 !
=
±
±
" #
il
±
±
$ &
.
±
±
& '
DefineLabel
±
±
' 2
(
±
±
2 3
)
±
±
3 4
;
±
±
4 5
il
≥
≥
 
.
≥
≥
 
Emit
≥
≥
 
(
≥
≥
 
OpCodes
≥
≥
 #
.
≥
≥
# $
Ldloc_1
≥
≥
$ +
)
≥
≥
+ ,
;
≥
≥
, -
il
¥
¥
 
.
¥
¥
 
Emit
¥
¥
 
(
¥
¥
 
OpCodes
¥
¥
 #
.
¥
¥
# $
	Brfalse_S
¥
¥
$ -
,
¥
¥
- .
	endOfSize
¥
¥
/ 8
)
¥
¥
8 9
;
¥
¥
9 :
il
∂
∂
 
.
∂
∂
 
Emit
∂
∂
 
(
∂
∂
 
OpCodes
∂
∂
 #
.
∂
∂
# $
Dup
∂
∂
$ '
)
∂
∂
' (
;
∂
∂
( )
il
∑
∑
 
.
∑
∑
 
Emit
∑
∑
 
(
∑
∑
 
OpCodes
∑
∑
 #
.
∑
∑
# $
Ldloc_1
∑
∑
$ +
)
∑
∑
+ ,
;
∑
∑
, -
il
∏
∏
 
.
∏
∏
 
EmitCall
∏
∏
 
(
∏
∏
  
OpCodes
∏
∏
  '
.
∏
∏
' (
Callvirt
∏
∏
( 0
,
∏
∏
0 1
typeof
∏
∏
2 8
(
∏
∏
8 9
IDbDataParameter
∏
∏
9 I
)
∏
∏
I J
.
∏
∏
J K
GetProperty
∏
∏
K V
(
∏
∏
V W
$str
∏
∏
W ]
)
∏
∏
] ^
.
∏
∏
^ _
GetSetMethod
∏
∏
_ k
(
∏
∏
k l
)
∏
∏
l m
,
∏
∏
m n
null
∏
∏
o s
)
∏
∏
s t
;
∏
∏
t u
il
∫
∫
 
.
∫
∫
 
	MarkLabel
∫
∫
  
(
∫
∫
  !
	endOfSize
∫
∫
! *
)
∫
∫
* +
;
∫
∫
+ ,
}
ª
ª
 
il
Ω
Ω
 
.
Ω
Ω
 
EmitCall
Ω
Ω
 
(
Ω
Ω
 
OpCodes
Ω
Ω
 #
.
Ω
Ω
# $
Callvirt
Ω
Ω
$ ,
,
Ω
Ω
, -
typeof
Ω
Ω
. 4
(
Ω
Ω
4 5
IList
Ω
Ω
5 :
)
Ω
Ω
: ;
.
Ω
Ω
; <
	GetMethod
Ω
Ω
< E
(
Ω
Ω
E F
$str
Ω
Ω
F K
)
Ω
Ω
K L
,
Ω
Ω
L M
null
Ω
Ω
N R
)
Ω
Ω
R S
;
Ω
Ω
S T
il
æ
æ
 
.
æ
æ
 
Emit
æ
æ
 
(
æ
æ
 
OpCodes
æ
æ
 
.
æ
æ
  
Pop
æ
æ
  #
)
æ
æ
# $
;
æ
æ
$ %
}
ø
ø
 
il
¡
¡
 
.
¡
¡
 
Emit
¡
¡
 
(
¡
¡
 
OpCodes
¡
¡
 
.
¡
¡
 
Pop
¡
¡
 
)
¡
¡
  
;
¡
¡
  !
il
¬
¬
 
.
¬
¬
 
Emit
¬
¬
 
(
¬
¬
 
OpCodes
¬
¬
 
.
¬
¬
 
Ret
¬
¬
 
)
¬
¬
  
;
¬
¬
  !
return
√
√
 
(
√
√
 
Action
√
√
 
<
√
√
 

IDbCommand
√
√
 %
,
√
√
% &
object
√
√
' -
>
√
√
- .
)
√
√
. /
dm
√
√
/ 1
.
√
√
1 2
CreateDelegate
√
√
2 @
(
√
√
@ A
typeof
√
√
A G
(
√
√
G H
Action
√
√
H N
<
√
√
N O

IDbCommand
√
√
O Y
,
√
√
Y Z
object
√
√
[ a
>
√
√
a b
)
√
√
b c
)
√
√
c d
;
√
√
d e
}
ƒ
ƒ
 	
private
∆
∆
 
static
∆
∆
 

IDbCommand
∆
∆
 !
SetupCommand
∆
∆
" .
(
∆
∆
. /
IDbConnection
∆
∆
/ <
cnn
∆
∆
= @
,
∆
∆
@ A
IDbTransaction
∆
∆
B P
transaction
∆
∆
Q \
,
∆
∆
\ ]
string
∆
∆
^ d
sql
∆
∆
e h
,
∆
∆
h i
Action
∆
∆
j p
<
∆
∆
p q

IDbCommand
∆
∆
q {
,
∆
∆
{ |
object∆
∆
} É
>∆
∆
É Ñ
paramReader∆
∆
Ö ê
,∆
∆
ê ë
object∆
∆
í ò
obj∆
∆
ô ú
,∆
∆
ú ù
int∆
∆
û °
?∆
∆
° ¢
commandTimeout∆
∆
£ ±
,∆
∆
± ≤
CommandType∆
∆
≥ æ
?∆
∆
æ ø
commandType∆
∆
¿ À
)∆
∆
À Ã
{
«
«
 	
var
»
»
 
cmd
»
»
 
=
»
»
 
cnn
»
»
 
.
»
»
 
CreateCommand
»
»
 '
(
»
»
' (
)
»
»
( )
;
»
»
) *
var
…
…
 

bindByName
…
…
 
=
…
…
 
GetBindByName
…
…
 *
(
…
…
* +
cmd
…
…
+ .
.
…
…
. /
GetType
…
…
/ 6
(
…
…
6 7
)
…
…
7 8
)
…
…
8 9
;
…
…
9 :
if
 
 
 
(
 
 
 

bindByName
 
 
 
!=
 
 
 
null
 
 
 "
)
 
 
" #

bindByName
 
 
$ .
(
 
 
. /
cmd
 
 
/ 2
,
 
 
2 3
true
 
 
4 8
)
 
 
8 9
;
 
 
9 :
cmd
À
À
 
.
À
À
 
Transaction
À
À
 
=
À
À
 
transaction
À
À
 )
;
À
À
) *
cmd
Ã
Ã
 
.
Ã
Ã
 
CommandText
Ã
Ã
 
=
Ã
Ã
 
sql
Ã
Ã
 !
;
Ã
Ã
! "
if
Õ
Õ
 
(
Õ
Õ
 
commandTimeout
Õ
Õ
 
.
Õ
Õ
 
HasValue
Õ
Õ
 '
)
Õ
Õ
' (
cmd
Œ
Œ
 
.
Œ
Œ
 
CommandTimeout
Œ
Œ
 "
=
Œ
Œ
# $
commandTimeout
Œ
Œ
% 3
.
Œ
Œ
3 4
Value
Œ
Œ
4 9
;
Œ
Œ
9 :
if
œ
œ
 
(
œ
œ
 
commandType
œ
œ
 
.
œ
œ
 
HasValue
œ
œ
 $
)
œ
œ
$ %
cmd
–
–
 
.
–
–
 
CommandType
–
–
 
=
–
–
  !
commandType
–
–
" -
.
–
–
- .
Value
–
–
. 3
;
–
–
3 4
if
—
—
 
(
—
—
 
paramReader
—
—
 
!=
—
—
 
null
—
—
 #
)
—
—
# $
{
“
“
 
paramReader
”
”
 
(
”
”
 
cmd
”
”
 
,
”
”
  
obj
”
”
! $
)
”
”
$ %
;
”
”
% &
}
‘
‘
 
return
’
’
 
cmd
’
’
 
;
’
’
 
}
÷
÷
 	
private
Ÿ
Ÿ
 
static
Ÿ
Ÿ
 
int
Ÿ
Ÿ
 
ExecuteCommand
Ÿ
Ÿ
 )
(
Ÿ
Ÿ
) *
IDbConnection
Ÿ
Ÿ
* 7
cnn
Ÿ
Ÿ
8 ;
,
Ÿ
Ÿ
; <
IDbTransaction
Ÿ
Ÿ
= K
transaction
Ÿ
Ÿ
L W
,
Ÿ
Ÿ
W X
string
Ÿ
Ÿ
Y _
sql
Ÿ
Ÿ
` c
,
Ÿ
Ÿ
c d
Action
Ÿ
Ÿ
e k
<
Ÿ
Ÿ
k l

IDbCommand
Ÿ
Ÿ
l v
,
Ÿ
Ÿ
v w
object
Ÿ
Ÿ
x ~
>
Ÿ
Ÿ
~ 
paramReaderŸ
Ÿ
Ä ã
,Ÿ
Ÿ
ã å
objectŸ
Ÿ
ç ì
objŸ
Ÿ
î ó
,Ÿ
Ÿ
ó ò
intŸ
Ÿ
ô ú
?Ÿ
Ÿ
ú ù
commandTimeoutŸ
Ÿ
û ¨
,Ÿ
Ÿ
¨ ≠
CommandTypeŸ
Ÿ
Æ π
?Ÿ
Ÿ
π ∫
commandTypeŸ
Ÿ
ª ∆
)Ÿ
Ÿ
∆ «
{
⁄
⁄
 	
using
€
€
 
(
€
€
 
var
€
€
 
cmd
€
€
 
=
€
€
 
SetupCommand
€
€
 )
(
€
€
) *
cnn
€
€
* -
,
€
€
- .
transaction
€
€
/ :
,
€
€
: ;
sql
€
€
< ?
,
€
€
? @
paramReader
€
€
A L
,
€
€
L M
obj
€
€
N Q
,
€
€
Q R
commandTimeout
€
€
S a
,
€
€
a b
commandType
€
€
c n
)
€
€
n o
)
€
€
o p
{
‹
‹
 
return
›
›
 
cmd
›
›
 
.
›
›
 
ExecuteNonQuery
›
›
 *
(
›
›
* +
)
›
›
+ ,
;
›
›
, -
}
ﬁ
ﬁ
 
}
ﬂ
ﬂ
 	
private
·
·
 
static
·
·
 
Func
·
·
 
<
·
·
 
IDataReader
·
·
 '
,
·
·
' (
object
·
·
) /
>
·
·
/ 0#
GetStructDeserializer
·
·
1 F
(
·
·
F G
Type
·
·
G K
type
·
·
L P
,
·
·
P Q
int
·
·
R U
index
·
·
V [
)
·
·
[ \
{
‚
‚
 	
if
Â
Â
 
(
Â
Â
 
type
Â
Â
 
==
Â
Â
 
typeof
Â
Â
 
(
Â
Â
 
char
Â
Â
 #
)
Â
Â
# $
)
Â
Â
$ %
{
Ê
Ê
 
return
Á
Á
 
r
Á
Á
 
=>
Á
Á
 
	SqlMapper
Á
Á
 %
.
Á
Á
% &
ReadChar
Á
Á
& .
(
Á
Á
. /
r
Á
Á
/ 0
.
Á
Á
0 1
GetValue
Á
Á
1 9
(
Á
Á
9 :
index
Á
Á
: ?
)
Á
Á
? @
)
Á
Á
@ A
;
Á
Á
A B
}
Ë
Ë
 
if
È
È
 
(
È
È
 
type
È
È
 
==
È
È
 
typeof
È
È
 
(
È
È
 
char
È
È
 #
?
È
È
# $
)
È
È
$ %
)
È
È
% &
{
Í
Í
 
return
Î
Î
 
r
Î
Î
 
=>
Î
Î
 
	SqlMapper
Î
Î
 %
.
Î
Î
% &
ReadNullableChar
Î
Î
& 6
(
Î
Î
6 7
r
Î
Î
7 8
.
Î
Î
8 9
GetValue
Î
Î
9 A
(
Î
Î
A B
index
Î
Î
B G
)
Î
Î
G H
)
Î
Î
H I
;
Î
Î
I J
}
Ï
Ï
 
if
Ì
Ì
 
(
Ì
Ì
 
type
Ì
Ì
 
==
Ì
Ì
 
typeof
Ì
Ì
 
(
Ì
Ì
 
System
Ì
Ì
 %
.
Ì
Ì
% &
Data
Ì
Ì
& *
.
Ì
Ì
* +
Linq
Ì
Ì
+ /
.
Ì
Ì
/ 0
Binary
Ì
Ì
0 6
)
Ì
Ì
6 7
)
Ì
Ì
7 8
{
Ó
Ó
 
return
Ô
Ô
 
r
Ô
Ô
 
=>
Ô
Ô
 
new
Ô
Ô
 
System
Ô
Ô
  &
.
Ô
Ô
& '
Data
Ô
Ô
' +
.
Ô
Ô
+ ,
Linq
Ô
Ô
, 0
.
Ô
Ô
0 1
Binary
Ô
Ô
1 7
(
Ô
Ô
7 8
(
Ô
Ô
8 9
byte
Ô
Ô
9 =
[
Ô
Ô
= >
]
Ô
Ô
> ?
)
Ô
Ô
? @
r
Ô
Ô
@ A
.
Ô
Ô
A B
GetValue
Ô
Ô
B J
(
Ô
Ô
J K
index
Ô
Ô
K P
)
Ô
Ô
P Q
)
Ô
Ô
Q R
;
Ô
Ô
R S
}


 
return
Ú
Ú
 
r
Ú
Ú
 
=>
Ú
Ú
 
{
Û
Û
 
var
Ù
Ù
 
val
Ù
Ù
 
=
Ù
Ù
 
r
Ù
Ù
 
.
Ù
Ù
 
GetValue
Ù
Ù
 $
(
Ù
Ù
$ %
index
Ù
Ù
% *
)
Ù
Ù
* +
;
Ù
Ù
+ ,
return
ı
ı
 
val
ı
ı
 
is
ı
ı
 
DBNull
ı
ı
 $
?
ı
ı
% &
null
ı
ı
' +
:
ı
ı
, -
val
ı
ı
. 1
;
ı
ı
1 2
}
ˆ
ˆ
 
;
ˆ
ˆ
 
}
˜
˜
 	
static
˘
˘
 
readonly
˘
˘
 

MethodInfo
˘
˘
 "
	enumParse
˙
˙
 
=
˙
˙
 
typeof
˙
˙
  &
(
˙
˙
& '
Enum
˙
˙
' +
)
˙
˙
+ ,
.
˙
˙
, -
	GetMethod
˙
˙
- 6
(
˙
˙
6 7
$str
˙
˙
7 >
,
˙
˙
> ?
new
˙
˙
@ C
Type
˙
˙
D H
[
˙
˙
H I
]
˙
˙
I J
{
˙
˙
K L
typeof
˙
˙
M S
(
˙
˙
S T
Type
˙
˙
T X
)
˙
˙
X Y
,
˙
˙
Y Z
typeof
˙
˙
[ a
(
˙
˙
a b
string
˙
˙
b h
)
˙
˙
h i
,
˙
˙
i j
typeof
˙
˙
k q
(
˙
˙
q r
bool
˙
˙
r v
)
˙
˙
v w
}
˙
˙
x y
)
˙
˙
y z
,
˙
˙
z {
getItem
˚
˚
 
=
˚
˚
 
typeof
˚
˚
 $
(
˚
˚
$ %
IDataRecord
˚
˚
% 0
)
˚
˚
0 1
.
˚
˚
1 2
GetProperties
˚
˚
2 ?
(
˚
˚
? @
BindingFlags
˚
˚
@ L
.
˚
˚
L M
Instance
˚
˚
M U
|
˚
˚
V W
BindingFlags
˚
˚
X d
.
˚
˚
d e
Public
˚
˚
e k
)
˚
˚
k l
.
¸
¸
 
Where
¸
¸
 
(
¸
¸
 
p
¸
¸
  
=>
¸
¸
! #
p
¸
¸
$ %
.
¸
¸
% & 
GetIndexParameters
¸
¸
& 8
(
¸
¸
8 9
)
¸
¸
9 :
.
¸
¸
: ;
Any
¸
¸
; >
(
¸
¸
> ?
)
¸
¸
? @
&&
¸
¸
A C
p
¸
¸
D E
.
¸
¸
E F 
GetIndexParameters
¸
¸
F X
(
¸
¸
X Y
)
¸
¸
Y Z
[
¸
¸
Z [
$num
¸
¸
[ \
]
¸
¸
\ ]
.
¸
¸
] ^
ParameterType
¸
¸
^ k
==
¸
¸
l n
typeof
¸
¸
o u
(
¸
¸
u v
int
¸
¸
v y
)
¸
¸
y z
)
¸
¸
z {
.
˝
˝
 
Select
˝
˝
 
(
˝
˝
  
p
˝
˝
  !
=>
˝
˝
" $
p
˝
˝
% &
.
˝
˝
& '
GetGetMethod
˝
˝
' 3
(
˝
˝
3 4
)
˝
˝
4 5
)
˝
˝
5 6
.
˝
˝
6 7
First
˝
˝
7 <
(
˝
˝
< =
)
˝
˝
= >
;
˝
˝
> ?
class
ˇ
ˇ
 
PropInfo
ˇ
ˇ
 
{
ÄÄ 	
public
ÅÅ 
string
ÅÅ 
Name
ÅÅ 
{
ÅÅ  
get
ÅÅ! $
;
ÅÅ$ %
set
ÅÅ& )
;
ÅÅ) *
}
ÅÅ+ ,
public
ÇÇ 

MethodInfo
ÇÇ 
Setter
ÇÇ $
{
ÇÇ% &
get
ÇÇ' *
;
ÇÇ* +
set
ÇÇ, /
;
ÇÇ/ 0
}
ÇÇ1 2
public
ÉÉ 
Type
ÉÉ 
Type
ÉÉ 
{
ÉÉ 
get
ÉÉ "
;
ÉÉ" #
set
ÉÉ$ '
;
ÉÉ' (
}
ÉÉ) *
}
ÑÑ 	
static
ÜÜ 
List
ÜÜ 
<
ÜÜ 
PropInfo
ÜÜ 
>
ÜÜ 
GetSettableProps
ÜÜ .
(
ÜÜ. /
Type
ÜÜ/ 3
t
ÜÜ4 5
)
ÜÜ5 6
{
áá 	
return
àà 
t
àà 
.
ââ 
GetProperties
ââ  
(
ââ  !
BindingFlags
ââ! -
.
ââ- .
Public
ââ. 4
|
ââ5 6
BindingFlags
ââ7 C
.
ââC D
	NonPublic
ââD M
|
ââN O
BindingFlags
ââP \
.
ââ\ ]
Instance
ââ] e
)
ââe f
.
ää 
Select
ää 
(
ää 
p
ää 
=>
ää 
new
ää "
PropInfo
ää# +
{
ãã 
Name
åå 
=
åå 
p
åå 
.
åå 
Name
åå #
,
åå# $
Setter
çç 
=
çç 
p
çç  
.
çç  !
DeclaringType
çç! .
==
çç/ 1
t
çç2 3
?
çç4 5
p
çç6 7
.
çç7 8
GetSetMethod
çç8 D
(
ççD E
true
ççE I
)
ççI J
:
ççK L
p
ççM N
.
ççN O
DeclaringType
ççO \
.
çç\ ]
GetProperty
çç] h
(
ççh i
p
ççi j
.
ççj k
Name
ççk o
)
çço p
.
ççp q
GetSetMethod
ççq }
(
çç} ~
trueçç~ Ç
)ççÇ É
,ççÉ Ñ
Type
éé 
=
éé 
p
éé 
.
éé 
PropertyType
éé +
}
èè 
)
èè 
.
êê 
Where
êê 
(
êê 
info
êê 
=>
êê  
info
êê! %
.
êê% &
Setter
êê& ,
!=
êê- /
null
êê0 4
)
êê4 5
.
ëë 
ToList
ëë 
(
ëë 
)
ëë 
;
ëë 
}
íí 	
static
îî 
List
îî 
<
îî 
	FieldInfo
îî 
>
îî 
GetSettableFields
îî 0
(
îî0 1
Type
îî1 5
t
îî6 7
)
îî7 8
{
ïï 	
return
ññ 
t
ññ 
.
ññ 
	GetFields
ññ 
(
ññ 
BindingFlags
ññ +
.
ññ+ ,
Public
ññ, 2
|
ññ3 4
BindingFlags
ññ5 A
.
ññA B
	NonPublic
ññB K
|
ññL M
BindingFlags
ññN Z
.
ññZ [
Instance
ññ[ c
)
ññc d
.
ññd e
ToList
ññe k
(
ññk l
)
ññl m
;
ññm n
}
óó 	
public
¢¢ 
static
¢¢ 
Func
¢¢ 
<
¢¢ 
IDataReader
¢¢ &
,
¢¢& '
object
¢¢( .
>
¢¢. /"
GetClassDeserializer
¢¢0 D
(
¢¢D E
Type¶¶ 
type
¶¶ 	
,
¶¶	 

IDataReader
¶¶ 
reader
¶¶ 
,
¶¶ 
int
¶¶ "

startBound
¶¶# -
=
¶¶. /
$num
¶¶0 1
,
¶¶1 2
int
¶¶3 6
length
¶¶7 =
=
¶¶> ?
-
¶¶@ A
$num
¶¶A B
,
¶¶B C
bool
¶¶D H&
returnNullIfFirstMissing
¶¶I a
=
¶¶b c
false
¶¶d i
)®® 
{
©© 	
var
™™ 
dm
™™ 
=
™™ 
new
™™ 
DynamicMethod
™™ &
(
™™& '
string
™™' -
.
™™- .
Format
™™. 4
(
™™4 5
$str
™™5 E
,
™™E F
Guid
™™G K
.
™™K L
NewGuid
™™L S
(
™™S T
)
™™T U
)
™™U V
,
™™V W
type
™™X \
,
™™\ ]
new
™™^ a
[
™™a b
]
™™b c
{
™™d e
typeof
™™f l
(
™™l m
IDataReader
™™m x
)
™™x y
}
™™z {
,
™™{ |
true™™} Å
)™™Å Ç
;™™Ç É
var
¨¨ 
il
¨¨ 
=
¨¨ 
dm
¨¨ 
.
¨¨ 
GetILGenerator
¨¨ &
(
¨¨& '
)
¨¨' (
;
¨¨( )
il
≠≠ 
.
≠≠ 
DeclareLocal
≠≠ 
(
≠≠ 
typeof
≠≠ "
(
≠≠" #
int
≠≠# &
)
≠≠& '
)
≠≠' (
;
≠≠( )
il
ÆÆ 
.
ÆÆ 
DeclareLocal
ÆÆ 
(
ÆÆ 
type
ÆÆ  
)
ÆÆ  !
;
ÆÆ! "
bool
ØØ 
haveEnumLocal
ØØ 
=
ØØ  
false
ØØ! &
;
ØØ& '
il
∞∞ 
.
∞∞ 
Emit
∞∞ 
(
∞∞ 
OpCodes
∞∞ 
.
∞∞ 
Ldc_I4_0
∞∞ $
)
∞∞$ %
;
∞∞% &
il
±± 
.
±± 
Emit
±± 
(
±± 
OpCodes
±± 
.
±± 
Stloc_0
±± #
)
±±# $
;
±±$ %
var
≤≤ 

properties
≤≤ 
=
≤≤ 
GetSettableProps
≤≤ -
(
≤≤- .
type
≤≤. 2
)
≤≤2 3
;
≤≤3 4
var
≥≥ 
fields
≥≥ 
=
≥≥ 
GetSettableFields
≥≥ *
(
≥≥* +
type
≥≥+ /
)
≥≥/ 0
;
≥≥0 1
if
¥¥ 
(
¥¥ 
length
¥¥ 
==
¥¥ 
-
¥¥ 
$num
¥¥ 
)
¥¥ 
{
µµ 
length
∂∂ 
=
∂∂ 
reader
∂∂ 
.
∂∂  

FieldCount
∂∂  *
-
∂∂+ ,

startBound
∂∂- 7
;
∂∂7 8
}
∑∑ 
if
ππ 
(
ππ 
reader
ππ 
.
ππ 

FieldCount
ππ !
<=
ππ" $

startBound
ππ% /
)
ππ/ 0
{
∫∫ 
throw
ªª 
new
ªª 
ArgumentException
ªª +
(
ªª+ ,
$strªª, è
,ªªè ê
$strªªë ö
)ªªö õ
;ªªõ ú
}
ºº 
var
ææ 
names
ææ 
=
ææ 
new
ææ 
List
ææ  
<
ææ  !
string
ææ! '
>
ææ' (
(
ææ( )
)
ææ) *
;
ææ* +
for
¿¿ 
(
¿¿ 
int
¿¿ 
i
¿¿ 
=
¿¿ 

startBound
¿¿ #
;
¿¿# $
i
¿¿% &
<
¿¿' (

startBound
¿¿) 3
+
¿¿4 5
length
¿¿6 <
;
¿¿< =
i
¿¿> ?
++
¿¿? A
)
¿¿A B
{
¡¡ 
names
¬¬ 
.
¬¬ 
Add
¬¬ 
(
¬¬ 
reader
¬¬  
.
¬¬  !
GetName
¬¬! (
(
¬¬( )
i
¬¬) *
)
¬¬* +
)
¬¬+ ,
;
¬¬, -
}
√√ 
var
≈≈ 
setters
≈≈ 
=
≈≈ 
(
≈≈ 
from
∆∆  
n
∆∆! "
in
∆∆# %
names
∆∆& +
let
«« 
prop
««  $
=
««% &

properties
««' 1
.
««1 2
FirstOrDefault
««2 @
(
««@ A
p
««A B
=>
««C E
string
««F L
.
««L M
Equals
««M S
(
««S T
p
««T U
.
««U V
Name
««V Z
,
««Z [
n
««\ ]
,
««] ^
StringComparison
««_ o
.
««o p
Ordinal
««p w
)
««w x
)
««x y
??
»»" $

properties
»»% /
.
»»/ 0
FirstOrDefault
»»0 >
(
»»> ?
p
»»? @
=>
»»A C
string
»»D J
.
»»J K
Equals
»»K Q
(
»»Q R
p
»»R S
.
»»S T
Name
»»T X
,
»»X Y
n
»»Z [
,
»»[ \
StringComparison
»»] m
.
»»m n
OrdinalIgnoreCase
»»n 
)»» Ä
)»»Ä Å
let
…… 
field
……  %
=
……& '
prop
……( ,
!=
……- /
null
……0 4
?
……5 6
null
……7 ;
:
……< =
(
……> ?
fields
……? E
.
……E F
FirstOrDefault
……F T
(
……T U
p
……U V
=>
……W Y
string
……Z `
.
……` a
Equals
……a g
(
……g h
p
……h i
.
……i j
Name
……j n
,
……n o
n
……p q
,
……q r
StringComparison……s É
.……É Ñ
Ordinal……Ñ ã
)……ã å
)……å ç
??
    "
fields
  # )
.
  ) *
FirstOrDefault
  * 8
(
  8 9
p
  9 :
=>
  ; =
string
  > D
.
  D E
Equals
  E K
(
  K L
p
  L M
.
  M N
Name
  N R
,
  R S
n
  T U
,
  U V
StringComparison
  W g
.
  g h
OrdinalIgnoreCase
  h y
)
  y z
)
  z {
)
  { |
select
ÀÀ "
new
ÀÀ# &
{
ÀÀ' (
Name
ÀÀ) -
=
ÀÀ. /
n
ÀÀ0 1
,
ÀÀ1 2
Property
ÀÀ3 ;
=
ÀÀ< =
prop
ÀÀ> B
,
ÀÀB C
Field
ÀÀD I
=
ÀÀJ K
field
ÀÀL Q
}
ÀÀR S
)
ÃÃ 
.
ÃÃ 
ToList
ÃÃ "
(
ÃÃ" #
)
ÃÃ# $
;
ÃÃ$ %
int
ŒŒ 
index
ŒŒ 
=
ŒŒ 

startBound
ŒŒ "
;
ŒŒ" #
il
–– 
.
–– !
BeginExceptionBlock
–– "
(
––" #
)
––# $
;
––$ %
il
““ 
.
““ 
Emit
““ 
(
““ 
OpCodes
““ 
.
““ 
Newobj
““ "
,
““" #
type
““$ (
.
““( )
GetConstructor
““) 7
(
““7 8
BindingFlags
““8 D
.
““D E
Instance
““E M
|
““N O
BindingFlags
““P \
.
““\ ]
Public
““] c
|
““d e
BindingFlags
““f r
.
““r s
	NonPublic
““s |
,
““| }
null““~ Ç
,““Ç É
Type““Ñ à
.““à â

EmptyTypes““â ì
,““ì î
null““ï ô
)““ô ö
)““ö õ
;““õ ú
bool
”” 
first
”” 
=
”” 
true
”” 
;
”” 
var
‘‘ 
allDone
‘‘ 
=
‘‘ 
il
‘‘ 
.
‘‘ 
DefineLabel
‘‘ (
(
‘‘( )
)
‘‘) *
;
‘‘* +
foreach
’’ 
(
’’ 
var
’’ 
item
’’ 
in
’’  
setters
’’! (
)
’’( )
{
÷÷ 
if
◊◊ 
(
◊◊ 
item
◊◊ 
.
◊◊ 
Property
◊◊ !
!=
◊◊" $
null
◊◊% )
||
◊◊* ,
item
◊◊- 1
.
◊◊1 2
Field
◊◊2 7
!=
◊◊8 :
null
◊◊; ?
)
◊◊? @
{
ÿÿ 
il
ŸŸ 
.
ŸŸ 
Emit
ŸŸ 
(
ŸŸ 
OpCodes
ŸŸ #
.
ŸŸ# $
Dup
ŸŸ$ '
)
ŸŸ' (
;
ŸŸ( )
Label
⁄⁄ 
isDbNullLabel
⁄⁄ '
=
⁄⁄( )
il
⁄⁄* ,
.
⁄⁄, -
DefineLabel
⁄⁄- 8
(
⁄⁄8 9
)
⁄⁄9 :
;
⁄⁄: ;
Label
€€ 
finishLabel
€€ %
=
€€& '
il
€€( *
.
€€* +
DefineLabel
€€+ 6
(
€€6 7
)
€€7 8
;
€€8 9
il
›› 
.
›› 
Emit
›› 
(
›› 
OpCodes
›› #
.
››# $
Ldarg_0
››$ +
)
››+ ,
;
››, -
	EmitInt32
ﬁﬁ 
(
ﬁﬁ 
il
ﬁﬁ  
,
ﬁﬁ  !
index
ﬁﬁ" '
)
ﬁﬁ' (
;
ﬁﬁ( )
il
ﬂﬂ 
.
ﬂﬂ 
Emit
ﬂﬂ 
(
ﬂﬂ 
OpCodes
ﬂﬂ #
.
ﬂﬂ# $
Dup
ﬂﬂ$ '
)
ﬂﬂ' (
;
ﬂﬂ( )
il
‡‡ 
.
‡‡ 
Emit
‡‡ 
(
‡‡ 
OpCodes
‡‡ #
.
‡‡# $
Stloc_0
‡‡$ +
)
‡‡+ ,
;
‡‡, -
il
·· 
.
·· 
Emit
·· 
(
·· 
OpCodes
·· #
.
··# $
Callvirt
··$ ,
,
··, -
getItem
··. 5
)
··5 6
;
··6 7
Type
‰‰ 

memberType
‰‰ #
=
‰‰$ %
item
‰‰& *
.
‰‰* +
Property
‰‰+ 3
!=
‰‰4 6
null
‰‰7 ;
?
‰‰< =
item
‰‰> B
.
‰‰B C
Property
‰‰C K
.
‰‰K L
Type
‰‰L P
:
‰‰Q R
item
‰‰S W
.
‰‰W X
Field
‰‰X ]
.
‰‰] ^
	FieldType
‰‰^ g
;
‰‰g h
if
ÊÊ 
(
ÊÊ 

memberType
ÊÊ "
==
ÊÊ# %
typeof
ÊÊ& ,
(
ÊÊ, -
char
ÊÊ- 1
)
ÊÊ1 2
||
ÊÊ3 5

memberType
ÊÊ6 @
==
ÊÊA C
typeof
ÊÊD J
(
ÊÊJ K
char
ÊÊK O
?
ÊÊO P
)
ÊÊP Q
)
ÊÊQ R
{
ÁÁ 
il
ËË 
.
ËË 
EmitCall
ËË #
(
ËË# $
OpCodes
ËË$ +
.
ËË+ ,
Call
ËË, 0
,
ËË0 1
typeof
ËË2 8
(
ËË8 9
	SqlMapper
ËË9 B
)
ËËB C
.
ËËC D
	GetMethod
ËËD M
(
ËËM N

memberType
ÈÈ &
==
ÈÈ' )
typeof
ÈÈ* 0
(
ÈÈ0 1
char
ÈÈ1 5
)
ÈÈ5 6
?
ÈÈ7 8
$str
ÈÈ9 C
:
ÈÈD E
$str
ÈÈF X
,
ÈÈX Y
BindingFlags
ÈÈZ f
.
ÈÈf g
Static
ÈÈg m
|
ÈÈn o
BindingFlags
ÈÈp |
.
ÈÈ| }
PublicÈÈ} É
)ÈÈÉ Ñ
,ÈÈÑ Ö
nullÈÈÜ ä
)ÈÈä ã
;ÈÈã å
}
ÍÍ 
else
ÎÎ 
{
ÏÏ 
il
ÌÌ 
.
ÌÌ 
Emit
ÌÌ 
(
ÌÌ  
OpCodes
ÌÌ  '
.
ÌÌ' (
Dup
ÌÌ( +
)
ÌÌ+ ,
;
ÌÌ, -
il
ÓÓ 
.
ÓÓ 
Emit
ÓÓ 
(
ÓÓ  
OpCodes
ÓÓ  '
.
ÓÓ' (
Isinst
ÓÓ( .
,
ÓÓ. /
typeof
ÓÓ0 6
(
ÓÓ6 7
DBNull
ÓÓ7 =
)
ÓÓ= >
)
ÓÓ> ?
;
ÓÓ? @
il
ÔÔ 
.
ÔÔ 
Emit
ÔÔ 
(
ÔÔ  
OpCodes
ÔÔ  '
.
ÔÔ' (
Brtrue_S
ÔÔ( 0
,
ÔÔ0 1
isDbNullLabel
ÔÔ2 ?
)
ÔÔ? @
;
ÔÔ@ A
var
ÛÛ  
nullUnderlyingType
ÛÛ .
=
ÛÛ/ 0
Nullable
ÛÛ1 9
.
ÛÛ9 :
GetUnderlyingType
ÛÛ: K
(
ÛÛK L

memberType
ÛÛL V
)
ÛÛV W
;
ÛÛW X
var
ÙÙ 
	unboxType
ÙÙ %
=
ÙÙ& ' 
nullUnderlyingType
ÙÙ( :
!=
ÙÙ; =
null
ÙÙ> B
&&
ÙÙC E 
nullUnderlyingType
ÙÙF X
.
ÙÙX Y
IsEnum
ÙÙY _
?
ÙÙ` a 
nullUnderlyingType
ÙÙb t
:
ÙÙu v

memberTypeÙÙw Å
;ÙÙÅ Ç
if
ˆˆ 
(
ˆˆ 
	unboxType
ˆˆ %
.
ˆˆ% &
IsEnum
ˆˆ& ,
)
ˆˆ, -
{
˜˜ 
if
¯¯ 
(
¯¯  
!
¯¯  !
haveEnumLocal
¯¯! .
)
¯¯. /
{
˘˘ 
il
˙˙  "
.
˙˙" #
DeclareLocal
˙˙# /
(
˙˙/ 0
typeof
˙˙0 6
(
˙˙6 7
string
˙˙7 =
)
˙˙= >
)
˙˙> ?
;
˙˙? @
haveEnumLocal
˚˚  -
=
˚˚. /
true
˚˚0 4
;
˚˚4 5
}
¸¸ 
Label
˛˛ !
isNotString
˛˛" -
=
˛˛. /
il
˛˛0 2
.
˛˛2 3
DefineLabel
˛˛3 >
(
˛˛> ?
)
˛˛? @
;
˛˛@ A
il
ˇˇ 
.
ˇˇ 
Emit
ˇˇ #
(
ˇˇ# $
OpCodes
ˇˇ$ +
.
ˇˇ+ ,
Dup
ˇˇ, /
)
ˇˇ/ 0
;
ˇˇ0 1
il
ÄÄ 
.
ÄÄ 
Emit
ÄÄ #
(
ÄÄ# $
OpCodes
ÄÄ$ +
.
ÄÄ+ ,
Isinst
ÄÄ, 2
,
ÄÄ2 3
typeof
ÄÄ4 :
(
ÄÄ: ;
string
ÄÄ; A
)
ÄÄA B
)
ÄÄB C
;
ÄÄC D
il
ÅÅ 
.
ÅÅ 
Emit
ÅÅ #
(
ÅÅ# $
OpCodes
ÅÅ$ +
.
ÅÅ+ ,
Dup
ÅÅ, /
)
ÅÅ/ 0
;
ÅÅ0 1
il
ÇÇ 
.
ÇÇ 
Emit
ÇÇ #
(
ÇÇ# $
OpCodes
ÇÇ$ +
.
ÇÇ+ ,
Stloc_2
ÇÇ, 3
)
ÇÇ3 4
;
ÇÇ4 5
il
ÉÉ 
.
ÉÉ 
Emit
ÉÉ #
(
ÉÉ# $
OpCodes
ÉÉ$ +
.
ÉÉ+ ,
	Brfalse_S
ÉÉ, 5
,
ÉÉ5 6
isNotString
ÉÉ7 B
)
ÉÉB C
;
ÉÉC D
il
ÖÖ 
.
ÖÖ 
Emit
ÖÖ #
(
ÖÖ# $
OpCodes
ÖÖ$ +
.
ÖÖ+ ,
Pop
ÖÖ, /
)
ÖÖ/ 0
;
ÖÖ0 1
il
àà 
.
àà 
Emit
àà #
(
àà# $
OpCodes
àà$ +
.
àà+ ,
Ldtoken
àà, 3
,
àà3 4
	unboxType
àà5 >
)
àà> ?
;
àà? @
il
ââ 
.
ââ 
EmitCall
ââ '
(
ââ' (
OpCodes
ââ( /
.
ââ/ 0
Call
ââ0 4
,
ââ4 5
typeof
ââ6 <
(
ââ< =
Type
ââ= A
)
ââA B
.
ââB C
	GetMethod
ââC L
(
ââL M
$str
ââM `
)
ââ` a
,
ââa b
null
ââc g
)
ââg h
;
ââh i
il
ää 
.
ää 
Emit
ää #
(
ää# $
OpCodes
ää$ +
.
ää+ ,
Ldloc_2
ää, 3
)
ää3 4
;
ää4 5
il
ãã 
.
ãã 
Emit
ãã #
(
ãã# $
OpCodes
ãã$ +
.
ãã+ ,
Ldc_I4_1
ãã, 4
)
ãã4 5
;
ãã5 6
il
åå 
.
åå 
EmitCall
åå '
(
åå' (
OpCodes
åå( /
.
åå/ 0
Call
åå0 4
,
åå4 5
	enumParse
åå6 ?
,
åå? @
null
ååA E
)
ååE F
;
ååF G
il
éé 
.
éé 
Emit
éé #
(
éé# $
OpCodes
éé$ +
.
éé+ ,
	Unbox_Any
éé, 5
,
éé5 6
	unboxType
éé7 @
)
éé@ A
;
ééA B
if
êê 
(
êê   
nullUnderlyingType
êê  2
!=
êê3 5
null
êê6 :
)
êê: ;
{
ëë 
il
íí  "
.
íí" #
Emit
íí# '
(
íí' (
OpCodes
íí( /
.
íí/ 0
Newobj
íí0 6
,
íí6 7

memberType
íí8 B
.
ííB C
GetConstructor
ííC Q
(
ííQ R
new
ííR U
[
ííU V
]
ííV W
{
ííX Y 
nullUnderlyingType
ííZ l
}
íím n
)
íín o
)
íío p
;
ííp q
}
ìì 
if
îî 
(
îî  
item
îî  $
.
îî$ %
Property
îî% -
!=
îî. 0
null
îî1 5
)
îî5 6
{
ïï 
il
ññ  "
.
ññ" #
Emit
ññ# '
(
ññ' (
OpCodes
ññ( /
.
ññ/ 0
Callvirt
ññ0 8
,
ññ8 9
item
ññ: >
.
ññ> ?
Property
ññ? G
.
ññG H
Setter
ññH N
)
ññN O
;
ññO P
}
óó 
else
òò  
{
ôô 
il
öö  "
.
öö" #
Emit
öö# '
(
öö' (
OpCodes
öö( /
.
öö/ 0
Stfld
öö0 5
,
öö5 6
item
öö7 ;
.
öö; <
Field
öö< A
)
ööA B
;
ööB C
}
õõ 
il
úú 
.
úú 
Emit
úú #
(
úú# $
OpCodes
úú$ +
.
úú+ ,
Br_S
úú, 0
,
úú0 1
finishLabel
úú2 =
)
úú= >
;
úú> ?
il
üü 
.
üü 
	MarkLabel
üü (
(
üü( )
isNotString
üü) 4
)
üü4 5
;
üü5 6
}
†† 
if
°° 
(
°° 

memberType
°° &
==
°°' )
typeof
°°* 0
(
°°0 1
System
°°1 7
.
°°7 8
Data
°°8 <
.
°°< =
Linq
°°= A
.
°°A B
Binary
°°B H
)
°°H I
)
°°I J
{
¢¢ 
il
££ 
.
££ 
Emit
££ #
(
££# $
OpCodes
££$ +
.
££+ ,
	Unbox_Any
££, 5
,
££5 6
typeof
££7 =
(
££= >
byte
££> B
[
££B C
]
££C D
)
££D E
)
££E F
;
££F G
il
§§ 
.
§§ 
Emit
§§ #
(
§§# $
OpCodes
§§$ +
.
§§+ ,
Newobj
§§, 2
,
§§2 3
typeof
§§4 :
(
§§: ;
System
§§; A
.
§§A B
Data
§§B F
.
§§F G
Linq
§§G K
.
§§K L
Binary
§§L R
)
§§R S
.
§§S T
GetConstructor
§§T b
(
§§b c
new
§§c f
Type
§§g k
[
§§k l
]
§§l m
{
§§n o
typeof
§§p v
(
§§v w
byte
§§w {
[
§§{ |
]
§§| }
)
§§} ~
}§§ Ä
)§§Ä Å
)§§Å Ç
;§§Ç É
}
•• 
else
¶¶ 
{
ßß 
il
®® 
.
®® 
Emit
®® #
(
®®# $
OpCodes
®®$ +
.
®®+ ,
	Unbox_Any
®®, 5
,
®®5 6
	unboxType
®®7 @
)
®®@ A
;
®®A B
}
©© 
if
™™ 
(
™™  
nullUnderlyingType
™™ .
!=
™™/ 1
null
™™2 6
&&
™™7 9 
nullUnderlyingType
™™: L
.
™™L M
IsEnum
™™M S
)
™™S T
{
´´ 
il
¨¨ 
.
¨¨ 
Emit
¨¨ #
(
¨¨# $
OpCodes
¨¨$ +
.
¨¨+ ,
Newobj
¨¨, 2
,
¨¨2 3

memberType
¨¨4 >
.
¨¨> ?
GetConstructor
¨¨? M
(
¨¨M N
new
¨¨N Q
[
¨¨Q R
]
¨¨R S
{
¨¨T U 
nullUnderlyingType
¨¨V h
}
¨¨i j
)
¨¨j k
)
¨¨k l
;
¨¨l m
}
≠≠ 
}
ÆÆ 
if
ØØ 
(
ØØ 
item
ØØ 
.
ØØ 
Property
ØØ %
!=
ØØ& (
null
ØØ) -
)
ØØ- .
{
∞∞ 
il
±± 
.
±± 
Emit
±± 
(
±±  
OpCodes
±±  '
.
±±' (
Callvirt
±±( 0
,
±±0 1
item
±±2 6
.
±±6 7
Property
±±7 ?
.
±±? @
Setter
±±@ F
)
±±F G
;
±±G H
}
≤≤ 
else
≥≥ 
{
¥¥ 
il
µµ 
.
µµ 
Emit
µµ 
(
µµ  
OpCodes
µµ  '
.
µµ' (
Stfld
µµ( -
,
µµ- .
item
µµ/ 3
.
µµ3 4
Field
µµ4 9
)
µµ9 :
;
µµ: ;
}
∂∂ 
il
∏∏ 
.
∏∏ 
Emit
∏∏ 
(
∏∏ 
OpCodes
∏∏ #
.
∏∏# $
Br_S
∏∏$ (
,
∏∏( )
finishLabel
∏∏* 5
)
∏∏5 6
;
∏∏6 7
il
∫∫ 
.
∫∫ 
	MarkLabel
∫∫  
(
∫∫  !
isDbNullLabel
∫∫! .
)
∫∫. /
;
∫∫/ 0
il
ºº 
.
ºº 
Emit
ºº 
(
ºº 
OpCodes
ºº #
.
ºº# $
Pop
ºº$ '
)
ºº' (
;
ºº( )
il
ΩΩ 
.
ΩΩ 
Emit
ΩΩ 
(
ΩΩ 
OpCodes
ΩΩ #
.
ΩΩ# $
Pop
ΩΩ$ '
)
ΩΩ' (
;
ΩΩ( )
if
øø 
(
øø 
first
øø 
&&
øø  &
returnNullIfFirstMissing
øø! 9
)
øø9 :
{
¿¿ 
il
¡¡ 
.
¡¡ 
Emit
¡¡ 
(
¡¡  
OpCodes
¡¡  '
.
¡¡' (
Pop
¡¡( +
)
¡¡+ ,
;
¡¡, -
il
¬¬ 
.
¬¬ 
Emit
¬¬ 
(
¬¬  
OpCodes
¬¬  '
.
¬¬' (
Ldnull
¬¬( .
)
¬¬. /
;
¬¬/ 0
il
√√ 
.
√√ 
Emit
√√ 
(
√√  
OpCodes
√√  '
.
√√' (
Stloc_1
√√( /
)
√√/ 0
;
√√0 1
il
ƒƒ 
.
ƒƒ 
Emit
ƒƒ 
(
ƒƒ  
OpCodes
ƒƒ  '
.
ƒƒ' (
Br
ƒƒ( *
,
ƒƒ* +
allDone
ƒƒ, 3
)
ƒƒ3 4
;
ƒƒ4 5
}
≈≈ 
il
«« 
.
«« 
	MarkLabel
««  
(
««  !
finishLabel
««! ,
)
««, -
;
««- .
}
»» 
first
…… 
=
…… 
false
…… 
;
…… 
index
   
+=
   
$num
   
;
   
}
ÀÀ 
il
ÃÃ 
.
ÃÃ 
Emit
ÃÃ 
(
ÃÃ 
OpCodes
ÃÃ 
.
ÃÃ 
Stloc_1
ÃÃ #
)
ÃÃ# $
;
ÃÃ$ %
il
ÕÕ 
.
ÕÕ 
	MarkLabel
ÕÕ 
(
ÕÕ 
allDone
ÕÕ  
)
ÕÕ  !
;
ÕÕ! "
il
ŒŒ 
.
ŒŒ 
BeginCatchBlock
ŒŒ 
(
ŒŒ 
typeof
ŒŒ %
(
ŒŒ% &
	Exception
ŒŒ& /
)
ŒŒ/ 0
)
ŒŒ0 1
;
ŒŒ1 2
il
œœ 
.
œœ 
Emit
œœ 
(
œœ 
OpCodes
œœ 
.
œœ 
Ldloc_0
œœ #
)
œœ# $
;
œœ$ %
il
–– 
.
–– 
Emit
–– 
(
–– 
OpCodes
–– 
.
–– 
Ldarg_0
–– #
)
––# $
;
––$ %
il
—— 
.
—— 
EmitCall
—— 
(
—— 
OpCodes
—— 
.
——  
Call
——  $
,
——$ %
typeof
——& ,
(
——, -
	SqlMapper
——- 6
)
——6 7
.
——7 8
	GetMethod
——8 A
(
——A B
$str
——B V
)
——V W
,
——W X
null
——Y ]
)
——] ^
;
——^ _
il
““ 
.
““ 
Emit
““ 
(
““ 
OpCodes
““ 
.
““ 
Ldnull
““ "
)
““" #
;
““# $
il
”” 
.
”” 
Emit
”” 
(
”” 
OpCodes
”” 
.
”” 
Stloc_1
”” #
)
””# $
;
””$ %
il
‘‘ 
.
‘‘ 
EndExceptionBlock
‘‘  
(
‘‘  !
)
‘‘! "
;
‘‘" #
il
÷÷ 
.
÷÷ 
Emit
÷÷ 
(
÷÷ 
OpCodes
÷÷ 
.
÷÷ 
Ldloc_1
÷÷ #
)
÷÷# $
;
÷÷$ %
il
◊◊ 
.
◊◊ 
Emit
◊◊ 
(
◊◊ 
OpCodes
◊◊ 
.
◊◊ 
Ret
◊◊ 
)
◊◊  
;
◊◊  !
return
ŸŸ 
(
ŸŸ 
Func
ŸŸ 
<
ŸŸ 
IDataReader
ŸŸ $
,
ŸŸ$ %
object
ŸŸ& ,
>
ŸŸ, -
)
ŸŸ- .
dm
ŸŸ. 0
.
ŸŸ0 1
CreateDelegate
ŸŸ1 ?
(
ŸŸ? @
typeof
ŸŸ@ F
(
ŸŸF G
Func
ŸŸG K
<
ŸŸK L
IDataReader
ŸŸL W
,
ŸŸW X
object
ŸŸY _
>
ŸŸ_ `
)
ŸŸ` a
)
ŸŸa b
;
ŸŸb c
}
⁄⁄ 	
public
‚‚ 
static
‚‚ 
void
‚‚  
ThrowDataException
‚‚ -
(
‚‚- .
	Exception
‚‚. 7
ex
‚‚8 :
,
‚‚: ;
int
‚‚< ?
index
‚‚@ E
,
‚‚E F
IDataReader
‚‚G R
reader
‚‚S Y
)
‚‚Y Z
{
„„ 	
string
‰‰ 
name
‰‰ 
=
‰‰ 
$str
‰‰ !
,
‰‰! "
value
‰‰# (
=
‰‰) *
$str
‰‰+ 2
;
‰‰2 3
if
ÂÂ 
(
ÂÂ 
reader
ÂÂ 
!=
ÂÂ 
null
ÂÂ 
&&
ÂÂ !
index
ÂÂ" '
>=
ÂÂ( *
$num
ÂÂ+ ,
&&
ÂÂ- /
index
ÂÂ0 5
<
ÂÂ6 7
reader
ÂÂ8 >
.
ÂÂ> ?

FieldCount
ÂÂ? I
)
ÂÂI J
{
ÊÊ 
name
ÁÁ 
=
ÁÁ 
reader
ÁÁ 
.
ÁÁ 
GetName
ÁÁ %
(
ÁÁ% &
index
ÁÁ& +
)
ÁÁ+ ,
;
ÁÁ, -
object
ËË 
val
ËË 
=
ËË 
reader
ËË #
.
ËË# $
GetValue
ËË$ ,
(
ËË, -
index
ËË- 2
)
ËË2 3
;
ËË3 4
if
ÈÈ 
(
ÈÈ 
val
ÈÈ 
==
ÈÈ 
null
ÈÈ 
||
ÈÈ  "
val
ÈÈ# &
is
ÈÈ' )
DBNull
ÈÈ* 0
)
ÈÈ0 1
{
ÍÍ 
value
ÎÎ 
=
ÎÎ 
$str
ÎÎ $
;
ÎÎ$ %
}
ÏÏ 
else
ÌÌ 
{
ÓÓ 
value
ÔÔ 
=
ÔÔ 
Convert
ÔÔ #
.
ÔÔ# $
ToString
ÔÔ$ ,
(
ÔÔ, -
val
ÔÔ- 0
)
ÔÔ0 1
+
ÔÔ2 3
$str
ÔÔ4 9
+
ÔÔ: ;
Type
ÔÔ< @
.
ÔÔ@ A
GetTypeCode
ÔÔA L
(
ÔÔL M
val
ÔÔM P
.
ÔÔP Q
GetType
ÔÔQ X
(
ÔÔX Y
)
ÔÔY Z
)
ÔÔZ [
;
ÔÔ[ \
}
 
}
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
DataException
ÚÚ #
(
ÚÚ# $
string
ÚÚ$ *
.
ÚÚ* +
Format
ÚÚ+ 1
(
ÚÚ1 2
$str
ÚÚ2 V
,
ÚÚV W
index
ÚÚX ]
,
ÚÚ] ^
name
ÚÚ_ c
,
ÚÚc d
value
ÚÚe j
)
ÚÚj k
,
ÚÚk l
ex
ÚÚm o
)
ÚÚo p
;
ÚÚp q
}
ÛÛ 	
private
ÙÙ 
static
ÙÙ 
void
ÙÙ 
	EmitInt32
ÙÙ %
(
ÙÙ% &
ILGenerator
ÙÙ& 1
il
ÙÙ2 4
,
ÙÙ4 5
int
ÙÙ6 9
value
ÙÙ: ?
)
ÙÙ? @
{
ıı 	
switch
ˆˆ 
(
ˆˆ 
value
ˆˆ 
)
ˆˆ 
{
˜˜ 
case
¯¯ 
-
¯¯ 
$num
¯¯ 
:
¯¯ 
il
¯¯ 
.
¯¯ 
Emit
¯¯  
(
¯¯  !
OpCodes
¯¯! (
.
¯¯( )
	Ldc_I4_M1
¯¯) 2
)
¯¯2 3
;
¯¯3 4
break
¯¯5 :
;
¯¯: ;
case
˘˘ 
$num
˘˘ 
:
˘˘ 
il
˘˘ 
.
˘˘ 
Emit
˘˘ 
(
˘˘  
OpCodes
˘˘  '
.
˘˘' (
Ldc_I4_0
˘˘( 0
)
˘˘0 1
;
˘˘1 2
break
˘˘3 8
;
˘˘8 9
case
˙˙ 
$num
˙˙ 
:
˙˙ 
il
˙˙ 
.
˙˙ 
Emit
˙˙ 
(
˙˙  
OpCodes
˙˙  '
.
˙˙' (
Ldc_I4_1
˙˙( 0
)
˙˙0 1
;
˙˙1 2
break
˙˙3 8
;
˙˙8 9
case
˚˚ 
$num
˚˚ 
:
˚˚ 
il
˚˚ 
.
˚˚ 
Emit
˚˚ 
(
˚˚  
OpCodes
˚˚  '
.
˚˚' (
Ldc_I4_2
˚˚( 0
)
˚˚0 1
;
˚˚1 2
break
˚˚3 8
;
˚˚8 9
case
¸¸ 
$num
¸¸ 
:
¸¸ 
il
¸¸ 
.
¸¸ 
Emit
¸¸ 
(
¸¸  
OpCodes
¸¸  '
.
¸¸' (
Ldc_I4_3
¸¸( 0
)
¸¸0 1
;
¸¸1 2
break
¸¸3 8
;
¸¸8 9
case
˝˝ 
$num
˝˝ 
:
˝˝ 
il
˝˝ 
.
˝˝ 
Emit
˝˝ 
(
˝˝  
OpCodes
˝˝  '
.
˝˝' (
Ldc_I4_4
˝˝( 0
)
˝˝0 1
;
˝˝1 2
break
˝˝3 8
;
˝˝8 9
case
˛˛ 
$num
˛˛ 
:
˛˛ 
il
˛˛ 
.
˛˛ 
Emit
˛˛ 
(
˛˛  
OpCodes
˛˛  '
.
˛˛' (
Ldc_I4_5
˛˛( 0
)
˛˛0 1
;
˛˛1 2
break
˛˛3 8
;
˛˛8 9
case
ˇˇ 
$num
ˇˇ 
:
ˇˇ 
il
ˇˇ 
.
ˇˇ 
Emit
ˇˇ 
(
ˇˇ  
OpCodes
ˇˇ  '
.
ˇˇ' (
Ldc_I4_6
ˇˇ( 0
)
ˇˇ0 1
;
ˇˇ1 2
break
ˇˇ3 8
;
ˇˇ8 9
case
ÄÄ 
$num
ÄÄ 
:
ÄÄ 
il
ÄÄ 
.
ÄÄ 
Emit
ÄÄ 
(
ÄÄ  
OpCodes
ÄÄ  '
.
ÄÄ' (
Ldc_I4_7
ÄÄ( 0
)
ÄÄ0 1
;
ÄÄ1 2
break
ÄÄ3 8
;
ÄÄ8 9
case
ÅÅ 
$num
ÅÅ 
:
ÅÅ 
il
ÅÅ 
.
ÅÅ 
Emit
ÅÅ 
(
ÅÅ  
OpCodes
ÅÅ  '
.
ÅÅ' (
Ldc_I4_8
ÅÅ( 0
)
ÅÅ0 1
;
ÅÅ1 2
break
ÅÅ3 8
;
ÅÅ8 9
default
ÇÇ 
:
ÇÇ 
if
ÉÉ 
(
ÉÉ 
value
ÉÉ 
>=
ÉÉ  
-
ÉÉ! "
$num
ÉÉ" %
&&
ÉÉ& (
value
ÉÉ) .
<=
ÉÉ/ 1
$num
ÉÉ2 5
)
ÉÉ5 6
{
ÑÑ 
il
ÖÖ 
.
ÖÖ 
Emit
ÖÖ 
(
ÖÖ  
OpCodes
ÖÖ  '
.
ÖÖ' (
Ldc_I4_S
ÖÖ( 0
,
ÖÖ0 1
(
ÖÖ2 3
sbyte
ÖÖ3 8
)
ÖÖ8 9
value
ÖÖ9 >
)
ÖÖ> ?
;
ÖÖ? @
}
ÜÜ 
else
áá 
{
àà 
il
ââ 
.
ââ 
Emit
ââ 
(
ââ  
OpCodes
ââ  '
.
ââ' (
Ldc_I4
ââ( .
,
ââ. /
value
ââ0 5
)
ââ5 6
;
ââ6 7
}
ää 
break
ãã 
;
ãã 
}
åå 
}
çç 	
public
íí 
class
íí 

GridReader
íí 
:
íí  !
IDisposable
íí" -
{
ìì 	
private
îî 
IDataReader
îî 
reader
îî  &
;
îî& '
private
ïï 

IDbCommand
ïï 
command
ïï &
;
ïï& '
private
ññ 
Identity
ññ 
identity
ññ %
;
ññ% &
internal
òò 

GridReader
òò 
(
òò  

IDbCommand
òò  *
command
òò+ 2
,
òò2 3
IDataReader
òò4 ?
reader
òò@ F
,
òòF G
Identity
òòH P
identity
òòQ Y
)
òòY Z
{
ôô 
this
öö 
.
öö 
command
öö 
=
öö 
command
öö &
;
öö& '
this
õõ 
.
õõ 
reader
õõ 
=
õõ 
reader
õõ $
;
õõ$ %
this
úú 
.
úú 
identity
úú 
=
úú 
identity
úú  (
;
úú( )
}
ùù 
public
°° 
IEnumerable
°° 
<
°° 
T
°°  
>
°°  !
Read
°°" &
<
°°& '
T
°°' (
>
°°( )
(
°°) *
)
°°* +
{
¢¢ 
if
££ 
(
££ 
reader
££ 
==
££ 
null
££ "
)
££" #
throw
££$ )
new
££* -%
ObjectDisposedException
££. E
(
££E F
GetType
££F M
(
££M N
)
££N O
.
££O P
Name
££P T
)
££T U
;
££U V
if
§§ 
(
§§ 
consumed
§§ 
)
§§ 
throw
§§ #
new
§§$ ''
InvalidOperationException
§§( A
(
§§A B
$str
§§B g
)
§§g h
;
§§h i
var
•• 
typedIdentity
•• !
=
••" #
identity
••$ ,
.
••, -
ForGrid
••- 4
(
••4 5
typeof
••5 ;
(
••; <
T
••< =
)
••= >
,
••> ?
	gridIndex
••@ I
)
••I J
;
••J K
	CacheInfo
¶¶ 
cache
¶¶ 
=
¶¶  !
GetCacheInfo
¶¶" .
(
¶¶. /
typedIdentity
¶¶/ <
)
¶¶< =
;
¶¶= >
var
ßß 
deserializer
ßß  
=
ßß! "
cache
ßß# (
.
ßß( )
Deserializer
ßß) 5
;
ßß5 6
Func
©© 
<
©© 
Func
©© 
<
©© 
IDataReader
©© %
,
©©% &
object
©©' -
>
©©- .
>
©©. /#
deserializerGenerator
©©0 E
=
©©F G
(
©©H I
)
©©I J
=>
©©K M
{
™™ 
deserializer
´´  
=
´´! "
GetDeserializer
´´# 2
(
´´2 3
typeof
´´3 9
(
´´9 :
T
´´: ;
)
´´; <
,
´´< =
reader
´´> D
,
´´D E
$num
´´F G
,
´´G H
-
´´I J
$num
´´J K
,
´´K L
false
´´M R
)
´´R S
;
´´S T
cache
¨¨ 
.
¨¨ 
Deserializer
¨¨ &
=
¨¨' (
deserializer
¨¨) 5
;
¨¨5 6
return
≠≠ 
deserializer
≠≠ '
;
≠≠' (
}
ÆÆ 
;
ÆÆ 
if
∞∞ 
(
∞∞ 
deserializer
∞∞  
==
∞∞! #
null
∞∞$ (
)
∞∞( )
{
±± 
deserializer
≤≤  
=
≤≤! "#
deserializerGenerator
≤≤# 8
(
≤≤8 9
)
≤≤9 :
;
≤≤: ;
}
≥≥ 
consumed
¥¥ 
=
¥¥ 
true
¥¥ 
;
¥¥  
return
µµ 
ReadDeferred
µµ #
<
µµ# $
T
µµ$ %
>
µµ% &
(
µµ& '
	gridIndex
µµ' 0
,
µµ0 1
deserializer
µµ2 >
,
µµ> ?
typedIdentity
µµ@ M
,
µµM N#
deserializerGenerator
µµO d
)
µµd e
;
µµe f
}
∂∂ 
private
∏∏ 
IEnumerable
∏∏ 
<
∏∏  
TReturn
∏∏  '
>
∏∏' (
MultiReadInternal
∏∏) :
<
∏∏: ;
TFirst
∏∏; A
,
∏∏A B
TSecond
∏∏C J
,
∏∏J K
TThird
∏∏L R
,
∏∏R S
TFourth
∏∏T [
,
∏∏[ \
TFifth
∏∏] c
,
∏∏c d
TReturn
∏∏e l
>
∏∏l m
(
∏∏m n
object
∏∏n t
func
∏∏u y
,
∏∏y z
string∏∏{ Å
splitOn∏∏Ç â
)∏∏â ä
{
ππ 
var
ªª 
identity
ªª 
=
ªª 
this
ªª #
.
ªª# $
identity
ªª$ ,
.
ªª, -
ForGrid
ªª- 4
(
ªª4 5
typeof
ªª5 ;
(
ªª; <
TReturn
ªª< C
)
ªªC D
,
ªªD E
new
ªªF I
Type
ªªJ N
[
ªªN O
]
ªªO P
{
ªªQ R
typeof
ºº 
(
ºº 
TFirst
ºº !
)
ºº! "
,
ºº" #
typeof
ΩΩ 
(
ΩΩ 
TSecond
ΩΩ "
)
ΩΩ" #
,
ΩΩ# $
typeof
ææ 
(
ææ 
TThird
ææ !
)
ææ! "
,
ææ" #
typeof
øø 
(
øø 
TFourth
øø "
)
øø" #
,
øø# $
typeof
¿¿ 
(
¿¿ 
TFifth
¿¿ !
)
¿¿! "
}
¡¡ 
,
¡¡ 
	gridIndex
¡¡ 
)
¡¡ 
;
¡¡ 
try
¬¬ 
{
√√ 
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ  
r
ƒƒ! "
in
ƒƒ# %
	SqlMapper
ƒƒ& /
.
ƒƒ/ 0
MultiMapImpl
ƒƒ0 <
<
ƒƒ< =
TFirst
ƒƒ= C
,
ƒƒC D
TSecond
ƒƒE L
,
ƒƒL M
TThird
ƒƒN T
,
ƒƒT U
TFourth
ƒƒV ]
,
ƒƒ] ^
TFifth
ƒƒ_ e
,
ƒƒe f
TReturn
ƒƒg n
>
ƒƒn o
(
ƒƒo p
null
ƒƒp t
,
ƒƒt u
null
ƒƒv z
,
ƒƒz {
funcƒƒ| Ä
,ƒƒÄ Å
nullƒƒÇ Ü
,ƒƒÜ á
nullƒƒà å
,ƒƒå ç
splitOnƒƒé ï
,ƒƒï ñ
nullƒƒó õ
,ƒƒõ ú
nullƒƒù °
,ƒƒ° ¢
readerƒƒ£ ©
,ƒƒ© ™
identityƒƒ´ ≥
)ƒƒ≥ ¥
)ƒƒ¥ µ
{
≈≈ 
yield
∆∆ 
return
∆∆ $
r
∆∆% &
;
∆∆& '
}
«« 
}
»» 
finally
…… 
{
   

NextResult
ÀÀ 
(
ÀÀ 
)
ÀÀ  
;
ÀÀ  !
}
ÃÃ 
}
ÕÕ 
public
€€ 
IEnumerable
€€ 
<
€€ 
TReturn
€€ &
>
€€& '
Read
€€( ,
<
€€, -
TFirst
€€- 3
,
€€3 4
TSecond
€€5 <
,
€€< =
TReturn
€€> E
>
€€E F
(
€€F G
Func
€€G K
<
€€K L
TFirst
€€L R
,
€€R S
TSecond
€€T [
,
€€[ \
TReturn
€€] d
>
€€d e
func
€€f j
,
€€j k
string
€€l r
splitOn
€€s z
=
€€{ |
$str€€} Å
)€€Å Ç
{
›› 
return
ﬁﬁ 
MultiReadInternal
ﬁﬁ (
<
ﬁﬁ( )
TFirst
ﬁﬁ) /
,
ﬁﬁ/ 0
TSecond
ﬁﬁ1 8
,
ﬁﬁ8 9
DontMap
ﬁﬁ: A
,
ﬁﬁA B
DontMap
ﬁﬁC J
,
ﬁﬁJ K
DontMap
ﬁﬁL S
,
ﬁﬁS T
TReturn
ﬁﬁU \
>
ﬁﬁ\ ]
(
ﬁﬁ] ^
func
ﬁﬁ^ b
,
ﬁﬁb c
splitOn
ﬁﬁd k
)
ﬁﬁk l
;
ﬁﬁl m
}
ﬂﬂ 
public
ÓÓ 
IEnumerable
ÓÓ 
<
ÓÓ 
TReturn
ÓÓ &
>
ÓÓ& '
Read
ÓÓ( ,
<
ÓÓ, -
TFirst
ÓÓ- 3
,
ÓÓ3 4
TSecond
ÓÓ5 <
,
ÓÓ< =
TThird
ÓÓ> D
,
ÓÓD E
TReturn
ÓÓF M
>
ÓÓM N
(
ÓÓN O
Func
ÓÓO S
<
ÓÓS T
TFirst
ÓÓT Z
,
ÓÓZ [
TSecond
ÓÓ\ c
,
ÓÓc d
TThird
ÓÓe k
,
ÓÓk l
TReturn
ÓÓm t
>
ÓÓt u
func
ÓÓv z
,
ÓÓz {
stringÓÓ| Ç
splitOnÓÓÉ ä
=ÓÓã å
$strÓÓç ë
)ÓÓë í
{
 
return
ÒÒ 
MultiReadInternal
ÒÒ (
<
ÒÒ( )
TFirst
ÒÒ) /
,
ÒÒ/ 0
TSecond
ÒÒ1 8
,
ÒÒ8 9
TThird
ÒÒ: @
,
ÒÒ@ A
DontMap
ÒÒB I
,
ÒÒI J
DontMap
ÒÒK R
,
ÒÒR S
TReturn
ÒÒT [
>
ÒÒ[ \
(
ÒÒ\ ]
func
ÒÒ] a
,
ÒÒa b
splitOn
ÒÒc j
)
ÒÒj k
;
ÒÒk l
}
ÚÚ 
public
ÇÇ 
IEnumerable
ÇÇ 
<
ÇÇ 
TReturn
ÇÇ &
>
ÇÇ& '
Read
ÇÇ( ,
<
ÇÇ, -
TFirst
ÇÇ- 3
,
ÇÇ3 4
TSecond
ÇÇ5 <
,
ÇÇ< =
TThird
ÇÇ> D
,
ÇÇD E
TFourth
ÇÇF M
,
ÇÇM N
TReturn
ÇÇO V
>
ÇÇV W
(
ÇÇW X
Func
ÇÇX \
<
ÇÇ\ ]
TFirst
ÇÇ] c
,
ÇÇc d
TSecond
ÇÇe l
,
ÇÇl m
TThird
ÇÇn t
,
ÇÇt u
TFourth
ÇÇv }
,
ÇÇ} ~
TReturnÇÇ Ü
>ÇÇÜ á
funcÇÇà å
,ÇÇå ç
stringÇÇé î
splitOnÇÇï ú
=ÇÇù û
$strÇÇü £
)ÇÇ£ §
{
ÑÑ 
return
ÖÖ 
MultiReadInternal
ÖÖ (
<
ÖÖ( )
TFirst
ÖÖ) /
,
ÖÖ/ 0
TSecond
ÖÖ1 8
,
ÖÖ8 9
TThird
ÖÖ: @
,
ÖÖ@ A
TFourth
ÖÖB I
,
ÖÖI J
DontMap
ÖÖK R
,
ÖÖR S
TReturn
ÖÖT [
>
ÖÖ[ \
(
ÖÖ\ ]
func
ÖÖ] a
,
ÖÖa b
splitOn
ÖÖc j
)
ÖÖj k
;
ÖÖk l
}
ÜÜ 
public
ïï 
IEnumerable
ïï 
<
ïï 
TReturn
ïï &
>
ïï& '
Read
ïï( ,
<
ïï, -
TFirst
ïï- 3
,
ïï3 4
TSecond
ïï5 <
,
ïï< =
TThird
ïï> D
,
ïïD E
TFourth
ïïF M
,
ïïM N
TFifth
ïïO U
,
ïïU V
TReturn
ïïW ^
>
ïï^ _
(
ïï_ `
Func
ïï` d
<
ïïd e
TFirst
ïïe k
,
ïïk l
TSecond
ïïm t
,
ïït u
TThird
ïïv |
,
ïï| }
TFourthïï~ Ö
,ïïÖ Ü
TFifthïïá ç
,ïïç é
TReturnïïè ñ
>ïïñ ó
funcïïò ú
,ïïú ù
stringïïû §
splitOnïï• ¨
=ïï≠ Æ
$strïïØ ≥
)ïï≥ ¥
{
ññ 
return
óó 
MultiReadInternal
óó (
<
óó( )
TFirst
óó) /
,
óó/ 0
TSecond
óó1 8
,
óó8 9
TThird
óó: @
,
óó@ A
TFourth
óóB I
,
óóI J
TFifth
óóK Q
,
óóQ R
TReturn
óóS Z
>
óóZ [
(
óó[ \
func
óó\ `
,
óó` a
splitOn
óób i
)
óói j
;
óój k
}
òò 
private
õõ 
IEnumerable
õõ 
<
õõ  
T
õõ  !
>
õõ! "
ReadDeferred
õõ# /
<
õõ/ 0
T
õõ0 1
>
õõ1 2
(
õõ2 3
int
õõ3 6
index
õõ7 <
,
õõ< =
Func
õõ> B
<
õõB C
IDataReader
õõC N
,
õõN O
object
õõP V
>
õõV W
deserializer
õõX d
,
õõd e
Identity
õõf n
typedIdentity
õõo |
,
õõ| }
Funcõõ~ Ç
<õõÇ É
FuncõõÉ á
<õõá à
IDataReaderõõà ì
,õõì î
objectõõï õ
>õõõ ú
>õõú ù%
deserializerGeneratorõõû ≥
)õõ≥ ¥
{
úú 
try
ùù 
{
ûû 
while
üü 
(
üü 
index
üü  
==
üü! #
	gridIndex
üü$ -
&&
üü. 0
reader
üü1 7
.
üü7 8
Read
üü8 <
(
üü< =
)
üü= >
)
üü> ?
{
†† 
object
°° 
next
°° #
;
°°# $
try
¢¢ 
{
££ 
next
§§  
=
§§! "
deserializer
§§# /
(
§§/ 0
reader
§§0 6
)
§§6 7
;
§§7 8
}
•• 
catch
¶¶ 
(
¶¶ 
DataException
¶¶ ,
)
¶¶, -
{
ßß 
deserializer
®® (
=
®®) *#
deserializerGenerator
®®+ @
(
®®@ A
)
®®A B
;
®®B C
next
©©  
=
©©! "
deserializer
©©# /
(
©©/ 0
reader
©©0 6
)
©©6 7
;
©©7 8
}
™™ 
yield
´´ 
return
´´ $
(
´´% &
T
´´& '
)
´´' (
next
´´( ,
;
´´, -
}
¨¨ 
}
≠≠ 
finally
ÆÆ 
{
ØØ 
if
∞∞ 
(
∞∞ 
index
∞∞ 
==
∞∞  
	gridIndex
∞∞! *
)
∞∞* +
{
±± 

NextResult
≤≤ "
(
≤≤" #
)
≤≤# $
;
≤≤$ %
}
≥≥ 
}
¥¥ 
}
µµ 
private
∂∂ 
int
∂∂ 
	gridIndex
∂∂ !
;
∂∂! "
private
∑∑ 
bool
∑∑ 
consumed
∑∑ !
;
∑∑! "
private
∏∏ 
void
∏∏ 

NextResult
∏∏ #
(
∏∏# $
)
∏∏$ %
{
ππ 
if
∫∫ 
(
∫∫ 
reader
∫∫ 
.
∫∫ 

NextResult
∫∫ %
(
∫∫% &
)
∫∫& '
)
∫∫' (
{
ªª 
	gridIndex
ºº 
++
ºº 
;
ºº  
consumed
ΩΩ 
=
ΩΩ 
false
ΩΩ $
;
ΩΩ$ %
}
ææ 
else
øø 
{
¿¿ 
Dispose
¡¡ 
(
¡¡ 
)
¡¡ 
;
¡¡ 
}
¬¬ 
}
ƒƒ 
public
»» 
void
»» 
Dispose
»» 
(
»»  
)
»»  !
{
…… 
if
   
(
   
reader
   
!=
   
null
   "
)
  " #
{
ÀÀ 
reader
ÃÃ 
.
ÃÃ 
Dispose
ÃÃ "
(
ÃÃ" #
)
ÃÃ# $
;
ÃÃ$ %
reader
ÕÕ 
=
ÕÕ 
null
ÕÕ !
;
ÕÕ! "
}
ŒŒ 
if
œœ 
(
œœ 
command
œœ 
!=
œœ 
null
œœ #
)
œœ# $
{
–– 
command
—— 
.
—— 
Dispose
—— #
(
——# $
)
——$ %
;
——% &
command
““ 
=
““ 
null
““ "
;
““" #
}
”” 
}
‘‘ 
}
’’ 	
}
÷÷ 
public
€€ 

class
€€ 
DynamicParameters
€€ "
:
€€# $
	SqlMapper
€€% .
.
€€. / 
IDynamicParameters
€€/ A
{
‹‹ 
static
›› 

Dictionary
›› 
<
›› 
	SqlMapper
›› #
.
››# $
Identity
››$ ,
,
››, -
Action
››. 4
<
››4 5

IDbCommand
››5 ?
,
››? @
object
››A G
>
››G H
>
››H I
paramReaderCache
››J Z
=
››[ \
new
››] `

Dictionary
››a k
<
››k l
	SqlMapper
››l u
.
››u v
Identity
››v ~
,
››~ 
Action››Ä Ü
<››Ü á

IDbCommand››á ë
,››ë í
object››ì ô
>››ô ö
>››ö õ
(››õ ú
)››ú ù
;››ù û

Dictionary
ﬂﬂ 
<
ﬂﬂ 
string
ﬂﬂ 
,
ﬂﬂ 
	ParamInfo
ﬂﬂ $
>
ﬂﬂ$ %

parameters
ﬂﬂ& 0
=
ﬂﬂ1 2
new
ﬂﬂ3 6

Dictionary
ﬂﬂ7 A
<
ﬂﬂA B
string
ﬂﬂB H
,
ﬂﬂH I
	ParamInfo
ﬂﬂJ S
>
ﬂﬂS T
(
ﬂﬂT U
)
ﬂﬂU V
;
ﬂﬂV W
List
‡‡ 
<
‡‡ 
object
‡‡ 
>
‡‡ 
	templates
‡‡ 
;
‡‡ 
class
‚‚ 
	ParamInfo
‚‚ 
{
„„ 	
public
‰‰ 
string
‰‰ 
Name
‰‰ 
{
‰‰  
get
‰‰! $
;
‰‰$ %
set
‰‰& )
;
‰‰) *
}
‰‰+ ,
public
ÂÂ 
object
ÂÂ 
Value
ÂÂ 
{
ÂÂ  !
get
ÂÂ" %
;
ÂÂ% &
set
ÂÂ' *
;
ÂÂ* +
}
ÂÂ, -
public
ÊÊ  
ParameterDirection
ÊÊ % 
ParameterDirection
ÊÊ& 8
{
ÊÊ9 :
get
ÊÊ; >
;
ÊÊ> ?
set
ÊÊ@ C
;
ÊÊC D
}
ÊÊE F
public
ÁÁ 
DbType
ÁÁ 
?
ÁÁ 
DbType
ÁÁ !
{
ÁÁ" #
get
ÁÁ$ '
;
ÁÁ' (
set
ÁÁ) ,
;
ÁÁ, -
}
ÁÁ. /
public
ËË 
int
ËË 
?
ËË 
Size
ËË 
{
ËË 
get
ËË "
;
ËË" #
set
ËË$ '
;
ËË' (
}
ËË) *
public
ÈÈ 
IDbDataParameter
ÈÈ #
AttachedParam
ÈÈ$ 1
{
ÈÈ2 3
get
ÈÈ4 7
;
ÈÈ7 8
set
ÈÈ9 <
;
ÈÈ< =
}
ÈÈ> ?
}
ÍÍ 	
public
ÔÔ 
DynamicParameters
ÔÔ  
(
ÔÔ  !
)
ÔÔ! "
{
ÔÔ# $
}
ÔÔ% &
public
ÙÙ 
DynamicParameters
ÙÙ  
(
ÙÙ  !
object
ÙÙ! '
template
ÙÙ( 0
)
ÙÙ0 1
{
ıı 	
if
ˆˆ 
(
ˆˆ 
template
ˆˆ 
!=
ˆˆ 
null
ˆˆ  
)
ˆˆ  !
{
˜˜ 
AddDynamicParams
¯¯  
(
¯¯  !
template
¯¯! )
)
¯¯) *
;
¯¯* +
}
˘˘ 
}
˙˙ 	
public
ÅÅ 
void
ÅÅ 
AddDynamicParams
ÅÅ $
(
ÅÅ$ %
dynamicÖÖ 
param
ÖÖ 
)áá 
{
àà 	
object
ââ 
obj
ââ 
=
ââ 
param
ââ 
as
ââ !
object
ââ" (
;
ââ( )
if
ãã 
(
ãã 
obj
ãã 
!=
ãã 
null
ãã 
)
ãã 
{
åå 
var
çç 

subDynamic
çç 
=
çç  
obj
çç! $
as
çç% '
DynamicParameters
çç( 9
;
çç9 :
if
èè 
(
èè 

subDynamic
èè 
==
èè !
null
èè" &
)
èè& '
{
êê 
	templates
ëë 
=
ëë 
	templates
ëë  )
??
ëë* ,
new
ëë- 0
List
ëë1 5
<
ëë5 6
object
ëë6 <
>
ëë< =
(
ëë= >
)
ëë> ?
;
ëë? @
	templates
íí 
.
íí 
Add
íí !
(
íí! "
obj
íí" %
)
íí% &
;
íí& '
}
ìì 
else
îî 
{
ïï 
if
ññ 
(
ññ 

subDynamic
ññ "
.
ññ" #

parameters
ññ# -
!=
ññ. 0
null
ññ1 5
)
ññ5 6
{
óó 
foreach
òò 
(
òò  !
var
òò! $
kvp
òò% (
in
òò) +

subDynamic
òò, 6
.
òò6 7

parameters
òò7 A
)
òòA B
{
ôô 

parameters
öö &
.
öö& '
Add
öö' *
(
öö* +
kvp
öö+ .
.
öö. /
Key
öö/ 2
,
öö2 3
kvp
öö4 7
.
öö7 8
Value
öö8 =
)
öö= >
;
öö> ?
}
õõ 
}
úú 
if
ûû 
(
ûû 

subDynamic
ûû "
.
ûû" #
	templates
ûû# ,
!=
ûû- /
null
ûû0 4
)
ûû4 5
{
üü 
foreach
†† 
(
††  !
var
††! $
t
††% &
in
††' )

subDynamic
††* 4
.
††4 5
	templates
††5 >
)
††> ?
{
°° 
	templates
¢¢ %
.
¢¢% &
Add
¢¢& )
(
¢¢) *
t
¢¢* +
)
¢¢+ ,
;
¢¢, -
}
££ 
}
§§ 
}
•• 
}
¶¶ 
}
ßß 	
public
±± 
void
±± 
Add
±± 
(
±± 
stringµµ 
name
µµ 
,
µµ 
object
µµ 
value
µµ 
=
µµ 
null
µµ  
,
µµ  !
DbType
µµ" (
?
µµ( )
dbType
µµ* 0
=
µµ1 2
null
µµ3 7
,
µµ7 8 
ParameterDirection
µµ9 K
?
µµK L
	direction
µµM V
=
µµW X
null
µµY ]
,
µµ] ^
int
µµ_ b
?
µµb c
size
µµd h
=
µµi j
null
µµk o
)∑∑ 
{
∏∏ 	

parameters
ππ 
[
ππ 
Clean
ππ 
(
ππ 
name
ππ !
)
ππ! "
]
ππ" #
=
ππ$ %
new
ππ& )
	ParamInfo
ππ* 3
(
ππ3 4
)
ππ4 5
{
ππ6 7
Name
ππ8 <
=
ππ= >
name
ππ? C
,
ππC D
Value
ππE J
=
ππK L
value
ππM R
,
ππR S 
ParameterDirection
ππT f
=
ππg h
	direction
ππi r
??
ππs u!
ParameterDirectionππv à
.ππà â
Inputππâ é
,ππé è
DbTypeππê ñ
=ππó ò
dbTypeππô ü
,ππü †
Sizeππ° •
=ππ¶ ß
sizeππ® ¨
}ππ≠ Æ
;ππÆ Ø
}
∫∫ 	
static
ºº 
string
ºº 
Clean
ºº 
(
ºº 
string
ºº "
name
ºº# '
)
ºº' (
{
ΩΩ 	
if
ææ 
(
ææ 
!
ææ 
string
ææ 
.
ææ 
IsNullOrEmpty
ææ %
(
ææ% &
name
ææ& *
)
ææ* +
)
ææ+ ,
{
øø 
switch
¿¿ 
(
¿¿ 
name
¿¿ 
[
¿¿ 
$num
¿¿ 
]
¿¿ 
)
¿¿  
{
¡¡ 
case
¬¬ 
$char
¬¬ 
:
¬¬ 
case
√√ 
$char
√√ 
:
√√ 
case
ƒƒ 
$char
ƒƒ 
:
ƒƒ 
return
≈≈ 
name
≈≈ #
.
≈≈# $
	Substring
≈≈$ -
(
≈≈- .
$num
≈≈. /
)
≈≈/ 0
;
≈≈0 1
}
∆∆ 
}
«« 
return
»» 
name
»» 
;
»» 
}
…… 	
void
ÀÀ 
	SqlMapper
ÀÀ 
.
ÀÀ  
IDynamicParameters
ÀÀ )
.
ÀÀ) *
AddParameters
ÀÀ* 7
(
ÀÀ7 8

IDbCommand
ÀÀ8 B
command
ÀÀC J
,
ÀÀJ K
	SqlMapper
ÀÀL U
.
ÀÀU V
Identity
ÀÀV ^
identity
ÀÀ_ g
)
ÀÀg h
{
ÃÃ 	
if
ÕÕ 
(
ÕÕ 
	templates
ÕÕ 
!=
ÕÕ 
null
ÕÕ !
)
ÕÕ! "
{
ŒŒ 
foreach
œœ 
(
œœ 
var
œœ 
template
œœ %
in
œœ& (
	templates
œœ) 2
)
œœ2 3
{
–– 
var
—— 
newIdent
——  
=
——! "
identity
——# +
.
——+ ,"
ForDynamicParameters
——, @
(
——@ A
template
——A I
.
——I J
GetType
——J Q
(
——Q R
)
——R S
)
——S T
;
——T U
Action
““ 
<
““ 

IDbCommand
““ %
,
““% &
object
““' -
>
““- .
appender
““/ 7
;
““7 8
lock
‘‘ 
(
‘‘ 
paramReaderCache
‘‘ *
)
‘‘* +
{
’’ 
if
÷÷ 
(
÷÷ 
!
÷÷ 
paramReaderCache
÷÷ -
.
÷÷- .
TryGetValue
÷÷. 9
(
÷÷9 :
newIdent
÷÷: B
,
÷÷B C
out
÷÷D G
appender
÷÷H P
)
÷÷P Q
)
÷÷Q R
{
◊◊ 
appender
ÿÿ $
=
ÿÿ% &
	SqlMapper
ÿÿ' 0
.
ÿÿ0 1&
CreateParamInfoGenerator
ÿÿ1 I
(
ÿÿI J
newIdent
ÿÿJ R
)
ÿÿR S
;
ÿÿS T
paramReaderCache
ŸŸ ,
[
ŸŸ, -
newIdent
ŸŸ- 5
]
ŸŸ5 6
=
ŸŸ7 8
appender
ŸŸ9 A
;
ŸŸA B
}
⁄⁄ 
}
€€ 
appender
›› 
(
›› 
command
›› $
,
››$ %
template
››& .
)
››. /
;
››/ 0
}
ﬁﬁ 
}
ﬂﬂ 
foreach
·· 
(
·· 
var
·· 
param
·· 
in
·· !

parameters
··" ,
.
··, -
Values
··- 3
)
··3 4
{
‚‚ 
var
„„ 
p
„„ 
=
„„ 
command
„„ 
.
„„  
CreateParameter
„„  /
(
„„/ 0
)
„„0 1
;
„„1 2
var
‰‰ 
val
‰‰ 
=
‰‰ 
param
‰‰ 
.
‰‰  
Value
‰‰  %
;
‰‰% &
p
ÂÂ 
.
ÂÂ 
ParameterName
ÂÂ 
=
ÂÂ  !
Clean
ÂÂ" '
(
ÂÂ' (
param
ÂÂ( -
.
ÂÂ- .
Name
ÂÂ. 2
)
ÂÂ2 3
;
ÂÂ3 4
p
ÊÊ 
.
ÊÊ 
Value
ÊÊ 
=
ÊÊ 
val
ÊÊ 
??
ÊÊ  
DBNull
ÊÊ! '
.
ÊÊ' (
Value
ÊÊ( -
;
ÊÊ- .
p
ÁÁ 
.
ÁÁ 
	Direction
ÁÁ 
=
ÁÁ 
param
ÁÁ #
.
ÁÁ# $ 
ParameterDirection
ÁÁ$ 6
;
ÁÁ6 7
var
ËË 
s
ËË 
=
ËË 
val
ËË 
as
ËË 
string
ËË %
;
ËË% &
if
ÈÈ 
(
ÈÈ 
s
ÈÈ 
!=
ÈÈ 
null
ÈÈ 
)
ÈÈ 
{
ÍÍ 
if
ÎÎ 
(
ÎÎ 
s
ÎÎ 
.
ÎÎ 
Length
ÎÎ  
<=
ÎÎ! #
$num
ÎÎ$ (
)
ÎÎ( )
{
ÏÏ 
p
ÌÌ 
.
ÌÌ 
Size
ÌÌ 
=
ÌÌ  
$num
ÌÌ! %
;
ÌÌ% &
}
ÓÓ 
}
ÔÔ 
if
 
(
 
param
 
.
 
Size
 
!=
 !
null
" &
)
& '
{
ÒÒ 
p
ÚÚ 
.
ÚÚ 
Size
ÚÚ 
=
ÚÚ 
param
ÚÚ "
.
ÚÚ" #
Size
ÚÚ# '
.
ÚÚ' (
Value
ÚÚ( -
;
ÚÚ- .
}
ÛÛ 
if
ÙÙ 
(
ÙÙ 
param
ÙÙ 
.
ÙÙ 
DbType
ÙÙ  
!=
ÙÙ! #
null
ÙÙ$ (
)
ÙÙ( )
{
ıı 
p
ˆˆ 
.
ˆˆ 
DbType
ˆˆ 
=
ˆˆ 
param
ˆˆ $
.
ˆˆ$ %
DbType
ˆˆ% +
.
ˆˆ+ ,
Value
ˆˆ, 1
;
ˆˆ1 2
}
˜˜ 
command
¯¯ 
.
¯¯ 

Parameters
¯¯ "
.
¯¯" #
Add
¯¯# &
(
¯¯& '
p
¯¯' (
)
¯¯( )
;
¯¯) *
param
˘˘ 
.
˘˘ 
AttachedParam
˘˘ #
=
˘˘$ %
p
˘˘& '
;
˘˘' (
}
˙˙ 
}
˚˚ 	
public
ÉÉ 
T
ÉÉ 
Get
ÉÉ 
<
ÉÉ 
T
ÉÉ 
>
ÉÉ 
(
ÉÉ 
string
ÉÉ 
name
ÉÉ #
)
ÉÉ# $
{
ÑÑ 	
var
ÖÖ 
val
ÖÖ 
=
ÖÖ 

parameters
ÖÖ  
[
ÖÖ  !
Clean
ÖÖ! &
(
ÖÖ& '
name
ÖÖ' +
)
ÖÖ+ ,
]
ÖÖ, -
.
ÖÖ- .
AttachedParam
ÖÖ. ;
.
ÖÖ; <
Value
ÖÖ< A
;
ÖÖA B
if
ÜÜ 
(
ÜÜ 
val
ÜÜ 
==
ÜÜ 
DBNull
ÜÜ 
.
ÜÜ 
Value
ÜÜ #
)
ÜÜ# $
{
áá 
if
àà 
(
àà 
default
àà 
(
àà 
T
àà 
)
àà 
!=
àà !
null
àà" &
)
àà& '
{
ââ 
throw
ää 
new
ää "
ApplicationException
ää 2
(
ää2 3
$str
ää3 h
)
ääh i
;
ääi j
}
ãã 
return
åå 
default
åå 
(
åå 
T
åå  
)
åå  !
;
åå! "
}
çç 
return
éé 
(
éé 
T
éé 
)
éé 
val
éé 
;
éé 
}
èè 	
}
êê 
public
ïï 

sealed
ïï 
class
ïï 
DbString
ïï  
{
ññ 
public
öö 
DbString
öö 
(
öö 
)
öö 
{
öö 
Length
öö "
=
öö# $
-
öö% &
$num
öö& '
;
öö' (
}
öö) *
public
ûû 
bool
ûû 
IsAnsi
ûû 
{
ûû 
get
ûû  
;
ûû  !
set
ûû" %
;
ûû% &
}
ûû' (
public
¢¢ 
bool
¢¢ 
IsFixedLength
¢¢ !
{
¢¢" #
get
¢¢$ '
;
¢¢' (
set
¢¢) ,
;
¢¢, -
}
¢¢. /
public
¶¶ 
int
¶¶ 
Length
¶¶ 
{
¶¶ 
get
¶¶ 
;
¶¶  
set
¶¶! $
;
¶¶$ %
}
¶¶& '
public
™™ 
string
™™ 
Value
™™ 
{
™™ 
get
™™ !
;
™™! "
set
™™# &
;
™™& '
}
™™( )
public
∞∞ 
void
∞∞ 
AddParameter
∞∞  
(
∞∞  !

IDbCommand
∞∞! +
command
∞∞, 3
,
∞∞3 4
string
∞∞5 ;
name
∞∞< @
)
∞∞@ A
{
±± 	
if
≤≤ 
(
≤≤ 
IsFixedLength
≤≤ 
&&
≤≤  
Length
≤≤! '
==
≤≤( *
-
≤≤+ ,
$num
≤≤, -
)
≤≤- .
{
≥≥ 
throw
¥¥ 
new
¥¥ '
InvalidOperationException
¥¥ 3
(
¥¥3 4
$str
¥¥4 s
)
¥¥s t
;
¥¥t u
}
µµ 
var
∂∂ 
param
∂∂ 
=
∂∂ 
command
∂∂ 
.
∂∂  
CreateParameter
∂∂  /
(
∂∂/ 0
)
∂∂0 1
;
∂∂1 2
param
∑∑ 
.
∑∑ 
ParameterName
∑∑ 
=
∑∑  !
name
∑∑" &
;
∑∑& '
param
∏∏ 
.
∏∏ 
Value
∏∏ 
=
∏∏ 
(
∏∏ 
object
∏∏ !
)
∏∏! "
Value
∏∏" '
??
∏∏( *
DBNull
∏∏+ 1
.
∏∏1 2
Value
∏∏2 7
;
∏∏7 8
if
ππ 
(
ππ 
Length
ππ 
==
ππ 
-
ππ 
$num
ππ 
&&
ππ 
Value
ππ  %
!=
ππ& (
null
ππ) -
&&
ππ. 0
Value
ππ1 6
.
ππ6 7
Length
ππ7 =
<=
ππ> @
$num
ππA E
)
ππE F
{
∫∫ 
param
ªª 
.
ªª 
Size
ªª 
=
ªª 
$num
ªª !
;
ªª! "
}
ºº 
else
ΩΩ 
{
ææ 
param
øø 
.
øø 
Size
øø 
=
øø 
Length
øø #
;
øø# $
}
¿¿ 
param
¡¡ 
.
¡¡ 
DbType
¡¡ 
=
¡¡ 
IsAnsi
¡¡ !
?
¡¡" #
(
¡¡$ %
IsFixedLength
¡¡% 2
?
¡¡3 4
DbType
¡¡5 ;
.
¡¡; <#
AnsiStringFixedLength
¡¡< Q
:
¡¡R S
DbType
¡¡T Z
.
¡¡Z [

AnsiString
¡¡[ e
)
¡¡e f
:
¡¡g h
(
¡¡i j
IsFixedLength
¡¡j w
?
¡¡x y
DbType¡¡z Ä
.¡¡Ä Å!
StringFixedLength¡¡Å í
:¡¡ì î
DbType¡¡ï õ
.¡¡õ ú
String¡¡ú ¢
)¡¡¢ £
;¡¡£ §
command
¬¬ 
.
¬¬ 

Parameters
¬¬ 
.
¬¬ 
Add
¬¬ "
(
¬¬" #
param
¬¬# (
)
¬¬( )
;
¬¬) *
}
√√ 	
}
ƒƒ 
}≈≈ Æ#
\C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\StackTraceSnippet.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
{ 
public 

class 
StackTraceSnippet "
{ 
private 
const 
string &
AspNetEntryPointMethodName 7
=8 9
$str: m
;m n
public 
static 
string 
Get  
(  !
)! "
{ 	
var 
frames 
= 
new 

StackTrace '
(' (
)( )
.) *
	GetFrames* 3
(3 4
)4 5
;5 6
if 
( 
frames 
== 
null 
|| !
MiniProfiler" .
.. /
Settings/ 7
.7 8
StackMaxLength8 F
<=G I
$numJ K
)K L
{ 
return 
$str 
; 
} 
var 
methods 
= 
new 
List "
<" #
string# )
>) *
(* +
)+ ,
;, -
int 
stackLength 
= 
- 
$num  
;  !
foreach 
( 

StackFrame 
t  !
in" $
frames% +
)+ ,
{ 
var   
method   
=   
t   
.   
	GetMethod   (
(  ( )
)  ) *
;  * +
if## 
(## 
method## 
.## 
Name## 
==##  "&
AspNetEntryPointMethodName### =
)##= >
break$$ 
;$$ 
if&& 
(&& 
stackLength&& 
>=&&  "
MiniProfiler&&# /
.&&/ 0
Settings&&0 8
.&&8 9
StackMaxLength&&9 G
)&&G H
break'' 
;'' 
var)) 
assembly)) 
=)) 
method)) %
.))% &
Module))& ,
.)), -
Assembly))- 5
.))5 6
GetName))6 =
())= >
)))> ?
.))? @
Name))@ D
;))D E
if** 
(** 
!** 
ShouldExcludeType** &
(**& '
method**' -
)**- .
&&++ 
!++ 
MiniProfiler++ $
.++$ %
Settings++% -
.++- .
AssembliesToExclude++. A
.++A B
Contains++B J
(++J K
assembly++K S
)++S T
&&,, 
!,, 
MiniProfiler,, $
.,,$ %
Settings,,% -
.,,- .
MethodsToExclude,,. >
.,,> ?
Contains,,? G
(,,G H
method,,H N
.,,N O
Name,,O S
),,S T
),,T U
{-- 
methods.. 
... 
Add.. 
(..  
method..  &
...& '
Name..' +
)..+ ,
;.., -
stackLength// 
+=//  "
method//# )
.//) *
Name//* .
.//. /
Length/// 5
+//6 7
$num//8 9
;//9 :
}00 
}11 
return33 
string33 
.33 
Join33 
(33 
$str33 "
,33" #
methods33$ +
)33+ ,
;33, -
}44 	
private66 
static66 
bool66 
ShouldExcludeType66 -
(66- .

MethodBase66. 8
method669 ?
)66? @
{77 	
var88 
t88 
=88 
method88 
.88 
DeclaringType88 (
;88( )
while:: 
(:: 
t:: 
!=:: 
null:: 
):: 
{;; 
if<< 
(<< 
MiniProfiler<<  
.<<  !
Settings<<! )
.<<) *
TypesToExclude<<* 8
.<<8 9
Contains<<9 A
(<<A B
t<<B C
.<<C D
Name<<D H
)<<H I
)<<I J
return== 
true== 
;==  
t?? 
=?? 
t?? 
.?? 
DeclaringType?? #
;??# $
}@@ 
returnBB 
falseBB 
;BB 
}CC 	
}DD 
}EE Ÿp
YC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Helpers\HaackFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Helpers" )
{ 
internal 
static 
class 
HaackFormatter (
{ 
public 
static 
string 
Format #
(# $
this$ (
string) /
format0 6
,6 7
object8 >
source? E
)E F
{ 	
if 
( 
format 
== 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
$str0 8
)8 9
;9 :
} 
var 
formattedStrings  
=! "
(# $
from$ (

expression) 3
in4 6
SplitFormat7 B
(B C
formatC I
)I J
select$ *

expression+ 5
.5 6
Eval6 :
(: ;
source; A
)A B
)B C
.C D
ToArrayD K
(K L
)L M
;M N
return 
string 
. 
Join 
( 
string %
.% &
Empty& +
,+ ,
formattedStrings- =
)= >
;> ?
} 	
private&& 
static&& 
IEnumerable&& "
<&&" #
ITextExpression&&# 2
>&&2 3
SplitFormat&&4 ?
(&&? @
string&&@ F
format&&G M
)&&M N
{'' 	
int(( 
exprEndIndex(( 
=(( 
-((  
$num((  !
;((! "
int)) 
expStartIndex)) 
;)) 
do++ 
{,, 
expStartIndex-- 
=-- 
format--  &
.--& '"
IndexOfExpressionStart--' =
(--= >
exprEndIndex--> J
+--K L
$num--M N
)--N O
;--O P
if.. 
(.. 
expStartIndex.. !
<.." #
$num..$ %
)..% &
{// 
if11 
(11 
exprEndIndex11 $
+11% &
$num11' (
<11) *
format11+ 1
.111 2
Length112 8
)118 9
{22 
yield33 
return33 $
new33% (
LiteralFormat33) 6
(336 7
format337 =
.33= >
	Substring33> G
(33G H
exprEndIndex33H T
+33U V
$num33W X
)33X Y
)33Y Z
;33Z [
}44 
break66 
;66 
}77 
if99 
(99 
expStartIndex99 !
-99" #
exprEndIndex99$ 0
-991 2
$num993 4
>995 6
$num997 8
)998 9
{:: 
yield<< 
return<<  
new== 
LiteralFormat== )
(==) *
format==* 0
.==0 1
	Substring==1 :
(==: ;
exprEndIndex==; G
+==H I
$num==J K
,==K L
expStartIndex==M Z
-==[ \
exprEndIndex==] i
-==j k
$num==l m
)==m n
)==n o
;==o p
}>> 
int@@ 
endBraceIndex@@ !
=@@" #
format@@$ *
.@@* + 
IndexOfExpressionEnd@@+ ?
(@@? @
expStartIndex@@@ M
+@@N O
$num@@P Q
)@@Q R
;@@R S
ifAA 
(AA 
endBraceIndexAA !
<AA" #
$numAA$ %
)AA% &
{BB 
yieldDD 
returnDD  
newDD! $
FormatExpressionDD% 5
(DD5 6
formatDD6 <
.DD< =
	SubstringDD= F
(DDF G
expStartIndexDDG T
)DDT U
)DDU V
;DDV W
}EE 
elseFF 
{GG 
exprEndIndexHH  
=HH! "
endBraceIndexHH# 0
;HH0 1
yieldKK 
returnKK  
newLL 
FormatExpressionLL ,
(LL, -
formatLL- 3
.LL3 4
	SubstringLL4 =
(LL= >
expStartIndexLL> K
,LLK L
endBraceIndexLLM Z
-LL[ \
expStartIndexLL] j
+LLk l
$numLLm n
)LLn o
)LLo p
;LLp q
}MM 
}NN 
whileOO 
(OO 
expStartIndexOO  
>OO! "
-OO# $
$numOO$ %
)OO% &
;OO& '
}PP 	
privateXX 
staticXX 
intXX "
IndexOfExpressionStartXX 1
(XX1 2
thisXX2 6
stringXX7 =
formatXX> D
,XXD E
intXXF I

startIndexXXJ T
)XXT U
{YY 	
intZZ 
indexZZ 
=ZZ 
formatZZ 
.ZZ 
IndexOfZZ &
(ZZ& '
$charZZ' *
,ZZ* +

startIndexZZ, 6
)ZZ6 7
;ZZ7 8
if[[ 
([[ 
index[[ 
==[[ 
-[[ 
$num[[ 
)[[ 
{\\ 
return]] 
index]] 
;]] 
}^^ 
ifaa 
(aa 
indexaa 
+aa 
$numaa 
<aa 
formataa "
.aa" #
Lengthaa# )
)aa) *
{bb 
charcc 
nextCharcc 
=cc 
formatcc  &
[cc& '
indexcc' ,
+cc- .
$numcc/ 0
]cc0 1
;cc1 2
ifdd 
(dd 
nextChardd 
==dd 
$chardd  #
)dd# $
{ee 
returnff "
IndexOfExpressionStartff 1
(ff1 2
formatff2 8
,ff8 9
indexff: ?
+ff@ A
$numffB C
)ffC D
;ffD E
}gg 
}hh 
returnjj 
indexjj 
;jj 
}kk 	
privatess 
staticss 
intss  
IndexOfExpressionEndss /
(ss/ 0
thisss0 4
stringss5 ;
formatss< B
,ssB C
intssD G

startIndexssH R
)ssR S
{tt 	
intuu 
endBraceIndexuu 
=uu 
formatuu  &
.uu& '
IndexOfuu' .
(uu. /
$charuu/ 2
,uu2 3

startIndexuu4 >
)uu> ?
;uu? @
ifvv 
(vv 
endBraceIndexvv 
==vv  
-vv! "
$numvv" #
)vv# $
{ww 
returnxx 
endBraceIndexxx $
;xx$ %
}yy 
int}} 

braceCount}} 
=}} 
$num}} 
;}} 
for~~ 
(~~ 
int~~ 
i~~ 
=~~ 
endBraceIndex~~ &
+~~' (
$num~~) *
;~~* +
i~~, -
<~~. /
format~~0 6
.~~6 7
Length~~7 =
;~~= >
i~~? @
++~~@ B
)~~B C
{ 
if
ÄÄ 
(
ÄÄ 
format
ÄÄ 
[
ÄÄ 
i
ÄÄ 
]
ÄÄ 
==
ÄÄ  
$char
ÄÄ! $
)
ÄÄ$ %
{
ÅÅ 

braceCount
ÇÇ 
++
ÇÇ  
;
ÇÇ  !
}
ÉÉ 
else
ÑÑ 
{
ÖÖ 
break
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 
if
ää 
(
ää 

braceCount
ää 
%
ää 
$num
ää 
==
ää !
$num
ää" #
)
ää# $
{
ãã 
return
åå "
IndexOfExpressionEnd
åå +
(
åå+ ,
format
åå, 2
,
åå2 3
endBraceIndex
åå4 A
+
ååB C

braceCount
ååD N
+
ååO P
$num
ååQ R
)
ååR S
;
ååS T
}
çç 
return
èè 
endBraceIndex
èè  
;
èè  !
}
êê 	
public
ïï 
class
ïï 
FormatExpression
ïï %
:
ïï& '
ITextExpression
ïï( 7
{
ññ 	
private
öö 
readonly
öö 
bool
öö ! 
_invalidExpression
öö" 4
=
öö5 6
false
öö7 <
;
öö< =
public
¢¢ 
FormatExpression
¢¢ #
(
¢¢# $
string
¢¢$ *

expression
¢¢+ 5
)
¢¢5 6
{
££ 
if
§§ 
(
§§ 
!
§§ 

expression
§§ 
.
§§  

StartsWith
§§  *
(
§§* +
$str
§§+ .
)
§§. /
||
§§0 2
!
§§3 4

expression
§§4 >
.
§§> ?
EndsWith
§§? G
(
§§G H
$str
§§H K
)
§§K L
)
§§L M
{
••  
_invalidExpression
¶¶ &
=
¶¶' (
true
¶¶) -
;
¶¶- .

Expression
ßß 
=
ßß  

expression
ßß! +
;
ßß+ ,
return
®® 
;
®® 
}
©© 
var
´´ %
expressionWithoutBraces
´´ +
=
´´, -

expression
´´. 8
.
´´8 9
	Substring
´´9 B
(
´´B C
$num
´´C D
,
´´D E

expression
´´F P
.
´´P Q
Length
´´Q W
-
´´X Y
$num
´´Z [
)
´´[ \
;
´´\ ]
int
¨¨ 

colonIndex
¨¨ 
=
¨¨  %
expressionWithoutBraces
¨¨! 8
.
¨¨8 9
IndexOf
¨¨9 @
(
¨¨@ A
$char
¨¨A D
)
¨¨D E
;
¨¨E F
if
≠≠ 
(
≠≠ 

colonIndex
≠≠ 
<
≠≠  
$num
≠≠! "
)
≠≠" #
{
ÆÆ 

Expression
ØØ 
=
ØØ  %
expressionWithoutBraces
ØØ! 8
;
ØØ8 9
}
∞∞ 
else
±± 
{
≤≤ 

Expression
≥≥ 
=
≥≥  %
expressionWithoutBraces
≥≥! 8
.
≥≥8 9
	Substring
≥≥9 B
(
≥≥B C
$num
≥≥C D
,
≥≥D E

colonIndex
≥≥F P
)
≥≥P Q
;
≥≥Q R
Format
¥¥ 
=
¥¥ %
expressionWithoutBraces
¥¥ 4
.
¥¥4 5
	Substring
¥¥5 >
(
¥¥> ?

colonIndex
¥¥? I
+
¥¥J K
$num
¥¥L M
)
¥¥M N
;
¥¥N O
}
µµ 
}
∂∂ 
public
ªª 
string
ªª 

Expression
ªª $
{
ºº 
get
ΩΩ 
;
ΩΩ 
private
ææ 
set
ææ 
;
ææ 
}
øø 
public
≈≈ 
string
≈≈ 
Format
≈≈  
{
«« 
get
»» 
;
»» 
private
…… 
set
…… 
;
…… 
}
   
public
—— 
string
—— 
Eval
—— 
(
—— 
object
—— %
o
——& '
)
——' (
{
““ 
if
”” 
(
””  
_invalidExpression
”” &
)
””& '
{
‘‘ 
throw
’’ 
new
’’ 
FormatException
’’ -
(
’’- .
$str
’’. B
)
’’B C
;
’’C D
}
÷÷ 
try
ÿÿ 
{
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
string
⁄⁄ 
.
⁄⁄ 
IsNullOrEmpty
⁄⁄ ,
(
⁄⁄, -
Format
⁄⁄- 3
)
⁄⁄3 4
)
⁄⁄4 5
{
€€ 
return
‹‹ 
(
‹‹  

DataBinder
‹‹  *
.
‹‹* +
Eval
‹‹+ /
(
‹‹/ 0
o
‹‹0 1
,
‹‹1 2

Expression
‹‹3 =
)
‹‹= >
??
‹‹? A
string
‹‹B H
.
‹‹H I
Empty
‹‹I N
)
‹‹N O
.
‹‹O P
ToString
‹‹P X
(
‹‹X Y
)
‹‹Y Z
;
‹‹Z [
}
›› 
return
ﬂﬂ 
(
ﬂﬂ 

DataBinder
ﬂﬂ &
.
ﬂﬂ& '
Eval
ﬂﬂ' +
(
ﬂﬂ+ ,
o
ﬂﬂ, -
,
ﬂﬂ- .

Expression
ﬂﬂ/ 9
,
ﬂﬂ9 :
$str
ﬂﬂ; @
+
ﬂﬂA B
Format
ﬂﬂC I
+
ﬂﬂJ K
$str
ﬂﬂL O
)
ﬂﬂO P
??
ﬂﬂQ S
string
ﬂﬂT Z
.
ﬂﬂZ [
Empty
ﬂﬂ[ `
)
ﬂﬂ` a
.
ﬂﬂa b
ToString
ﬂﬂb j
(
ﬂﬂj k
)
ﬂﬂk l
;
ﬂﬂl m
}
‡‡ 
catch
·· 
(
·· 
ArgumentException
·· (
)
··( )
{
‚‚ 
throw
„„ 
new
„„ 
FormatException
„„ -
(
„„- .
)
„„. /
;
„„/ 0
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
HttpException
ÂÂ $
)
ÂÂ$ %
{
ÊÊ 
throw
ÁÁ 
new
ÁÁ 
FormatException
ÁÁ -
(
ÁÁ- .
)
ÁÁ. /
;
ÁÁ/ 0
}
ËË 
}
ÈÈ 
}
ÍÍ 	
public
ÔÔ 
class
ÔÔ 
LiteralFormat
ÔÔ "
:
ÔÔ# $
ITextExpression
ÔÔ% 4
{
 	
public
˜˜ 
LiteralFormat
˜˜  
(
˜˜  !
string
˜˜! '
literalText
˜˜( 3
)
˜˜3 4
{
¯¯ 
LiteralText
˘˘ 
=
˘˘ 
literalText
˘˘ )
;
˘˘) *
}
˙˙ 
public
ˇˇ 
string
ˇˇ 
LiteralText
ˇˇ %
{
ÄÄ 
get
ÅÅ 
;
ÅÅ 
private
ÇÇ 
set
ÇÇ 
;
ÇÇ 
}
ÉÉ 
public
ää 
string
ää 
Eval
ää 
(
ää 
object
ää %
o
ää& '
)
ää' (
{
ãã 
string
åå 
literalText
åå "
=
åå# $
LiteralText
åå% 0
.
çç 
Replace
çç 
(
çç 
$str
çç !
,
çç! "
$str
çç# &
)
çç& '
.
éé 
Replace
éé 
(
éé 
$str
éé !
,
éé! "
$str
éé# &
)
éé& '
;
éé' (
return
èè 
literalText
èè "
;
èè" #
}
êê 
}
ëë 	
public
ññ 
	interface
ññ 
ITextExpression
ññ (
{
óó 	
string
ùù 
Eval
ùù 
(
ùù 
object
ùù 
o
ùù  
)
ùù  !
;
ùù! "
}
ûû 	
}
üü 
}†† ˚

TC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\IpAddressProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public		 

class		 
IpAddressIdentity		 "
:		# $
IUserProvider		% 2
{

 
public 
string 
GetUser 
( 
HttpRequest )
request* 1
)1 2
{ 	
if 
( 
String 
. 
IsNullOrWhiteSpace )
() *
request* 1
.1 2
ServerVariables2 A
[A B
$strB X
]X Y
)Y Z
)Z [
{ 
return 
request 
. 
ServerVariables .
[. /
$str/ <
]< =
??> @
$strA C
;C D
} 
return 
string 
. 
Format  
(  !
$str! ,
,, -
request. 5
.5 6
ServerVariables6 E
[E F
$strF S
]S T
??U W
$strX Z
,Z [
request. 5
.5 6
ServerVariables6 E
[E F
$strF \
]\ ]
)] ^
;^ _
} 	
} 
} ¯
TC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\IProfilerProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public		 

	interface		 
IProfilerProvider		 &
{

 
MiniProfiler 
Start 
( 
ProfileLevel '
level( -
,- .
string/ 5
sessionName6 A
=B C
nullD H
)H I
;I J
void 
Stop 
( 
bool 
discardResults %
)% &
;& '
MiniProfiler"" 
GetCurrentProfiler"" '
(""' (
)""( )
;"") *
}## 
}$$ ™
PC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\IUserProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

	interface 
IUserProvider "
{		 
string 
GetUser 
( 
HttpRequest "
request# *
)* +
;+ ,
} 
} ´
[C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\MiniProfiler.IDbProfiler.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
partial 
class 
MiniProfiler 
:  
IDbProfiler! ,
{		 
internal 
SqlProfiler 
SqlProfiler (
{) *
get+ .
;. /
private0 7
set8 ;
;; <
}= >
void 
IDbProfiler 
. 
ExecuteStart %
(% &

IDbCommand& 0
profiledDbCommand1 B
,B C
SqlExecuteTypeD R
executeTypeS ^
)^ _
{ 	
SqlProfiler 
. 
ExecuteStart $
($ %
profiledDbCommand% 6
,6 7
executeType8 C
)C D
;D E
} 	
void 
IDbProfiler 
. 
ExecuteFinish &
(& '

IDbCommand' 1
profiledDbCommand2 C
,C D
SqlExecuteTypeE S
executeTypeT _
,_ `
DbDataReadera m
readern t
)t u
{ 	
if 
( 
reader 
!= 
null 
) 
{ 
SqlProfiler 
. 
ExecuteFinish )
() *
profiledDbCommand* ;
,; <
executeType= H
,H I
readerJ P
)P Q
;Q R
} 
else 
{ 
SqlProfiler 
. 
ExecuteFinish )
() *
profiledDbCommand* ;
,; <
executeType= H
)H I
;I J
} 
}   	
void"" 
IDbProfiler"" 
."" 
ReaderFinish"" %
(""% &
IDataReader""& 1
reader""2 8
)""8 9
{## 	
SqlProfiler$$ 
.$$ 
ReaderFinish$$ $
($$$ %
reader$$% +
)$$+ ,
;$$, -
}%% 	
void'' 
IDbProfiler'' 
.'' 
OnError''  
(''  !

IDbCommand''! +
profiledDbCommand'', =
,''= >
SqlExecuteType''? M
executeType''N Y
,''Y Z
	Exception''[ d
	exception''e n
)''n o
{(( 	
}** 	
bool-- 
	_isActive-- 
;-- 
bool.. 
IDbProfiler.. 
... 
IsActive.. !
{.." #
get..$ '
{..( )
return..* 0
	_isActive..1 :
;..: ;
}..< =
}..> ?
internal// 
bool// 
IsActive// 
{00 	
get11 
{11 
return11 
	_isActive11 "
;11" #
}11$ %
set22 
{22 
	_isActive22 
=22 
value22 #
;22# $
}22% &
}33 	
}44 
}55 ˙ö
XC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\MiniProfiler.Settings.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
partial 
class 
MiniProfiler 
{ 
public 
static 
class 
Settings $
{ 	
private 
static 
readonly #
HashSet$ +
<+ ,
string, 2
>2 3
assembliesToExclude4 G
;G H
private 
static 
readonly #
HashSet$ +
<+ ,
string, 2
>2 3
typesToExclude4 B
;B C
private 
static 
readonly #
HashSet$ +
<+ ,
string, 2
>2 3
methodsToExclude4 D
;D E
static 
Settings 
( 
) 
{ 
var 
props 
= 
from  
p! "
in# %
typeof& ,
(, -
Settings- 5
)5 6
.6 7
GetProperties7 D
(D E
BindingFlagsE Q
.Q R
PublicR X
|Y Z
BindingFlags[ g
.g h
Statich n
)n o
let 
t  !
=" #
typeof$ *
(* +!
DefaultValueAttribute+ @
)@ A
where !
p" #
.# $
	IsDefined$ -
(- .
t. /
,/ 0
inherit1 8
:8 9
false: ?
)? @
let 
a  !
=" #
p$ %
.% &
GetCustomAttributes& 9
(9 :
t: ;
,; <
inherit= D
:D E
falseF K
)K L
.L M
SingleM S
(S T
)T U
asV X!
DefaultValueAttributeY n
select "
new# &
{' (
PropertyInfo) 5
=6 7
p8 9
,9 :
DefaultValue; G
=H I
aJ K
}L M
;M N
foreach!! 
(!! 
var!! 
pair!! !
in!!" $
props!!% *
)!!* +
{"" 
pair## 
.## 
PropertyInfo## %
.##% &
SetValue##& .
(##. /
null##/ 3
,##3 4
Convert##5 <
.##< =

ChangeType##= G
(##G H
pair##H L
.##L M
DefaultValue##M Y
.##Y Z
Value##Z _
,##_ `
pair##a e
.##e f
PropertyInfo##f r
.##r s
PropertyType##s 
)	## Ä
,
##Ä Å
null
##Ç Ü
)
##Ü á
;
##á à
}$$ 
string(( 
location(( 
;((  
try)) 
{** 
location++ 
=++ 
typeof++ %
(++& '
Settings++' /
)++/ 0
.++0 1
Assembly++1 9
.++9 :
Location++: B
;++B C
},, 
catch-- 
{.. 
location// 
=// 
HttpContext// *
.//* +
Current//+ 2
.//2 3
Server//3 9
.//9 :
MapPath//: A
(//A B
$str//B Z
)//Z [
;//[ \
}00 
try22 
{33 
List44 
<44 
string44 
>44  
files44! &
=44' (
new44) ,
List44- 1
<441 2
string442 8
>448 9
(449 :
)44: ;
;44; <
files55 
.55 
Add55 
(55 
location55 &
)55& '
;55' (
string77 !
customUITemplatesPath77 0
=771 2
$str773 5
;775 6
if88 
(88 
HttpContext88 #
.88# $
Current88$ +
!=88, .
null88/ 3
)883 4!
customUITemplatesPath99 -
=99. /
HttpContext990 ;
.99; <
Current99< C
.99C D
Server99D J
.99J K
MapPath99K R
(99R S
MiniProfiler99S _
.99_ `
Settings99` h
.99h i
CustomUITemplates99i z
)99z {
;99{ |
if;; 
(;; 
System;; 
.;; 
IO;; !
.;;! "
	Directory;;" +
.;;+ ,
Exists;;, 2
(;;2 3!
customUITemplatesPath;;3 H
);;H I
);;I J
{<< 
files== 
.== 
AddRange== &
(==& '
System==' -
.==- .
IO==. 0
.==0 1
	Directory==1 :
.==: ;
EnumerateFiles==; I
(==I J!
customUITemplatesPath==J _
)==_ `
)==` a
;==a b
}>> 
using@@ 
(@@ 
var@@ 
sha256@@ %
=@@& '
new@@( +
System@@, 2
.@@2 3
Security@@3 ;
.@@; <
Cryptography@@< H
.@@H I'
SHA256CryptoServiceProvider@@I d
(@@d e
)@@e f
)@@f g
{AA 
byteBB 
[BB 
]BB 
hashBB #
=BB$ %
newBB& )
byteBB* .
[BB. /
sha256BB/ 5
.BB5 6
HashSizeBB6 >
/BB? @
$numBBA B
]BBB C
;BBC D
foreachCC 
(CC  !
stringCC! '
fileCC( ,
inCC- /
filesCC0 5
)CC5 6
{DD 
byteFF  
[FF  !
]FF! "
contentsFF# +
=FF, -
SystemFF. 4
.FF4 5
IOFF5 7
.FF7 8
FileFF8 <
.FF< =
ReadAllBytesFF= I
(FFI J
fileFFJ N
)FFN O
;FFO P
byteGG  
[GG  !
]GG! "
hashfileGG# +
=GG, -
sha256GG. 4
.GG4 5
ComputeHashGG5 @
(GG@ A
contentsGGA I
)GGI J
;GGJ K
forHH 
(HH  !
intHH! $
iHH% &
=HH' (
$numHH) *
;HH* +
iHH, -
<HH. /
(HH0 1
sha256HH1 7
.HH7 8
HashSizeHH8 @
/HHA B
$numHHC D
)HHD E
;HHE F
iHHG H
++HHH J
)HHJ K
{II 
hashJJ  $
[JJ$ %
iJJ% &
]JJ& '
=JJ( )
(JJ* +
byteJJ+ /
)JJ/ 0
(JJ0 1
hashfileJJ1 9
[JJ9 :
iJJ: ;
]JJ; <
^JJ= >
hashJJ? C
[JJC D
iJJD E
]JJE F
)JJF G
;JJG H
}KK 
}LL 
VersionMM 
=MM  !
SystemMM" (
.MM( )
ConvertMM) 0
.MM0 1
ToBase64StringMM1 ?
(MM? @
hashMM@ D
)MMD E
;MME F
}NN 
}OO 
catchPP 
{QQ 
VersionRR 
=RR 
GuidRR "
.RR" #
NewGuidRR# *
(RR* +
)RR+ ,
.RR, -
ToStringRR- 5
(RR5 6
)RR6 7
;RR7 8
}SS 
typesToExcludeUU 
=UU  
newUU! $
HashSetUU% ,
<UU, -
stringUU- 3
>UU3 4
{VV 
$strXX 
}YY 
;YY 
methodsToExclude[[  
=[[! "
new[[# &
HashSet[[' .
<[[. /
string[[/ 5
>[[5 6
{\\ 
$str]] #
,]]# $
$str^^ 
}__ 
;__ 
assembliesToExcludeaa #
=aa$ %
newaa& )
HashSetaa* 1
<aa1 2
stringaa2 8
>aa8 9
{bb 
typeofdd 
(dd 
Settingsdd #
)dd# $
.dd$ %
Assemblydd% -
.dd- .
GetNamedd. 5
(dd5 6
)dd6 7
.dd7 8
Namedd8 <
,dd< =
$strgg @
,gg@ A
$strjj !
,jj! "
$strkk !
,kk! "
$strll &
,ll& '
$strmm  
,mm  !
$strnn $
,nn$ %
$stroo 
,oo 
}pp 
;pp 
StopwatchProviderss !
=ss" #
StopwatchWrapperss$ 4
.ss4 5
StartNewss5 =
;ss= >
}tt 
publiczz 
staticzz 
IEnumerablezz %
<zz% &
stringzz& ,
>zz, -
AssembliesToExcludezz. A
{{{ 
get|| 
{|| 
return|| 
assembliesToExclude|| 0
;||0 1
}||2 3
}}} 
public
ÉÉ 
static
ÉÉ 
IEnumerable
ÉÉ %
<
ÉÉ% &
string
ÉÉ& ,
>
ÉÉ, -
TypesToExclude
ÉÉ. <
{
ÑÑ 
get
ÖÖ 
{
ÖÖ 
return
ÖÖ 
typesToExclude
ÖÖ +
;
ÖÖ+ ,
}
ÖÖ- .
}
ÜÜ 
public
åå 
static
åå 
IEnumerable
åå %
<
åå% &
string
åå& ,
>
åå, -
MethodsToExclude
åå. >
{
çç 
get
éé 
{
éé 
return
éé 
methodsToExclude
éé -
;
éé- .
}
éé/ 0
}
èè 
public
ïï 
static
ïï 
void
ïï 
ExcludeAssembly
ïï .
(
ïï. /
string
ïï/ 5
assemblyName
ïï6 B
)
ïïB C
{
ññ !
assembliesToExclude
óó #
.
óó# $
Add
óó$ '
(
óó' (
assemblyName
óó( 4
)
óó4 5
;
óó5 6
}
òò 
public
ûû 
static
ûû 
void
ûû 
ExcludeType
ûû *
(
ûû* +
string
ûû+ 1
typeToExclude
ûû2 ?
)
ûû? @
{
üü 
typesToExclude
†† 
.
†† 
Add
†† "
(
††" #
typeToExclude
††# 0
)
††0 1
;
††1 2
}
°° 
public
ßß 
static
ßß 
void
ßß 
ExcludeMethod
ßß ,
(
ßß, -
string
ßß- 3

methodName
ßß4 >
)
ßß> ?
{
®® 
methodsToExclude
©©  
.
©©  !
Add
©©! $
(
©©$ %

methodName
©©% /
)
©©/ 0
;
©©0 1
}
™™ 
[
ØØ 
DefaultValue
ØØ 
(
ØØ 
$num
ØØ 
)
ØØ 
]
ØØ 
public
∞∞ 
static
∞∞ 
int
∞∞ !
MaxUnviewedProfiles
∞∞ 1
{
∞∞2 3
get
∞∞4 7
;
∞∞7 8
set
∞∞9 <
;
∞∞< =
}
∞∞> ?
[
µµ 
DefaultValue
µµ 
(
µµ 
$num
µµ 
)
µµ 
]
µµ 
public
∂∂ 
static
∂∂ 
int
∂∂ 
StackMaxLength
∂∂ ,
{
∂∂- .
get
∂∂/ 2
;
∂∂2 3
set
∂∂4 7
;
∂∂7 8
}
∂∂9 :
[
ªª 
DefaultValue
ªª 
(
ªª 
$num
ªª 
)
ªª 
]
ªª 
public
ºº 
static
ºº 
decimal
ºº !2
$TrivialDurationThresholdMilliseconds
ºº" F
{
ººG H
get
ººI L
;
ººL M
set
ººN Q
;
ººQ R
}
ººS T
[
¬¬ 
DefaultValue
¬¬ 
(
¬¬ 
false
¬¬ 
)
¬¬  
]
¬¬  !
public
√√ 
static
√√ 
bool
√√ '
PopupShowTimeWithChildren
√√ 8
{
√√9 :
get
√√; >
;
√√> ?
set
√√@ C
;
√√C D
}
√√E F
[
…… 
DefaultValue
…… 
(
…… 
false
…… 
)
……  
]
……  !
public
   
static
   
bool
   
PopupShowTrivial
   /
{
  0 1
get
  2 5
;
  5 6
set
  7 :
;
  : ;
}
  < =
[
–– 
DefaultValue
–– 
(
–– 
$num
–– 
)
–– 
]
–– 
public
—— 
static
—— 
int
—— "
PopupMaxTracesToShow
—— 2
{
——3 4
get
——5 8
;
——8 9
set
——: =
;
——= >
}
——? @
[
◊◊ 
DefaultValue
◊◊ 
(
◊◊ 
RenderPosition
◊◊ (
.
◊◊( )
Left
◊◊) -
)
◊◊- .
]
◊◊. /
public
ÿÿ 
static
ÿÿ 
RenderPosition
ÿÿ (!
PopupRenderPosition
ÿÿ) <
{
ÿÿ= >
get
ÿÿ? B
;
ÿÿB C
set
ÿÿD G
;
ÿÿG H
}
ÿÿI J
[
›› 
DefaultValue
›› 
(
›› 
$str
›› !
)
››! "
]
››" #
public
ﬁﬁ 
static
ﬁﬁ 
string
ﬁﬁ  )
PopupToggleKeyboardShortcut
ﬁﬁ! <
{
ﬁﬁ= >
get
ﬁﬁ? B
;
ﬁﬁB C
set
ﬁﬁD G
;
ﬁﬁG H
}
ﬁﬁI J
[
„„ 
DefaultValue
„„ 
(
„„ 
false
„„ 
)
„„  
]
„„  !
public
‰‰ 
static
‰‰ 
bool
‰‰ 
PopupStartHidden
‰‰ /
{
‰‰0 1
get
‰‰2 5
;
‰‰5 6
set
‰‰7 :
;
‰‰: ;
}
‰‰< =
[
ÍÍ 
DefaultValue
ÍÍ 
(
ÍÍ 
false
ÍÍ 
)
ÍÍ  
]
ÍÍ  !
public
ÎÎ 
static
ÎÎ 
bool
ÎÎ 
ShowControls
ÎÎ +
{
ÎÎ, -
get
ÎÎ. 1
;
ÎÎ1 2
set
ÎÎ3 6
;
ÎÎ6 7
}
ÎÎ8 9
[
ÒÒ 
DefaultValue
ÒÒ 
(
ÒÒ 
false
ÒÒ 
)
ÒÒ  
]
ÒÒ  !
[
ÚÚ 
Obsolete
ÚÚ 
(
ÚÚ 
$strÚÚ á
,ÚÚá à
trueÚÚâ ç
)ÚÚç é
]ÚÚé è
public
ÛÛ 
static
ÛÛ 
bool
ÛÛ 
UseExistingjQuery
ÛÛ 0
{
ÛÛ1 2
get
ÛÛ3 6
;
ÛÛ6 7
set
ÛÛ8 ;
;
ÛÛ; <
}
ÛÛ= >
[
˘˘ 
DefaultValue
˘˘ 
(
˘˘ 
false
˘˘ 
)
˘˘  
,
˘˘  !
Obsolete
˘˘" *
(
˘˘* +
$str
˘˘+ Z
)
˘˘Z [
]
˘˘[ \
public
˙˙ 
static
˙˙ 
bool
˙˙ 4
&ExcludeStackTraceSnippetFromSqlTimings
˙˙ E
{
˙˙F G
get
˙˙H K
;
˙˙K L
set
˙˙M P
;
˙˙P Q
}
˙˙R S
[
ÅÅ 
DefaultValue
ÅÅ 
(
ÅÅ 
false
ÅÅ 
)
ÅÅ  
]
ÅÅ  !
public
ÇÇ 
static
ÇÇ 
bool
ÇÇ 7
)ExcludeStackTraceSnippetFromCustomTimings
ÇÇ H
{
ÇÇI J
get
ÇÇK N
;
ÇÇN O
set
ÇÇP S
;
ÇÇS T
}
ÇÇU V
[
ää 
DefaultValue
ää 
(
ää 
new
ää 
string
ää $
[
ää$ %
]
ää% &
{
ää' (
$str
ää) 4
,
ää4 5
$str
ää6 A
,
ääA B
$str
ääC Q
}
ääR S
)
ääS T
]
ääT U
public
ãã 
static
ãã 
string
ãã  
[
ãã  !
]
ãã! "
IgnoredPaths
ãã# /
{
ãã0 1
get
ãã2 5
;
ãã5 6
set
ãã7 :
;
ãã: ;
}
ãã< =
[
íí 
DefaultValue
íí 
(
íí 
$str
íí 5
)
íí5 6
]
íí6 7
public
ìì 
static
ìì 
string
ìì  
RouteBasePath
ìì! .
{
ìì/ 0
get
ìì1 4
;
ìì4 5
set
ìì6 9
;
ìì9 :
}
ìì; <
[
õõ 
DefaultValue
õõ 
(
õõ 
$str
õõ 5
)
õõ5 6
]
õõ6 7
public
úú 
static
úú 
string
úú  
CustomUITemplates
úú! 2
{
úú3 4
get
úú5 8
;
úú8 9
set
úú: =
;
úú= >
}
úú? @
[
°° 
DefaultValue
°° 
(
°° 
$num
°° !
)
°°! "
]
°°" #
public
¢¢ 
static
¢¢ 
int
¢¢ !
MaxJsonResponseSize
¢¢ 1
{
¢¢2 3
get
¢¢4 7
;
¢¢7 8
set
¢¢9 <
;
¢¢< =
}
¢¢> ?
public
≥≥ 
static
≥≥ 
Storage
≥≥ !
.
≥≥! "
IStorage
≥≥" *
Storage
≥≥+ 2
{
≥≥3 4
get
≥≥5 8
;
≥≥8 9
set
≥≥: =
;
≥≥= >
}
≥≥? @
public
∏∏ 
static
∏∏ 
ISqlFormatter
∏∏ '
SqlFormatter
∏∏( 4
{
∏∏5 6
get
∏∏7 :
;
∏∏: ;
set
∏∏< ?
;
∏∏? @
}
∏∏A B
public
ΩΩ 
static
ΩΩ 
string
ΩΩ  
Version
ΩΩ! (
{
ΩΩ) *
get
ΩΩ+ .
;
ΩΩ. /
private
ΩΩ0 7
set
ΩΩ8 ;
;
ΩΩ; <
}
ΩΩ= >
public
≈≈ 
static
≈≈ 
IProfilerProvider
≈≈ +
ProfilerProvider
≈≈, <
{
≈≈= >
get
≈≈? B
;
≈≈B C
set
≈≈D G
;
≈≈G H
}
≈≈I J
public
ŒŒ 
static
ŒŒ 
Func
ŒŒ 
<
ŒŒ 
HttpRequest
ŒŒ *
,
ŒŒ* +
bool
ŒŒ, 0
>
ŒŒ0 1
Results_Authorize
ŒŒ2 C
{
ŒŒD E
get
ŒŒF I
;
ŒŒI J
set
ŒŒK N
;
ŒŒN O
}
ŒŒP Q
public
‘‘ 
static
‘‘ 
Func
‘‘ 
<
‘‘ 
HttpRequest
‘‘ *
,
‘‘* +
bool
‘‘, 0
>
‘‘0 1$
Results_List_Authorize
‘‘2 H
{
‘‘I J
get
‘‘K N
;
‘‘N O
set
‘‘P S
;
‘‘S T
}
‘‘U V
internal
ŸŸ 
static
ŸŸ 
void
ŸŸ  #
EnsureStorageStrategy
ŸŸ! 6
(
ŸŸ6 7
)
ŸŸ7 8
{
⁄⁄ 
if
€€ 
(
€€ 
Storage
€€ 
==
€€ 
null
€€ #
)
€€# $
{
‹‹ 
Storage
›› 
=
›› 
new
›› !
Storage
››" )
.
››) *%
HttpRuntimeCacheStorage
››* A
(
››A B
TimeSpan
››B J
.
››J K
FromDays
››K S
(
››S T
$num
››T U
)
››U V
)
››V W
;
››W X
}
ﬁﬁ 
}
ﬂﬂ 
internal
·· 
static
·· 
void
··  $
EnsureProfilerProvider
··! 7
(
··7 8
)
··8 9
{
‚‚ 
if
„„ 
(
„„ 
ProfilerProvider
„„ $
==
„„% '
null
„„( ,
)
„„, -
{
‰‰ 
ProfilerProvider
ÂÂ $
=
ÂÂ% &
new
ÂÂ' *(
WebRequestProfilerProvider
ÂÂ+ E
(
ÂÂE F
)
ÂÂF G
;
ÂÂG H
}
ÊÊ 
}
ÁÁ 
internal
ÏÏ 
static
ÏÏ 
Func
ÏÏ  
<
ÏÏ  !

IStopwatch
ÏÏ! +
>
ÏÏ+ ,
StopwatchProvider
ÏÏ- >
{
ÏÏ? @
get
ÏÏA D
;
ÏÏD E
set
ÏÏF I
;
ÏÏI J
}
ÏÏK L
[
ÚÚ 
DefaultValue
ÚÚ 
(
ÚÚ 
true
ÚÚ 
)
ÚÚ 
]
ÚÚ  
public
ÛÛ 
static
ÛÛ 
bool
ÛÛ 
EnableCompression
ÛÛ 0
{
ÛÛ1 2
get
ÛÛ3 6
;
ÛÛ6 7
set
ÛÛ8 ;
;
ÛÛ; <
}
ÛÛ= >
}
ÙÙ 	
}
ıı 
}ˆˆ •Ã
OC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\MiniProfiler.cs
	namespace

 	
StackExchange


 
.

 
	Profiling

 !
{ 
[ 
DataContract 
] 
public 

partial 
class 
MiniProfiler %
{ 
[ 	
Obsolete	 
( 
$str *
)* +
]+ ,
public 
MiniProfiler 
( 
) 
{ 	
} 	
public   
MiniProfiler   
(   
string   "
url  # &
)  & '
{!! 	
Id"" 
="" 
Guid"" 
."" 
NewGuid"" 
("" 
)"" 
;""  
Level$$ 
=$$ 
ProfileLevel$$  
.$$  !
Info$$! %
;$$% &
SqlProfiler&& 
=&& 
new&& 
SqlProfiler&& )
(&&) *
this&&* .
)&&. /
;&&/ 0
MachineName'' 
='' 
Environment'' %
.''% &
MachineName''& 1
;''1 2
Started(( 
=(( 
DateTime(( 
.(( 
UtcNow(( %
;((% &
_sw++ 
=++ 
Settings++ 
.++ 
StopwatchProvider++ ,
(++, -
)++- .
;++. /
Root,, 
=,, 
new,, 
Timing,, 
(,, 
this,, "
,,," #
null,,$ (
,,,( )
url,,* -
),,- .
;,,. /
}-- 	
[33 	
Obsolete33	 
(33 
$str33 w
)33w x
]33x y
public44 
MiniProfiler44 
(44 
string44 "
url44# &
,44& '
ProfileLevel44( 4
level445 :
=44; <
ProfileLevel44= I
.44I J
Info44J N
)44N O
:44P Q
this44R V
(44V W
url44W Z
)44Z [
{55 	
Level77 
=77 
level77 
;77 
}99 	
private?? 
readonly?? 

IStopwatch?? #
_sw??$ '
;??' (
privateDD 
TimingDD 
_rootDD 
;DD 
[JJ 	

DataMemberJJ	 
(JJ 
OrderJJ 
=JJ 
$numJJ 
)JJ 
]JJ 
publicKK 
GuidKK 
IdKK 
{KK 
getKK 
;KK 
setKK !
;KK! "
}KK# $
[PP 	

DataMemberPP	 
(PP 
OrderPP 
=PP 
$numPP 
)PP 
]PP 
publicQQ 
stringQQ 
NameQQ 
{QQ 
getQQ  
;QQ  !
setQQ" %
;QQ% &
}QQ' (
[VV 	

DataMemberVV	 
(VV 
OrderVV 
=VV 
$numVV 
)VV 
]VV 
publicWW 
DateTimeWW 
StartedWW 
{WW  !
getWW" %
;WW% &
setWW' *
;WW* +
}WW, -
[\\ 	

DataMember\\	 
(\\ 
Order\\ 
=\\ 
$num\\ 
)\\ 
]\\ 
public]] 
decimal]]  
DurationMilliseconds]] +
{]], -
get]]. 1
;]]1 2
set]]3 6
;]]6 7
}]]8 9
[bb 	

DataMemberbb	 
(bb 
Orderbb 
=bb 
$numbb 
)bb 
]bb 
publiccc 
stringcc 
MachineNamecc !
{cc" #
getcc$ '
;cc' (
setcc) ,
;cc, -
}cc. /
[ll 	

DataMemberll	 
(ll 
Orderll 
=ll 
$numll 
)ll 
]ll 
publicmm 

Dictionarymm 
<mm 
stringmm  
,mm  !
stringmm" (
>mm( )
CustomLinksmm* 5
{mm6 7
getmm8 ;
;mm; <
setmm= @
;mm@ A
}mmB C
[rr 	
ScriptIgnorerr	 
]rr 
publicss 
stringss 
CustomLinksJsonss %
{ss& '
gettt 
{tt 
returntt 
CustomLinkstt $
!=tt% '
nulltt( ,
?tt- .
CustomLinkstt/ :
.tt: ;
ToJsontt; A
(ttA B
)ttB C
:ttD E
nullttF J
;ttJ K
}ttL M
setuu 
{uu 
ifvv 
(vv 
valuevv 
.vv 
HasValuevv "
(vv" #
)vv# $
)vv$ %
{ww 
CustomLinksxx 
=xx  !
valuexx" '
.xx' (
FromJsonxx( 0
<xx0 1

Dictionaryxx1 ;
<xx; <
stringxx< B
,xxB C
stringxxD J
>xxJ K
>xxK L
(xxL M
)xxM N
;xxN O
}yy 
}zz 
}{{ 	
[
ÇÇ 	

DataMember
ÇÇ	 
(
ÇÇ 
Order
ÇÇ 
=
ÇÇ 
$num
ÇÇ 
)
ÇÇ 
]
ÇÇ 
public
ÉÉ 
Timing
ÉÉ 
Root
ÉÉ 
{
ÑÑ 	
get
ÖÖ 
{
ÜÜ 
return
áá 
_root
áá 
;
áá 
}
àà 
set
ââ 
{
ää 
_root
ãã 
=
ãã 
value
ãã 
;
ãã 
RootTimingId
åå 
=
åå 
value
åå $
.
åå$ %
Id
åå% '
;
åå' (
if
ëë 
(
ëë 
_root
ëë 
.
ëë 
HasChildren
ëë %
)
ëë% &
{
íí 
var
ìì 
timings
ìì 
=
ìì  !
new
ìì" %
Stack
ìì& +
<
ìì+ ,
Timing
ìì, 2
>
ìì2 3
(
ìì3 4
)
ìì4 5
;
ìì5 6
timings
ïï 
.
ïï 
Push
ïï  
(
ïï  !
_root
ïï! &
)
ïï& '
;
ïï' (
while
óó 
(
óó 
timings
óó "
.
óó" #
Count
óó# (
>
óó) *
$num
óó+ ,
)
óó, -
{
òò 
var
ôô 
timing
ôô "
=
ôô# $
timings
ôô% ,
.
ôô, -
Pop
ôô- 0
(
ôô0 1
)
ôô1 2
;
ôô2 3
if
õõ 
(
õõ 
timing
õõ "
.
õõ" #
HasChildren
õõ# .
)
õõ. /
{
úú 
var
ùù 
children
ùù  (
=
ùù) *
timing
ùù+ 1
.
ùù1 2
Children
ùù2 :
;
ùù: ;
for
üü 
(
üü  !
int
üü! $
i
üü% &
=
üü' (
children
üü) 1
.
üü1 2
Count
üü2 7
-
üü8 9
$num
üü: ;
;
üü; <
i
üü= >
>=
üü? A
$num
üüB C
;
üüC D
i
üüE F
--
üüF H
)
üüH I
{
†† 
children
°°  (
[
°°( )
i
°°) *
]
°°* +
.
°°+ ,
ParentTiming
°°, 8
=
°°9 :
timing
°°; A
;
°°A B
timings
¢¢  '
.
¢¢' (
Push
¢¢( ,
(
¢¢, -
children
¢¢- 5
[
¢¢5 6
i
¢¢6 7
]
¢¢7 8
)
¢¢8 9
;
¢¢9 :
}
££ 
}
§§ 
}
•• 
}
¶¶ 
}
ßß 
}
®® 	
[
≠≠ 	
ScriptIgnore
≠≠	 
]
≠≠ 
public
ÆÆ 
Guid
ÆÆ 
?
ÆÆ 
RootTimingId
ÆÆ !
{
ÆÆ" #
get
ÆÆ$ '
;
ÆÆ' (
set
ÆÆ) ,
;
ÆÆ, -
}
ÆÆ. /
[
≥≥ 	

DataMember
≥≥	 
(
≥≥ 
Order
≥≥ 
=
≥≥ 
$num
≥≥ 
)
≥≥ 
]
≥≥ 
public
¥¥ 
ClientTimings
¥¥ 
ClientTimings
¥¥ *
{
¥¥+ ,
get
¥¥- 0
;
¥¥0 1
set
¥¥2 5
;
¥¥5 6
}
¥¥7 8
[
ππ 	
ScriptIgnore
ππ	 
]
ππ 
public
∫∫ 
int
∫∫ 
?
∫∫ (
ClientTimingsRedirectCount
∫∫ .
{
∫∫/ 0
get
∫∫1 4
;
∫∫4 5
set
∫∫6 9
;
∫∫9 :
}
∫∫; <
[
√√ 	

DataMember
√√	 
(
√√ 
Order
√√ 
=
√√ 
$num
√√ 
)
√√ 
]
√√ 
public
ƒƒ 
string
ƒƒ 
User
ƒƒ 
{
ƒƒ 
get
ƒƒ  
;
ƒƒ  !
set
ƒƒ" %
;
ƒƒ% &
}
ƒƒ' (
[
ÕÕ 	

DataMember
ÕÕ	 
(
ÕÕ 
Order
ÕÕ 
=
ÕÕ 
$num
ÕÕ 
)
ÕÕ 
]
ÕÕ  
[
ŒŒ 	
ScriptIgnore
ŒŒ	 
]
ŒŒ 
public
œœ 
bool
œœ 
HasUserViewed
œœ !
{
œœ" #
get
œœ$ '
;
œœ' (
set
œœ) ,
;
œœ, -
}
œœ. /
[
’’ 	
Obsolete
’’	 
(
’’ 
$str
’’ f
)
’’f g
]
’’g h
[
÷÷ 	
ScriptIgnore
÷÷	 
]
÷÷ 
public
◊◊ 
ProfileLevel
◊◊ 
Level
◊◊ !
{
◊◊" #
get
◊◊$ '
;
◊◊' (
set
◊◊) ,
;
◊◊, -
}
◊◊. /
[
‹‹ 	
ScriptIgnore
‹‹	 
]
‹‹ 
public
›› 
Timing
›› 
Head
›› 
{
›› 
get
››  
;
››  !
set
››" %
;
››% &
}
››' (
internal
‚‚ 
long
‚‚ 
ElapsedTicks
‚‚ "
{
„„ 	
get
‰‰ 
{
‰‰ 
return
‰‰ 
_sw
‰‰ 
.
‰‰ 
ElapsedTicks
‰‰ )
;
‰‰) *
}
‰‰+ ,
}
ÂÂ 	
internal
ÍÍ 

IStopwatch
ÍÍ 
	Stopwatch
ÍÍ %
{
ÎÎ 	
get
ÏÏ 
{
ÏÏ 
return
ÏÏ 
_sw
ÏÏ 
;
ÏÏ 
}
ÏÏ 
}
ÌÌ 	
public
ÚÚ 
static
ÚÚ 
MiniProfiler
ÚÚ "
Current
ÚÚ# *
{
ÛÛ 	
get
ÙÙ 
{
ıı 
Settings
ˆˆ 
.
ˆˆ $
EnsureProfilerProvider
ˆˆ /
(
ˆˆ/ 0
)
ˆˆ0 1
;
ˆˆ1 2
return
˜˜ 
Settings
˜˜ 
.
˜˜  
ProfilerProvider
˜˜  0
.
˜˜0 1 
GetCurrentProfiler
˜˜1 C
(
˜˜C D
)
˜˜D E
;
˜˜E F
}
¯¯ 
}
˘˘ 	
public
ÄÄ 
IStorage
ÄÄ 
Storage
ÄÄ 
{
ÄÄ  !
get
ÄÄ" %
;
ÄÄ% &
set
ÄÄ' *
;
ÄÄ* +
}
ÄÄ, -
public
ÜÜ 
static
ÜÜ 
MiniProfiler
ÜÜ "
Start
ÜÜ# (
(
ÜÜ( )
)
ÜÜ) *
{
áá 	
return
ää 
Start
ää 
(
ää 
null
ää 
)
ää 
;
ää 
}
ãã 	
public
ïï 
static
ïï 
MiniProfiler
ïï "
Start
ïï# (
(
ïï( )
string
ïï) /
sessionName
ïï0 ;
)
ïï; <
{
ññ 	
Settings
óó 
.
óó $
EnsureProfilerProvider
óó +
(
óó+ ,
)
óó, -
;
óó- .
return
òò 
Settings
òò 
.
òò 
ProfilerProvider
òò ,
.
òò, -
Start
òò- 2
(
òò2 3
ProfileLevel
òò3 ?
.
òò? @
Info
òò@ D
,
òòD E
sessionName
òòF Q
)
òòQ R
;
òòR S
}
ôô 	
[
§§ 	
Obsolete
§§	 
(
§§ 
$str§§ Å
)§§Å Ç
]§§Ç É
public
•• 
static
•• 
MiniProfiler
•• "
Start
••# (
(
••( )
ProfileLevel
••) 5
level
••6 ;
,
••; <
string
••= C
sessionName
••D O
=
••P Q
null
••R V
)
••V W
{
¶¶ 	
Settings
ßß 
.
ßß $
EnsureProfilerProvider
ßß +
(
ßß+ ,
)
ßß, -
;
ßß- .
return
®® 
Settings
®® 
.
®® 
ProfilerProvider
®® ,
.
®®, -
Start
®®- 2
(
®®2 3
level
®®3 8
,
®®8 9
sessionName
®®: E
)
®®E F
;
®®F G
}
©© 	
public
≤≤ 
static
≤≤ 
void
≤≤ 
Stop
≤≤ 
(
≤≤  
bool
≤≤  $
discardResults
≤≤% 3
=
≤≤4 5
false
≤≤6 ;
)
≤≤; <
{
≥≥ 	
Settings
¥¥ 
.
¥¥ $
EnsureProfilerProvider
¥¥ +
(
¥¥+ ,
)
¥¥, -
;
¥¥- .
Settings
µµ 
.
µµ 
ProfilerProvider
µµ %
.
µµ% &
Stop
µµ& *
(
µµ* +
discardResults
µµ+ 9
)
µµ9 :
;
µµ: ;
}
∂∂ 	
public
ææ 
static
ææ 
IDisposable
ææ !

StepStatic
ææ" ,
(
ææ, -
string
ææ- 3
name
ææ4 8
)
ææ8 9
{
øø 	
return
¿¿ 
Current
¿¿ 
.
¿¿ 
Step
¿¿ 
(
¿¿  
name
¿¿  $
)
¿¿$ %
;
¿¿% &
}
¡¡ 	
[
   	
Obsolete
  	 
(
   
$str
   s
)
  s t
]
  t u
public
ÀÀ 
static
ÀÀ 
IDisposable
ÀÀ !

StepStatic
ÀÀ" ,
(
ÀÀ, -
string
ÀÀ- 3
name
ÀÀ4 8
,
ÀÀ8 9
ProfileLevel
ÀÀ: F
level
ÀÀG L
)
ÀÀL M
{
ÃÃ 	
return
ÕÕ 
Current
ÕÕ 
.
ÕÕ 
Step
ÕÕ 
(
ÕÕ  
name
ÕÕ  $
,
ÕÕ$ %
level
ÕÕ& +
)
ÕÕ+ ,
;
ÕÕ, -
}
ŒŒ 	
public
”” 
static
”” 
string
”” 
ToJson
”” #
(
””# $
)
””$ %
{
‘‘ 	
return
’’ 
ToJson
’’ 
(
’’ 
Current
’’ !
)
’’! "
;
’’" #
}
÷÷ 	
public
€€ 
static
€€ 
string
€€ 
ToJson
€€ #
(
€€# $
MiniProfiler
€€$ 0
profiler
€€1 9
)
€€9 :
{
‹‹ 	
return
›› 
profiler
›› 
==
›› 
null
›› #
?
››$ %
null
››& *
:
››+ ,
GetJsonSerializer
››- >
(
››> ?
)
››? @
.
››@ A
	Serialize
››A J
(
››J K
profiler
››K S
)
››S T
;
››T U
}
ﬁﬁ 	
public
„„ 
static
„„ 
MiniProfiler
„„ "
FromJson
„„# +
(
„„+ ,
string
„„, 2
json
„„3 7
)
„„7 8
{
‰‰ 	
return
ÂÂ 
json
ÂÂ 
.
ÂÂ 
HasValue
ÂÂ  
(
ÂÂ  !
)
ÂÂ! "
?
ÂÂ# $
GetJsonSerializer
ÂÂ% 6
(
ÂÂ6 7
)
ÂÂ7 8
.
ÂÂ8 9
Deserialize
ÂÂ9 D
<
ÂÂD E
MiniProfiler
ÂÂE Q
>
ÂÂQ R
(
ÂÂR S
json
ÂÂS W
)
ÂÂW X
:
ÂÂY Z
null
ÂÂ[ _
;
ÂÂ_ `
}
ÊÊ 	
private
ËË 
static
ËË "
JavaScriptSerializer
ËË +
GetJsonSerializer
ËË, =
(
ËË= >
)
ËË> ?
{
ÈÈ 	
return
ÍÍ 
new
ÍÍ "
JavaScriptSerializer
ÍÍ +
{
ÍÍ, -
MaxJsonLength
ÍÍ. ;
=
ÍÍ< =
Settings
ÍÍ> F
.
ÍÍF G!
MaxJsonResponseSize
ÍÍG Z
}
ÍÍ[ \
;
ÍÍ\ ]
}
ÎÎ 	
public
˚˚ 
static
˚˚ 
IHtmlString
˚˚ !
RenderIncludes
˚˚" 0
(
˚˚0 1
RenderPosition
¸¸ 
?
¸¸ 
position
¸¸ $
=
¸¸% &
null
¸¸' +
,
¸¸+ ,
bool
˝˝ 
?
˝˝ 
showTrivial
˝˝ 
=
˝˝ 
null
˝˝  $
,
˝˝$ %
bool
˛˛ 
?
˛˛ "
showTimeWithChildren
˛˛ &
=
˛˛' (
null
˛˛) -
,
˛˛- .
int
ˇˇ 
?
ˇˇ 
maxTracesToShow
ˇˇ  
=
ˇˇ! "
null
ˇˇ# '
,
ˇˇ' (
bool
ÄÄ 
?
ÄÄ 
showControls
ÄÄ 
=
ÄÄ  
null
ÄÄ! %
,
ÄÄ% &
bool
ÅÅ 
?
ÅÅ 
useExistingjQuery
ÅÅ #
=
ÅÅ$ %
null
ÅÅ& *
,
ÅÅ* +
bool
ÇÇ 
samplingOnly
ÇÇ 
=
ÇÇ 
false
ÇÇ  %
,
ÇÇ% &
bool
ÉÉ 
?
ÉÉ 
startHidden
ÉÉ 
=
ÉÉ 
null
ÉÉ  $
)
ÉÉ$ %
{
ÑÑ 	
return
ÖÖ !
MiniProfilerHandler
ÖÖ &
.
ÖÖ& '
RenderIncludes
ÖÖ' 5
(
ÖÖ5 6
Current
ÜÜ 
,
ÜÜ 
position
áá 
,
áá 
showTrivial
àà 
,
àà "
showTimeWithChildren
ââ $
,
ââ$ %
maxTracesToShow
ää 
,
ää  
showControls
ãã 
,
ãã 
startHidden
åå 
)
åå 
;
åå 
}
çç 	
public
ìì 
override
ìì 
string
ìì 
ToString
ìì '
(
ìì' (
)
ìì( )
{
îî 	
return
ïï 
Root
ïï 
!=
ïï 
null
ïï 
?
ïï  !
Root
ïï" &
.
ïï& '
Name
ïï' +
+
ïï, -
$str
ïï. 2
+
ïï3 4"
DurationMilliseconds
ïï5 I
+
ïïJ K
$str
ïïL R
:
ïïS T
$str
ïïU W
;
ïïW X
}
ññ 	
public
õõ 
override
õõ 
bool
õõ 
Equals
õõ #
(
õõ# $
object
õõ$ *
other
õõ+ 0
)
õõ0 1
{
úú 	
return
ùù 
other
ùù 
is
ùù 
MiniProfiler
ùù (
&&
ùù) +
Id
ùù, .
.
ùù. /
Equals
ùù/ 5
(
ùù5 6
(
ùù6 7
(
ùù7 8
MiniProfiler
ùù8 D
)
ùùD E
other
ùùE J
)
ùùJ K
.
ùùK L
Id
ùùL N
)
ùùN O
;
ùùO P
}
ûû 	
public
££ 
override
££ 
int
££ 
GetHashCode
££ '
(
££' (
)
££( )
{
§§ 	
return
•• 
Id
•• 
.
•• 
GetHashCode
•• !
(
••! "
)
••" #
;
••# $
}
¶¶ 	
public
´´ 
IEnumerable
´´ 
<
´´ 
Timing
´´ !
>
´´! " 
GetTimingHierarchy
´´# 5
(
´´5 6
)
´´6 7
{
¨¨ 	
var
≠≠ 
timings
≠≠ 
=
≠≠ 
new
≠≠ 
Stack
≠≠ #
<
≠≠# $
Timing
≠≠$ *
>
≠≠* +
(
≠≠+ ,
)
≠≠, -
;
≠≠- .
timings
ØØ 
.
ØØ 
Push
ØØ 
(
ØØ 
_root
ØØ 
)
ØØ 
;
ØØ  
while
±± 
(
±± 
timings
±± 
.
±± 
Count
±±  
>
±±! "
$num
±±# $
)
±±$ %
{
≤≤ 
var
≥≥ 
timing
≥≥ 
=
≥≥ 
timings
≥≥ $
.
≥≥$ %
Pop
≥≥% (
(
≥≥( )
)
≥≥) *
;
≥≥* +
yield
µµ 
return
µµ 
timing
µµ #
;
µµ# $
if
∑∑ 
(
∑∑ 
timing
∑∑ 
.
∑∑ 
HasChildren
∑∑ &
)
∑∑& '
{
∏∏ 
var
ππ 
children
ππ  
=
ππ! "
timing
ππ# )
.
ππ) *
Children
ππ* 2
;
ππ2 3
for
∫∫ 
(
∫∫ 
int
∫∫ 
i
∫∫ 
=
∫∫  
children
∫∫! )
.
∫∫) *
Count
∫∫* /
-
∫∫0 1
$num
∫∫2 3
;
∫∫3 4
i
∫∫5 6
>=
∫∫7 9
$num
∫∫: ;
;
∫∫; <
i
∫∫= >
--
∫∫> @
)
∫∫@ A
timings
∫∫B I
.
∫∫I J
Push
∫∫J N
(
∫∫N O
children
∫∫O W
[
∫∫W X
i
∫∫X Y
]
∫∫Y Z
)
∫∫Z [
;
∫∫[ \
}
ªª 
}
ºº 
}
ΩΩ 	
public
¬¬ 
MiniProfiler
¬¬ 
Clone
¬¬ !
(
¬¬! "
)
¬¬" #
{
√√ 	
var
ƒƒ 

serializer
ƒƒ 
=
ƒƒ 
new
ƒƒ  $
DataContractSerializer
ƒƒ! 7
(
ƒƒ7 8
typeof
ƒƒ8 >
(
ƒƒ> ?
MiniProfiler
ƒƒ? K
)
ƒƒK L
,
ƒƒL M
null
ƒƒN R
,
ƒƒR S
int
ƒƒT W
.
ƒƒW X
MaxValue
ƒƒX `
,
ƒƒ` a
false
ƒƒb g
,
ƒƒg h
true
ƒƒi m
,
ƒƒm n
null
ƒƒo s
)
ƒƒs t
;
ƒƒt u
using
≈≈ 
(
≈≈ 
var
≈≈ 
ms
≈≈ 
=
≈≈ 
new
≈≈ 
MemoryStream
≈≈  ,
(
≈≈, -
)
≈≈- .
)
≈≈. /
{
∆∆ 

serializer
«« 
.
«« 
WriteObject
«« &
(
««& '
ms
««' )
,
««) *
this
««+ /
)
««/ 0
;
««0 1
ms
»» 
.
»» 
Position
»» 
=
»» 
$num
»» 
;
»»  
return
…… 
(
…… 
MiniProfiler
…… $
)
……$ %

serializer
……% /
.
……/ 0

ReadObject
……0 :
(
……: ;
ms
……; =
)
……= >
;
……> ?
}
   
}
ÀÀ 	
internal
ÕÕ 
IDisposable
ÕÕ 
StepImpl
ÕÕ %
(
ÕÕ% &
string
ÕÕ& ,
name
ÕÕ- 1
,
ÕÕ1 2
decimal
ÕÕ3 :
?
ÕÕ: ;
	minSaveMs
ÕÕ< E
=
ÕÕF G
null
ÕÕH L
,
ÕÕL M
bool
ÕÕN R
?
ÕÕR S(
includeChildrenWithMinSave
ÕÕT n
=
ÕÕo p
false
ÕÕq v
)
ÕÕv w
{
ŒŒ 	
return
œœ 
new
œœ 
Timing
œœ 
(
œœ 
this
œœ "
,
œœ" #
Head
œœ$ (
,
œœ( )
name
œœ* .
,
œœ. /
	minSaveMs
œœ0 9
,
œœ9 :(
includeChildrenWithMinSave
œœ; U
)
œœU V
;
œœV W
}
–– 	
[
““ 	
Obsolete
““	 
(
““ 
$str
““ r
)
““r s
]
““s t
internal
”” 
IDisposable
”” 
StepImpl
”” %
(
””% &
string
””& ,
name
””- 1
,
””1 2
ProfileLevel
””3 ?
level
””@ E
)
””E F
{
‘‘ 	
return
’’ 
level
’’ 
>
’’ 
Level
’’  
?
’’! "
null
’’# '
:
’’( )
StepImpl
’’* 2
(
’’2 3
name
’’3 7
)
’’7 8
;
’’8 9
}
÷÷ 	
internal
ÿÿ 
IDisposable
ÿÿ 

IgnoreImpl
ÿÿ '
(
ÿÿ' (
)
ÿÿ( )
{
ŸŸ 	
return
⁄⁄ 
new
⁄⁄ 
Suppression
⁄⁄ "
(
⁄⁄" #
this
⁄⁄# '
)
⁄⁄' (
;
⁄⁄( )
}
€€ 	
internal
›› 
bool
›› 
StopImpl
›› 
(
›› 
)
››  
{
ﬁﬁ 	
if
ﬂﬂ 
(
ﬂﬂ 
!
ﬂﬂ 
_sw
ﬂﬂ 
.
ﬂﬂ 
	IsRunning
ﬂﬂ 
)
ﬂﬂ 
return
‡‡ 
false
‡‡ 
;
‡‡ 
_sw
‚‚ 
.
‚‚ 
Stop
‚‚ 
(
‚‚ 
)
‚‚ 
;
‚‚ "
DurationMilliseconds
„„  
=
„„! "$
GetRoundedMilliseconds
„„# 9
(
„„9 :
ElapsedTicks
„„: F
)
„„F G
;
„„G H
foreach
ÂÂ 
(
ÂÂ 
var
ÂÂ 
timing
ÂÂ 
in
ÂÂ  " 
GetTimingHierarchy
ÂÂ# 5
(
ÂÂ5 6
)
ÂÂ6 7
)
ÂÂ7 8
{
ÊÊ 
timing
ÁÁ 
.
ÁÁ 
Stop
ÁÁ 
(
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ËË 
return
ÍÍ 
true
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
internal
 
decimal
 $
GetRoundedMilliseconds
 /
(
/ 0
long
0 4
ticks
5 :
)
: ;
{
ÒÒ 	
long
ÚÚ 
z
ÚÚ 
=
ÚÚ 
$num
ÚÚ 
*
ÚÚ 
ticks
ÚÚ "
;
ÚÚ" #
decimal
ÛÛ 
timesTen
ÛÛ 
=
ÛÛ 
(
ÛÛ  
int
ÛÛ  #
)
ÛÛ# $
(
ÛÛ$ %
z
ÛÛ% &
/
ÛÛ' (
_sw
ÛÛ) ,
.
ÛÛ, -
	Frequency
ÛÛ- 6
)
ÛÛ6 7
;
ÛÛ7 8
return
ÙÙ 
timesTen
ÙÙ 
/
ÙÙ 
$num
ÙÙ  
;
ÙÙ  !
}
ıı 	
internal
˙˙ 
decimal
˙˙ %
GetDurationMilliseconds
˙˙ 0
(
˙˙0 1
long
˙˙1 5

startTicks
˙˙6 @
)
˙˙@ A
{
˚˚ 	
return
¸¸ $
GetRoundedMilliseconds
¸¸ )
(
¸¸) *
ElapsedTicks
¸¸* 6
-
¸¸7 8

startTicks
¸¸9 C
)
¸¸C D
;
¸¸D E
}
˝˝ 	
[
ÇÇ 	
OnDeserialized
ÇÇ	 
]
ÇÇ 
public
ÉÉ 
void
ÉÉ 
OnDeserialized
ÉÉ "
(
ÉÉ" #
StreamingContext
ÉÉ# 3
ctx
ÉÉ4 7
)
ÉÉ7 8
{
ÑÑ 	
if
ÖÖ 
(
ÖÖ 
_root
ÖÖ 
!=
ÖÖ 
null
ÖÖ 
)
ÖÖ 
{
ÜÜ 
}
àà 
}
ââ 	
}
ää 
}ãã Â

UC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\ClientTimingHelper.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

static 
class 
ClientTimingHelper *
{ 
public 
const 
string 

InitScript &
=' (
$str	) ◊
;
◊ ÿ
public 
static 
string 

TimeScript '
(' (
string( .
name/ 3
,3 4
string5 ;
html< @
)@ A
{ 	
if 
( 
MiniProfiler 
. 
Current $
!=% '
null( ,
), -
{ 
name 
= 
name 
. 
Replace #
(# $
$str$ '
,' (
$str) .
). /
;/ 0
var 
probe 
= 
$str H
+I J
nameK O
+P Q
$strR _
;_ `
html 
= 
probe 
+ 
html #
+$ %
probe& +
;+ ,
} 
return 
html 
; 
} 	
} 
} ¯{
YC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\MiniProfilerExtensions.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

static 
class "
MiniProfilerExtensions .
{ 
public 
static 
T 
Inline 
< 
T  
>  !
(! "
this" &
MiniProfiler' 3
profiler4 <
,< =
Func> B
<B C
TC D
>D E
selectorF N
,N O
stringP V
nameW [
)[ \
{ 	
if 
( 
selector 
== 
null  
)  !
throw" '
new( +!
ArgumentNullException, A
(A B
$strB L
)L M
;M N
if 
( 
profiler 
== 
null  
)  !
return" (
selector) 1
(1 2
)2 3
;3 4
using 
( 
profiler 
. 
StepImpl $
($ %
name% )
)) *
)* +
{ 
return 
selector 
(  
)  !
;! "
} 
} 	
[)) 	
Obsolete))	 
()) 
$str	)) Ç
)
))Ç É
]
))É Ñ
public** 
static** 
T** 
Inline** 
<** 
T**  
>**  !
(**! "
this**" &
MiniProfiler**' 3
profiler**4 <
,**< =
Func**> B
<**B C
T**C D
>**D E
selector**F N
,**N O
string**P V
name**W [
,**[ \
ProfileLevel**] i
level**j o
)**o p
{++ 	
return,, 
profiler,, 
.,, 
Inline,, "
(,," #
selector,,# +
,,,+ ,
name,,- 1
),,1 2
;,,2 3
}-- 	
public44 
static44 
IDisposable44 !
Step44" &
(44& '
this44' +
MiniProfiler44, 8
profiler449 A
,44A B
string44C I
name44J N
)44N O
{55 	
return66 
profiler66 
==66 
null66 #
?66$ %
null66& *
:66+ ,
profiler66- 5
.665 6
StepImpl666 >
(66> ?
name66? C
)66C D
;66D E
}77 	
[@@ 	
Obsolete@@	 
(@@ 
$str@@ n
)@@n o
]@@o p
publicAA 
staticAA 
IDisposableAA !
StepAA" &
(AA& '
thisAA' +
MiniProfilerAA, 8
profilerAA9 A
,AAA B
stringAAC I
nameAAJ N
,AAN O
ProfileLevelAAP \
levelAA] b
)AAb c
{BB 	
returnCC 
profilerCC 
==CC 
nullCC #
?CC$ %
nullCC& *
:CC+ ,
profilerCC- 5
.CC5 6
StepImplCC6 >
(CC> ?
nameCC? C
,CCC D
levelCCE J
)CCJ K
;CCK L
}DD 	
publicRR 
staticRR 
IDisposableRR !
StepIfRR" (
(RR( )
thisRR) -
MiniProfilerRR. :
profilerRR; C
,RRC D
stringRRE K
nameRRL P
,RRP Q
decimalRRR Y
	minSaveMsRRZ c
,RRc d
boolRRe i
includeChildrenRRj y
=RRz {
false	RR| Å
)
RRÅ Ç
{SS 	
returnTT 
profilerTT 
==TT 
nullTT #
?TT$ %
nullTT& *
:TT+ ,
profilerTT- 5
.TT5 6
StepImplTT6 >
(TT> ?
nameTT? C
,TTC D
	minSaveMsTTE N
,TTN O
includeChildrenTTP _
)TT_ `
;TT` a
}UU 	
publicbb 
staticbb 
CustomTimingbb "
CustomTimingbb# /
(bb/ 0
thisbb0 4
MiniProfilerbb5 A
profilerbbB J
,bbJ K
stringbbL R
categorybbS [
,bb[ \
stringbb] c
commandStringbbd q
,bbq r
stringbbs y
executeType	bbz Ö
=
bbÜ á
null
bbà å
)
bbå ç
{cc 	
returndd 
CustomTimingIfdd !
(dd! "
profilerdd" *
,dd* +
categorydd, 4
,dd4 5
commandStringdd6 C
,ddC D
$numddE F
,ddF G
executeTypeddH S
:ddS T
executeTypeddU `
)dd` a
;dda b
}ee 	
publictt 
statictt 
CustomTimingtt "
CustomTimingIftt# 1
(tt1 2
thistt2 6
MiniProfilertt7 C
profilerttD L
,ttL M
stringttN T
categoryttU ]
,tt] ^
stringtt_ e
commandStringttf s
,tts t
decimalttu |
	minSaveMs	tt} Ü
,
ttÜ á
string
ttà é
executeType
ttè ö
=
ttõ ú
null
ttù °
)
tt° ¢
{uu 	
ifww 
(ww 
profilerww 
==ww 
nullww  
||ww! #
!ww$ %
profilerww% -
.ww- .
IsActiveww. 6
)ww6 7
returnww8 >
nullww? C
;wwC D
ifxx 
(xx 
profilerxx 
.xx 
Headxx 
==xx  
nullxx! %
)xx% &
{yy 
profilerzz 
.zz 
Headzz 
=zz 
newzz  #
Timingzz$ *
(zz* +
)zz+ ,
;zz, -
}{{ 
var}} 
result}} 
=}} 
new}} 
CustomTiming}} )
(}}) *
profiler}}* 2
,}}2 3
commandString}}4 A
,}}A B
	minSaveMs}}C L
)}}L M
{~~ 
ExecuteType 
= 
executeType )
,) *
Category
ÄÄ 
=
ÄÄ 
category
ÄÄ #
}
ÅÅ 
;
ÅÅ 
if
ÖÖ 
(
ÖÖ 
profiler
ÖÖ 
.
ÖÖ 
Head
ÖÖ 
==
ÖÖ  
null
ÖÖ! %
)
ÖÖ% &
{
ÜÜ 
profiler
áá 
.
áá 
Head
áá 
=
áá 
new
áá  #
Timing
áá$ *
(
áá* +
)
áá+ ,
;
áá, -
}
àà 
profiler
ää 
.
ää 
Head
ää 
.
ää 
AddCustomTiming
ää )
(
ää) *
category
ää* 2
,
ää2 3
result
ää4 :
)
ää: ;
;
ää; <
return
åå 
result
åå 
;
åå 
}
çç 	
public
òò 
static
òò 
IDisposable
òò !
Ignore
òò" (
(
òò( )
this
òò) -
MiniProfiler
òò. :
profiler
òò; C
)
òòC D
{
ôô 	
return
öö 
profiler
öö 
==
öö 
null
öö #
?
öö$ %
null
öö& *
:
öö+ ,
profiler
öö- 5
.
öö5 6

IgnoreImpl
öö6 @
(
öö@ A
)
ööA B
;
ööB C
}
õõ 	
public
°° 
static
°° 
void
°°  
AddProfilerResults
°° -
(
°°- .
this
°°. 2
MiniProfiler
°°3 ?
profiler
°°@ H
,
°°H I
MiniProfiler
°°J V
externalProfiler
°°W g
)
°°g h
{
¢¢ 	
if
££ 
(
££ 
profiler
££ 
==
££ 
null
££  
||
££! #
profiler
££$ ,
.
££, -
Head
££- 1
==
££2 4
null
££5 9
||
££: <
externalProfiler
££= M
==
££N P
null
££Q U
)
££U V
return
££W ]
;
££] ^
profiler
§§ 
.
§§ 
Head
§§ 
.
§§ 
AddChild
§§ "
(
§§" #
externalProfiler
§§# 3
.
§§3 4
Root
§§4 8
)
§§8 9
;
§§9 :
}
•• 	
public
´´ 
static
´´ 
void
´´ 
AddCustomLink
´´ (
(
´´( )
this
´´) -
MiniProfiler
´´. :
profiler
´´; C
,
´´C D
string
´´E K
text
´´L P
,
´´P Q
string
´´R X
url
´´Y \
)
´´\ ]
{
¨¨ 	
if
≠≠ 
(
≠≠ 
profiler
≠≠ 
==
≠≠ 
null
≠≠  
||
≠≠! #
!
≠≠$ %
profiler
≠≠% -
.
≠≠- .
IsActive
≠≠. 6
)
≠≠6 7
return
≠≠8 >
;
≠≠> ?
lock
ØØ 
(
ØØ 
profiler
ØØ 
)
ØØ 
{
∞∞ 
if
±± 
(
±± 
profiler
±± 
.
±± 
CustomLinks
±± (
==
±±) +
null
±±, 0
)
±±0 1
{
≤≤ 
profiler
≥≥ 
.
≥≥ 
CustomLinks
≥≥ (
=
≥≥) *
new
≥≥+ .

Dictionary
≥≥/ 9
<
≥≥9 :
string
≥≥: @
,
≥≥@ A
string
≥≥B H
>
≥≥H I
(
≥≥I J
)
≥≥J K
;
≥≥K L
}
¥¥ 
}
µµ 
profiler
∑∑ 
.
∑∑ 
CustomLinks
∑∑  
[
∑∑  !
text
∑∑! %
]
∑∑% &
=
∑∑' (
url
∑∑) ,
;
∑∑, -
}
∏∏ 	
public
ææ 
static
ææ 
IHtmlString
ææ !
Render
ææ" (
(
ææ( )
this
ææ) -
MiniProfiler
ææ. :
profiler
ææ; C
)
ææC D
{
øø 	
return
¿¿ 
new
¿¿ 

HtmlString
¿¿ !
(
¿¿! "

RenderImpl
¿¿" ,
(
¿¿, -
profiler
¿¿- 5
,
¿¿5 6
true
¿¿7 ;
)
¿¿; <
)
¿¿< =
;
¿¿= >
}
¡¡ 	
public
»» 
static
»» 
string
»» 
RenderPlainText
»» ,
(
»», -
this
»»- 1
MiniProfiler
»»2 >
profiler
»»? G
)
»»G H
{
…… 	
return
   

RenderImpl
   
(
   
profiler
   &
,
  & '
false
  ( -
)
  - .
;
  . /
}
ÀÀ 	
private
ÕÕ 
static
ÕÕ 
string
ÕÕ 

RenderImpl
ÕÕ (
(
ÕÕ( )
MiniProfiler
ÕÕ) 5
profiler
ÕÕ6 >
,
ÕÕ> ?
bool
ÕÕ@ D

htmlEncode
ÕÕE O
)
ÕÕO P
{
ŒŒ 	
if
œœ 
(
œœ 
profiler
œœ 
==
œœ 
null
œœ  
)
œœ  !
return
œœ" (
string
œœ) /
.
œœ/ 0
Empty
œœ0 5
;
œœ5 6
var
—— 
text
—— 
=
—— 
new
—— 
StringBuilder
—— (
(
——( )
)
——) *
.
““ 
Append
““ 
(
““ 

htmlEncode
““ "
?
““# $
HttpUtility
““% 0
.
““0 1

HtmlEncode
““1 ;
(
““; <
Environment
““< G
.
““G H
MachineName
““H S
)
““S T
:
““U V
Environment
““W b
.
““b c
MachineName
““c n
)
““n o
.
”” 
Append
”” 
(
”” 
$str
”” 
)
”” 
.
‘‘ 
Append
‘‘ 
(
‘‘ 
DateTime
‘‘  
.
‘‘  !
UtcNow
‘‘! '
)
‘‘' (
.
’’ 

AppendLine
’’ 
(
’’ 
)
’’ 
;
’’ 
var
◊◊ 
timings
◊◊ 
=
◊◊ 
new
◊◊ 
Stack
◊◊ #
<
◊◊# $
Timing
◊◊$ *
>
◊◊* +
(
◊◊+ ,
)
◊◊, -
;
◊◊- .
timings
ÿÿ 
.
ÿÿ 
Push
ÿÿ 
(
ÿÿ 
profiler
ÿÿ !
.
ÿÿ! "
Root
ÿÿ" &
)
ÿÿ& '
;
ÿÿ' (
while
⁄⁄ 
(
⁄⁄ 
timings
⁄⁄ 
.
⁄⁄ 
Count
⁄⁄  
>
⁄⁄! "
$num
⁄⁄# $
)
⁄⁄$ %
{
€€ 
var
‹‹ 
timing
‹‹ 
=
‹‹ 
timings
‹‹ $
.
‹‹$ %
Pop
‹‹% (
(
‹‹( )
)
‹‹) *
;
‹‹* +
var
›› 
name
›› 
=
›› 

htmlEncode
›› %
?
››& '
HttpUtility
››( 3
.
››3 4

HtmlEncode
››4 >
(
››> ?
timing
››? E
.
››E F
Name
››F J
)
››J K
:
››L M
timing
››N T
.
››T U
Name
››U Y
;
››Y Z
text
ﬂﬂ 
.
ﬂﬂ 
AppendFormat
ﬂﬂ !
(
ﬂﬂ! "
$str
ﬂﬂ" >
,
ﬂﬂ> ?
name
ﬂﬂ@ D
,
ﬂﬂD E
timing
ﬂﬂF L
.
ﬂﬂL M"
DurationMilliseconds
ﬂﬂM a
,
ﬂﬂa b
new
ﬂﬂc f
string
ﬂﬂg m
(
ﬂﬂm n
$char
ﬂﬂn q
,
ﬂﬂq r
timing
ﬂﬂs y
.
ﬂﬂy z
Depth
ﬂﬂz 
)ﬂﬂ Ä
)ﬂﬂÄ Å
;ﬂﬂÅ Ç
if
·· 
(
·· 
timing
·· 
.
·· 
HasCustomTimings
·· +
)
··+ ,
{
‚‚ 
foreach
„„ 
(
„„ 
var
„„  
pair
„„! %
in
„„& (
timing
„„) /
.
„„/ 0
CustomTimings
„„0 =
)
„„= >
{
‰‰ 
var
ÂÂ 
type
ÂÂ  
=
ÂÂ! "
pair
ÂÂ# '
.
ÂÂ' (
Key
ÂÂ( +
;
ÂÂ+ ,
var
ÊÊ 
customTimings
ÊÊ )
=
ÊÊ* +
pair
ÊÊ, 0
.
ÊÊ0 1
Value
ÊÊ1 6
;
ÊÊ6 7
text
ËË 
.
ËË 
AppendFormat
ËË )
(
ËË) *
$str
ËË* S
,
ËËS T
type
ÈÈ  
,
ÈÈ  !
customTimings
ÍÍ )
.
ÍÍ) *
Sum
ÍÍ* -
(
ÍÍ- .
ct
ÍÍ. 0
=>
ÍÍ1 3
ct
ÍÍ4 6
.
ÍÍ6 7"
DurationMilliseconds
ÍÍ7 K
)
ÍÍK L
,
ÍÍL M
customTimings
ÎÎ )
.
ÎÎ) *
Count
ÎÎ* /
,
ÎÎ/ 0
customTimings
ÏÏ )
.
ÏÏ) *
Count
ÏÏ* /
==
ÏÏ0 2
$num
ÏÏ3 4
?
ÏÏ5 6
$str
ÏÏ7 9
:
ÏÏ: ;
$str
ÏÏ< ?
)
ÏÏ? @
;
ÏÏ@ A
}
ÌÌ 
}
ÓÓ 
text
 
.
 

AppendLine
 
(
  
)
  !
;
! "
if
ÚÚ 
(
ÚÚ 
timing
ÚÚ 
.
ÚÚ 
HasChildren
ÚÚ &
)
ÚÚ& '
{
ÛÛ 
var
ÙÙ 
children
ÙÙ  
=
ÙÙ! "
timing
ÙÙ# )
.
ÙÙ) *
Children
ÙÙ* 2
;
ÙÙ2 3
for
ıı 
(
ıı 
var
ıı 
i
ıı 
=
ıı  
children
ıı! )
.
ıı) *
Count
ıı* /
-
ıı0 1
$num
ıı2 3
;
ıı3 4
i
ıı5 6
>=
ıı7 9
$num
ıı: ;
;
ıı; <
i
ıı= >
--
ıı> @
)
ıı@ A
timings
ııB I
.
ııI J
Push
ııJ N
(
ııN O
children
ııO W
[
ııW X
i
ııX Y
]
ııY Z
)
ııZ [
;
ıı[ \
}
ˆˆ 
}
˜˜ 
return
˘˘ 
text
˘˘ 
.
˘˘ 
ToString
˘˘  
(
˘˘  !
)
˘˘! "
;
˘˘" #
}
˙˙ 	
}
˚˚ 
}¸¸ ∏
OC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\ProfileLevel.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

enum 
ProfileLevel 
: 
byte #
{ 
Info 
= 
$num 
, 
Verbose 
= 
$num 
} 
} ™
QC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\RenderPosition.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

enum 
RenderPosition 
{ 
Left 
= 
$num 
, 
Right 
= 
$num 
, 

BottomLeft 
= 
$num 
, 
BottomRight 
= 
$num 
} 
} ï,
`C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\InlineFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{ 
public 

class 
InlineFormatter  
:! "
ISqlFormatter# 0
{ 
private 
static 
readonly 
Regex  %
ParamPrefixes& 3
=4 5
new6 9
Regex: ?
(? @
$str@ J
,J K
RegexOptionsL X
.X Y

IgnoreCaseY c
|d e
RegexOptionsf r
.r s
Compileds {
){ |
;| }
private 
static 
bool 
includeTypeInfo +
;+ ,
public 
InlineFormatter 
( 
bool #
includeTypeInfo$ 3
=4 5
false6 ;
); <
{ 	
InlineFormatter 
. 
includeTypeInfo +
=, -
includeTypeInfo. =
;= >
} 	
public   
string   
	FormatSql   
(    
string    &
commandText  ' 2
,  2 3
List  4 8
<  8 9
SqlTimingParameter  9 K
>  K L

parameters  M W
)  W X
{!! 	
if"" 
("" 

parameters"" 
=="" 
null"" "
||""# %

parameters""& 0
.""0 1
Count""1 6
==""7 9
$num"": ;
)""; <
{## 
return$$ 
commandText$$ "
;$$" #
}%% 
foreach'' 
('' 
var'' 
p'' 
in'' 

parameters'' (
)''( )
{(( 
var** 
name** 
=** 
ParamPrefixes** (
.**( )
IsMatch**) 0
(**0 1
p**1 2
.**2 3
Name**3 7
)**7 8
?++ 
p++ 
.++ 
Name++ 
:,, 
Regex,, 
.,, 
Match,, !
(,,! "
commandText,," -
,,,- .
$str,,/ 8
+,,9 :
p,,; <
.,,< =
Name,,= A
,,,A B
RegexOptions,,C O
.,,O P

IgnoreCase,,P Z
),,Z [
.,,[ \
Value,,\ a
;,,a b
if-- 
(-- 
name-- 
.-- 
HasValue-- !
(--! "
)--" #
)--# $
{.. 
var// 
value// 
=// 
GetParameterValue//  1
(//1 2
p//2 3
)//3 4
;//4 5
commandText00 
=00  !
Regex00" '
.00' (
Replace00( /
(00/ 0
commandText000 ;
,00; <
$str00= @
+00A B
name00C G
+00H I
$str00J Z
,00Z [
m00\ ]
=>00^ `
value00a f
+00g h
m00i j
.00j k
Groups00k q
[00q r
$num00r s
]00s t
,00t u
RegexOptions	00v Ç
.
00Ç É

IgnoreCase
00É ç
)
00ç é
;
00é è
}11 
}22 
return44 
commandText44 
;44 
}55 	
public:: 
string:: 
GetParameterValue:: '
(::' (
SqlTimingParameter::( :
p::; <
)::< =
{;; 	
var== 
result== 
=== 
p== 
.== 
Value==  
;==  !
var>> 
type>> 
=>> 
p>> 
.>> 
DbType>> 
??>>  "
string>># )
.>>) *
Empty>>* /
;>>/ 0
switch@@ 
(@@ 
type@@ 
.@@ 
ToLower@@  
(@@  !
)@@! "
)@@" #
{AA 
caseBB 
$strBB 
:BB 
caseCC 
$strCC 
:CC  
resultDD 
=DD 
stringDD #
.DD# $
FormatDD$ *
(DD* +
$strDD+ 2
,DD2 3
resultDD4 :
)DD: ;
;DD; <
breakEE 
;EE 
caseFF 
$strFF 
:FF 
switchGG 
(GG 
resultGG "
)GG" #
{HH 
caseII 
$strII #
:II# $
resultJJ "
=JJ# $
$strJJ% (
;JJ( )
breakKK !
;KK! "
caseLL 
$strLL $
:LL$ %
resultMM "
=MM# $
$strMM% (
;MM( )
breakNN !
;NN! "
defaultOO 
:OO  
resultPP "
=PP# $
nullPP% )
;PP) *
breakQQ !
;QQ! "
}RR 
breakSS 
;SS 
}TT 
ifVV 
(VV 
resultVV 
==VV 
nullVV 
)VV 
{WW 
resultXX 
=XX 
$strXX 
;XX  
}YY 
ifZZ 
(ZZ 
includeTypeInfoZZ 
)ZZ  
{[[ 
result\\ 
+=\\ 
$str\\  
+\\! "
p\\# $
.\\$ %
Name\\% )
+\\* +
$str\\, 6
+\\7 8
p\\9 :
.\\: ;
DbType\\; A
+\\B C
$str\\D I
;\\I J
}]] 
return^^ 
result^^ 
;^^ 
}__ 	
}`` 
}aa ⁄
^C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\ISqlFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{ 
public		 

	interface		 
ISqlFormatter		 "
{

 
string 
	FormatSql 
( 
string 
commandText  +
,+ ,
List- 1
<1 2
SqlTimingParameter2 D
>D E

parametersF P
)P Q
;Q R
} 
} ”Ω
cC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlFormatters\SqlServerFormatter.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
SqlFormatters" /
{		 
public 

class 
SqlServerFormatter #
:$ %
ISqlFormatter& 3
{ 
	protected 
static 
readonly !

Dictionary" ,
<, -
DbType- 3
,3 4
Func5 9
<9 :
SqlTimingParameter: L
,L M
stringN T
>T U
>U V
ParamTranslatorW f
;f g
	protected 
static 
readonly !
string" (
[( )
]) *
	DontQuote+ 4
=5 6
{7 8
$str9 @
,@ A
$strB I
,I J
$strK R
,R S
$strT ]
,] ^
$str_ g
}h i
;i j
private 
static 
Func 
< 
SqlTimingParameter .
,. /
string0 6
>6 7
GetWithLenFormatter8 K
(K L
stringL R
nativeS Y
)Y Z
{ 	
var 
capture 
= 
native  
;  !
return 
p 
=> 
{ 
if 
( 
p 
. 
Size 
<  
$num! "
)" #
{ 
return 
capture &
;& '
}   
return!! 
capture!! "
+!!# $
$str!!% (
+!!) *
(!!+ ,
p!!, -
.!!- .
Size!!. 2
>!!3 4
$num!!5 9
?!!: ;
$str!!< A
:!!B C
p!!D E
.!!E F
Size!!F J
.!!J K
ToString!!K S
(!!S T
CultureInfo!!T _
.!!_ `
InvariantCulture!!` p
)!!p q
)!!q r
+!!s t
$str!!u x
;!!x y
}"" 
;"" 
}## 	
static(( 
SqlServerFormatter(( !
(((! "
)((" #
{)) 	
ParamTranslator** 
=** 
new** !

Dictionary**" ,
<**, -
DbType**- 3
,**3 4
Func**5 9
<**9 :
SqlTimingParameter**: L
,**L M
string**N T
>**T U
>**U V
{++ 
{,, 
DbType,, 
.,, 

AnsiString,, #
,,,# $
GetWithLenFormatter,,% 8
(,,8 9
$str,,9 B
),,B C
},,D E
,,,E F
{-- 
DbType-- 
.-- 
String-- 
,--  
GetWithLenFormatter--! 4
(--4 5
$str--5 ?
)--? @
}--A B
,--B C
{.. 
DbType.. 
... !
AnsiStringFixedLength.. .
,... /
GetWithLenFormatter..0 C
(..C D
$str..D J
)..J K
}..L M
,..M N
{// 
DbType// 
.// 
StringFixedLength// *
,//* +
GetWithLenFormatter//, ?
(//? @
$str//@ G
)//G H
}//I J
,//J K
{00 
DbType00 
.00 
Byte00 
,00 
p00  
=>00! #
$str00$ -
}00. /
,00/ 0
{11 
DbType11 
.11 
Int1611 
,11 
p11  !
=>11" $
$str11% /
}110 1
,111 2
{22 
DbType22 
.22 
Int3222 
,22 
p22  !
=>22" $
$str22% *
}22+ ,
,22, -
{33 
DbType33 
.33 
Int6433 
,33 
p33  !
=>33" $
$str33% -
}33. /
,33/ 0
{44 
DbType44 
.44 
DateTime44 !
,44! "
p44# $
=>44% '
$str44( 2
}443 4
,444 5
{55 
DbType55 
.55 
Guid55 
,55 
p55  
=>55! #
$str55$ 6
}557 8
,558 9
{66 
DbType66 
.66 
Boolean66  
,66  !
p66" #
=>66$ &
$str66' ,
}66- .
,66. /
{77 
DbType77 
.77 
Binary77 
,77  
GetWithLenFormatter77! 4
(774 5
$str775 @
)77@ A
}77B C
,77C D
}88 
;88 
}99 	
public>> 
virtual>> 
string>> 
	FormatSql>> '
(>>' (
string>>( .
commandText>>/ :
,>>: ;
List>>< @
<>>@ A
SqlTimingParameter>>A S
>>>S T

parameters>>U _
)>>_ `
{?? 	
return@@ 
	FormatSql@@ 
(@@ 
commandText@@ (
,@@( )

parameters@@* 4
,@@4 5
null@@6 :
)@@: ;
;@@; <
}AA 	
publicFF 
virtualFF 
stringFF 
	FormatSqlFF '
(FF' (
stringFF( .
commandTextFF/ :
,FF: ;
ListFF< @
<FF@ A
SqlTimingParameterFFA S
>FFS T

parametersFFU _
,FF_ `

IDbCommandFFa k
commandFFl s
)FFs t
{GG 	
StringBuilderHH 
bufferHH  
=HH! "
newHH# &
StringBuilderHH' 4
(HH4 5
)HH5 6
;HH6 7
ifJJ 
(JJ 

parametersJJ 
!=JJ 
nullJJ "
&&JJ# %

parametersJJ& 0
.JJ0 1
AnyJJ1 4
(JJ4 5
)JJ5 6
)JJ6 7
{KK 
GenerateParamTextLL !
(LL! "
bufferLL" (
,LL( )

parametersLL* 4
)LL4 5
;LL5 6
bufferNN 
.NN 
AppendNN 
(NN 
$strNN !
)NN! "
.OO 

AppendLineOO 
(OO  
)OO  !
.PP 

AppendLinePP 
(PP  
)PP  !
;PP! "
}QQ 
ifTT 
(TT 
commandTT 
!=TT 
nullTT 
&&TT  "
commandTT# *
.TT* +
CommandTypeTT+ 6
==TT7 9
CommandTypeTT: E
.TTE F
StoredProcedureTTF U
)TTU V
{UU &
GenerateStoreProcedureCallVV *
(VV* +
commandTextVV+ 6
,VV6 7

parametersVV8 B
,VVB C
bufferVVD J
)VVJ K
;VVK L
}WW 
elseXX 
{YY 
bufferZZ 
.ZZ 
AppendZZ 
(ZZ 
commandTextZZ )
)ZZ) *
;ZZ* +
}[[ 
string]] 
formattedText]]  
=]]! "!
TerminateSqlStatement]]# 8
(]]8 9
buffer]]9 ?
.]]? @
ToString]]@ H
(]]H I
)]]I J
)]]J K
;]]K L
return^^ 
formattedText^^  
;^^  !
}__ 	
privateaa 	
stringaa
 !
EnsureParameterPrefixaa &
(aa& '
stringaa' -
nameaa. 2
)aa2 3
{bb 
returncc 	
!cc
 
namecc 
.cc 

StartsWithcc 
(cc 
$strcc 
)cc 
?cc  !
$strcc" %
+cc& '
namecc( ,
:cc- .
namecc/ 3
;cc3 4
}dd 
privateff 	
stringff
 !
RemoveParameterPrefixff &
(ff& '
stringff' -
nameff. 2
)ff2 3
{gg 
returnhh 	
namehh
 
.hh 

StartsWithhh 
(hh 
$strhh 
)hh 
?hh  
namehh! %
.hh% &
	Substringhh& /
(hh/ 0
$numhh0 1
)hh1 2
:hh3 4
namehh5 9
;hh9 :
}ii 
privatekk 
voidkk &
GenerateStoreProcedureCallkk ,
(kk, -
stringkk- 3
commandTextkk4 ?
,kk? @
ListkkA E
<kkE F
SqlTimingParameterkkF X
>kkX Y

parameterskkZ d
,kkd e
StringBuilderkkf s
bufferkkt z
)kkz {
{ll 	
buffermm 
.mm 
Appendmm 
(mm 
$strmm !
)mm! "
;mm" #
SqlTimingParameteroo  
returnValueParameteroo 3
=oo4 5#
GetReturnValueParameteroo6 M
(ooM N

parametersooN X
)ooX Y
;ooY Z
ifpp 
(pp  
returnValueParameterpp $
!=pp% '
nullpp( ,
)pp, -
{qq 
bufferrr 
.rr 
Appendrr 
(rr !
EnsureParameterPrefixrr 3
(rr3 4 
returnValueParameterrr4 H
.rrH I
NamerrI M
)rrM N
)rrN O
.rrO P
AppendrrP V
(rrV W
$strrrW \
)rr\ ]
;rr] ^
}ss 
bufferuu 
.uu 
Appenduu 
(uu 
commandTextuu %
)uu% &
;uu& '-
!GenerateStoredProcedureParametersww -
(ww- .
bufferww. 4
,ww4 5

parametersww6 @
)ww@ A
;wwA B
bufferxx 
.xx 
Appendxx 
(xx 
$strxx 
)xx 
;xx #
GenerateSelectStatementzz	  
(zz  !
bufferzz! '
,zz' (

parameterszz) 3
)zz3 4
;zz4 5
}{{ 	
private}} 
void}} #
GenerateSelectStatement}} )
(}}) *
StringBuilder}}* 7
buffer}}8 >
,}}> ?
List}}@ D
<}}D E
SqlTimingParameter}}E W
>}}W X

parameters}}Y c
)}}c d
{~~ 
if 
(	 


parameters
 
== 
null 
) 
return $
;$ %
var
ÅÅ 	 
parametersToSelect
ÅÅ
 
=
ÅÅ 

parameters
ÅÅ )
.
ÅÅ) *
Where
ÅÅ* /
(
ÅÅ/ 0
x
ÇÇ 
=>
ÇÇ	 
x
ÇÇ 
.
ÇÇ 
	Direction
ÇÇ 
==
ÇÇ  
ParameterDirection
ÇÇ -
.
ÇÇ- .
InputOutput
ÇÇ. 9
.
ÇÇ9 :
ToString
ÇÇ: B
(
ÇÇB C
)
ÇÇC D
||
ÇÇE G
x
ÉÉ 
.
ÉÉ 
	Direction
ÉÉ 
==
ÉÉ  
ParameterDirection
ÉÉ -
.
ÉÉ- .
Output
ÉÉ. 4
.
ÉÉ4 5
ToString
ÉÉ5 =
(
ÉÉ= >
)
ÉÉ> ?
)
ÉÉ? @
.
ÑÑ 
Select
ÑÑ 
(
ÑÑ 
x
ÑÑ 
=>
ÑÑ #
EnsureParameterPrefix
ÑÑ (
(
ÑÑ( )
x
ÑÑ) *
.
ÑÑ* +
Name
ÑÑ+ /
)
ÑÑ/ 0
+
ÑÑ1 2
$str
ÑÑ3 9
+
ÑÑ: ;#
RemoveParameterPrefix
ÑÑ< Q
(
ÑÑQ R
x
ÑÑR S
.
ÑÑS T
Name
ÑÑT X
)
ÑÑX Y
)
ÑÑY Z
.
ÖÖ 
ToList
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
var
áá 	"
returnValueParameter
áá
 
=
áá  

parameters
áá! +
.
áá+ ,
SingleOrDefault
áá, ;
(
áá; <
x
áá< =
=>
áá> @
x
ááA B
.
ááB C
	Direction
ááC L
==
ááM O 
ParameterDirection
ááP b
.
ááb c
ReturnValue
áác n
.
áán o
ToString
ááo w
(
ááw x
)
ááx y
)
ááy z
;
ááz {
if
àà 
(
àà "
returnValueParameter
àà 
!=
àà 
null
àà #
)
àà# $
{
ââ  
parametersToSelect
ää 
.
ää 
Insert
ää 
(
ää 
$num
ää 
,
ää  #
EnsureParameterPrefix
ää! 6
(
ää6 7"
returnValueParameter
ää7 K
.
ääK L
Name
ääL P
)
ääP Q
+
ääR S
$str
ääT e
)
ääe f
;
ääf g
}
ãã 
if
çç 
(
çç	 

!
çç
  
parametersToSelect
çç 
.
çç 
Any
çç !
(
çç! "
)
çç" #
)
çç# $
return
çç% +
;
çç+ ,
buffer
èè 	
.
èè	 


AppendLine
èè
 
(
èè 
)
èè 
.
èè 
Append
èè 
(
èè 
$str
èè '
)
èè' (
.
èè( )
Append
èè) /
(
èè/ 0
string
èè0 6
.
èè6 7
Join
èè7 ;
(
èè; <
$str
èè< @
,
èè@ A 
parametersToSelect
èèB T
)
èèT U
)
èèU V
.
èèV W
Append
èèW ]
(
èè] ^
$str
èè^ a
)
èèa b
;
èèb c
}
êê 
private
íí 
static
íí  
SqlTimingParameter
íí &%
GetReturnValueParameter
íí' >
(
íí> ?
List
íí? C
<
ííC D 
SqlTimingParameter
ííD V
>
ííV W

parameters
ííX b
)
ííb c
{
ìì 	
if
îî 
(
îî 

parameters
îî 
==
îî 
null
îî "
||
îî# %
!
îî& '

parameters
îî' 1
.
îî1 2
Any
îî2 5
(
îî5 6
)
îî6 7
)
îî7 8
return
îî9 ?
null
îî@ D
;
îîD E
return
ïï 

parameters
ïï 
.
ïï 
FirstOrDefault
ïï ,
(
ïï, -
x
ïï- .
=>
ïï/ 1
x
ïï2 3
.
ïï3 4
	Direction
ïï4 =
==
ïï> @ 
ParameterDirection
ïïA S
.
ïïS T
ReturnValue
ïïT _
.
ïï_ `
ToString
ïï` h
(
ïïh i
)
ïïi j
)
ïïj k
;
ïïk l
}
ññ 	
private
úú 
string
úú #
TerminateSqlStatement
úú ,
(
úú, -
string
úú- 3
sqlStatement
úú4 @
)
úú@ A
{
ùù 	
if
ûû 
(
ûû 
sqlStatement
ûû 
[
ûû 
sqlStatement
ûû )
.
ûû) *
Length
ûû* 0
-
ûû1 2
$num
ûû3 4
]
ûû4 5
!=
ûû6 8
$char
ûû9 <
)
ûû< =
{
üü 
return
†† 
sqlStatement
†† #
+
††$ %
$str
††& )
;
††) *
}
°° 
return
¢¢ 
sqlStatement
¢¢ 
;
¢¢  
}
££ 	
private
•• 
void
•• /
!GenerateStoredProcedureParameters
•• 6
(
••6 7
StringBuilder
••7 D
buffer
••E K
,
••K L
List
••M Q
<
••Q R 
SqlTimingParameter
••R d
>
••d e

parameters
••f p
)
••p q
{
¶¶ 	
if
ßß 
(
ßß 

parameters
ßß 
==
ßß 
null
ßß "
||
ßß# %
!
ßß& '

parameters
ßß' 1
.
ßß1 2
Any
ßß2 5
(
ßß5 6
)
ßß6 7
)
ßß7 8
return
ßß9 ?
;
ßß? @
bool
©© 
firstParameter
©© 
=
©©  !
true
©©" &
;
©©& '
foreach
™™ 
(
™™ 
var
™™ 
	parameter
™™ "
in
™™# %

parameters
™™& 0
)
™™0 1
{
´´ 
if
¨¨ 
(
¨¨ 
	parameter
¨¨ 
.
¨¨ 
	Direction
¨¨ '
==
¨¨( * 
ParameterDirection
¨¨+ =
.
¨¨= >
ReturnValue
¨¨> I
.
¨¨I J
ToString
¨¨J R
(
¨¨R S
)
¨¨S T
)
¨¨T U
{
≠≠ 
continue
ÆÆ 
;
ÆÆ 
}
ØØ 
if
±± 
(
±± 
!
±± 
firstParameter
±± #
)
±±# $
{
≤≤ 
buffer
≥≥ 
.
≥≥ 
Append
≥≥ !
(
≥≥! "
$str
≥≥" %
)
≥≥% &
;
≥≥& '
}
¥¥ 
firstParameter
∂∂ 
=
∂∂  
false
∂∂! &
;
∂∂& '
buffer
∑∑ 
.
∑∑ 
Append
∑∑ 
(
∑∑ 
$str
∑∑ !
)
∑∑! "
.
∑∑" #
Append
∑∑# )
(
∑∑) *#
EnsureParameterPrefix
∑∑* ?
(
∑∑? @
	parameter
∑∑@ I
.
∑∑I J
Name
∑∑J N
)
∑∑N O
)
∑∑O P
.
∑∑P Q
Append
∑∑Q W
(
∑∑W X
$str
∑∑X ]
)
∑∑] ^
.
∑∑^ _
Append
∑∑_ e
(
∑∑e f#
EnsureParameterPrefix
∑∑f {
(
∑∑{ |
	parameter∑∑| Ö
.∑∑Ö Ü
Name∑∑Ü ä
)∑∑ä ã
)∑∑ã å
;∑∑å ç
if
∫∫ 
(
∫∫ 
	parameter
∫∫ 
.
∫∫ 
	Direction
∫∫ '
==
∫∫( * 
ParameterDirection
∫∫+ =
.
∫∫= >
Output
∫∫> D
.
∫∫D E
ToString
∫∫E M
(
∫∫M N
)
∫∫N O
||
∫∫P R
	parameter
ªª 
.
ªª 
	Direction
ªª '
==
ªª( * 
ParameterDirection
ªª+ =
.
ªª= >
InputOutput
ªª> I
.
ªªI J
ToString
ªªJ R
(
ªªR S
)
ªªS T
)
ªªT U
{
ºº 
buffer
ΩΩ 
.
ΩΩ 
Append
ΩΩ !
(
ΩΩ! "
$str
ΩΩ" +
)
ΩΩ+ ,
;
ΩΩ, -
}
ææ 
}
øø 
}
¿¿ 	
	protected
»» 
void
»» 
GenerateParamText
»» (
(
»»( )
StringBuilder
»») 6
buffer
»»7 =
,
»»= >
List
»»? C
<
»»C D 
SqlTimingParameter
»»D V
>
»»V W

parameters
»»X b
)
»»b c
{
…… 	
if
   
(
   

parameters
   
!=
   
null
   "
&&
  # %

parameters
  & 0
.
  0 1
Count
  1 6
>
  7 8
$num
  9 :
)
  : ;
{
ÀÀ 
buffer
ÃÃ 
.
ÃÃ 
Append
ÃÃ 
(
ÃÃ 
$str
ÃÃ (
)
ÃÃ( )
;
ÃÃ) *
var
ÕÕ 
first
ÕÕ 
=
ÕÕ 
true
ÕÕ  
;
ÕÕ  !
foreach
œœ 
(
œœ 
var
œœ 
	parameter
œœ &
in
œœ' )

parameters
œœ* 4
)
œœ4 5
{
–– 
if
—— 
(
—— 
first
—— 
)
—— 
{
““ 
first
”” 
=
”” 
false
””  %
;
””% &
}
‘‘ 
else
’’ 
{
÷÷ 
buffer
◊◊ 
.
◊◊ 

AppendLine
◊◊ )
(
◊◊) *
$str
◊◊* -
)
◊◊- .
.
◊◊. /
Append
◊◊/ 5
(
◊◊5 6
new
◊◊6 9
string
◊◊: @
(
◊◊@ A
$char
◊◊A D
,
◊◊D E
$num
◊◊F G
)
◊◊G H
)
◊◊H I
;
◊◊I J
}
ÿÿ 
DbType
⁄⁄ 
parsed
⁄⁄ !
;
⁄⁄! "
string
€€ 
resolvedType
€€ '
=
€€( )
null
€€* .
;
€€. /
if
‹‹ 
(
‹‹ 
!
‹‹ 
Enum
‹‹ 
.
‹‹ 
TryParse
‹‹ &
(
‹‹& '
	parameter
‹‹' 0
.
‹‹0 1
DbType
‹‹1 7
,
‹‹7 8
out
‹‹9 <
parsed
‹‹= C
)
‹‹C D
)
‹‹D E
{
›› 
resolvedType
ﬁﬁ $
=
ﬁﬁ% &
	parameter
ﬁﬁ' 0
.
ﬁﬁ0 1
DbType
ﬁﬁ1 7
;
ﬁﬁ7 8
}
ﬂﬂ 
if
·· 
(
·· 
resolvedType
·· $
==
··% '
null
··( ,
)
··, -
{
‚‚ 
Func
„„ 
<
„„  
SqlTimingParameter
„„ /
,
„„/ 0
string
„„1 7
>
„„7 8

translator
„„9 C
;
„„C D
if
‰‰ 
(
‰‰ 
ParamTranslator
‰‰ +
.
‰‰+ ,
TryGetValue
‰‰, 7
(
‰‰7 8
parsed
‰‰8 >
,
‰‰> ?
out
‰‰@ C

translator
‰‰D N
)
‰‰N O
)
‰‰O P
{
ÂÂ 
resolvedType
ÊÊ (
=
ÊÊ) *

translator
ÊÊ+ 5
(
ÊÊ5 6
	parameter
ÊÊ6 ?
)
ÊÊ? @
;
ÊÊ@ A
}
ÁÁ 
resolvedType
ËË $
=
ËË% &
resolvedType
ËË' 3
??
ËË4 6
	parameter
ËË7 @
.
ËË@ A
DbType
ËËA G
;
ËËG H
}
ÈÈ 
var
ÎÎ 
niceName
ÎÎ  
=
ÎÎ! "#
EnsureParameterPrefix
ÎÎ# 8
(
ÎÎ8 9
	parameter
ÎÎ9 B
.
ÎÎB C
Name
ÎÎC G
)
ÎÎG H
;
ÎÎH I
buffer
ÌÌ 
.
ÌÌ 
Append
ÌÌ !
(
ÌÌ! "
niceName
ÌÌ" *
)
ÌÌ* +
.
ÌÌ+ ,
Append
ÌÌ, 2
(
ÌÌ2 3
$str
ÌÌ3 6
)
ÌÌ6 7
.
ÌÌ7 8
Append
ÌÌ8 >
(
ÌÌ> ?
resolvedType
ÌÌ? K
)
ÌÌK L
;
ÌÌL M
if
 
(
 
	parameter
 !
.
! "
	Direction
" +
!=
, . 
ParameterDirection
/ A
.
A B
ReturnValue
B M
.
M N
ToString
N V
(
V W
)
W X
)
X Y
{
ÒÒ 
buffer
ÚÚ 
.
ÚÚ 
Append
ÚÚ %
(
ÚÚ% &
$str
ÚÚ& +
)
ÚÚ+ ,
.
ÚÚ, -
Append
ÚÚ- 3
(
ÚÚ3 4
PrepareValue
ÚÚ4 @
(
ÚÚ@ A
	parameter
ÚÚA J
)
ÚÚJ K
)
ÚÚK L
;
ÚÚL M
}
ÛÛ 
}
ÙÙ 
}
ıı 
}
ˆˆ 	
	protected
˝˝ 
string
˝˝ 
PrepareValue
˝˝ %
(
˝˝% & 
SqlTimingParameter
˝˝& 8
	parameter
˝˝9 B
)
˝˝B C
{
˛˛ 	
if
ˇˇ 
(
ˇˇ 
	parameter
ˇˇ 
.
ˇˇ 
Value
ˇˇ 
==
ˇˇ  "
null
ˇˇ# '
)
ˇˇ' (
{
ÄÄ 
return
ÅÅ 
$str
ÅÅ 
;
ÅÅ 
}
ÇÇ 
if
ÑÑ 
(
ÑÑ 
	DontQuote
ÑÑ 
.
ÑÑ 
Contains
ÑÑ "
(
ÑÑ" #
	parameter
ÑÑ# ,
.
ÑÑ, -
DbType
ÑÑ- 3
)
ÑÑ3 4
)
ÑÑ4 5
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
	parameter
ÜÜ 
.
ÜÜ 
DbType
ÜÜ $
==
ÜÜ% '
$str
ÜÜ( 1
)
ÜÜ1 2
{
áá 
return
àà 
	parameter
àà $
.
àà$ %
Value
àà% *
==
àà+ -
$str
àà. 4
?
àà5 6
$str
àà7 :
:
àà; <
$str
àà= @
;
àà@ A
}
ââ 
return
ãã 
	parameter
ãã  
.
ãã  !
Value
ãã! &
;
ãã& '
}
åå 
var
éé 
prefix
éé 
=
éé 
string
éé 
.
éé  
Empty
éé  %
;
éé% &
if
èè 
(
èè 
	parameter
èè 
.
èè 
DbType
èè  
==
èè! #
$str
èè$ ,
||
èè- /
	parameter
èè0 9
.
èè9 :
DbType
èè: @
==
èèA C
$str
èèD W
)
èèW X
{
êê 
prefix
ëë 
=
ëë 
$str
ëë 
;
ëë 
}
íí 
return
îî 
prefix
îî 
+
îî 
$str
îî 
+
îî  !
	parameter
îî" +
.
îî+ ,
Value
îî, 1
.
îî1 2
Replace
îî2 9
(
îî9 :
$str
îî: =
,
îî= >
$str
îî? C
)
îîC D
+
îîE F
$str
îîG J
;
îîJ K
}
ïï 	
}
ññ 
}óó ∂
\C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SingletonProfilerProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public		 

class		 %
SingletonProfilerProvider		 *
:		+ ,
IProfilerProvider		- >
{

 
private 
MiniProfiler 
	_profiler &
;& '
public 
MiniProfiler 
GetCurrentProfiler .
(. /
)/ 0
{ 	
return 
	_profiler 
; 
} 	
public 
MiniProfiler 
Start !
(! "
string" (
sessionName) 4
=5 6
null7 ;
); <
{ 	
	_profiler 
= 
new 
MiniProfiler (
(( )
sessionName) 4
??5 7
	AppDomain8 A
.A B
CurrentDomainB O
.O P
FriendlyNameP \
)\ ]
{^ _
IsActive` h
=i j
truek o
}p q
;q r
return 
	_profiler 
; 
} 	
["" 	
Obsolete""	 
("" 
$str"" v
)""v w
]""w x
public## 
MiniProfiler## 
Start## !
(##! "
ProfileLevel##" .
level##/ 4
,##4 5
string##6 <
sessionName##= H
=##I J
null##K O
)##O P
{$$ 	
return%% 
Start%% 
(%% 
sessionName%% $
)%%$ %
;%%% &
}&& 	
public++ 
void++ 
Stop++ 
(++ 
bool++ 
discardResults++ ,
)++, -
{,, 	
if-- 
(-- 
	_profiler-- 
!=-- 
null-- !
)--! "
	_profiler--# ,
.--, -
StopImpl--- 5
(--5 6
)--6 7
;--7 8
}.. 	
}// 
}00 ıá
bC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Storage\HttpRuntimeCacheStorage.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Storage" )
{ 
public 

class #
HttpRuntimeCacheStorage (
:) *
IStorage+ 3
{ 
private 
class 
ProfileInfo !
:" #
IComparable$ /
</ 0
ProfileInfo0 ;
>; <
{ 	
public 
Guid 
Id 
{ 
get  
;  !
set" %
;% &
}' (
public 
DateTime 
Started #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int 
	CompareTo  
(  !
ProfileInfo! ,
other- 2
)2 3
{ 
var 
comp 
= 
Started "
." #
	CompareTo# ,
(, -
other- 2
.2 3
Started3 :
): ;
;; <
if 
( 
comp 
== 
$num 
) 
comp #
=$ %
Id& (
.( )
	CompareTo) 2
(2 3
other3 8
.8 9
Id9 ;
); <
;< =
return 
comp 
; 
} 
} 	
private!! 
static!! 
readonly!! 
object!!  &%
AddPerUserUnviewedIdsLock!!' @
=!!A B
new!!C F
object!!G M
(!!M N
)!!N O
;!!O P
private## 
readonly## 

SortedList## #
<### $
ProfileInfo##$ /
,##/ 0
object##1 7
>##7 8
	_profiles##9 B
=##C D
new##E H

SortedList##I S
<##S T
ProfileInfo##T _
,##_ `
object##a g
>##g h
(##h i
)##i j
;##j k
public)) 
const)) 
string)) 
CacheKeyPrefix)) *
=))+ ,
$str))- =
;))= >
public.. 
TimeSpan.. 
CacheDuration.. %
{..& '
get..( +
;..+ ,
set..- 0
;..0 1
}..2 3
public44 #
HttpRuntimeCacheStorage44 &
(44& '
TimeSpan44' /
cacheDuration440 =
)44= >
{55 	
CacheDuration66 
=66 
cacheDuration66 )
;66) *
}77 	
public== 
void== 
Save== 
(== 
MiniProfiler== %
profiler==& .
)==. /
{>> 	
InsertIntoCache?? 
(?? 
GetCacheKey?? '
(??' (
profiler??( 0
.??0 1
Id??1 3
)??3 4
,??4 5
profiler??6 >
)??> ?
;??? @
lockAA 
(AA 
	_profilesAA 
)AA 
{BB 
varCC 
profileInfoCC 
=CC  !
newCC" %
ProfileInfoCC& 1
{CC2 3
IdCC4 6
=CC7 8
profilerCC9 A
.CCA B
IdCCB D
,CCD E
StartedCCF M
=CCN O
profilerCCP X
.CCX Y
StartedCCY `
}CCa b
;CCb c
ifDD 
(DD 
	_profilesDD 
.DD 

IndexOfKeyDD (
(DD( )
profileInfoDD) 4
)DD4 5
<DD6 7
$numDD8 9
)DD9 :
{EE 
	_profilesFF 
.FF 
AddFF !
(FF! "
profileInfoFF" -
,FF- .
nullFF/ 3
)FF3 4
;FF4 5
}GG 
whileII 
(II 
	_profilesII  
.II  !
CountII! &
>II' (
$numII) *
)II* +
{JJ 
varKK 
firstKK 
=KK 
	_profilesKK  )
.KK) *
KeysKK* .
[KK. /
$numKK/ 0
]KK0 1
;KK1 2
ifLL 
(LL 
firstLL 
.LL 
StartedLL %
<LL& '
DateTimeLL( 0
.LL0 1
NowLL1 4
.LL4 5
AddLL5 8
(LL8 9
-LL9 :
CacheDurationLL: G
)LLG H
.LLH I
ToUniversalTimeLLI X
(LLX Y
)LLY Z
)LLZ [
{MM 
	_profilesNN !
.NN! "
RemoveAtNN" *
(NN* +
$numNN+ ,
)NN, -
;NN- .
}OO 
elsePP 
{QQ 
breakRR 
;RR 
}SS 
}TT 
}UU 
}VV 	
public[[ 
void[[ 
SetUnviewed[[ 
([[  
string[[  &
user[[' +
,[[+ ,
Guid[[- 1
id[[2 4
)[[4 5
{\\ 	
var]] 
ids]] 
=]] !
GetPerUserUnviewedIds]] +
(]]+ ,
user]], 0
)]]0 1
;]]1 2
lock^^ 
(^^ 
ids^^ 
)^^ 
{__ 
if`` 
(`` 
!`` 
ids`` 
.`` 
Contains`` !
(``! "
id``" $
)``$ %
)``% &
{aa 
idsbb 
.bb 
Addbb 
(bb 
idbb 
)bb 
;bb  
}cc 
}dd 
}ee 	
publicjj 
voidjj 
	SetViewedjj 
(jj 
stringjj $
userjj% )
,jj) *
Guidjj+ /
idjj0 2
)jj2 3
{kk 	
varll 
idsll 
=ll !
GetPerUserUnviewedIdsll +
(ll+ ,
userll, 0
)ll0 1
;ll1 2
locknn 
(nn 
idsnn 
)nn 
{oo 
idspp 
.pp 
Removepp 
(pp 
idpp 
)pp 
;pp 
}qq 
}rr 	
publicxx 
MiniProfilerxx 
Loadxx  
(xx  !
Guidxx! %
idxx& (
)xx( )
{yy 	
varzz 
resultzz 
=zz 
HttpRuntimezz $
.zz$ %
Cachezz% *
[zz* +
GetCacheKeyzz+ 6
(zz6 7
idzz7 9
)zz9 :
]zz: ;
aszz< >
MiniProfilerzz? K
;zzK L
return{{ 
result{{ 
;{{ 
}|| 	
public
ÑÑ 
List
ÑÑ 
<
ÑÑ 
Guid
ÑÑ 
>
ÑÑ 
GetUnviewedIds
ÑÑ (
(
ÑÑ( )
string
ÑÑ) /
user
ÑÑ0 4
)
ÑÑ4 5
{
ÖÖ 	
var
ÜÜ 
ids
ÜÜ 
=
ÜÜ #
GetPerUserUnviewedIds
ÜÜ +
(
ÜÜ+ ,
user
ÜÜ, 0
)
ÜÜ0 1
;
ÜÜ1 2
lock
áá 
(
áá 
ids
áá 
)
áá 
{
àà 
return
ââ 
new
ââ 
List
ââ 
<
ââ  
Guid
ââ  $
>
ââ$ %
(
ââ% &
ids
ââ& )
)
ââ) *
;
ââ* +
}
ää 
}
ãã 	
private
çç 
void
çç 
InsertIntoCache
çç $
(
çç$ %
string
çç% +
key
çç, /
,
çç/ 0
object
çç1 7
value
çç8 =
)
çç= >
{
éé 	
var
èè 

expiration
èè 
=
èè 
DateTime
èè %
.
èè% &
Now
èè& )
.
èè) *
Add
èè* -
(
èè- .
CacheDuration
èè. ;
)
èè; <
;
èè< =
HttpRuntime
íí 
.
íí 
Cache
íí 
.
íí 
Insert
íí $
(
íí$ %
key
ìì 
:
ìì 
key
ìì 
,
ìì 
value
îî 
:
îî 
value
îî 
,
îî 
dependencies
ïï 
:
ïï 
null
ïï "
,
ïï" # 
absoluteExpiration
ññ "
:
ññ" #

expiration
ññ$ .
,
ññ. /
slidingExpiration
óó !
:
óó! "
System
óó# )
.
óó) *
Web
óó* -
.
óó- .
Caching
óó. 5
.
óó5 6
Cache
óó6 ;
.
óó; <!
NoSlidingExpiration
óó< O
,
óóO P
priority
òò 
:
òò 
System
òò  
.
òò  !
Web
òò! $
.
òò$ %
Caching
òò% ,
.
òò, -
CacheItemPriority
òò- >
.
òò> ?
Low
òò? B
,
òòB C
onRemoveCallback
ôô  
:
ôô  !
null
ôô" &
)
ôô& '
;
ôô' (
}
öö 	
private
úú 
string
úú 
GetCacheKey
úú "
(
úú" #
Guid
úú# '
id
úú( *
)
úú* +
{
ùù 	
return
ûû 
CacheKeyPrefix
ûû !
+
ûû" #
id
ûû$ &
;
ûû& '
}
üü 	
private
°° 
string
°° (
GetPerUserUnviewedCacheKey
°° 1
(
°°1 2
string
°°2 8
user
°°9 =
)
°°= >
{
¢¢ 	
return
££ 
CacheKeyPrefix
££ !
+
££" #
$str
££$ 8
+
££9 :
user
££; ?
;
££? @
}
§§ 	
private
¶¶ 
List
¶¶ 
<
¶¶ 
Guid
¶¶ 
>
¶¶ #
GetPerUserUnviewedIds
¶¶ 0
(
¶¶0 1
string
¶¶1 7
user
¶¶8 <
)
¶¶< =
{
ßß 	
var
®® 
key
®® 
=
®® (
GetPerUserUnviewedCacheKey
®® 0
(
®®0 1
user
®®1 5
)
®®5 6
;
®®6 7
var
©© 
result
©© 
=
©© 
HttpRuntime
©© $
.
©©$ %
Cache
©©% *
[
©©* +
key
©©+ .
]
©©. /
as
©©0 2
List
©©3 7
<
©©7 8
Guid
©©8 <
>
©©< =
;
©©= >
if
´´ 
(
´´ 
result
´´ 
==
´´ 
null
´´ 
)
´´ 
{
¨¨ 
lock
≠≠ 
(
≠≠ '
AddPerUserUnviewedIdsLock
≠≠ /
)
≠≠/ 0
{
ÆÆ 
result
∞∞ 
=
∞∞ 
HttpRuntime
∞∞ (
.
∞∞( )
Cache
∞∞) .
[
∞∞. /
key
∞∞/ 2
]
∞∞2 3
as
∞∞4 6
List
∞∞7 ;
<
∞∞; <
Guid
∞∞< @
>
∞∞@ A
;
∞∞A B
if
±± 
(
±± 
result
±± 
==
±± !
null
±±" &
)
±±& '
{
≤≤ 
result
≥≥ 
=
≥≥  
new
≥≥! $
List
≥≥% )
<
≥≥) *
Guid
≥≥* .
>
≥≥. /
(
≥≥/ 0
)
≥≥0 1
;
≥≥1 2
InsertIntoCache
¥¥ '
(
¥¥' (
key
¥¥( +
,
¥¥+ ,
result
¥¥- 3
)
¥¥3 4
;
¥¥4 5
}
µµ 
}
∂∂ 
}
∑∑ 
return
ππ 
result
ππ 
;
ππ 
}
∫∫ 	
public
øø 
IEnumerable
øø 
<
øø 
Guid
øø 
>
øø  
List
øø! %
(
øø% &
int
¿¿ 

maxResults
¿¿ 
,
¿¿ 
DateTime
¡¡ 
?
¡¡ 
start
¡¡ 
=
¡¡ 
null
¡¡ "
,
¡¡" #
DateTime
¬¬ 
?
¬¬ 
finish
¬¬ 
=
¬¬ 
null
¬¬ #
,
¬¬# $
ListResultsOrder
√√ 
orderBy
√√ $
=
√√% &
ListResultsOrder
√√' 7
.
√√7 8

Descending
√√8 B
)
√√B C
{
ƒƒ 	
var
≈≈ 
guids
≈≈ 
=
≈≈ 
new
≈≈ 
List
≈≈  
<
≈≈  !
Guid
≈≈! %
>
≈≈% &
(
≈≈& '
)
≈≈' (
;
≈≈( )
lock
∆∆ 
(
∆∆ 
	_profiles
∆∆ 
)
∆∆ 
{
«« 
int
»» 
idxStart
»» 
=
»» 
$num
»»  
;
»»  !
int
…… 
	idxFinish
…… 
=
…… 
	_profiles
……  )
.
……) *
Count
……* /
-
……0 1
$num
……2 3
;
……3 4
if
   
(
   
start
   
!=
   
null
   !
)
  ! "
idxStart
  # +
=
  , -!
BinaryClosestSearch
  . A
(
  A B
start
  B G
.
  G H
Value
  H M
)
  M N
;
  N O
if
ÀÀ 
(
ÀÀ 
finish
ÀÀ 
!=
ÀÀ 
null
ÀÀ "
)
ÀÀ" #
	idxFinish
ÀÀ$ -
=
ÀÀ. /!
BinaryClosestSearch
ÀÀ0 C
(
ÀÀC D
finish
ÀÀD J
.
ÀÀJ K
Value
ÀÀK P
)
ÀÀP Q
;
ÀÀQ R
if
ÕÕ 
(
ÕÕ 
idxStart
ÕÕ 
<
ÕÕ 
$num
ÕÕ  
)
ÕÕ  !
idxStart
ÕÕ" *
=
ÕÕ+ ,
$num
ÕÕ- .
;
ÕÕ. /
if
ŒŒ 
(
ŒŒ 
	idxFinish
ŒŒ 
>=
ŒŒ  
	_profiles
ŒŒ! *
.
ŒŒ* +
Count
ŒŒ+ 0
)
ŒŒ0 1
	idxFinish
ŒŒ2 ;
=
ŒŒ< =
	_profiles
ŒŒ> G
.
ŒŒG H
Count
ŒŒH M
-
ŒŒN O
$num
ŒŒP Q
;
ŒŒQ R
var
–– 
keys
–– 
=
–– 
	_profiles
–– $
.
––$ %
Keys
––% )
;
––) *
if
““ 
(
““ 
orderBy
““ 
==
““ 
ListResultsOrder
““ /
.
““/ 0
	Ascending
““0 9
)
““9 :
{
”” 
for
‘‘ 
(
‘‘ 
int
‘‘ 
i
‘‘ 
=
‘‘  
idxStart
‘‘! )
;
‘‘) *
i
‘‘+ ,
<=
‘‘- /
	idxFinish
‘‘0 9
;
‘‘9 :
i
‘‘; <
++
‘‘< >
)
‘‘> ?
{
’’ 
guids
÷÷ 
.
÷÷ 
Add
÷÷ !
(
÷÷! "
keys
÷÷" &
[
÷÷& '
i
÷÷' (
]
÷÷( )
.
÷÷) *
Id
÷÷* ,
)
÷÷, -
;
÷÷- .
if
◊◊ 
(
◊◊ 
guids
◊◊ !
.
◊◊! "
Count
◊◊" '
==
◊◊( *

maxResults
◊◊+ 5
)
◊◊5 6
break
◊◊7 <
;
◊◊< =
}
ÿÿ 
}
ŸŸ 
else
⁄⁄ 
{
€€ 
for
‹‹ 
(
‹‹ 
int
‹‹ 
i
‹‹ 
=
‹‹  
	idxFinish
‹‹! *
;
‹‹* +
i
‹‹, -
>=
‹‹. 0
idxStart
‹‹1 9
;
‹‹9 :
i
‹‹; <
--
‹‹< >
)
‹‹> ?
{
›› 
guids
ﬁﬁ 
.
ﬁﬁ 
Add
ﬁﬁ !
(
ﬁﬁ! "
keys
ﬁﬁ" &
[
ﬁﬁ& '
i
ﬁﬁ' (
]
ﬁﬁ( )
.
ﬁﬁ) *
Id
ﬁﬁ* ,
)
ﬁﬁ, -
;
ﬁﬁ- .
if
ﬂﬂ 
(
ﬂﬂ 
guids
ﬂﬂ !
.
ﬂﬂ! "
Count
ﬂﬂ" '
==
ﬂﬂ( *

maxResults
ﬂﬂ+ 5
)
ﬂﬂ5 6
break
ﬂﬂ7 <
;
ﬂﬂ< =
}
‡‡ 
}
·· 
}
„„ 
return
‰‰ 
guids
‰‰ 
;
‰‰ 
}
ÂÂ 	
private
ÁÁ 
int
ÁÁ !
BinaryClosestSearch
ÁÁ '
(
ÁÁ' (
DateTime
ÁÁ( 0
date
ÁÁ1 5
)
ÁÁ5 6
{
ËË 	
int
ÈÈ 
lower
ÈÈ 
=
ÈÈ 
$num
ÈÈ 
;
ÈÈ 
int
ÍÍ 
upper
ÍÍ 
=
ÍÍ 
	_profiles
ÍÍ !
.
ÍÍ! "
Count
ÍÍ" '
-
ÍÍ( )
$num
ÍÍ* +
;
ÍÍ+ ,
while
ÏÏ 
(
ÏÏ 
lower
ÏÏ 
<=
ÏÏ 
upper
ÏÏ !
)
ÏÏ! "
{
ÌÌ 
int
ÓÓ 
adjustedIndex
ÓÓ !
=
ÓÓ" #
lower
ÓÓ$ )
+
ÓÓ* +
(
ÓÓ, -
(
ÓÓ- .
upper
ÓÓ. 3
-
ÓÓ4 5
lower
ÓÓ6 ;
)
ÓÓ; <
>>
ÓÓ= ?
$num
ÓÓ@ A
)
ÓÓA B
;
ÓÓB C
int
ÔÔ 

comparison
ÔÔ 
=
ÔÔ  
	_profiles
ÔÔ! *
.
ÔÔ* +
Keys
ÔÔ+ /
[
ÔÔ/ 0
adjustedIndex
ÔÔ0 =
]
ÔÔ= >
.
ÔÔ> ?
Started
ÔÔ? F
.
ÔÔF G
	CompareTo
ÔÔG P
(
ÔÔP Q
date
ÔÔQ U
)
ÔÔU V
;
ÔÔV W
if
 
(
 

comparison
 
==
 !
$num
" #
)
# $
{
ÒÒ 
return
ÚÚ 
adjustedIndex
ÚÚ (
;
ÚÚ( )
}
ÛÛ 
if
ÙÙ 
(
ÙÙ 

comparison
ÙÙ 
<
ÙÙ  
$num
ÙÙ! "
)
ÙÙ" #
{
ıı 
lower
ˆˆ 
=
ˆˆ 
adjustedIndex
ˆˆ )
+
ˆˆ* +
$num
ˆˆ, -
;
ˆˆ- .
}
˜˜ 
else
¯¯ 
{
˘˘ 
upper
˙˙ 
=
˙˙ 
adjustedIndex
˙˙ )
-
˙˙* +
$num
˙˙, -
;
˙˙- .
}
˚˚ 
}
¸¸ 
return
˝˝ 
lower
˝˝ 
;
˝˝ 
}
˛˛ 	
}
ˇˇ 
}ÄÄ â
SC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Storage\IStorage.cs
	namespace 	
StackExchange
 
. 
	Profiling !
.! "
Storage" )
{ 
public		 

enum		 
ListResultsOrder		  
{

 
	Ascending 
, 

Descending 
} 
public$$ 

	interface$$ 
IStorage$$ 
{%% 
IEnumerable)) 
<)) 
Guid)) 
>)) 
List)) 
()) 
int** 

maxResults** 
,** 
DateTime++ 
?++ 
start++ 
=++ 
null++ "
,++" #
DateTime,, 
?,, 
finish,, 
=,, 
null,, #
,,,# $
ListResultsOrder-- 
orderBy-- $
=--% &
ListResultsOrder--' 7
.--7 8

Descending--8 B
)--B C
;--C D
void66 
Save66 
(66 
MiniProfiler66 
profiler66 '
)66' (
;66( )
MiniProfiler@@ 
Load@@ 
(@@ 
Guid@@ 
id@@ !
)@@! "
;@@" #
voidEE 
SetUnviewedEE 
(EE 
stringEE 
userEE  $
,EE$ %
GuidEE& *
idEE+ -
)EE- .
;EE. /
voidJJ 
	SetViewedJJ 
(JJ 
stringJJ 
userJJ "
,JJ" #
GuidJJ$ (
idJJ) +
)JJ+ ,
;JJ, -
ListRR 
<RR 
GuidRR 
>RR 
GetUnviewedIdsRR !
(RR! "
stringRR" (
userRR) -
)RR- .
;RR. /
}SS 
}TT î
ZC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 2
)2 3
]3 4
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str o
)o p
]p q
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str +
)+ ,
], -
[		 
assembly		 	
:			 

AssemblyProduct		 
(		 
$str		 4
)		4 5
]		5 6
[

 
assembly

 	
:

	 

AssemblyTrademark

 
(

 
$str

 
)

  
]

  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[ 
assembly 	
:	 

AssemblyVersion 
( 
$str  
)  !
]! "
[ 
assembly 	
:	 
(
AssemblyInformationalVersion '
(' (
$str( -
)- .
]. /
[ 
assembly 	
:	 

InternalsVisibleTo 
( 
$str	 â
)
â ä
]
ä ãã9
NC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\SqlProfiler.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{		 
public 

class 
SqlProfiler 
{ 
public 
SqlProfiler 
( 
MiniProfiler '
profiler( 0
)0 1
{ 	
Profiler 
= 
profiler 
;  
} 	
private 
readonly  
ConcurrentDictionary -
<- .
Tuple. 3
<3 4
object4 :
,: ;
SqlExecuteType< J
>J K
,K L
	SqlTimingM V
>V W
_inProgressX c
=d e
new  
ConcurrentDictionary $
<$ %
Tuple% *
<* +
object+ 1
,1 2
SqlExecuteType3 A
>A B
,B C
	SqlTimingD M
>M N
(N O
)O P
;P Q
private 
readonly  
ConcurrentDictionary -
<- .
IDataReader. 9
,9 :
	SqlTiming; D
>D E
_inProgressReadersF X
=Y Z
new  
ConcurrentDictionary $
<$ %
IDataReader% 0
,0 1
	SqlTiming2 ;
>; <
(< =
)= >
;> ?
public   
MiniProfiler   
Profiler   $
{  % &
get  ' *
;  * +
private  , 3
set  4 7
;  7 8
}  9 :
public%% 
void%% 
ExecuteStartImpl%% $
(%%$ %

IDbCommand%%% /
command%%0 7
,%%7 8
SqlExecuteType%%9 G
type%%H L
)%%L M
{&& 	
var'' 
id'' 
='' 
Tuple'' 
.'' 
Create'' !
(''! "
(''" #
object''# )
)'') *
command''* 1
,''1 2
type''3 7
)''7 8
;''8 9
var(( 
	sqlTiming(( 
=(( 
new(( 
	SqlTiming((  )
((() *
command((* 1
,((1 2
type((3 7
,((7 8
Profiler((9 A
)((A B
;((B C
_inProgress** 
[** 
id** 
]** 
=** 
	sqlTiming** '
;**' (
}++ 	
public00 
void00 
ExecuteFinishImpl00 %
(00% &

IDbCommand00& 0
command001 8
,008 9
SqlExecuteType00: H
type00I M
,00M N
DbDataReader00O [
reader00\ b
=00c d
null00e i
)00i j
{11 	
var22 
id22 
=22 
Tuple22 
.22 
Create22 !
(22! "
(22" #
object22# )
)22) *
command22* 1
,221 2
type223 7
)227 8
;228 9
var33 
current33 
=33 
_inProgress33 %
[33% &
id33& (
]33( )
;33) *
current44 
.44 
ExecutionComplete44 %
(44% &
reader44& ,
!=44- /
null440 4
)444 5
;445 6
	SqlTiming55 
ignore55 
;55 
_inProgress66 
.66 
	TryRemove66 !
(66! "
id66" $
,66$ %
out66& )
ignore66* 0
)660 1
;661 2
if77 
(77 
reader77 
!=77 
null77 
)77 
{88 
_inProgressReaders99 "
[99" #
reader99# )
]99) *
=99+ ,
current99- 4
;994 5
}:: 
};; 	
public@@ 
void@@ 
ReaderFinishedImpl@@ &
(@@& '
IDataReader@@' 2
reader@@3 9
)@@9 :
{AA 	
	SqlTimingBB 
statBB 
;BB 
ifEE 
(EE 
_inProgressReadersEE "
.EE" #
TryGetValueEE# .
(EE. /
readerEE/ 5
,EE5 6
outEE7 :
statEE; ?
)EE? @
)EE@ A
{FF 
statGG 
.GG 
ReaderFetchCompleteGG (
(GG( )
)GG) *
;GG* +
	SqlTimingHH 
ignoreHH  
;HH  !
_inProgressReadersII "
.II" #
	TryRemoveII# ,
(II, -
readerII- 3
,II3 4
outII5 8
ignoreII9 ?
)II? @
;II@ A
}JJ 
}KK 	
publicPP 
	SqlTimingPP 
[PP 
]PP !
GetInProgressCommandsPP 0
(PP0 1
)PP1 2
{QQ 	
returnRR 
_inProgressRR 
.RR 
ValuesRR %
.RR% &
OrderByRR& -
(RR- .
xRR. /
=>RR0 2
xRR3 4
.RR4 5
StartMillisecondsRR5 F
)RRF G
.RRG H
ToArrayRRH O
(RRO P
)RRP Q
;RRQ R
}SS 	
}TT 
publicYY 

staticYY 
classYY !
SqlProfilerExtensionsYY -
{ZZ 
public^^ 
static^^ 
void^^ 
ExecuteStart^^ '
(^^' (
this^^( ,
SqlProfiler^^- 8
sqlProfiler^^9 D
,^^D E

IDbCommand^^F P
command^^Q X
,^^X Y
SqlExecuteType^^Z h
type^^i m
)^^m n
{__ 	
if`` 
(`` 
sqlProfiler`` 
==`` 
null`` #
)``# $
return``% +
;``+ ,
sqlProfileraa 
.aa 
ExecuteStartImplaa (
(aa( )
commandaa) 0
,aa0 1
typeaa2 6
)aa6 7
;aa7 8
}bb 	
publicgg 
staticgg 
voidgg 
ExecuteFinishgg (
(gg( )
thishh 
SqlProfilerhh 
sqlProfilerhh (
,hh( )

IDbCommandii 
commandii 
,ii 
SqlExecuteTypejj 
typejj 
,jj  
DbDataReaderkk 
readerkk 
=kk  !
nullkk" &
)kk& '
{ll 	
ifmm 
(mm 
sqlProfilermm 
==mm 
nullmm #
)mm# $
returnmm% +
;mm+ ,
sqlProfilernn 
.nn 
ExecuteFinishImplnn )
(nn) *
commandnn* 1
,nn1 2
typenn3 7
,nn7 8
readernn9 ?
)nn? @
;nn@ A
}oo 	
publictt 
statictt 
voidtt 
ReaderFinishtt '
(tt' (
thistt( ,
SqlProfilertt- 8
sqlProfilertt9 D
,ttD E
IDataReaderttF Q
readerttR X
)ttX Y
{uu 	
ifvv 
(vv 
sqlProfilervv 
==vv 
nullvv #
)vv# $
returnvv% +
;vv+ ,
sqlProfilerww 
.ww 
ReaderFinishedImplww *
(ww* +
readerww+ 1
)ww1 2
;ww2 3
}xx 	
}yy 
}zz à
IC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\Timing.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{		 
[ 
DataContract 
] 
public 

class 
Timing 
: 
IDisposable %
{ 
private 
readonly 
long 
_startTicks )
;) *
private 
readonly 
decimal  
?  !

_minSaveMs" ,
;, -
private 
readonly 
bool '
_includeChildrenWithMinSave 9
;9 :
[ 	
Obsolete	 
( 
$str *
)* +
]+ ,
public 
Timing 
( 
) 
{ 	
} 	
public$$ 
Timing$$ 
($$ 
MiniProfiler$$ "
profiler$$# +
,$$+ ,
Timing$$- 3
parent$$4 :
,$$: ;
string$$< B
name$$C G
,$$G H
decimal$$I P
?$$P Q
	minSaveMs$$R [
=$$\ ]
null$$^ b
,$$b c
bool$$d h
?$$h i'
includeChildrenWithMinSave	$$j Ñ
=
$$Ö Ü
false
$$á å
)
$$å ç
{%% 	
Id&& 
=&& 
Guid&& 
.&& 
NewGuid&& 
(&& 
)&& 
;&&  
Profiler'' 
='' 
profiler'' 
;''  
Profiler(( 
.(( 
Head(( 
=(( 
this((  
;((  !
if** 
(** 
parent** 
!=** 
null** 
)** 
{++ 
parent-- 
.-- 
AddChild-- 
(--  
this--  $
)--$ %
;--% &
}.. 
Name00 
=00 
name00 
;00 
_startTicks22 
=22 
profiler22 "
.22" #
ElapsedTicks22# /
;22/ 0

_minSaveMs33 
=33 
	minSaveMs33 "
;33" #'
_includeChildrenWithMinSave44 '
=44( )&
includeChildrenWithMinSave44* D
==44E G
true44H L
;44L M
StartMilliseconds55 
=55 
profiler55  (
.55( )"
GetRoundedMilliseconds55) ?
(55? @
_startTicks55@ K
)55K L
;55L M
}66 	
[;; 	

DataMember;;	 
(;; 
Order;; 
=;; 
$num;; 
);; 
];; 
public<< 
Guid<< 
Id<< 
{<< 
get<< 
;<< 
set<< !
;<<! "
}<<# $
[AA 	

DataMemberAA	 
(AA 
OrderAA 
=AA 
$numAA 
)AA 
]AA 
publicBB 
stringBB 
NameBB 
{BB 
getBB  
;BB  !
setBB" %
;BB% &
}BB' (
[GG 	

DataMemberGG	 
(GG 
OrderGG 
=GG 
$numGG 
)GG 
]GG 
publicHH 
decimalHH 
?HH  
DurationMillisecondsHH ,
{HH- .
getHH/ 2
;HH2 3
setHH4 7
;HH7 8
}HH9 :
[MM 	

DataMemberMM	 
(MM 
OrderMM 
=MM 
$numMM 
)MM 
]MM 
publicNN 
decimalNN 
StartMillisecondsNN (
{NN) *
getNN+ .
;NN. /
setNN0 3
;NN3 4
}NN5 6
[SS 	

DataMemberSS	 
(SS 
OrderSS 
=SS 
$numSS 
)SS 
]SS 
publicTT 
ListTT 
<TT 
TimingTT 
>TT 
ChildrenTT $
{TT% &
getTT' *
;TT* +
setTT, /
;TT/ 0
}TT1 2
[YY 	

DataMemberYY	 
(YY 
OrderYY 
=YY 
$numYY 
)YY 
]YY 
publicZZ 

DictionaryZZ 
<ZZ 
stringZZ  
,ZZ  !
ListZZ" &
<ZZ& '
CustomTimingZZ' 3
>ZZ3 4
>ZZ4 5
CustomTimingsZZ6 C
{ZZD E
getZZF I
;ZZI J
setZZK N
;ZZN O
}ZZP Q
[__ 	
ScriptIgnore__	 
]__ 
public`` 
string`` 
CustomTimingsJson`` '
{``( )
getaa 
{aa 
returnaa 
CustomTimingsaa &
!=aa' )
nullaa* .
?aa/ 0
CustomTimingsaa1 >
.aa> ?
ToJsonaa? E
(aaE F
)aaF G
:aaH I
nullaaJ N
;aaN O
}aaP Q
setbb 
{bb 
CustomTimingsbb 
=bb  !
valuebb" '
.bb' (
FromJsonbb( 0
<bb0 1

Dictionarybb1 ;
<bb; <
stringbb< B
,bbB C
ListbbD H
<bbH I
CustomTimingbbI U
>bbU V
>bbV W
>bbW X
(bbX Y
)bbY Z
;bbZ [
}bb\ ]
}cc 	
[hh 	
ScriptIgnorehh	 
]hh 
publicii 
boolii 
HasCustomTimingsii $
{jj 	
getkk 
{kk 
returnkk 
CustomTimingskk &
!=kk' )
nullkk* .
&&kk/ 1
CustomTimingskk2 ?
.kk? @
Anykk@ C
(kkC D
pairkkD H
=>kkI K
pairkkL P
.kkP Q
ValuekkQ V
!=kkW Y
nullkkZ ^
&&kk_ a
pairkkb f
.kkf g
Valuekkg l
.kkl m
Anykkm p
(kkp q
)kkq r
)kkr s
;kks t
}kku v
}ll 	
[rr 	
ScriptIgnorerr	 
]rr 
publicss 
Timingss 
ParentTimingss "
{ss# $
getss% (
;ss( )
setss* -
;ss- .
}ss/ 0
[xx 	
ScriptIgnorexx	 
]xx 
publicyy 
Guidyy 
ParentTimingIdyy "
{yy# $
getyy% (
;yy( )
setyy* -
;yy- .
}yy/ 0
[~~ 	
ScriptIgnore~~	 
]~~ 
public 
decimal /
#DurationWithoutChildrenMilliseconds :
{
ÄÄ 	
get
ÅÅ 
{
ÇÇ 
var
ÉÉ 
result
ÉÉ 
=
ÉÉ "
DurationMilliseconds
ÉÉ 1
.
ÉÉ1 2
GetValueOrDefault
ÉÉ2 C
(
ÉÉC D
)
ÉÉD E
;
ÉÉE F
if
ÖÖ 
(
ÖÖ 
HasChildren
ÖÖ 
)
ÖÖ  
{
ÜÜ 
foreach
áá 
(
áá 
var
áá  
child
áá! &
in
áá' )
Children
áá* 2
)
áá2 3
{
àà 
result
ââ 
-=
ââ !
child
ââ" '
.
ââ' ("
DurationMilliseconds
ââ( <
.
ââ< =
GetValueOrDefault
ââ= N
(
ââN O
)
ââO P
;
ââP Q
}
ää 
}
ãã 
return
çç 
Math
çç 
.
çç 
Round
çç !
(
çç! "
result
çç" (
,
çç( )
$num
çç* +
)
çç+ ,
;
çç, -
}
éé 
}
èè 	
[
ïï 	
ScriptIgnore
ïï	 
]
ïï 
public
ññ 
bool
ññ 
	IsTrivial
ññ 
{
óó 	
get
òò 
{
òò 
return
òò 1
#DurationWithoutChildrenMilliseconds
òò <
<=
òò= ?
MiniProfiler
òò@ L
.
òòL M
Settings
òòM U
.
òòU V2
$TrivialDurationThresholdMilliseconds
òòV z
;
òòz {
}
òò| }
}
ôô 	
[
ûû 	
ScriptIgnore
ûû	 
]
ûû 
public
üü 
bool
üü 
HasChildren
üü 
{
†† 	
get
°° 
{
°° 
return
°° 
Children
°° !
!=
°°" $
null
°°% )
&&
°°* ,
Children
°°- 5
.
°°5 6
Count
°°6 ;
>
°°< =
$num
°°> ?
;
°°? @
}
°°A B
}
¢¢ 	
[
ßß 	
ScriptIgnore
ßß	 
]
ßß 
public
®® 
bool
®® 
IsRoot
®® 
{
©© 	
get
™™ 
{
™™ 
return
™™ 
Equals
™™ 
(
™™  
Profiler
™™  (
.
™™( )
Root
™™) -
)
™™- .
;
™™. /
}
™™0 1
}
´´ 	
[
∞∞ 	
ScriptIgnore
∞∞	 
]
∞∞ 
public
±± 
short
±± 
Depth
±± 
{
≤≤ 	
get
≥≥ 
{
¥¥ 
short
µµ 
result
µµ 
=
µµ 
$num
µµ  
;
µµ  !
var
∂∂ 
parent
∂∂ 
=
∂∂ 
ParentTiming
∂∂ )
;
∂∂) *
while
∏∏ 
(
∏∏ 
parent
∏∏ 
!=
∏∏  
null
∏∏! %
)
∏∏% &
{
ππ 
parent
∫∫ 
=
∫∫ 
parent
∫∫ #
.
∫∫# $
ParentTiming
∫∫$ 0
;
∫∫0 1
result
ªª 
++
ªª 
;
ªª 
}
ºº 
return
ææ 
result
ææ 
;
ææ 
}
øø 
}
¿¿ 	
internal
≈≈ 
MiniProfiler
≈≈ 
Profiler
≈≈ &
{
≈≈' (
get
≈≈) ,
;
≈≈, -
set
≈≈. 1
;
≈≈1 2
}
≈≈3 4
[
   	
ScriptIgnore
  	 
]
   
public
ÀÀ 
Guid
ÀÀ 
MiniProfilerId
ÀÀ "
{
ÀÀ# $
get
ÀÀ% (
;
ÀÀ( )
set
ÀÀ* -
;
ÀÀ- .
}
ÀÀ/ 0
public
–– 
override
–– 
string
–– 
ToString
–– '
(
––' (
)
––( )
{
—— 	
return
““ 
Name
““ 
;
““ 
}
”” 	
public
ÿÿ 
override
ÿÿ 
bool
ÿÿ 
Equals
ÿÿ #
(
ÿÿ# $
object
ÿÿ$ *
other
ÿÿ+ 0
)
ÿÿ0 1
{
ŸŸ 	
return
⁄⁄ 
other
⁄⁄ 
is
⁄⁄ 
Timing
⁄⁄ "
&&
⁄⁄# %
Id
⁄⁄& (
.
⁄⁄( )
Equals
⁄⁄) /
(
⁄⁄/ 0
(
⁄⁄0 1
(
⁄⁄1 2
Timing
⁄⁄2 8
)
⁄⁄8 9
other
⁄⁄9 >
)
⁄⁄> ?
.
⁄⁄? @
Id
⁄⁄@ B
)
⁄⁄B C
;
⁄⁄C D
}
€€ 	
public
‡‡ 
override
‡‡ 
int
‡‡ 
GetHashCode
‡‡ '
(
‡‡' (
)
‡‡( )
{
·· 	
return
‚‚ 
Id
‚‚ 
.
‚‚ 
GetHashCode
‚‚ !
(
‚‚! "
)
‚‚" #
;
‚‚# $
}
„„ 	
public
ËË 
void
ËË 
Stop
ËË 
(
ËË 
)
ËË 
{
ÈÈ 	
if
ÍÍ 
(
ÍÍ "
DurationMilliseconds
ÍÍ $
!=
ÍÍ% '
null
ÍÍ( ,
)
ÍÍ, -
return
ÍÍ. 4
;
ÍÍ4 5"
DurationMilliseconds
ÎÎ  
=
ÎÎ! "
Profiler
ÎÎ# +
.
ÎÎ+ ,%
GetDurationMilliseconds
ÎÎ, C
(
ÎÎC D
_startTicks
ÎÎD O
)
ÎÎO P
;
ÎÎP Q
Profiler
ÏÏ 
.
ÏÏ 
Head
ÏÏ 
=
ÏÏ 
ParentTiming
ÏÏ (
;
ÏÏ( )
if
ÓÓ 
(
ÓÓ 

_minSaveMs
ÓÓ 
.
ÓÓ 
HasValue
ÓÓ #
&&
ÓÓ$ &

_minSaveMs
ÓÓ' 1
.
ÓÓ1 2
Value
ÓÓ2 7
>
ÓÓ8 9
$num
ÓÓ: ;
&&
ÓÓ< >
ParentTiming
ÓÓ? K
!=
ÓÓL N
null
ÓÓO S
)
ÓÓS T
{
ÔÔ 
var
 
	compareMs
 
=
 )
_includeChildrenWithMinSave
  ;
?
< ="
DurationMilliseconds
> R
:
S T1
#DurationWithoutChildrenMilliseconds
U x
;
x y
if
ÒÒ 
(
ÒÒ 
	compareMs
ÒÒ 
<
ÒÒ 

_minSaveMs
ÒÒ  *
.
ÒÒ* +
Value
ÒÒ+ 0
)
ÒÒ0 1
{
ÚÚ 
ParentTiming
ÛÛ  
.
ÛÛ  !
RemoveChild
ÛÛ! ,
(
ÛÛ, -
this
ÛÛ- 1
)
ÛÛ1 2
;
ÛÛ2 3
}
ÙÙ 
}
ıı 
}
ˆˆ 	
void
˚˚ 
IDisposable
˚˚ 
.
˚˚ 
Dispose
˚˚  
(
˚˚  !
)
˚˚! "
{
¸¸ 	
Stop
˝˝ 
(
˝˝ 
)
˝˝ 
;
˝˝ 
}
˛˛ 	
public
ÜÜ 
void
ÜÜ 
AddChild
ÜÜ 
(
ÜÜ 
Timing
ÜÜ #
timing
ÜÜ$ *
)
ÜÜ* +
{
áá 	
if
àà 
(
àà 
Children
àà 
==
àà 
null
àà  
)
àà  !
Children
ââ 
=
ââ 
new
ââ 
List
ââ #
<
ââ# $
Timing
ââ$ *
>
ââ* +
(
ââ+ ,
)
ââ, -
;
ââ- .
Children
ãã 
.
ãã 
Add
ãã 
(
ãã 
timing
ãã 
)
ãã  
;
ãã  !
if
åå 
(
åå 
timing
åå 
.
åå 
Profiler
åå 
==
åå !
null
åå" &
)
åå& '
timing
çç 
.
çç 
Profiler
çç 
=
çç  !
Profiler
çç" *
;
çç* +
timing
éé 
.
éé 
ParentTiming
éé 
=
éé  !
this
éé" &
;
éé& '
timing
èè 
.
èè 
ParentTimingId
èè !
=
èè" #
Id
èè$ &
;
èè& '
timing
êê 
.
êê 
MiniProfilerId
êê !
=
êê" #
Profiler
êê$ ,
.
êê, -
Id
êê- /
;
êê/ 0
}
ëë 	
internal
ìì 
void
ìì 
RemoveChild
ìì !
(
ìì! "
Timing
ìì" (
timing
ìì) /
)
ìì/ 0
{
îî 	
if
ïï 
(
ïï 
Children
ïï 
!=
ïï 
null
ïï  
)
ïï  !
{
ññ 
Children
óó 
.
óó 
Remove
óó 
(
óó  
timing
óó  &
)
óó& '
;
óó' (
}
òò 
}
ôô 	
public
¢¢ 
void
¢¢ 
AddCustomTiming
¢¢ #
(
¢¢# $
string
¢¢$ *
category
¢¢+ 3
,
¢¢3 4
CustomTiming
¢¢5 A
customTiming
¢¢B N
)
¢¢N O
{
££ 	!
GetCustomTimingList
§§ 
(
§§  
category
§§  (
)
§§( )
.
§§) *
Add
§§* -
(
§§- .
customTiming
§§. :
)
§§: ;
;
§§; <
}
•• 	
internal
ßß 
void
ßß  
RemoveCustomTiming
ßß (
(
ßß( )
string
ßß) /
category
ßß0 8
,
ßß8 9
CustomTiming
ßß: F
customTiming
ßßG S
)
ßßS T
{
®® 	!
GetCustomTimingList
©© 
(
©©  
category
©©  (
)
©©( )
.
©©) *
Remove
©©* 0
(
©©0 1
customTiming
©©1 =
)
©©= >
;
©©> ?
}
™™ 	
private
¨¨ 
readonly
¨¨ 
object
¨¨ 
_lockObject
¨¨  +
=
¨¨, -
new
¨¨. 1
object
¨¨2 8
(
¨¨8 9
)
¨¨9 :
;
¨¨: ;
private
≤≤ 
List
≤≤ 
<
≤≤ 
CustomTiming
≤≤ !
>
≤≤! "!
GetCustomTimingList
≤≤# 6
(
≤≤6 7
string
≤≤7 =
category
≤≤> F
)
≤≤F G
{
≥≥ 	
lock
¥¥ 
(
¥¥ 
_lockObject
¥¥ 
)
¥¥ 
{
µµ 
if
∂∂ 
(
∂∂ 
CustomTimings
∂∂ !
==
∂∂" $
null
∂∂% )
)
∂∂) *
CustomTimings
∑∑ !
=
∑∑" #
new
∑∑$ '

Dictionary
∑∑( 2
<
∑∑2 3
string
∑∑3 9
,
∑∑9 :
List
∑∑; ?
<
∑∑? @
CustomTiming
∑∑@ L
>
∑∑L M
>
∑∑M N
(
∑∑N O
)
∑∑O P
;
∑∑P Q
}
∏∏ 
List
∫∫ 
<
∫∫ 
CustomTiming
∫∫ 
>
∫∫ 
result
∫∫ %
;
∫∫% &
lock
ªª 
(
ªª 
CustomTimings
ªª 
)
ªª  
{
ºº 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
CustomTimings
ΩΩ "
.
ΩΩ" #
TryGetValue
ΩΩ# .
(
ΩΩ. /
category
ΩΩ/ 7
,
ΩΩ7 8
out
ΩΩ9 <
result
ΩΩ= C
)
ΩΩC D
)
ΩΩD E
{
ææ 
result
øø 
=
øø 
new
øø  
List
øø! %
<
øø% &
CustomTiming
øø& 2
>
øø2 3
(
øø3 4
)
øø4 5
;
øø5 6
CustomTimings
¿¿ !
[
¿¿! "
category
¿¿" *
]
¿¿* +
=
¿¿, -
result
¿¿. 4
;
¿¿4 5
}
¡¡ 
}
¬¬ 
return
√√ 
result
√√ 
;
√√ 
}
ƒƒ 	
}
≈≈ 
}∆∆ ◊y
]C:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\WebRequestProfilerProvider.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
public 

partial 
class &
WebRequestProfilerProvider 3
:4 5 
BaseProfilerProvider6 J
{ 
public &
WebRequestProfilerProvider )
() *
)* +
{ 	
MiniProfilerHandler 
.  
RegisterRoutes  .
(. /
)/ 0
;0 1
} 	
public 
override 
MiniProfiler $
Start% *
(* +
string+ 1
sessionName2 =
=> ?
null@ D
)D E
{ 	
var 
context 
= 
HttpContext %
.% &
Current& -
;- .
if   
(   
context   
==   
null   
||    "
context  # *
.  * +
Request  + 2
.  2 3/
#AppRelativeCurrentExecutionFilePath  3 V
==  W Y
null  Z ^
)  ^ _
return  ` f
null  g k
;  k l
var"" 
url"" 
="" 
context"" 
."" 
Request"" %
.""% &
Url""& )
;"") *
var## 
path## 
=## 
context## 
.## 
Request## &
.##& '/
#AppRelativeCurrentExecutionFilePath##' J
.##J K
	Substring##K T
(##T U
$num##U V
)##V W
.##W X
ToUpperInvariant##X h
(##h i
)##i j
;##j k
foreach&& 
(&& 
var&& 
ignored&&  
in&&! #
MiniProfiler&&$ 0
.&&0 1
Settings&&1 9
.&&9 :
IgnoredPaths&&: F
??&&G I
new&&J M
string&&N T
[&&T U
$num&&U V
]&&V W
)&&W X
{'' 
if(( 
((( 
path(( 
.(( 
Contains(( !
(((! "
(((" #
ignored((# *
??((+ -
string((. 4
.((4 5
Empty((5 :
)((: ;
.((; <
ToUpperInvariant((< L
(((L M
)((M N
)((N O
)((O P
return)) 
null)) 
;))  
}** 
if,, 
(,, 
context,, 
.,, 
Request,, 
.,,  
Path,,  $
.,,$ %

StartsWith,,% /
(,,/ 0
VirtualPathUtility,,0 B
.,,B C

ToAbsolute,,C M
(,,M N
MiniProfiler,,N Z
.,,Z [
Settings,,[ c
.,,c d
RouteBasePath,,d q
),,q r
,,,r s
StringComparison	,,t Ñ
.
,,Ñ Ö(
InvariantCultureIgnoreCase
,,Ö ü
)
,,ü †
)
,,† °
{-- 
return.. 
null.. 
;.. 
}// 
var11 
result11 
=11 
new11 
MiniProfiler11 )
(11) *
sessionName11* 5
??116 8
url119 <
.11< =
OriginalString11= K
)11K L
;11L M
Current22 
=22 
result22 
;22 
SetProfilerActive44 
(44 
result44 $
)44$ %
;44% &
result77 
.77 
User77 
=77 
Settings77 "
.77" #
UserProvider77# /
.77/ 0
GetUser770 7
(777 8
context778 ?
.77? @
Request77@ G
)77G H
;77H I
return99 
result99 
;99 
}:: 	
[?? 	
Obsolete??	 
(?? 
$str?? v
)??v w
]??w x
public@@ 
override@@ 
MiniProfiler@@ $
Start@@% *
(@@* +
ProfileLevel@@+ 7
level@@8 =
,@@= >
string@@? E
sessionName@@F Q
=@@R S
null@@T X
)@@X Y
{AA 	
varBB 
contextBB 
=BB 
HttpContextBB %
.BB% &
CurrentBB& -
;BB- .
ifCC 
(CC 
contextCC 
==CC 
nullCC 
||CC  "
contextCC# *
.CC* +
RequestCC+ 2
.CC2 3/
#AppRelativeCurrentExecutionFilePathCC3 V
==CCW Y
nullCCZ ^
)CC^ _
returnCC` f
nullCCg k
;CCk l
varEE 
urlEE 
=EE 
contextEE 
.EE 
RequestEE %
.EE% &
UrlEE& )
;EE) *
varFF 
pathFF 
=FF 
contextFF 
.FF 
RequestFF &
.FF& '/
#AppRelativeCurrentExecutionFilePathFF' J
.FFJ K
	SubstringFFK T
(FFT U
$numFFU V
)FFV W
.FFW X
ToUpperInvariantFFX h
(FFh i
)FFi j
;FFj k
foreachII 
(II 
varII 
ignoredII  
inII! #
MiniProfilerII$ 0
.II0 1
SettingsII1 9
.II9 :
IgnoredPathsII: F
??IIG I
newIIJ M
stringIIN T
[IIT U
$numIIU V
]IIV W
)IIW X
{JJ 
ifKK 
(KK 
pathKK 
.KK 
ContainsKK !
(KK! "
(KK" #
ignoredKK# *
??KK+ -
stringKK. 4
.KK4 5
EmptyKK5 :
)KK: ;
.KK; <
ToUpperInvariantKK< L
(KKL M
)KKM N
)KKN O
)KKO P
returnLL 
nullLL 
;LL  
}MM 
ifOO 
(OO 
contextOO 
.OO 
RequestOO 
.OO  
PathOO  $
.OO$ %

StartsWithOO% /
(OO/ 0
VirtualPathUtilityOO0 B
.OOB C

ToAbsoluteOOC M
(OOM N
MiniProfilerOON Z
.OOZ [
SettingsOO[ c
.OOc d
RouteBasePathOOd q
)OOq r
,OOr s
StringComparison	OOt Ñ
.
OOÑ Ö(
InvariantCultureIgnoreCase
OOÖ ü
)
OOü †
)
OO† °
{PP 
returnQQ 
nullQQ 
;QQ 
}RR 
varTT 
resultTT 
=TT 
newTT 
MiniProfilerTT )
(TT) *
sessionNameTT* 5
??TT6 8
urlTT9 <
.TT< =
OriginalStringTT= K
,TTK L
levelTTM R
)TTR S
;TTS T
CurrentUU 
=UU 
resultUU 
;UU 
SetProfilerActiveWW 
(WW 
resultWW $
)WW$ %
;WW% &
resultZZ 
.ZZ 
UserZZ 
=ZZ 
SettingsZZ "
.ZZ" #
UserProviderZZ# /
.ZZ/ 0
GetUserZZ0 7
(ZZ7 8
contextZZ8 ?
.ZZ? @
RequestZZ@ G
)ZZG H
;ZZH I
return\\ 
result\\ 
;\\ 
}]] 	
publicff 
overrideff 
voidff 
Stopff !
(ff! "
boolff" &
discardResultsff' 5
)ff5 6
{gg 	
varhh 
contexthh 
=hh 
HttpContexthh %
.hh% &
Currenthh& -
;hh- .
ifii 
(ii 
contextii 
==ii 
nullii 
)ii  
returnjj 
;jj 
varll 
currentll 
=ll 
Currentll !
;ll! "
ifmm 
(mm 
currentmm 
==mm 
nullmm 
)mm  
returnnn 
;nn 
ifqq 
(qq 
!qq 
StopProfilerqq 
(qq 
currentqq %
)qq% &
)qq& '
returnrr 
;rr 
iftt 
(tt 
discardResultstt 
)tt 
{uu 
Currentvv 
=vv 
nullvv 
;vv 
returnww 
;ww 
}xx 
varzz 
requestzz 
=zz 
contextzz !
.zz! "
Requestzz" )
;zz) *
var{{ 
response{{ 
={{ 
context{{ "
.{{" #
Response{{# +
;{{+ ,

EnsureName~~ 
(~~ 
current~~ 
,~~ 
request~~  '
)~~' (
;~~( )
SaveProfiler
ÅÅ 
(
ÅÅ 
current
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
try
ÉÉ 
{
ÑÑ 
var
ÖÖ 

arrayOfIds
ÖÖ 
=
ÖÖ  
MiniProfiler
ÖÖ! -
.
ÖÖ- .
Settings
ÖÖ. 6
.
ÖÖ6 7
Storage
ÖÖ7 >
.
ÖÖ> ?
GetUnviewedIds
ÖÖ? M
(
ÖÖM N
current
ÖÖN U
.
ÖÖU V
User
ÖÖV Z
)
ÖÖZ [
;
ÖÖ[ \
if
áá 
(
áá 

arrayOfIds
áá 
!=
áá !
null
áá" &
&&
áá' )

arrayOfIds
áá* 4
.
áá4 5
Count
áá5 :
>
áá; <
MiniProfiler
áá= I
.
ááI J
Settings
ááJ R
.
ááR S!
MaxUnviewedProfiles
ááS f
)
ááf g
{
àà 
foreach
ââ 
(
ââ 
var
ââ  
id
ââ! #
in
ââ$ &

arrayOfIds
ââ' 1
.
ââ1 2
Take
ââ2 6
(
ââ6 7

arrayOfIds
ââ7 A
.
ââA B
Count
ââB G
-
ââH I
MiniProfiler
ââJ V
.
ââV W
Settings
ââW _
.
ââ_ `!
MaxUnviewedProfiles
ââ` s
)
ââs t
)
âât u
{
ää 
MiniProfiler
ãã $
.
ãã$ %
Settings
ãã% -
.
ãã- .
Storage
ãã. 5
.
ãã5 6
	SetViewed
ãã6 ?
(
ãã? @
current
ãã@ G
.
ããG H
User
ããH L
,
ããL M
id
ããN P
)
ããP Q
;
ããQ R
}
åå 
}
çç 
if
êê 
(
êê 

arrayOfIds
êê 
!=
êê !
null
êê" &
&&
êê' )

arrayOfIds
êê* 4
.
êê4 5
Count
êê5 :
>
êê; <
$num
êê= >
)
êê> ?
{
ëë 
response
íí 
.
íí 
AppendHeader
íí )
(
íí) *
$str
íí* >
,
íí> ?

arrayOfIds
íí@ J
.
ííJ K
ToJson
ííK Q
(
ííQ R
)
ííR S
)
ííS T
;
ííT U
}
ìì 
}
îî 
catch
ïï 
{
ññ 
}
óó 
}
òò 	
private
ùù 
static
ùù 
void
ùù 

EnsureName
ùù &
(
ùù& '
MiniProfiler
ùù' 3
profiler
ùù4 <
,
ùù< =
HttpRequest
ùù> I
request
ùùJ Q
)
ùùQ R
{
ûû 	
if
†† 
(
†† 
string
†† 
.
††  
IsNullOrWhiteSpace
†† )
(
††) *
profiler
††* 2
.
††2 3
Name
††3 7
)
††7 8
)
††8 9
{
°° 
var
¢¢ 
rc
¢¢ 
=
¢¢ 
request
¢¢  
.
¢¢  !
RequestContext
¢¢! /
;
¢¢/ 0"
RouteValueDictionary
££ $
values
££% +
;
££+ ,
if
•• 
(
•• 
rc
•• 
!=
•• 
null
•• 
&&
•• !
rc
••" $
.
••$ %
	RouteData
••% .
!=
••/ 1
null
••2 6
&&
••7 9
(
••: ;
values
••; A
=
••B C
rc
••D F
.
••F G
	RouteData
••G P
.
••P Q
Values
••Q W
)
••W X
.
••X Y
Count
••Y ^
>
••_ `
$num
••a b
)
••b c
{
¶¶ 
var
ßß 

controller
ßß "
=
ßß# $
values
ßß% +
[
ßß+ ,
$str
ßß, 8
]
ßß8 9
;
ßß9 :
var
®® 
action
®® 
=
®®  
values
®®! '
[
®®' (
$str
®®( 0
]
®®0 1
;
®®1 2
if
™™ 
(
™™ 

controller
™™ "
!=
™™# %
null
™™& *
&&
™™+ -
action
™™. 4
!=
™™5 7
null
™™8 <
)
™™< =
profiler
´´  
.
´´  !
Name
´´! %
=
´´& '

controller
´´( 2
.
´´2 3
ToString
´´3 ;
(
´´; <
)
´´< =
+
´´> ?
$str
´´@ C
+
´´D E
action
´´F L
.
´´L M
ToString
´´M U
(
´´U V
)
´´V W
;
´´W X
}
¨¨ 
if
ÆÆ 
(
ÆÆ 
string
ÆÆ 
.
ÆÆ  
IsNullOrWhiteSpace
ÆÆ -
(
ÆÆ- .
profiler
ÆÆ. 6
.
ÆÆ6 7
Name
ÆÆ7 ;
)
ÆÆ; <
)
ÆÆ< =
{
ØØ 
profiler
∞∞ 
.
∞∞ 
Name
∞∞ !
=
∞∞" #
request
∞∞$ +
.
∞∞+ ,
Url
∞∞, /
.
∞∞/ 0
AbsolutePath
∞∞0 <
??
∞∞= ?
string
∞∞@ F
.
∞∞F G
Empty
∞∞G L
;
∞∞L M
if
±± 
(
±± 
profiler
±±  
.
±±  !
Name
±±! %
.
±±% &
Length
±±& ,
>
±±- .
$num
±±/ 1
)
±±1 2
profiler
≤≤  
.
≤≤  !
Name
≤≤! %
=
≤≤& '
profiler
≤≤( 0
.
≤≤0 1
Name
≤≤1 5
.
≤≤5 6
Remove
≤≤6 <
(
≤≤< =
$num
≤≤= ?
)
≤≤? @
;
≤≤@ A
}
≥≥ 
}
¥¥ 
}
µµ 	
public
∫∫ 
override
∫∫ 
MiniProfiler
∫∫ $ 
GetCurrentProfiler
∫∫% 7
(
∫∫7 8
)
∫∫8 9
{
ªª 	
return
ºº 
Current
ºº 
;
ºº 
}
ΩΩ 	
private
¿¿ 
const
¿¿ 
string
¿¿ 
CacheKey
¿¿ %
=
¿¿& '
$str
¿¿( 9
;
¿¿9 :
private
≈≈ 
MiniProfiler
≈≈ 
Current
≈≈ $
{
∆∆ 	
get
«« 
{
»» 
var
…… 
context
…… 
=
…… 
HttpContext
…… )
.
……) *
Current
……* 1
;
……1 2
if
   
(
   
context
   
==
   
null
   #
)
  # $
return
  % +
null
  , 0
;
  0 1
return
ÃÃ 
context
ÃÃ 
.
ÃÃ 
Items
ÃÃ $
[
ÃÃ$ %
CacheKey
ÃÃ% -
]
ÃÃ- .
as
ÃÃ/ 1
MiniProfiler
ÃÃ2 >
;
ÃÃ> ?
}
ÕÕ 
set
ŒŒ 
{
œœ 
var
–– 
context
–– 
=
–– 
HttpContext
–– )
.
––) *
Current
––* 1
;
––1 2
if
—— 
(
—— 
context
—— 
==
—— 
null
—— #
)
——# $
return
——% +
;
——+ ,
context
”” 
.
”” 
Items
”” 
[
”” 
CacheKey
”” &
]
””& '
=
””( )
value
””* /
;
””/ 0
}
‘‘ 
}
’’ 	
}
÷÷ 
}◊◊ ø
fC:\Repos\SmallApps\WebAdapterSimplified\StackExchange.Profiling\WebRequestProfilerProvider.Settings.cs
	namespace 	
StackExchange
 
. 
	Profiling !
{ 
partial 
class &
WebRequestProfilerProvider ,
{ 
public 
static 
class 
Settings $
{		 	
static 
IUserProvider  
provider! )
=* +
new, /
IpAddressIdentity0 A
(A B
)B C
;C D
public 
static 
IUserProvider '
UserProvider( 4
{ 
get 
{ 
return 
provider #
;# $
} 
set 
{ 
provider 
= 
value $
;$ %
} 
} 
} 	
} 
} 